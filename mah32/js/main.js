/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
"undefined"==typeof _pio&&(_pio={});
(function(){_pio.channel=function(){};_pio.channel.prototype.call=function(a,g,d,e,c){var b="undefined"!=typeof PLAYERIO_API_HOST?PLAYERIO_API_HOST:(PlayerIO.useSecureApiRequests?"https":"http")+"://api.playerio.com/json/",f=new XMLHttpRequest;"withCredentials"in f?f.open("post",b,!0):"undefined"!=typeof XDomainRequest?(f=new XDomainRequest,f.open("post",b)):f=new _pio.flashWebRequest("post",b);var h=Error();null!=f?(f.send("["+a+"|"+(this.token||"")+"]"+JSON.stringify(g)),f.onload=function(){var b=
null;try{var a=f.response||f.responseText;if("["==a[0]){var g=a.indexOf("]");this.token=a.substring(1,g);a=a.substring(g+1)}b=JSON.parse(a)}catch(n){_pio.handleError(h,e,PlayerIOErrorCode.GeneralError,"Error decoding response from webservice: "+n);return}if("undefined"==typeof b.errorcode&&"undefined"==typeof b.message){a=b;if(c)try{a=c(b)}catch(n){_pio.handleError(h,e,n.code,n.message)}d&&d(a)}else _pio.handleError(h,e,b.errorcode,b.message)},f.onerror=function(b){_pio.handleError(h,e,PlayerIOErrorCode.GeneralError,
"Error talking to webservice: "+JSON.stringify(b))}):_pio.handleError(h,e,PlayerIOErrorCode.GeneralError,"Need to implement flash calling")};_pio.runCallback=function(a,g,d){try{a&&a(g)}catch(e){a="Unhandled error in callback: "+e.message,a=a+"\nStack:\n"+(e.stack||e.stacktrace||e.StackTrace),d&&(a=a+"\nCallsite stack:\n"+(d.stack||d.stacktrace||d.StackTrace)),console.log(a)}};_pio.handleError=function(a,g,d,e){d=_pio.error(d,e);a&&(a.stack&&(d.stack=a.stack),a.stacktrace&&(d.stacktrace=a.stacktrace),
a.StackTrace&&(d.StackTrace=a.StackTrace));g?_pio.runCallback(g,d,a):"undefined"!=typeof console?console.log("No error callback specified for: "+d.code+": "+d.message+"\n"+(d.stack||d.stacktrace||d.StackTrace)):alert("No error callback specified for: "+d.code+": "+d.message+"\n"+(d.stack||d.stacktrace||d.StackTrace))};_pio.error=function(a,g){1==arguments.length&&(g=a,a=PlayerIOErrorCode.GeneralError);"number"==typeof a&&(a=PlayerIOErrorCode.codes[a]);if("string"!=typeof a)throw console.log(a,g,Error().stack),
"Code must be a string!";var d=Error();return new PlayerIOError(a,g,d.stack||d.stacktrace||d.StackTrace)};_pio.debugLog=function(a){"undefined"!=typeof console&&console.log(a)};_pio.convertToKVArray=function(a){var g=[];if(a)for(var d in a)g.push({key:""+d,value:""+a[d]});return g};_pio.convertFromKVArray=function(a){var g={};if(a&&a.length)for(var d in a)g[a[d].key]=a[d].value;return g};_pio.convertToSegmentArray=function(a){var g=[];if(a)for(var d in a)g.push(d+":"+a[d]);return g}})();
PlayerIO={useSecureApiRequests:!1,authenticate:function(a,g,d,e,c,b){if("auto"==d.publishingnetworklogin)"undefined"==typeof window.PublishingNetwork?b(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Could not find the PublishingNetwork object on the current page. Did you include the PublishingNetwork.js script?")):PublishingNetwork.dialog("login",{gameId:a,connectionId:g,__use_usertoken__:!0},function(f){f.error?b(new PlayerIOError(PlayerIOErrorCode.GeneralError,f.error)):"undefined"==typeof f.userToken?
b(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Missing userToken value in result, but no error message given.")):PlayerIO.authenticate(a,g,{userToken:f.userToken},e,c,b)});else{var f=new _pio.channel;f.authenticate(a,g,_pio.convertToKVArray(d),_pio.convertToSegmentArray(e),"javascript",_pio.convertToKVArray({}),null,c,b,function(b){f.token=b.token;return new _pio.client(f,a,b.gamefsredirectmap,b.userid)})}},quickConnect:null,gameFS:function(a){return new _pio.gameFS(a)}};var JSON;
JSON||(JSON={});
(function(){function a(b){return 10>b?"0"+b:b}function g(b){c.lastIndex=0;return c.test(b)?'"'+b.replace(c,function(b){var c=h[b];return"string"===typeof c?c:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function d(c,h){var a,e=b,k=h[c];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(c));"function"===typeof l&&(k=l.call(h,c,k));switch(typeof k){case "string":return g(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);case "object":if(!k)return"null";
b+=f;var m=[];if("[object Array]"===Object.prototype.toString.apply(k)){var r=k.length;for(a=0;a<r;a+=1)m[a]=d(a,k)||"null";var x=0===m.length?"[]":b?"[\n"+b+m.join(",\n"+b)+"\n"+e+"]":"["+m.join(",")+"]";b=e;return x}if(l&&"object"===typeof l)for(r=l.length,a=0;a<r;a+=1){if("string"===typeof l[a]){var y=l[a];(x=d(y,k))&&m.push(g(y)+(b?": ":":")+x)}}else for(y in k)Object.prototype.hasOwnProperty.call(k,y)&&(x=d(y,k))&&m.push(g(y)+(b?": ":":")+x);x=0===m.length?"{}":b?"{\n"+b+m.join(",\n"+b)+"\n"+
e+"}":"{"+m.join(",")+"}";b=e;return x}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(b){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,f,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(c,a,h){var e;f=b="";if("number"===typeof h)for(e=0;e<h;e+=1)f+=" ";else"string"===typeof h&&(f=h);if((l=a)&&"function"!==typeof a&&("object"!==typeof a||"number"!==typeof a.length))throw Error("JSON.stringify");return d("",{"":c})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function f(b,d){var a,h=b[d];if(h&&"object"===typeof h)for(a in h)if(Object.prototype.hasOwnProperty.call(h,a)){var e=f(h,a);void 0!==e?h[a]=e:delete h[a]}return c.call(b,d,h)}b=String(b);e.lastIndex=0;e.test(b)&&(b=b.replace(e,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var d=eval("("+b+")");return"function"===typeof c?f({"":d},""):d}throw new SyntaxError("JSON.parse");})})();
(function(){function a(d){if(null!=c)d(c);else if(b)d(null);else if(null==f){f=[d];var a=setInterval(function(){var b=g();null!=b&&h(b)},50);setTimeout(function(){null==c&&h(null)},3E4);var h=function(d){c=d;b=null==d;clearInterval(a);for(var h=0;h!=f.length;h++)f[h](d)}}else f.push(d)}function g(){var b='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="10" height="10" style="$style$" id="$id$">\t<param name="movie" value="$src$" />\t<param name="allowNetworking" value="all" />\t<param name="allowScriptAccess" value="always" />\t\x3c!--[if !IE]>--\x3e\t<object type="application/x-shockwave-flash" data="$src$" width="10" height="10" style="$style$">\t\t<param name="allowNetworking" value="all" />\t\t<param name="allowScriptAccess" value="always" />\t</object>\t\x3c!--<![endif]--\x3e</object>'.replace(/\$id\$/gi,"__pio_flashfallback__");
b=b.replace(/\$src\$/gi,"http://192.168.30.154/html5client/FlashFallback/bin-debug/FlashFallback.swf");b=b.replace(/\$style\$/gi,"width:10px;height:10px");var c=document.getElementById("containerId");if(!c){var f=document.createElement("div");f.setAttribute("id",c);f.setAttribute("style","position:absolute;top:-20px;left:-20px");f.innerHTML=b;try{document.body.appendChild(f)}catch(m){}}b=function(b){b=document.getElementsByTagName(b);for(var c=0;c!=b.length;c++)if(b[c].ping&&"pong"==b[c].ping())return b[c]};
return b("embed")||b("object")}var d={},e=0;__pio_flashfallback_callback__=function(){var b=d[arguments[0]];if(b){for(var c=[],f=1;f!=arguments.length;f++)c[f-1]=arguments[f];b.apply(null,c)}};_pio.flashWebRequest=function(b,c){var f=this;this.response=null;this.onload=function(){};this.onerror=function(){};this.send=function(h){a(function(a){if(null==a)f.onerror("Browser does not support Cross-Origin (CORS) webrequest or Flash as a fallback method");else{var g="cb"+e++;d[g]=function(b,c){delete d[g];
if(b)f.response=c,f.onload();else f.onerror(c)};a.webrequest(g,b,c,h)}})}};_pio.flashSocketConnection=function(b,c,f,g,n){var h="cb"+e++,l=this,k=new _pio.messageSerializer,m=!1,x=!1,y=setTimeout(function(){m||(m=!0,f(!1,"Connect attempt timed out"))},c);this.disconnect=function(){console.log("... this shouldn't happen")};this.sendMessage=function(b){console.log("... send msg. this shouldn't happen")};a(function(c){null==c?(m=!0,f(!1,"Browser does not support WebSocket connections and the Flash fallback failed.")):
(d[h]=function(b,d){switch(b){case "onopen":m||(clearTimeout(y),x=m=!0,c.socketSend(h,[0]),f(x));break;case "onclose":l.disconnect();break;case "onerror":l.disconnect();break;case "onmessage":n(k.deserializeMessage(d,0,d.length))}},l.disconnect=function(){if(x){x=!1;g();try{c.socketClose(h)}catch(B){_pio.debugLog(B)}}},l.sendMessage=function(b){b=k.serializeMessage(b);c.socketSend(h,b)},c.socketConnection(h,b))})};_pio.isFlashFallbackEnabled=function(b){a(function(c){b(null!=c)})};var c=null,b=!1,
f=null})();
(function(){var a=_pio.channel.prototype;a.connect=function(a,d,e,c,b,f,h,l,k,m,n){this.call(10,{gameid:a,connectionid:d,userid:e,auth:c,partnerid:b,playerinsightsegments:f,clientapi:h,clientinfo:l},k,m,n)};_pio.ApiSecurityRule={RespectClientSetting:0,UseHttp:1,UseHttps:2};a.authenticate=function(a,d,e,c,b,f,h,l,k,m){this.call(13,{gameid:a,connectionid:d,authenticationarguments:e,playerinsightsegments:c,clientapi:b,clientinfo:f,playcodes:h},l,k,m)};a.createRoom=function(a,d,e,c,b,f,h,l){this.call(21,{roomid:a,
roomtype:d,visible:e,roomdata:c,isdevroom:b},f,h,l)};a.joinRoom=function(a,d,e,c,b,f){this.call(24,{roomid:a,joindata:d,isdevroom:e},c,b,f)};a.createJoinRoom=function(a,d,e,c,b,f,h,l,k){this.call(27,{roomid:a,roomtype:d,visible:e,roomdata:c,joindata:b,isdevroom:f},h,l,k)};a.listRooms=function(a,d,e,c,b,f,h,l){this.call(30,{roomtype:a,searchcriteria:d,resultlimit:e,resultoffset:c,onlydevrooms:b},f,h,l)};a.userLeftRoom=function(a,d,e,c,b,f){this.call(40,{extendedroomid:a,newplayercount:d,closed:e},
c,b,f)};a.writeError=function(a,d,e,c,b,f,h,l){this.call(50,{source:a,error:d,details:e,stacktrace:c,extradata:b},f,h,l)};a.updateRoom=function(a,d,e,c,b,f){this.call(53,{extendedroomid:a,visible:d,roomdata:e},c,b,f)};_pio.ValueType={String:0,Int:1,UInt:2,Long:3,Bool:4,Float:5,Double:6,ByteArray:7,DateTime:8,Array:9,Obj:10};a.createObjects=function(a,d,e,c,b){this.call(82,{objects:a,loadexisting:d},e,c,b)};a.loadObjects=function(a,d,e,c){this.call(85,{objectids:a},d,e,c)};_pio.LockType={NoLocks:0,
LockIndividual:1,LockAll:2};a.saveObjectChanges=function(a,d,e,c,b,f){this.call(88,{locktype:a,changesets:d,createifmissing:e},c,b,f)};a.deleteObjects=function(a,d,e,c){this.call(91,{objectids:a},d,e,c)};a.loadMatchingObjects=function(a,d,e,c,b,f,h){this.call(94,{table:a,index:d,indexvalue:e,limit:c},b,f,h)};a.loadIndexRange=function(a,d,e,c,b,f,h,l){this.call(97,{table:a,index:d,startindexvalue:e,stopindexvalue:c,limit:b},f,h,l)};a.deleteIndexRange=function(a,d,e,c,b,f,h){this.call(100,{table:a,
index:d,startindexvalue:e,stopindexvalue:c},b,f,h)};a.loadMyPlayerObject=function(a,d,e){this.call(103,{},a,d,e)};a.payVaultReadHistory=function(a,d,e,c,b,f){this.call(160,{page:a,pagesize:d,targetuserid:e},c,b,f)};a.payVaultRefresh=function(a,d,e,c,b){this.call(163,{lastversion:a,targetuserid:d},e,c,b)};a.payVaultConsume=function(a,d,e,c,b){this.call(166,{ids:a,targetuserid:d},e,c,b)};a.payVaultCredit=function(a,d,e,c,b,f){this.call(169,{amount:a,reason:d,targetuserid:e},c,b,f)};a.payVaultDebit=
function(a,d,e,c,b,f){this.call(172,{amount:a,reason:d,targetuserid:e},c,b,f)};a.payVaultBuy=function(a,d,e,c,b,f){this.call(175,{items:a,storeitems:d,targetuserid:e},c,b,f)};a.payVaultGive=function(a,d,e,c,b){this.call(178,{items:a,targetuserid:d},e,c,b)};a.payVaultPaymentInfo=function(a,d,e,c,b,f){this.call(181,{provider:a,purchasearguments:d,items:e},c,b,f)};a.payVaultUsePaymentInfo=function(a,d,e,c,b){this.call(184,{provider:a,providerarguments:d},e,c,b)};a.partnerPayTrigger=function(a,d,e,c,
b){this.call(200,{key:a,count:d},e,c,b)};a.partnerPaySetTag=function(a,d,e,c){this.call(203,{partnerid:a},d,e,c)};a.notificationsRefresh=function(a,d,e,c){this.call(213,{lastversion:a},d,e,c)};a.notificationsRegisterEndpoints=function(a,d,e,c,b){this.call(216,{lastversion:a,endpoints:d},e,c,b)};a.notificationsSend=function(a,d,e,c){this.call(219,{notifications:a},d,e,c)};a.notificationsToggleEndpoints=function(a,d,e,c,b,f){this.call(222,{lastversion:a,endpoints:d,enabled:e},c,b,f)};a.notificationsDeleteEndpoints=
function(a,d,e,c,b){this.call(225,{lastversion:a,endpoints:d},e,c,b)};a.gameRequestsSend=function(a,d,e,c,b,f){this.call(241,{requesttype:a,requestdata:d,requestrecipients:e},c,b,f)};a.gameRequestsRefresh=function(a,d,e,c){this.call(244,{playcodes:a},d,e,c)};a.gameRequestsDelete=function(a,d,e,c){this.call(247,{requestids:a},d,e,c)};a.achievementsRefresh=function(a,d,e,c){this.call(271,{lastversion:a},d,e,c)};a.achievementsLoad=function(a,d,e,c){this.call(274,{userids:a},d,e,c)};a.achievementsProgressSet=
function(a,d,e,c,b){this.call(277,{achievementid:a,progress:d},e,c,b)};a.achievementsProgressAdd=function(a,d,e,c,b){this.call(280,{achievementid:a,progressdelta:d},e,c,b)};a.achievementsProgressMax=function(a,d,e,c,b){this.call(283,{achievementid:a,progress:d},e,c,b)};a.achievementsProgressComplete=function(a,d,e,c){this.call(286,{achievementid:a},d,e,c)};a.playerInsightRefresh=function(a,d,e){this.call(301,{},a,d,e)};a.playerInsightSetSegments=function(a,d,e,c){this.call(304,{segments:a},d,e,c)};
a.playerInsightTrackInvitedBy=function(a,d,e,c,b){this.call(307,{invitinguserid:a,invitationchannel:d},e,c,b)};a.playerInsightTrackEvents=function(a,d,e,c){this.call(311,{events:a},d,e,c)};a.playerInsightTrackExternalPayment=function(a,d,e,c,b){this.call(314,{currency:a,amount:d},e,c,b)};a.playerInsightSessionKeepAlive=function(a,d,e){this.call(317,{},a,d,e)};a.playerInsightSessionStop=function(a,d,e){this.call(320,{},a,d,e)};a.oneScoreLoad=function(a,d,e,c){this.call(351,{userids:a},d,e,c)};a.oneScoreSet=
function(a,d,e,c){this.call(354,{score:a},d,e,c)};a.oneScoreAdd=function(a,d,e,c){this.call(357,{score:a},d,e,c)};a.oneScoreRefresh=function(a,d,e){this.call(360,{},a,d,e)};a.simpleConnect=function(a,d,e,c,b,f,h,l,k){this.call(400,{gameid:a,usernameoremail:d,password:e,playerinsightsegments:c,clientapi:b,clientinfo:f},h,l,k)};a.simpleRegister=function(a,d,e,c,b,f,h,l,k,m,n,q,t,w){this.call(403,{gameid:a,username:d,password:e,email:c,captchakey:b,captchavalue:f,extradata:h,partnerid:l,playerinsightsegments:k,
clientapi:m,clientinfo:n},q,t,w)};a.simpleRecoverPassword=function(a,d,e,c,b){this.call(406,{gameid:a,usernameoremail:d},e,c,b)};a.kongregateConnect=function(a,d,e,c,b,f,h,l,k){this.call(412,{gameid:a,userid:d,gameauthtoken:e,playerinsightsegments:c,clientapi:b,clientinfo:f},h,l,k)};a.simpleGetCaptcha=function(a,d,e,c,b,f){this.call(415,{gameid:a,width:d,height:e},c,b,f)};a.facebookOAuthConnect=function(a,d,e,c,b,f,h,l,k){this.call(418,{gameid:a,accesstoken:d,partnerid:e,playerinsightsegments:c,clientapi:b,
clientinfo:f},h,l,k)};a.steamConnect=function(a,d,e,c,b,f,h,l,k){this.call(421,{gameid:a,steamappid:d,steamsessionticket:e,playerinsightsegments:c,clientapi:b,clientinfo:f},h,l,k)};a.simpleUserGetSecureLoginInfo=function(a,d,e){this.call(424,{},a,d,e)};a.joinCluster=function(a,d,e,c,b,f,h,l,k,m,n,q,t,w,r,x,y){this.call(504,{clusteraccesskey:a,isdevelopmentserver:d,ports:e,machinename:c,version:b,machineid:f,os:h,cpu:l,cpucores:k,cpulogicalcores:m,cpuaddresswidth:n,cpumaxclockspeed:q,rammegabytes:t,
ramspeed:w},r,x,y)};a.serverHeartbeat=function(a,d,e,c,b,f,h,l,k,m,n,q,t,w,r,x,y,C,B,O){this.call(510,{serverid:a,appdomains:d,servertypes:e,machinecpu:c,processcpu:b,memoryusage:f,avaliablememory:h,freememory:l,runningrooms:k,usedresources:m,apirequests:n,apirequestserror:q,apirequestsfailed:t,apirequestsexecuting:w,apirequestsqueued:r,apirequeststime:x,serverunixtimeutc:y},C,B,O)};a.getGameAssemblyUrl=function(a,d,e,c,b,f){this.call(513,{clusteraccesskey:a,gamecodeid:d,machineid:e},c,b,f)};a.devServerLogin=
function(a,d,e,c,b){this.call(524,{username:a,password:d},e,c,b)};a.webserviceOnlineTest=function(a,d,e){this.call(533,{},a,d,e)};a.getServerInfo=function(a,d,e,c){this.call(540,{machineid:a},d,e,c)};a.socialRefresh=function(a,d,e){this.call(601,{},a,d,e)};a.socialLoadProfiles=function(a,d,e,c){this.call(604,{userids:a},d,e,c)}})();
PlayerIOError=function(a,g,d){this.code=a;this.message=g;this.stack=d;this.stack||(d=Error(),this.stack=d.stack||d.stacktrace||d.StackTrace);this.toString=function(){return"PlayerIOError["+a+"]: "+g}};PlayerIOError.prototype=Error();
PlayerIOErrorCode={UnsupportedMethod:"UnsupportedMethod",GeneralError:"GeneralError",InternalError:"InternalError",AccessDenied:"AccessDenied",InvalidMessageFormat:"InvalidMessageFormat",MissingValue:"MissingValue",GameRequired:"GameRequired",ExternalError:"ExternalError",ArgumentOutOfRange:"ArgumentOutOfRange",GameDisabled:"GameDisabled",UnknownGame:"UnknownGame",UnknownConnection:"UnknownConnection",InvalidAuth:"InvalidAuth",NoServersAvailable:"NoServersAvailable",RoomDataTooLarge:"RoomDataTooLarge",
RoomAlreadyExists:"RoomAlreadyExists",UnknownRoomType:"UnknownRoomType",UnknownRoom:"UnknownRoom",MissingRoomId:"MissingRoomId",RoomIsFull:"RoomIsFull",NotASearchColumn:"NotASearchColumn",QuickConnectMethodNotEnabled:"QuickConnectMethodNotEnabled",UnknownUser:"UnknownUser",InvalidPassword:"InvalidPassword",InvalidRegistrationData:"InvalidRegistrationData",InvalidBigDBKey:"InvalidBigDBKey",BigDBObjectTooLarge:"BigDBObjectTooLarge",BigDBObjectDoesNotExist:"BigDBObjectDoesNotExist",UnknownTable:"UnknownTable",
UnknownIndex:"UnknownIndex",InvalidIndexValue:"InvalidIndexValue",NotObjectCreator:"NotObjectCreator",KeyAlreadyUsed:"KeyAlreadyUsed",StaleVersion:"StaleVersion",CircularReference:"CircularReference",HeartbeatFailed:"HeartbeatFailed",InvalidGameCode:"InvalidGameCode",VaultNotLoaded:"VaultNotLoaded",UnknownPayVaultProvider:"UnknownPayVaultProvider",DirectPurchaseNotSupportedByProvider:"DirectPurchaseNotSupportedByProvider",BuyingCoinsNotSupportedByProvider:"BuyingCoinsNotSupportedByProvider",NotEnoughCoins:"NotEnoughCoins",
ItemNotInVault:"ItemNotInVault",InvalidPurchaseArguments:"InvalidPurchaseArguments",InvalidPayVaultProviderSetup:"InvalidPayVaultProviderSetup",UnknownPartnerPayAction:"UnknownPartnerPayAction",InvalidType:"InvalidType",IndexOutOfBounds:"IndexOutOfBounds",InvalidIdentifier:"InvalidIdentifier",InvalidArgument:"InvalidArgument",LoggedOut:"LoggedOut",InvalidSegment:"InvalidSegment",GameRequestsNotLoaded:"GameRequestsNotLoaded",AchievementsNotLoaded:"AchievementsNotLoaded",UnknownAchievement:"UnknownAchievement",
NotificationsNotLoaded:"NotificationsNotLoaded",InvalidNotificationsEndpoint:"InvalidNotificationsEndpoint",NetworkIssue:"NetworkIssue",OneScoreNotLoaded:"OneScoreNotLoaded",PublishingNetworkNotAvailable:"PublishingNetworkNotAvailable",PublishingNetworkNotLoaded:"PublishingNetworkNotLoaded",DialogClosed:"DialogClosed",AdTrackCheckCookie:"AdTrackCheckCookie",codes:{0:"UnsupportedMethod",1:"GeneralError",2:"InternalError",3:"AccessDenied",4:"InvalidMessageFormat",5:"MissingValue",6:"GameRequired",7:"ExternalError",
8:"ArgumentOutOfRange",9:"GameDisabled",10:"UnknownGame",11:"UnknownConnection",12:"InvalidAuth",13:"NoServersAvailable",14:"RoomDataTooLarge",15:"RoomAlreadyExists",16:"UnknownRoomType",17:"UnknownRoom",18:"MissingRoomId",19:"RoomIsFull",20:"NotASearchColumn",21:"QuickConnectMethodNotEnabled",22:"UnknownUser",23:"InvalidPassword",24:"InvalidRegistrationData",25:"InvalidBigDBKey",26:"BigDBObjectTooLarge",27:"BigDBObjectDoesNotExist",28:"UnknownTable",29:"UnknownIndex",30:"InvalidIndexValue",31:"NotObjectCreator",
32:"KeyAlreadyUsed",33:"StaleVersion",34:"CircularReference",40:"HeartbeatFailed",41:"InvalidGameCode",50:"VaultNotLoaded",51:"UnknownPayVaultProvider",52:"DirectPurchaseNotSupportedByProvider",54:"BuyingCoinsNotSupportedByProvider",55:"NotEnoughCoins",56:"ItemNotInVault",57:"InvalidPurchaseArguments",58:"InvalidPayVaultProviderSetup",70:"UnknownPartnerPayAction",80:"InvalidType",81:"IndexOutOfBounds",82:"InvalidIdentifier",83:"InvalidArgument",84:"LoggedOut",90:"InvalidSegment",100:"GameRequestsNotLoaded",
110:"AchievementsNotLoaded",111:"UnknownAchievement",120:"NotificationsNotLoaded",121:"InvalidNotificationsEndpoint",130:"NetworkIssue",131:"OneScoreNotLoaded",200:"PublishingNetworkNotAvailable",201:"PublishingNetworkNotLoaded",301:"DialogClosed",302:"AdTrackCheckCookie"}};
(function(){_pio.client=function(a,g,d,e){this.connectUserId=e;this.gameId=g;this.gameFS=new _pio.gameFS(g,d);this.errorLog=new _pio.errorLog(a);this.payVault=new _pio.payVault(a);this.bigDB=new _pio.bigDB(a);this.multiplayer=new _pio.multiplayer(a);this.gameRequests=new _pio.gameRequests(a);this.achievements=new _pio.achievements(a);this.playerInsight=new _pio.playerInsight(a);this.oneScore=new _pio.oneScore(a);this.notifications=new _pio.notifications(a);this.publishingNetwork=new _pio.publishingNetwork(a,
this.connectUserId)}})();
(function(){var a={};_pio.gameFS=function(g,d){if("string"==typeof d&&0<d.length){var e=(d||"").split("|");if(1<=e.length)for(var c=a[g.toLowerCase()]={},b=0;b!=e.length;b++){var f=e[b];"alltoredirect"==f||"cdnmap"==f?c.baseUrl=e[b+1]:"alltoredirectsecure"==f||"cdnmapsecure"==f?c.secureBaseUrl=e[b+1]:c["."+f]=e[b+1]}}this.getUrl=function(b,c){if("/"==!b[0])throw _pio.error("The path given to getUrl must start with a slash, like: '/myfile.swf' or '/folder/file.jpg'");var f=a[g];return f?(c?f.secureBaseUrl:
f.baseUrl)+(f["."+b]||b):(c?"https":"http")+"://r.playerio.com/r/"+g+b}}})();
(function(){_pio.gameRequests=function(a){function g(c){if(null==c||0==c.length)return[];for(var b=[],f=0;f!=c.length;f++){var a=c[f];b.push(new _pio.gameRequest(a.id,a.type,a.senderuserid,a.created,a.data))}return b}var d=[];this.waitingRequests="[ERROR: You tried to access gameRequests.waitingRequests before loading waiting requests. You have to call the refresh method first.]";var e=this;this.send=function(c,b,f,d,e){a.gameRequestsSend(c,_pio.convertToKVArray(b),f,d,e,function(b){})};this.refresh=
function(c,b){a.gameRequestsRefresh(d,c,b,function(b){e._playCodes=b.newplaycodes;e.waitingRequests=g(b.requests)})};this["delete"]=function(c,b,f){if("object"==typeof c||c.length){for(var d=[],l=0;l!=c.length;l++){var k=c[l].id;if(k)d.push(k);else{c=_pio.error("No GameRequest id found on item#"+l+". You have to use requests from the gameRequests.waitingRequests array. For instance: client.gameRequests.delete(client.gameRequests.waitingRequests, ...)");_pio.handleError(c,f,c.code,c.message);return}}a.gameRequestsDelete(d,
b,f,function(b){e.waitingRequests=g(b.requests)})}else c=_pio.error("The first argument to delete should be an array: client.gameRequests.delete([requests], ...)"),_pio.handleError(c,f,c.code,c.message)}};_pio.gameRequest=function(a,g,d,e,c){this.id=a;this.type=g;this.senderUserId=d;this.created=new Date(e);this.data=_pio.convertFromKVArray(c)}})();(function(){_pio.errorLog=function(a){this.writeError=function(g,d,e,c){a.writeError("Javascript",g,d,e,_pio.convertToKVArray(c))}}})();
(function(){_pio.quickConnect=function(){this.simpleGetCaptcha=function(a,g,d,e,c){(new _pio.channel).simpleGetCaptcha(a,g,d,e,c,function(b){return new _pio.simpleGetCaptchaOutput(b.captchakey,b.captchaimageurl)})};this.simpleRecoverPassword=function(a,g,d,e){(new _pio.channel).simpleRecoverPassword(a,g,d,e,function(c){})}};_pio.simpleGetCaptchaOutput=function(a,g){this.captchaKey=a;this.captchaImageUrl=g};PlayerIO.quickConnect=new _pio.quickConnect})();
(function(){_pio.payVault=function(a){function g(c){if(null!=c&&(d=c.version,e.coins=c.coins||0,e.items=[],c.items&&c.items.length))for(var b=0;b!=c.items.length;b++){var f=c.items[b],a=e.items[b]=new _pio.vaultItem(f.id,f.itemkey,(new Date).setTime(f.purchasedate));_pio.bigDBDeserialize(f.properties,a,!0)}}var d=null;this.coins="[ERROR: you tried to access payVault.coins before the vault was loaded. You have to refresh the vault before the .coins property is set to the right value]";this.items="[ERROR: you tried to access payVault.items before the vault was loaded. You have to refresh the vault before the .items property is set to the right value]";
this.has=function(c){if(null==d)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var b=0;b!=this.items.length;b++)if(this.items[b].itemKey==c)return!0;return!1};this.first=function(c){if(null==d)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var b=0;b!=this.items.length;b++)if(this.items[b].itemKey==c)return this.items[b];
return null};this.count=function(c){if(null==d)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var b=0,f=0;f!=this.items.length;f++)this.items[f].itemKey==c&&b++;return b};this.refresh=function(c,b){a.payVaultRefresh(d,null,c,b,function(b){g(b.vaultcontents)})};this.readHistory=function(c,b,f,d){a.payVaultReadHistory(c,b,null,f,d,function(b){for(var c=[],f=0;f!=b.entries.length;f++){var a=b.entries[f];
c.push(new _pio.payVaultHistoryEntry(a.type,a.amount,a.timestamp,a.itemkeys||[],a.reason,a.providertransactionid,a.providerprice))}return c})};this.credit=function(c,b,f,d){a.payVaultCredit(c,b,null,f,d,function(b){g(b.vaultcontents)})};this.debit=function(c,b,f,d){a.payVaultDebit(c,b,null,f,d,function(b){g(b.vaultcontents)})};this.consume=function(c,b,f){if("object"==typeof c||c.length){for(var d=[],e=0;e!=c.length;e++){var k=c[e].id;if(k)d.push(k);else{c=_pio.error("No PayVault item id found on item#"+
e+". You have to use items from the payVault.items array. For instance: client.payVault.consume([client.payVault.first('sportscar')], ...)");_pio.handleError(c,f,c.code,c.message);return}}a.payVaultConsume(d,null,b,f,function(b){g(b.vaultcontents)})}else c=_pio.error("The first argument to consume should be an array: client.payVault.consume([item], ...)"),_pio.handleError(c,f,c.code,c.message)};this.buy=function(c,b,f,d){a.payVaultBuy(_pio.convertBuyItems(c),b,null,f,d,function(b){g(b.vaultcontents)})};
this.give=function(c,b,f){a.payVaultGive(_pio.convertBuyItems(c),null,b,f,function(b){g(b.vaultcontents)})};this.getBuyCoinsInfo=function(c,b,f,d){a.payVaultPaymentInfo(c,_pio.convertToKVArray(b),null,f,d,function(b){return _pio.convertFromKVArray(b.providerarguments)})};this.getBuyDirectInfo=function(c,b,f,d,e){a.payVaultPaymentInfo(c,_pio.convertToKVArray(b),_pio.convertBuyItems(f),d,e,function(b){return _pio.convertFromKVArray(b.providerarguments)})};var e=this};_pio.convertBuyItems=function(a){if(null==
a)return[];for(var g=[],d=0;d!=a.length;d++){var e=a[d].itemkey;if(!e)throw _pio.error("You have to specify an itemkey for the payvault item. Example:  {itemkey:'car'}");g.push({itemkey:e,payload:_pio.compareForChanges({itemkey:e},a[d],!0,!0)})}return g};_pio.vaultItem=function(a,g,d){this.id=a;this.itemKey=g;this.purchaseDate=d};_pio.payVaultHistoryEntry=function(a,g,d,e,c,b,f){this.type=a;this.amount=g;this.timestamp=(new Date).setTime(d);this.itemKeys=e;this.reason=c;this.providerTransactionId=
b;this.providerPrice=f}})();
(function(){_pio.bigDB=function(a){function g(){for(var b=0;b<c.length;b++){var f=c[b],a=!0,d;for(d in f.objects)if(f.objects[d]._internal_("get-is-saving")){a=!1;break}if(a){for(d in f.objects)for(a=b+1;a<c.length;a++){futureSave=c[a];for(var e=0;e<futureSave.objects.length;e++)futureSave.objects[e]==f.objects[d]&&futureSave.fullOverwrite==f.fullOverwrite&&futureSave.useOptimisticLock==f.useOptimisticLock&&(f.changesets[d]=futureSave.changesets[e],f.futureSaves.push(futureSave))}c.splice(b,1);b--;
f.execute()}}}function d(b,c){null==b?b=[]:b instanceof Array||(b=[b]);null!=c&&(b=b.concat([c]));for(var f=[],a=0;a!=b.length;a++){var d=b[a];switch(typeof d){case "boolean":f.push({valuetype:_pio.ValueType.Bool,bool:d});break;case "string":f.push({valuetype:_pio.ValueType.String,string:d});break;case "number":0!=d%1?f.push({valuetype:_pio.ValueType.Double,"double":d}):-2147483648<d&&2147483647>d?f.push({valuetype:_pio.ValueType.Int,"int":d}):0<d&&4294967295>d?f.push({valuetype:_pio.ValueType.UInt,
uint:d}):f.push({valuetype:_pio.ValueType.Long,"long":d});break;case "object":if(d.getTime&&d.getMilliseconds)f.push({valuetype:_pio.ValueType.DateTime,datetime:d.getTime()});else throw Error("Don't know how to serialize type '"+typeof d+"' for BigDB");break;default:throw Error("Don't know how to serialize type '"+typeof d+"' for BigDB");}}return f}var e=this,c=[];this.createObject=function(b,c,d,l,g){var f=_pio.compareForChanges({},d||{},!0,!0);a.createObjects([{key:c,table:b,properties:f}],!1,l,
g,function(c){if(1==c.objects.length)return new _pio.databaseobject(e,b,c.objects[0].key,c.objects[0].version,!1,f);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.loadMyPlayerObject=function(b,c){a.loadMyPlayerObject(b,c,function(b){return new _pio.databaseobject(e,"PlayerObjects",b.playerobject.key,b.playerobject.version,!0,b.playerobject.properties)})};this.load=function(b,c,d,l){a.loadObjects([{table:b,keys:[c]}],d,l,function(c){if(1==c.objects.length)return null==
c.objects[0]?null:new _pio.databaseobject(e,b,c.objects[0].key,c.objects[0].version,!1,c.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error loading object");})};this.loadKeys=function(b,c,d,l){a.loadObjects([{table:b,keys:c}],d,l,function(c){for(var f=[],a=0;a!=c.objects.length;a++){var d=c.objects[a];f[a]=null==d?null:new _pio.databaseobject(e,b,d.key,d.version,!1,d.properties)}return f})};this.loadOrCreate=function(b,c,d,l){a.createObjects([{key:c,table:b,properties:[]}],
!0,d,l,function(c){if(1==c.objects.length)return new _pio.databaseobject(e,b,c.objects[0].key,c.objects[0].version,!1,c.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.deleteKeys=function(b,c,d,e){a.deleteObjects([{table:b,keys:c}],d,e,function(b){return null})};this.loadKeysOrCreate=function(b,c,d,l){for(var f=[],h=0;h!=c.length;h++)f.push({key:c[h],table:b,properties:[]});a.createObjects(f,!0,d,l,function(c){for(var f=[],a=0;a!=c.objects.length;a++){var d=
c.objects[a];f[a]=new _pio.databaseobject(e,b,d.key,d.version,!1,d.properties)}return f})};this.loadSingle=function(b,c,h,l,g){a.loadMatchingObjects(b,c,d(h),1,l,g,function(c){return 0==c.objects.length?null:new _pio.databaseobject(e,b,c.objects[0].key,c.objects[0].version,!1,c.objects[0].properties)})};this.loadRange=function(b,c,h,l,g,m,n,q){a.loadIndexRange(b,c,d(h,l),d(h,g),m,n,q,function(c){for(var f=[],a=0;a!=c.objects.length;a++){var d=c.objects[a];f[a]=null==d?null:new _pio.databaseobject(e,
b,d.key,d.version,!1,d.properties)}return f})};this.deleteRange=function(b,c,e,l,g,m,n){a.deleteIndexRange(b,c,d(e,l),d(e,g),m,n,function(){})};this.saveChanges=function(b,f,d,e,k,m){var h=1==m;m=[];for(var l in d){var t=d[l];if(!(t.existsInDatabase&&t.key&&t.table&&t._internal_&&t.save)){b=_pio.error("You can only save database objects that exist in the database");_pio.handleError(b,k,b.code,b.message);return}var w=_pio.compareForChanges(f?{}:t._internal_("get-dbCurrent"),t,!0,!0);(f||0<w.length)&&
m.push({key:t._internal_("get-key"),table:t._internal_("get-table"),fulloverwrite:f,onlyifversion:b?t._internal_("get-version"):null,changes:w})}c.push({objects:d,changesets:m,fullOverwrite:f,useOptimisticLock:b,futureSaves:[],setIsSavingOnAll:function(b){for(var c=0;c!=this.objects.length;c++)this.objects[c]._internal_("set-is-saving",b)},done:function(){this.setIsSavingOnAll(!1);g()},execute:function(){var b=this;b.setIsSavingOnAll(!0);0<b.changesets.length?a.saveObjectChanges(_pio.LockType.LockAll,
b.changesets,h,e,function(c){b.done();_pio.handleError(c,k,c.code,c.message)},function(c){for(var f=0;f!=b.objects.length;f++){var a=b.objects[f];a._internal_("set-version",c.versions[f]);a._internal_("change-dbCurrent",b.changesets[f].changes);for(var d=0;d!=b.futureSaves.length;d++)for(var e=b.futureSaves[d],h=0;h<e.objects.length;h++)e.objects[h]==a&&(e.changesets.splice(h,1),e.objects.splice(h,1),h--)}b.done()}):(b.done(),setTimeout(e,1))}});g()}};_pio.databaseobject=function(a,g,d,e,c,b){var f=
{},h=!1;_pio.bigDBDeserialize(b,f,!0);this.table=g;this.key=d;this.existsInDatabase=!0;this.save=function(b,f,d,e){a.saveChanges(b,f,[this],d,e,c)};this._internal_=function(b,c){switch(b){case "get-table":return g;case "get-key":return d;case "set-is-saving":h=c;case "get-is-saving":return h;case "get-version":return e;case "set-version":e=c;case "get-dbCurrent":return f;case "change-dbCurrent":_pio.bigDBDeserialize(c,f,!0)}};_pio.bigDBDeserialize(b,this,!0)};_pio.compareForChanges=function(a,g,d,
e){var c=[],b;for(b in g){var f=g[b],h=a?a[b]:null;switch(b){case "table":if(e)continue;case "key":if(e)continue;case "save":if(e)continue;case "existsInDatabase":if(e)continue;case "_internal_":if(e)continue;case "_circular_reference_finder_":continue}if(null!=f){var l=d?{name:b}:{index:parseInt(b)};switch(typeof f){case "boolean":f!=h&&(l.value={valuetype:_pio.ValueType.Bool,bool:f},c.push(l));break;case "number":f!=h&&(isFinite(f)&&Math.floor(f)===f?l.value=-2147483648<=f&&2147483647>=f?{valuetype:_pio.ValueType.Int,
"int":f}:0<f&&4294967295>=f?{valuetype:_pio.ValueType.UInt,uint:f}:-0x7ffffffffffffc00<=f&&0x7ffffffffffffc00>=f?{valuetype:_pio.ValueType.Long,"long":f}:0<f&&1.844674407370955E19>=f?{valuetype:_pio.ValueType.ULong,ulong:f}:{valuetype:_pio.ValueType.Double,"double":f}:l.value={valuetype:_pio.ValueType.Double,"double":f},c.push(l));break;case "string":f!=h&&(l.value={valuetype:_pio.ValueType.String,string:f},c.push(l));break;case "object":if(f.getTime&&f.getMilliseconds)f+""!=h+""&&(l.value={valuetype:_pio.ValueType.DateTime,
datetime:f.getTime()},c.push(l));else{if(f._circular_reference_finder_)throw new PlayerIOError(PlayerIOErrorCode.CircularReference,"The object you're trying to save contains a circular reference for "+(d?"a property named":"the array entry")+"): "+b);f._circular_reference_finder_=!0;var k=f instanceof Array;if(k&&f.bytearray){k=Array(f.length);for(h=0;h!=k.length;h++){var m=f[h];if(0<=m&&255>=m)k[h]=m;else throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"The bytearray property '"+b+"' was supposed to only contain byte (0-255) values, but contained the value: "+
m);}l.value={valuetype:_pio.ValueType.ByteArray,bytearray:k}}else h=_pio.compareForChanges(h,f,!k,!1),l.value=k?{valuetype:_pio.ValueType.Array,arrayproperties:h}:{valuetype:_pio.ValueType.Obj,objectproperties:h};c.push(l);delete f._circular_reference_finder_}break;case "undefined":break;case "function":break;default:throw Error("Don't know how to serialize type '"+typeof f+"' for BigDB");}}}for(b in a)null!=g[b]&&"undefined"!=typeof g[b]||c.push(d?{name:b}:{index:parseInt(b)});return c};_pio.bigDBDeserialize=
function(a,g,d){for(var e in a){var c=a[e],b=d?c.name:c.index||0;if(c=c.value)switch(c.valuetype||0){case _pio.ValueType.String:g[b]=c.string||"";break;case _pio.ValueType.Int:g[b]=c["int"]||0;break;case _pio.ValueType.UInt:g[b]=c.uint||0;break;case _pio.ValueType.Long:g[b]=c["long"]||0;break;case _pio.ValueType.Bool:g[b]=c.bool||0;break;case _pio.ValueType.Float:g[b]=c["float"]||0;break;case _pio.ValueType.Double:g[b]=c["double"]||0;break;case _pio.ValueType.ByteArray:g[b]=c.bytearray;g[b].bytearray=
!0;break;case _pio.ValueType.DateTime:g[b]=new Date(c.datetime||0);break;case _pio.ValueType.Array:var f=g[b]instanceof Array?g[b]:[];_pio.bigDBDeserialize(c.arrayproperties,f,!1);g[b]=f;break;case _pio.ValueType.Obj:f="object"==typeof g[b]?g[b]:{},_pio.bigDBDeserialize(c.objectproperties,f,!0),g[b]=f}else delete g[b]}}})();
(function(){_pio.multiplayer=function(a){var d=this;this.developmentServer=null;this.useSecureConnections=!1;this.createRoom=function(c,b,f,e,g,k){a.createRoom(c,b,f,_pio.convertToKVArray(e),null!=d.developmentServer,g,k,function(b){return b.roomid})};this.joinRoom=function(c,b,f,e){clearTimeout(setTimeout(function(){f(new _pio.connection)},1E4));var h=Error();a.joinRoom(c,_pio.convertToKVArray(b),null!=d.developmentServer,function(){},e,function(c){return new _pio.connection(h,d.developmentServer,
d.useSecureConnections,c.endpoints,c.joinkey,b||{},f,e)})};this.createJoinRoom=function(c,b,f,e,g,k,m){clearTimeout(setTimeout(function(){k(new _pio.connection)},1E4));var h=Error();a.createJoinRoom(c,b,f,_pio.convertToKVArray(e),_pio.convertToKVArray(g),null!=d.developmentServer,function(){},m,function(b){return new _pio.connection(h,d.developmentServer,d.useSecureConnections,b.endpoints,b.joinkey,g||{},k,m)})};this.listRooms=function(c,b,f,e,g,k){a.listRooms(c,_pio.convertToKVArray(b),f,e,null!=
d.developmentServer,g,k,function(b){var c=[];if(b.rooms&&0<b.rooms.length)for(var f=0;f!=b.rooms.length;f++){var a=b.rooms[f];c.push(new _pio.roomInfo(a.id,a.roomtype,a.onlineusers,_pio.convertFromKVArray(a.roomdata)))}return c})}};_pio.websocketConnection=function(a,e,c,b,f,h,g){var d=this,l=!1,n=new _pio.messageSerializer,q=!1,t=null;e=(e?"wss://":"ws://")+c+"/";try{t="undefined"!=typeof MozWebSocket?new MozWebSocket(e):new WebSocket(e)}catch(r){f(!1,""+r);return}var w=setTimeout(function(){l||
(l=!0,f(!1,"Connect attempt timed out"))},b);t.onopen=function(){l||(clearTimeout(w),q=l=!0,f(q))};t.onclose=function(b){d.disconnect()};t.onerror=function(b){d.disconnect()};t.onmessage=function(b){if(q)if(a){var c=new FileReader;c.onloadend=function(){for(var b=new Uint8Array(c.result),f=Array(b.length),a=0;a!=b.length;a++)f[a]=b[a];g(n.deserializeMessage(f,0,f.length))};c.readAsArrayBuffer(b.data)}else b=_pio.base64decode(b.data),g(n.deserializeMessage(b,0,b.length))};this.disconnect=function(){if(q){q=
!1;h();try{t.close()}catch(r){_pio.debugLog(r)}}};this.sendMessage=function(b){b=n.serializeMessage(b);if(a){for(var c=new Uint8Array(b.length),f=0;f<b.length;f++)c[f]=b[f];t.send(c.buffer)}else b=_pio.base64encode(b),t.send(b)}};_pio.connection=function(a,e,c,b,f,h,g,k){function d(d){function m(){if(0<C.length){var b=C[0];C.splice(0,1);var e=d(c,b,4E3,function(c,a){if(c){x=e;l.connected=!0;var d=l.createMessage("join");d.addString(f);if(null!=h)for(var g in h)d.addString(g),d.addString(""+h[g]);
l.sendMessage(d)}else _pio.debugLog("Unable to connect to endpoint: "+b+'. reason: "'+a+(0<C.length?'". Trying next endpoint.':'". No more endpoints to try.')),m()},function(b){l.connected&&(l.connected=!1,setTimeout(function(){for(var b=0;b!=t.length;b++)_pio.runCallback(t[b].callback,l,t[b].stackSource)},100))},function(b){q?"playerio.joinresult"==b.type?(q=!1,b.getBoolean(0)?_pio.runCallback(g,l,null):_pio.handleError(a,k,b.getInt(1),b.getString(2))):_pio.handleError(a,k,PlayerIOErrorCode.GeneralError,
"The expected inital messagetype is: playerio.joinresult, received: "+joinResult.getType()):(n(b.type,b),n("*",b))})}else _pio.handleError(a,k,PlayerIOErrorCode.GeneralError,"Could not establish a socket connection to any of the given endpoints for the room")}function n(b,c){var f=w[b];if(f)for(var a=0;a<f.length;a++)_pio.runCallback(f[a].callback,c,f[a].stackSource)}var C=[];if(e)C.push(e);else for(var r=0;r!=b.length;r++)C.push(b[r].address+":"+b[r].port);m()}var l=this,q=!0,t=[],w={},r=[],x=null,
y=/(WebKit|Firefox|Trident)\/([0-9]+)/gi.exec(navigator.userAgent),C=y&&3<=y.length?y[1]:null;y=y&&3<=y.length?parseInt(y[2]):null;window.FileReader&&"WebKit"==C&&535<=y||"Firefox"==C&&11<=y||"Trident"==C&&6<=y?d(function(b,c,f,a,d,e){return new _pio.websocketConnection(!0,b,c,f,a,d,e)}):_pio.isFlashFallbackEnabled(function(b){b?d(function(b,c,f,a,d,e){return new _pio.flashSocketConnection(c,f,a,d,e)}):d(function(b,c,f,a,d,e){return new _pio.websocketConnection(!1,b,c,f,a,d,e)})});this.connected=
!1;this.addDisconnectCallback=function(b){t.push({callback:b,stackSourc:Error()})};this.addMessageCallback=function(b,c){null==b&&(b="*");var f=w[b];f||(w[b]=f=[]);f.push({callback:c,stackSource:Error()})};this.removeDisconnectCallback=function(b){for(var c=0;c<t.length;c++)t[c].callback==b&&(t.splice(c,1),c--)};this.removeMessageCallback=function(b){for(var c in w)for(var f=w[c],a=0;a<f.length;a++)f[a].callback==b&&(f.splice(a,1),a--)};this.createMessage=function(b){for(var c=new _pio.message(b),
f=1;f<arguments.length;f++)c.add(arguments[f]);return c};this.send=function(b){var c=this.createMessage.apply(this,arguments);this.sendMessage(c)};this.sendMessage=function(b){l.connected?x.sendMessage(b):r.push(b)};this.disconnect=function(){l.connected&&x.disconnect()}};_pio.message=function(a){function d(b,c,f,a){if(b)k.push(c),g.push(f),h.length=k.length;else throw _pio.error("The given value ("+c+") is not "+a);}function c(c,f){if(c>k.length)throw _pio.error("this message ("+h.type+") only has "+
k.length+" entries");if(g[c]==f)return k[c];throw _pio.error("Value at index:"+c+" is a "+b(g[c])+" and not a "+b(f)+" as requested. The value is: "+k[c]);}function b(b){return{0:"Integer",1:"Unsigned Integer",2:"Long",3:"Unsigned Long",4:"Double",5:"Float",6:"String",7:"ByteArray",8:"Boolean"}[b]}function f(b){var c="object"==typeof b&&"undefined"!=typeof b.length;if(c)for(var f=0;f!=b.length;f++)if(255<b[f]||0>b[f]){c=!1;break}return c}var h=this,g=[],k=[];this.type=a;this.length=0;this.add=function(){for(var b=
0;b<arguments.length;b++){var c=arguments[b];switch(typeof c){case "string":h.addString(c);break;case "boolean":h.addBoolean(c);break;case "number":if(isFinite(c)&&Math.floor(c)===c)if(-2147483648<=c&&2147483647>=c){h.addInt(c);break}else if(0<c&&4294967295>=c){h.addUInt(c);break}else if(-0x7ffffffffffffc00<=c&&0x7ffffffffffffc00>=c){h.addLong(c);break}else if(0<c&&1.844674407370955E19>=c){h.addULong(c);break}h.addDouble(c);break;case "object":if(f(c)){this.addByteArray(c);break}default:throw _pio.error("The type of the value ("+
c+") cannot be inferred");}}};this.addInt=function(b){d(-2147483648<=b&&2147483647>=b,Math.trunc(b),0,"an integer (32bit)")};this.addUInt=function(b){d(0<=b&&4294967295>=b,Math.trunc(b),1,"an unsigned integer (32bit)")};this.addLong=function(b){d(-0x7ffffffffffffc00<=b&&0x7ffffffffffffc00>=b,Math.trunc(b),2,"a long (64bit)")};this.addULong=function(b){d(0<=b&&1.844674407370955E19>=b,b,3,"an unsigned long (64bit)")};this.addBoolean=function(b){d(!0,b?!0:!1,8,"a boolean value")};this.addFloat=function(b){d(!0,
Number(b),5,"a floating point value (32bit)")};this.addDouble=function(b){d(!0,Number(b),4,"a double floating point value (64bit)")};this.addByteArray=function(b){d(f(b),b,7,"a bytearray")};this.addString=function(b){d(!0,b+"",6,"a string")};this.getInt=function(b){return c(b,0)};this.getUInt=function(b){return c(b,1)};this.getLong=function(b){return c(b,2)};this.getULong=function(b){return c(b,3)};this.getBoolean=function(b){return c(b,8)};this.getDouble=function(b){return c(b,4)};this.getFloat=
function(b){return c(b,5)};this.getByteArray=function(b){return c(b,7)};this.getString=function(b){return c(b,6)};this.toString=function(){for(var c="msg.Type = "+this.type,f=0;f!=this.length;f++)c+=", msg["+f+"] = "+k[f]+" ("+b(g[f])+")";return c};this._internal_=function(b,c){switch(b){case "get-objects":return k;case "get-types":return g}}};_pio.roomInfo=function(a,e,c,b){this.id=a;this.roomType=e;this.onlineUsers=c;this.roomData=b};_pio.byteWriter=function(){this.bytes=[];this.writeByte=function(a){if(0<=
a&&255>=a)this.bytes.push(a);else throw Error("This is not a byte value: "+a);};this.writeBytes=function(a){for(var d=0;d!=a.length;d++)this.writeByte(a[d])};this.writeTagWithLength=function(a,e,c){63<a||0>a?this.writeBottomPatternAndBytes(c,_pio.binaryserializer.bytesFromInt(a)):this.writeByte(e|a)};this.writeBottomPatternAndBytes=function(a,e){var c=0;0!=e[0]?c=3:0!=e[1]?c=2:0!=e[2]&&(c=1);this.writeByte(a|c);for(c=e.length-c-1;c!=e.length;c++)this.writeByte(e[c])};this.writeLongPattern=function(a,
e,c){for(var b=0,f=0;7!=f;f++)if(0!=c[f]){b=7-f;break}3<b?this.writeByte(e|b-4):this.writeByte(a|b);for(f=c.length-b-1;f!=c.length;f++)this.writeByte(c[f])}};_pio.messageSerializer=function(){this.serializeMessage=function(a){var d=new _pio.byteWriter;d.writeTagWithLength(a.length,128,4);var c=_pio.binaryserializer.bytesFromString(a.type);d.writeTagWithLength(c.length,192,12);d.writeBytes(c);for(var b=0;b!=a.length;b++)switch(c=a._internal_("get-objects")[b],a._internal_("get-types")[b]){case 6:c=
_pio.binaryserializer.bytesFromString(c);d.writeTagWithLength(c.length,192,12);d.writeBytes(c);break;case 0:d.writeTagWithLength(c,128,4);break;case 1:d.writeBottomPatternAndBytes(8,_pio.binaryserializer.bytesFromUInt(c));break;case 2:d.writeLongPattern(48,52,_pio.binaryserializer.bytesFromLong(c));break;case 3:d.writeLongPattern(56,60,_pio.binaryserializer.bytesFromULong(c));break;case 7:d.writeTagWithLength(c.length,64,16);d.writeBytes(c);break;case 4:d.writeByte(3);d.writeBytes(_pio.binaryserializer.bytesFromDouble(c));
break;case 5:d.writeByte(2);c=_pio.binaryserializer.bytesFromFloat(c);d.writeBytes(c);break;case 8:d.writeByte(c?1:0)}return d.bytes};this.deserializeMessage=function(a,e,c){var b=e;e+=c;c=null;for(var f=0;b<e;){var d=0,g=0,k=a[b];b++;var m=k&192;0==m&&(m=k&60,0==m&&(m=k));switch(m){case 12:case 16:d=(k&3)+1;if(b+d>e)throw Error("Unexpected: Unfinished message");k=d;d=_pio.binaryserializer.intFromBytes(a,b,d);b+=k;break;case 192:d=k&63;break;case 128:g=k&63;break;case 64:d=k&63;break;case 4:case 8:case 48:case 56:d=
(k&3)+1;break;case 52:case 60:d=(k&3)+5;break;case 3:d=8;break;case 2:d=4}if(b+d>e)throw Error("Unexpected: Unfinished message");switch(m){case 12:case 192:null==c?(c=new _pio.message(_pio.binaryserializer.stringFromBytes(a,b,d)),f++):c.addString(_pio.binaryserializer.stringFromBytes(a,b,d));break;case 4:g=_pio.binaryserializer.intFromBytes(a,b,d);case 128:0==f?f=g:c.addInt(g);break;case 16:case 64:c.addByteArray(a.slice(b,b+d));break;case 8:c.addUInt(_pio.binaryserializer.uintFromBytes(a,b,d));break;
case 48:case 52:c.addLong(_pio.binaryserializer.longFromBytes(a,b,d));break;case 56:case 60:c.addULong(_pio.binaryserializer.ulongFromBytes(a,b,d));break;case 3:c.addDouble(_pio.binaryserializer.doubleFromBytes(a,b,d));break;case 2:c.addFloat(_pio.binaryserializer.floatFromBytes(a,b,d));break;case 1:c.addBoolean(!0);break;case 0:c.addBoolean(!1)}b+=d;if(null!=c&&0==--f)return c}throw Error("Unexpected: Misaligned message");}};_pio.binaryserializer={pow2:function(a){return 0<=a&&31>a?1<<a:this.pow2[a]||
(this.pow2[a]=Math.pow(2,a))},_intEncode:function(a,e){if(4==e)var c=[a>>>24&255,a>>>16&255,a>>>8&255,a&255];else{if(0<=a){c=Math.floor(a/this.pow2(32));var b=a-c*this.pow2(32)}else c=Math.floor(a/this.pow2(32)),b=a-c*this.pow2(32),c+=this.pow2(32);c=[c>>>24&255,c>>>16&255,c>>>8&255,c&255,b>>>24&255,b>>>16&255,b>>>8&255,b&255]}return c},_floatEncode:function(a,e,c){var b=0>a?1:0,f,d=~(-1<<c-1),g=1-d;0>a&&(a=-a);0===a?a=f=0:isNaN(a)?(f=2*d+1,a=1):Infinity===a?(f=2*d+1,a=0):(f=Math.floor(Math.log(a)/
Math.LN2),f>=g&&f<=d?(a=Math.floor((a*this.pow2(-f)-1)*this.pow2(e)),f+=d):(a=Math.floor(a/this.pow2(g-e)),f=0));for(d=[];8<=e;)d.push(a%256),a=Math.floor(a/256),e-=8;f=f<<e|a;for(c+=e;8<=c;)d.push(f&255),f>>>=8,c-=8;d.push(b<<c|f);d.reverse();return d},bytesFromString:function(a){for(var d=[],c=0;c<a.length;c++)if(127>=a.charCodeAt(c))d.push(a.charCodeAt(c));else for(var b=encodeURIComponent(a.charAt(c)).substr(1).split("%"),f=0;f<b.length;f++)d.push(parseInt(b[f],16));return d},bytesFromInt:function(a){return this._intEncode(a,
4)},bytesFromUInt:function(a){return this._intEncode(a,4)},bytesFromLong:function(a){return this._intEncode(a,8)},bytesFromULong:function(a){return this._intEncode(a,8)},bytesFromFloat:function(a){return this._floatEncode(a,23,8)},bytesFromDouble:function(a){return this._floatEncode(a,52,11)},_intDecode:function(a,e,c,b,f){var d=e+c-1;e=f&&c==b&&a[e]&128;b=0;f=1;for(var g=0;g<c;g++){var k=a[d-g];e&&(k=(k^255)+f,f=k>>8,k&=255);b+=k*this.pow2(8*g)}return e?-b:b},_float32Decode:function(a,e){var c=a.slice(e,
e+4).reverse(),b=1-2*(c[3]>>7),f=(c[3]<<1&255|c[2]>>7)-127;c=(c[2]&127)<<16|c[1]<<8|c[0];return 128===f?0!==c?NaN:Infinity*b:-127===f?b*c*this.pow2(-149):b*(1+c*this.pow2(-23))*this.pow2(f)},_float64Decode:function(a,e){var c=a.slice(e,e+8).reverse(),b=1-2*(c[7]>>7),f=((c[7]<<1&255)<<3|c[6]>>4)-1023;c=(c[6]&15)*this.pow2(48)+c[5]*this.pow2(40)+c[4]*this.pow2(32)+c[3]*this.pow2(24)+c[2]*this.pow2(16)+c[1]*this.pow2(8)+c[0];return 1024===f?0!==c?NaN:Infinity*b:-1023===f?b*c*this.pow2(-1074):b*(1+c*
this.pow2(-52))*this.pow2(f)},stringFromBytes:function(a,e,c){for(var b="",f=e;f<e+c;f++)b+=127>=a[f]?37===a[f]?"%25":String.fromCharCode(a[f]):"%"+a[f].toString(16).toUpperCase();return decodeURIComponent(b)},intFromBytes:function(a,e,c){return this._intDecode(a,e,c,4,!0)},uintFromBytes:function(a,e,c){return this._intDecode(a,e,c,4,!1)},longFromBytes:function(a,e,c){return this._intDecode(a,e,c,8,!0)},ulongFromBytes:function(a,e,c){return this._intDecode(a,e,c,8,!1)},floatFromBytes:function(a,e,
c){return 4==c?this._float32Decode(a,e):NaN},doubleFromBytes:function(a,e,c){return 8==c?this._float64Decode(a,e):NaN}};for(var a=[],g=0;65!=g;g++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(g)]=g;_pio.base64encode=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c],f=++c<=a.length?a[c]:NaN,h=++c<=a.length?a[c]:NaN,g=b>>2;b=(b&3)<<4|f>>4;var k=(f&15)<<2|h>>6,m=h&63;isNaN(f)?k=m=64:isNaN(h)&&(m=64);d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g));
d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m))}return d.join("")};_pio.base64decode=function(d){for(var e=[],c=0;c<d.length;c++){var b=a[d.charCodeAt(c)],f=++c<d.length?a[d.charCodeAt(c)]:64,h=++c<d.length?a[d.charCodeAt(c)]:64,g=++c<d.length?a[d.charCodeAt(c)]:64,k=(f&15)<<4|h>>2,m=(h&3)<<
6|g;e.push(b<<2|f>>4);64!=h&&(e.push(k),64!=g&&e.push(m))}return e}})();
(function(){_pio.achievements=function(a){function g(c,b){var a=new _pio.achievement(c.identifier,c.title,c.description,c.imageurl,c.progress,c.progressgoal,c.lastupdated);if("string"!==typeof e.myAchievements)for(var d=0;d<e.myAchievements.length;d++)e.myAchievements[d].id==a.id&&(e.myAchievements[d]=a,e.currentVersion=null);if(b)for(d=0;d<e.onCompleteHandlers.length;d++)(0,e.onCompleteHandlers[d])(a);return a}var d=null;this.myAchievements="[ERROR: You tried to access achievements.myAchievements before loading them. You have to call the refresh method first.]";
this.onCompleteHandlers=[];var e=this;this.addOnComplete=function(c){if("function"===typeof c&&1==c.length)e.onCompleteHandlers.push(c);else throw new PlayerIOError(PlayerIOErrorCode.InvalidArgument,"Expects argument to be a function that takes an achievement as an argument.");};this.get=function(c){if("string"===typeof e.myAchievements)return null;for(var b=0;b<e.myAchievements.length;b++)if(e.myAchievements[b].id==c)return e.myAchievements[b];return null};this.refresh=function(c,b){a.achievementsRefresh(d,
c,b,function(b){if(d!=b.version)if(d=b.version,null==b.achievements||0==b.achievements.length)e.myAchievements=[];else{for(var c=[],a=0;a<b.achievements.length;a++){var f=b.achievements[a];c.push(new _pio.achievement(f.identifier,f.title,f.description,f.imageurl,f.progress,f.progressgoal,f.lastupdated))}e.myAchievements=c}})};this.load=function(c,b,f){"object"==typeof c||requests.length?a.achievementsLoad(c,b,f,function(b){if(null==b||0==b.length)return{};for(var c={},a=0;a<b.userachievements.length;a++){for(var f=
b.userachievements[a],d=[],e=0;e<f.achievements.length;e++){var h=f.achievements[e];d.push(new _pio.achievement(h.identifier,h.title,h.description,h.imageurl,h.progress,h.progressgoal,h.lastupdated))}c[f.userid]=d}return c}):(c=_pio.error("The first argument to load should be an array: client.achievements.load(['user1', 'user2', ...], ...)"),_pio.handleError(c,f,c.code,c.message))};this.progressSet=function(c,b,f,d){a.achievementsProgressSet(c,b,f,d,function(b){return g(b.achievement,b.completednow)})};
this.progressAdd=function(c,b,f,d){a.achievementsProgressAdd(c,b,f,d,function(b){return g(b.achievement,b.completednow)})};this.progressMax=function(c,b,f,d){a.achievementsProgressMax(c,b,f,d,function(b){return g(b.achievement,b.completednow)})};this.progressComplete=function(c,b,f){a.achievementsProgressComplete(c,b,f,function(b){return g(b.achievement,b.completednow)})}};_pio.achievement=function(a,g,d,e,c,b,f){this.id=a;this.title=g;this.description=d;this.imageUrl=e;this.progress="undefined"===
typeof c?0:c;this.progressGoal=b;this.lastUpdated=new Date(1E3*f);this.progressRatio=this.progress/this.progressGoal;this.completed=this.progress==this.progressGoal}})();
(function(){_pio.playerInsight=function(a){function g(a){d.playersOnline=-1==a.playersonline?"[ERROR: The current connection does not have the rights required to read the playersonline variable.]":a.playersonline;d.segments=_pio.convertFromKVArray(a.segments)}this.playersOnline="[ERROR: You tried to access playerInsight.playersOnline before loading it. You have to call the refresh method first.]";this.segments={};var d=this;this.refresh=function(d,c){a.playerInsightRefresh(d,c,function(b){g(b.state)})};
this.setSegments=function(d,c,b){a.playerInsightSetSegments(_pio.convertToSegmentArray(d),c,b,function(b){g(b.state)})};this.trackInvitedBy=function(d,c,b,f){a.playerInsightTrackInvitedBy(d,c,b,f,function(b){})};this.trackEvent=function(d,c,b,f){a.playerInsightTrackEvents([{eventtype:d,value:c}],b,f,function(b){})};this.trackExternalPayment=function(d,c,b,f){a.playerInsightTrackExternalPayment(d,c,b,f,function(b){})};this.sessionKeepAlive=function(d,c){a.playerInsightSessionKeepAlive(d,c,function(b){})}}})();
(function(){_pio.oneScore=function(a){this.percentile="[ERROR: You tried to access oneScore.percentile before loading the OneScore. You have to call the refresh method first.]";this.score="[ERROR: You tried to access oneScore.score before loading the OneScore. You have to call the refresh method first.]";this.topRank="[ERROR: You tried to access oneScore.topRank before loading the OneScore. You have to call the refresh method first.]";var g=this;this.refresh=function(d,e){a.oneScoreRefresh(d,e,function(c){c=
new _pio.oneScoreValue(c.onescore.percentile,c.onescore.score,c.onescore.toprank);g.percentile=c.percentile;g.score=c.score;g.topRank=c.toprank})};this.set=function(d,e,c){a.oneScoreSet(d,e,c,function(b){b=new _pio.oneScoreValue(b.onescore.percentile,b.onescore.score,b.onescore.toprank);g.percentile=b.percentile;g.score=b.score;g.topRank=b.toprank;return b})};this.add=function(d,e,c){a.oneScoreAdd(d,e,c,function(b){b=new _pio.oneScoreValue(b.onescore.percentile,b.onescore.score,b.onescore.toprank);
g.percentile=b.percentile;g.score=b.score;g.topRank=b.toprank;return b})};this.load=function(d,e,c){if("object"==typeof d||requests.length)a.oneScoreLoad(d,e,c,function(b){if(null==b||null==b.onescores||0==b.onescores.length)return[];for(var c=[],a=0,e=0;e<d.length;e++){var g=b.onescores[a];g&&d[e]==g.userid?(c.push(new _pio.oneScoreValue(g.percentile,g.score,g.toprank)),a++):c.push(null)}return c});else e=_pio.error("The first argument to load should be an array: client.oneScore.load(['user1', 'user2', ...], ...)"),
_pio.handleError(e,c,e.code,e.message)}};_pio.oneScoreValue=function(a,g,d){this.percentile="undefined"===typeof a?0:a;this.score="undefined"===typeof g?0:g;this.topRank="undefined"===typeof d?0:d}})();
(function(){_pio.notifications=function(a){function g(b){if(b.version!=c){var a=[];if(b.endpoints)for(var d=0;d!=b.endpoints.length;d++){var g=b.endpoints[d];a[d]=new _pio.notificationEndpoint(g.type,g.identifier,_pio.convertFromKVArray(g.configuration),g.enabled?!0:!1)}c=b.version;e.myEndpoints=a}}function d(b){var c=[];if(b&&0<b.length)for(var a=0;a!=b.length;a++){var d=b[a];d.type&&d.identifier&&c.push({type:d.type,identifier:d.identifier})}return c}this.myEndpoints="[ERROR: You tried to access notifications.myEndpoints before calling refresh.]";
var e=this,c="";this.refresh=function(b,f){a.notificationsRefresh(c,b,f,g)};this.registerEndpoint=function(b,f,d,l,k,m){var h;a:{if(""!=c)for(h=0;h!=e.myEndpoints.length;h++){var q=e.myEndpoints[h];if(q.type==b&&q.identifier==f){h=q;break a}}h=null}(q=null==h||h.enabled!=l)||(q=JSON.stringify(h.configuration)!=JSON.stringify(d));q?a.notificationsRegisterEndpoints(c,[{type:b,identifier:f,configuration:_pio.convertToKVArray(d),enabled:l}],k,m,g):k&&k()};this.toggleEndpoints=function(b,f,e,l){b=d(b);
0<b.length?a.notificationsToggleEndpoints(c,b,f?!0:!1,e,l,g):e&&e()};this.deleteEndpoints=function(b,f,e){b=d(b);0<b.length?a.notificationsDeleteEndpoints(c,b,f,e,g):f&&f()};this.send=function(b,c,d){for(var f=[],e=0;e!=b.length;e++){var h=b[e],g={recipient:h.recipientUserId,endpointtype:h.endpointType,data:{}};0!=(g.recipient+"").length&&0!=(g.endpointtype+"").length||console.log("error");for(var q in h)"recipientUserId"!=q&&"endpointType"!=q&&(g.data[q]=h[q]);f[e]=g}0<f.length?a.notificationsSend(f,
c,d,null):c&&c()}};_pio.notificationEndpoint=function(a,g,d,e){this.type=a;this.identifier=g;this.configuration=d;this.enabled=e}})();
(function(){_pio.publishingNetwork=function(a,g){var d=this;this.profiles=new _pio.publishingNetworkProfiles(a);this.payments=new _pio.publishingNetworkPayments(a);this.relations=new _pio.publishingNetworkRelations(a,g,this);this.userToken="[ERROR: you tried to access publishingNetwork.userToken before calling publishingNetwork.refresh(callback)]";this.refresh=function(e,c){a.socialRefresh(e,c,function(b){d.userToken=b.myprofile.usertoken;d.profiles.myProfile=new _pio.publishingNetworkProfile(b.myprofile);
"undefined"==typeof _pio.friendLookup&&(_pio.friendLookup={},_pio.blockedLookup={});var c=_pio.friendLookup[d.profiles.myProfile.userId],a=_pio.blockedLookup[d.profiles.myProfile.userId];c||a||(c=_pio.friendLookup[d.profiles.myProfile.userId]={},a=_pio.blockedLookup[d.profiles.myProfile.userId]={});d.relations.friends=[];for(var e=0;e!=b.friends.length;e++){var g=new _pio.publishingNetworkProfile(b.friends[e]);d.relations.friends.push(g);c[g.userId]=!0}for(e=0;e!=b.blocked.length;e++)a[b.blocked[e]]=
!0})}};_pio.showDialog=function(a,g,d,e){if("undefined"==typeof window.PublishingNetwork)throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotAvailable,"PublishingNetwork.js was not found on the current page. You have to include the 'piocdn.com/publishingnetwork.js' on the containing page to show dialogs. See http://playerio.com/documentation/ for more information.");d.__apitoken__=g.token;window.PublishingNetwork.dialog(a,d,e)}})();
(function(){_pio.publishingNetworkPayments=function(a){this.showBuyCoinsDialog=function(g,d,e,c){d||(d={});d.coinamount=g;a.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(d),null,function(b){_pio.showDialog("buy",a,b,function(b){b.error?c(new PlayerIOError(PlayerIOErrorCode.GeneralError,b.error)):e(b)})},c,function(b){return _pio.convertFromKVArray(b.providerarguments)})};this.showBuyItemsDialog=function(g,d,e,c){a.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(d||{}),
_pio.convertBuyItems(g),function(b){_pio.showDialog("buy",a,b,function(b){b.error?c(new PlayerIOError(PlayerIOErrorCode.GeneralError,b.error)):e(b)})},c,function(b){return _pio.convertFromKVArray(b.providerarguments)})}}})();
(function(){_pio.publishingNetworkProfiles=function(a){this.myProfile="[ERROR: you tried to access publishingNetworkProfiles.myProfile before calling publishingNetwork.refresh(callback)]";this.showProfile=function(g,d){_pio.showDialog("profile",a,{userId:g},d)};this.loadProfiles=function(g,d,e){a.socialLoadProfiles(g,d,e,function(c){for(var b=[],a=0;a!=g.length;a++){var d=g[a];b[a]=null;for(var e=0;e!=c.profiles.length;e++){var k=c.profiles[e];if(k&&k.userid==d){b[a]=new _pio.publishingNetworkProfile(c.profiles[e]);
break}}}return b})}};_pio.publishingNetworkProfile=function(a){this.userId=a.userid;this.displayName=a.displayname;this.avatarUrl=a.avatarurl;this.lastOnline=new Date(a.lastonline);this.countryCode=a.countrycode}})();
(function(){_pio.publishingNetworkRelations=function(a,g,d){this.friends="[ERROR: you tried to access publishingNetworkRelations.friends before calling publishingNetwork.refresh(callback)]";this.isFriend=function(a){if("undefined"!=typeof _pio.friendLookup&&"undefined"!=typeof _pio.friendLookup[g])return _pio.friendLookup[g][a]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");
};this.isBlocked=function(a){if("undefined"!=typeof _pio.blockedLookup&&"undefined"!=typeof _pio.blockedLookup[g])return _pio.blockedLookup[g][a]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");};this.showRequestFriendshipDialog=function(d,c){_pio.showDialog("requestfriendship",a,{userId:d},c)};this.showRequestBlockUserDialog=function(e,c){_pio.showDialog("requestblockuser",
a,{userId:e},function(){d.refresh(function(){c&&c()},function(){c&&c()})})};this.showFriendsManager=function(e){_pio.showDialog("friendsmanager",a,{},function(a){a.updated?d.refresh(function(){e&&e()},function(){e&&e()}):e&&e()})};this.showBlockedUsersManager=function(e){_pio.showDialog("blockedusersmanager",a,{},function(a){a.updated?d.refresh(function(){e&&e()},function(){e&&e()}):e&&e()})}}})();
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},g="undefined"!==typeof module&&module.exports,d="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,e=function(){for(var b,c=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],d=0,e=c.length,g={};d<e;d++)if((b=c[d])&&b[1]in a){for(d=0;d<b.length;d++)g[c[0][d]]=
b[d];return g}return!1}(),c={change:e.fullscreenchange,error:e.fullscreenerror},b={request:function(b){var c=e.requestFullscreen;b=b||a.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))b[c]();else b[c](d&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){a[e.exitFullscreen]()},toggle:function(b){this.isFullscreen?this.exit():this.request(b)},onchange:function(b){this.on("change",b)},onerror:function(b){this.on("error",b)},on:function(b,d){var f=c[b];f&&a.addEventListener(f,d,!1)},off:function(b,
d){var f=c[b];f&&a.removeEventListener(f,d,!1)},raw:e};e?(Object.defineProperties(b,{isFullscreen:{get:function(){return!!a[e.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!a[e.fullscreenEnabled]}}}),g?module.exports=b:window.screenfull=b):g?module.exports=!1:window.screenfull=!1})();
(function(){function a(b){b=String(b);return b.charAt(0).toUpperCase()+b.slice(1)}function g(b,a){var c=-1,f=b?b.length:0;if("number"==typeof f&&-1<f&&f<=t)for(;++c<f;)a(b[c],c,b);else e(b,a)}function d(b){b=String(b).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(b)?b:a(b)}function e(b,a){for(var c in b)r.call(b,c)&&a(b[c],c,b)}function c(b){return null==b?a(b):x.call(b).slice(8,-1)}function b(b,a){var c=null!=b?typeof b[a]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&
("object"==c?!!b[a]:!0)}function f(b){return String(b).replace(/([ -])(?!$)/g,"$1?")}function h(b,a){var c=null;g(b,function(f,d){c=a(c,f,d,b)});return c}function l(a){function g(b){return h(b,function(b,c){var e=c.pattern||f(c);!b&&(b=RegExp("\\b"+e+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+e+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+e+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((b=String(c.label&&!RegExp(e,"i").test(c.label)?c.label:b).split("/"))[1]&&!/[\d.]+/.test(b[0])&&(b[0]+=
" "+b[1]),c=c.label||c,b=d(b[0].replace(RegExp(e,"i"),c).replace(RegExp("; *(?:"+c+"[_-])?","i")," ").replace(RegExp("("+c+")[-_.]?(\\w)","i"),"$1 $2")));return b})}function k(b){return h(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}var n=m,q=a&&"object"==typeof a&&"String"!=c(a);q&&(n=a,a=null);var t=n.navigator||{},r=t.userAgent||"";a||(a=r);var C=q?!!t.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(x.toString()),
y=q?"Object":"ScriptBridgingProxyObject",L=q?"Object":"Environment",G=q&&n.java?"JavaPackage":c(n.java),P=q?"Object":"RuntimeObject";L=(G=/\bJava/.test(G)&&n.java)&&c(n.environment)==L;var R=G?"a":"\u03b1",S=G?"b":"\u03b2",M=n.document||{},E=n.operamini||n.opera,I=w.test(I=q&&E?E["[[Class]]"]:c(E))?I:E=null,p,J=a;q=[];var K=null,F=a==r;r=F&&E&&"function"==typeof E.version&&E.version();var z=function(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||f(c))+"\\b","i").exec(a)&&(c.label||
c)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),u=function(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||f(c))+"\\b","i").exec(a)&&(c.label||c)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),A=g([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(b){return h(b,function(b,c,d){return b||(c[A]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(A)]||RegExp("\\b"+f(d)+"(?:\\b|\\w*\\d)","i").exec(a))&&d})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),v=function(b){return h(b,function(b,c){var e=c.pattern||f(c);if(!b&&(b=RegExp("\\b"+e+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))){var h=b,g=c.label||c,l={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};e&&g&&/^Win/i.test(h)&&!/^Windows Phone /i.test(h)&&(l=l[/[\d.]+$/.exec(h)])&&(h="Windows "+l);h=String(h);e&&g&&(h=h.replace(RegExp(e,"i"),g));b=h=d(h.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return b})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);z&&(z=[z]);D&&!A&&(A=g([D]));if(p=/\bGoogle TV\b/.exec(A))A=p[0];/\bSimulator\b/i.test(a)&&(A=(A?A+" ":"")+"Simulator");"Opera Mini"==u&&/\bOPiOS\b/.test(a)&&q.push("running in Turbo/Uncompressed mode");"IE"==u&&/\blike iPhone OS\b/.test(a)?(p=l(a.replace(/like iPhone OS/,"")),D=p.manufacturer,A=p.product):/^iP/.test(A)?(u||(u="Safari"),v="iOS"+((p=/ OS ([\d_]+)/i.exec(a))?" "+p[1].replace(/_/g,"."):"")):"Konqueror"!=u||/buntu/i.test(v)?D&&"Google"!=D&&(/Chrome/.test(u)&&
!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(A))||/\bAndroid\b/.test(v)&&/^Chrome/.test(u)&&/\bVersion\//i.test(a)?(u="Android Browser",v=/\bAndroid\b/.test(v)?v:"Android"):"Silk"==u?(/\bMobi/i.test(a)||(v="Android",q.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&q.unshift("accelerated")):"PaleMoon"==u&&(p=/\bFirefox\/([\d.]+)\b/.exec(a))?q.push("identifying as Firefox "+p[1]):"Firefox"==u&&(p=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(v||(v="Firefox OS"),A||(A=p[1])):!u||(p=!/\bMinefield\b/i.test(a)&&
/\b(?:Firefox|Safari)\b/.exec(u))?(u&&!A&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(p+"/")+8))&&(u=null),(p=A||D||v)&&(A||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(v))&&(u=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(v)?v:p)+" Browser")):"Electron"==u&&(p=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&q.push("Chromium "+p):v="Kubuntu";r||(r=k(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",f(u),"(?:Firefox|Minefield|NetFront)"]));
if(p="iCab"==z&&3<parseFloat(r)&&"WebKit"||/\bOpera\b/.test(u)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(a)&&("Mac OS"==v?"Tasman":"Trident")||"WebKit"==z&&/\bPlayStation\b(?! Vita\b)/i.test(u)&&"NetFront")z=[p];"IE"==u&&(p=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(u+=" Mobile",v="Windows Phone "+(/\+$/.test(p)?p:p+".x"),q.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(u="IE Mobile",v="Windows Phone 8.x",
q.unshift("desktop mode"),r||(r=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=u&&"Trident"==z&&(p=/\brv:([\d.]+)/.exec(a))&&(u&&q.push("identifying as "+u+(r?" "+r:"")),u="IE",r=p[1]);if(F){if(b(n,"global"))if(G&&(p=G.lang.System,J=p.getProperty("os.arch"),v=v||p.getProperty("os.name")+" "+p.getProperty("os.version")),L){try{r=n.require("ringo/engine").version.join("."),u="RingoJS"}catch(Q){(p=n.system)&&p.global.system==n.system&&(u="Narwhal",v||(v=p[0].os||null))}u||(u="Rhino")}else"object"==typeof n.process&&
!n.process.browser&&(p=n.process)&&("object"==typeof p.versions&&("string"==typeof p.versions.electron?(q.push("Node "+p.versions.node),u="Electron",r=p.versions.electron):"string"==typeof p.versions.nw&&(q.push("Chromium "+r,"Node "+p.versions.node),u="NW.js",r=p.versions.nw)),u||(u="Node.js",J=p.arch,v=p.platform,r=(r=/[\d.]+/.exec(p.version))?r[0]:null));else c(p=n.runtime)==y?(u="Adobe AIR",v=p.flash.system.Capabilities.os):c(p=n.phantom)==P?(u="PhantomJS",r=(p=p.version||null)&&p.major+"."+p.minor+
"."+p.patch):"number"==typeof M.documentMode&&(p=/\bTrident\/(\d+)/i.exec(a))?(r=[r,M.documentMode],(p=+p[1]+4)!=r[1]&&(q.push("IE "+r[1]+" mode"),z&&(z[1]=""),r[1]=p),r="IE"==u?String(r[1].toFixed(1)):r[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(u)&&(q.push("masking as "+u+" "+r),u="IE",r="11.0",z=["Trident"],v="Windows");v=v&&d(v)}r&&(p=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(r)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(F&&t.appMinorVersion))||/\bMinefield\b/i.test(a)&&
"a")&&(K=/b/i.test(p)?"beta":"alpha",r=r.replace(RegExp(p+"\\+?$"),"")+("beta"==K?S:R)+(/\d+\+?/.exec(p)||""));if("Fennec"==u||"Firefox"==u&&/\b(?:Android|Firefox OS)\b/.test(v))u="Firefox Mobile";else if("Maxthon"==u&&r)r=r.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(A))"Xbox 360"==A&&(v=null),"Xbox 360"==A&&/\bIEMobile\b/.test(a)&&q.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(u)&&(!u||A||/Browser|Mobi/.test(u))||"Windows CE"!=v&&!/Mobi/i.test(a))if("IE"==u&&F)try{null===n.external&&
q.unshift("platform preview")}catch(Q){q.unshift("embedded")}else(/\bBlackBerry\b/.test(A)||/\bBB10\b/.test(a))&&(p=(RegExp(A.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||r)?(p=[p,/BB10/.test(a)],v=(p[1]?(A=null,D="BlackBerry"):"Device Software")+" "+p[0],r=null):this!=e&&"Wii"!=A&&(F&&E||/Opera/.test(u)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==u&&/\bOS X (?:\d+\.){2,}/.test(v)||"IE"==u&&(v&&!/^Win/.test(v)&&5.5<r||/\bWindows XP\b/.test(v)&&8<r||8==r&&!/\bTrident\b/.test(a)))&&!w.test(p=
l.call(e,a.replace(w,"")+";"))&&p.name&&(p="ing as "+p.name+((p=p.version)?" "+p:""),w.test(u)?(/\bIE\b/.test(p)&&"Mac OS"==v&&(v=null),p="identify"+p):(p="mask"+p,u=I?d(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(p)&&(v=null),F||(r=null)),z=["Presto"],q.push(p));else u+=" Mobile";if(p=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1]){p=[parseFloat(p.replace(/\.(\d)$/,".0$1")),p];if("Safari"==u&&"+"==p[1].slice(-1))u="WebKit Nightly",K="alpha",r=p[1].slice(0,-1);else if(r==p[1]||r==(p[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))r=null;p[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1];537.36==p[0]&&537.36==p[2]&&28<=parseFloat(p[1])&&"WebKit"==z&&(z=["Blink"]);F&&(C||p[1])?(z&&(z[1]="like Chrome"),p=p[1]||(p=p[0],530>p?1:532>p?2:532.05>p?3:533>p?4:534.03>p?5:534.07>p?6:534.1>p?7:534.13>p?8:534.16>p?9:534.24>p?10:534.3>p?11:535.01>p?12:535.02>p?"13+":535.07>p?15:535.11>p?16:535.19>p?17:536.05>p?18:536.1>p?19:537.01>p?20:537.11>p?"21+":537.13>p?23:537.18>p?24:537.24>p?25:537.36>p?26:"Blink"!=
z?"27":"28")):(z&&(z[1]="like Safari"),p=(p=p[0],400>p?1:500>p?2:526>p?3:533>p?4:534>p?"4+":535>p?5:537>p?6:538>p?7:601>p?8:"8"));z&&(z[1]+=" "+(p+="number"==typeof p?".x":/[.+]/.test(p)?"":"+"));"Safari"==u&&(!r||45<parseInt(r))&&(r=p)}"Opera"==u&&(p=/\bzbov|zvav$/.exec(v))?(u+=" ",q.unshift("desktop mode"),"zvav"==p?(u+="Mini",r=null):u+="Mobile",v=v.replace(RegExp(" *"+p+"$"),"")):"Safari"==u&&/\bChrome\b/.exec(z&&z[1])&&(q.unshift("desktop mode"),u="Chrome Mobile",r=null,/\bOS X\b/.test(v)?(D=
"Apple",v="iOS 4.3+"):v=null);r&&0==r.indexOf(p=/[\d.]+$/.exec(v))&&-1<a.indexOf("/"+p+"-")&&(v=String(v.replace(p,"")).replace(/^ +| +$/g,""));z&&!/\b(?:Avant|Nook)\b/.test(u)&&(/Browser|Lunascape|Maxthon/.test(u)||"Safari"!=u&&/^iOS/.test(v)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(u)&&z[1])&&(p=z[z.length-1])&&q.push(p);q.length&&(q=["("+q.join("; ")+")"]);D&&A&&0>A.indexOf(D)&&q.push("on "+D);A&&q.push((/^on /.test(q[q.length-
1])?"":"on ")+A);if(v){var N=(p=/ ([\d.+]+)$/.exec(v))&&"/"==v.charAt(v.length-p[0].length-1);v={architecture:32,family:p&&!N?v.replace(p[0],""):v,version:p?p[1]:null,toString:function(){var b=this.version;return this.family+(b&&!N?" "+b:"")+(64==this.architecture?" 64-bit":"")}}}(p=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(J))&&!/\bi686\b/i.test(J)?(v&&(v.architecture=64,v.family=v.family.replace(RegExp(" *"+p),"")),u&&(/\bWOW64\b/i.test(a)||F&&/\w(?:86|32)$/.test(t.cpuClass||t.platform)&&!/\bWin64; x64\b/i.test(a))&&
q.unshift("32-bit")):v&&/^OS X/.test(v.family)&&"Chrome"==u&&39<=parseFloat(r)&&(v.architecture=64);a||(a=null);n={};n.description=a;n.layout=z&&z[0];n.manufacturer=D;n.name=u;n.prerelease=K;n.product=A;n.ua=a;n.version=u&&r;n.os=v||{architecture:null,family:null,version:null,toString:function(){return"null"}};n.parse=l;n.toString=function(){return this.description||""};n.version&&q.unshift(r);n.name&&q.unshift(u);v&&u&&(v!=String(v).split(" ")[0]||v!=u.split(" ")[0]&&!A)&&q.push(A?"("+v+")":"on "+
v);q.length&&(n.description=q.join(" "));return n}var k={"function":!0,object:!0},m=k[typeof window]&&window||this,n=k[typeof exports]&&exports;k=k[typeof module]&&module&&!module.nodeType&&module;var q=n&&k&&"object"==typeof global&&global;!q||q.global!==q&&q.window!==q&&q.self!==q||(m=q);var t=Math.pow(2,53)-1,w=/\bOpera/;q=Object.prototype;var r=q.hasOwnProperty,x=q.toString,y=l();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(m.platform=y,define(function(){return y})):n&&
k?e(y,function(b,a){n[a]=b}):m.platform=y}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],g=0;g<a.length;g++){var d=document.createElement("meta");d.name=a[g].name;d.content=a[g].content;var e=window.document.head.querySelector('meta[name="'+d.name+'"]');e&&e.parentNode.removeChild(e);window.document.head.appendChild(d)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;
case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&iosResize()});
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.TreeModel=a()}}(function(){return function c(g,d,e){function b(h,k){if(!d[h]){if(!g[h]){var l="function"==typeof require&&require;if(!k&&l)return l(h,!0);if(f)return f(h,!0);l=Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",
l;}l=d[h]={exports:{}};g[h][0].call(l.exports,function(c){var f=g[h][1][c];return b(f?f:c)},l,l.exports,c,g,d,e)}return d[h].exports}for(var f="function"==typeof require&&require,h=0;h<e.length;h++)b(e[h]);return b}({1:[function(g,d,e){var c=g("mergesort");var b=g("find-insert-index");d.exports=function(){function f(b){this.config=b=b||{};this.config.childrenPropertyName=b.childrenPropertyName||"children";this.config.modelComparatorFn=b.modelComparatorFn}function d(b,c){this.config=b;this.model=c;
this.children=[]}function e(c,f,e){if(!(f instanceof d))throw new TypeError("Child must be of type Node.");f.parent=c;c.model[c.config.childrenPropertyName]instanceof Array||(c.model[c.config.childrenPropertyName]=[]);if("function"===typeof c.config.modelComparatorFn){var h=b(c.config.modelComparatorFn,c.model[c.config.childrenPropertyName],f.model);c.model[c.config.childrenPropertyName].splice(h,0,f.model);c.children.splice(h,0,f)}else if(void 0===e)c.model[c.config.childrenPropertyName].push(f.model),
c.children.push(f);else{if(0>e||e>c.children.length)throw Error("Invalid index.");c.model[c.config.childrenPropertyName].splice(e,0,f.model);c.children.splice(h,0,f)}return f}function g(){var b={};1===arguments.length?b.fn=arguments[0]:2===arguments.length?"function"===typeof arguments[0]?(b.fn=arguments[0],b.ctx=arguments[1]):(b.options=arguments[0],b.fn=arguments[1]):(b.options=arguments[0],b.fn=arguments[1],b.ctx=arguments[2]);b.options=b.options||{};b.options.strategy||(b.options.strategy="pre");
if(!m[b.options.strategy])throw Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return b}var m={};f.prototype.parse=function(b){var f;if(!(b instanceof Object))throw new TypeError("Model must be of type object.");var e=new d(this.config,b);if(b[this.config.childrenPropertyName]instanceof Array){this.config.modelComparatorFn&&(b[this.config.childrenPropertyName]=c(this.config.modelComparatorFn,b[this.config.childrenPropertyName]));var h=0;for(f=b[this.config.childrenPropertyName].length;h<
f;h++){var g=e,l=this.parse(b[this.config.childrenPropertyName][h]);l.parent=g;g.children.push(l)}}return e};d.prototype.isRoot=function(){return void 0===this.parent};d.prototype.hasChildren=function(){return 0<this.children.length};d.prototype.addChild=function(b){return e(this,b)};d.prototype.addChildAtIndex=function(b,c){if("function"===typeof this.config.modelComparatorFn)throw Error("Cannot add child at index when using a comparator function.");return e(this,b,c)};d.prototype.getPath=function(){var b=
[];(function w(c){b.unshift(c);c.isRoot()||w(c.parent)})(this);return b};d.prototype.walk=function(){var b=g.apply(this,arguments);m[b.options.strategy].call(this,b.fn,b.ctx)};m.pre=function w(b,c){var f;var d=b.call(c,this);var e=0;for(f=this.children.length;e<f;e++){if(!1===d)return!1;d=w.call(this.children[e],b,c)}return d};m.post=function r(b,c){var f;var d=0;for(f=this.children.length;d<f;d++){var e=r.call(this.children[d],b,c);if(!1===e)return!1}return e=b.call(c,this)};m.breadth=function(b,
c){var f=[this];(function y(){var d;if(0!==f.length){var e=f.shift();var h=0;for(d=e.children.length;h<d;h++)f.push(e.children[h]);!1!==b.call(c,e)&&y()}})()};d.prototype.all=function(){var b=[];var c=g.apply(this,arguments);m[c.options.strategy].call(this,function(f){c.fn.call(c.ctx,f)&&b.push(f)},c.ctx);return b};d.prototype.first=function(){var b;var c=g.apply(this,arguments);m[c.options.strategy].call(this,function(f){if(c.fn.call(c.ctx,f))return b=f,!1},c.ctx);return b};d.prototype.drop=function(){if(!this.isRoot()){var b=
this.parent.children.indexOf(this);this.parent.children.splice(b,1);this.parent.model[this.config.childrenPropertyName].splice(b,1);this.parent=void 0;delete this.parent}return this};return f}()},{"find-insert-index":2,mergesort:3}],2:[function(g,d,e){d.exports=function(){return function(c,b,f){var d;var e=0;for(d=b.length;e<d&&!(0<c(b[e],f));e++);return e}}()},{}],3:[function(g,d,e){d.exports=function(){function c(b,f){var d=f.length;if(2<=d){var e=f.slice(0,d/2);d=f.slice(d/2,d);e=c(b,e);d=c(b,
d);for(var g=[],m=e.length,n=d.length;0<m&&0<n;)0>=b(e[0],d[0])?(g.push(e.shift()),m--):(g.push(d.shift()),n--);0<m?g.push.apply(g,e):g.push.apply(g,d);return g}return f.slice()}return c}()},{}]},{},[1])(1)});
var CCTLMultiplayerGui=function(){this._cssClassDomain="ctl-multiplayer-";this._idCurDialog;this._idLoadingDialog;var a=localStorage.getItem("nickname");this._szNickName=null===a?"":a;jQuery(document).on("click","."+this._cssClassDomain+"room-list li",function(){g_oCTLMultiplayer.closeCurrentDialog();var a=jQuery(this).text();"true"===jQuery(this).attr("data-private")?g_oCTLMultiplayer.showTypeRoomPassword(a):(g_oCTLMultiplayer.showLoading("connecting"),on_ctl_multiplayer_join_room(a))})};
CCTLMultiplayerGui.prototype.refreshRoomList=function(a){for(var g="",d=0;d<a.length;d++)g+='<li data-private="'+a[d]["private"]+'">',g+="<span>",g+=a[d].name,g+="</span>",!0===a[d]["private"]&&(g+='<i class="'+this._cssClassDomain+'icons-lock"></i>'),g+="</li>";jQuery("."+this._cssClassDomain+"room-list").html(g)};
CCTLMultiplayerGui.prototype.showRoomList=function(a){var g='<ul class="'+this._cssClassDomain+'room-list">';g=g+'</ul><button onclick="on_ctl_multiplayer_refresh_room_list()" type="button" class="'+(this._cssClassDomain+"update "+this._cssClassDomain+'btn-gray">');g+='<i class="'+this._cssClassDomain+'icons-arrows-cw"></i>';this._idCurDialog=this.showDialog("Match list",g+"<span>update</span></button>",[{txt:"quick match",cb:"on_ctl_multiplayer_join_quick_match",classes:""},{txt:"create match",cb:"on_ctl_multiplayer_show_create_match",
classes:""},{txt:"back",cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}]);this.refreshRoomList(a)};CCTLMultiplayerGui.prototype.setNickName=function(a){this._szNickName=a;localStorage.setItem("nickname",a)};
CCTLMultiplayerGui.prototype.showTypeRoomPassword=function(a){var g='<div class="'+this._cssClassDomain+'form-group">';this._idCurDialog=this.showDialog("Type Room Password",g+'<label>Type Room Password</label><input type="password" name="password" data-room-name="'+(a+'"></div>'),[{txt:"ok",cb:"on_ctl_multiplayer_send_password",classes:""},{txt:"back",cb:"on_ctl_multiplayer_close_type_room_password",classes:""}])};
CCTLMultiplayerGui.prototype.showCreateRoom=function(){var a='<div class="'+this._cssClassDomain+'form-group">';a=a+'<label>Name Room</label><input type="text" name="roomname" value="'+(this._szNickName+"'s room\">");a=a+'</div><div class="'+(this._cssClassDomain+'form-group">');this._idCurDialog=this.showDialog("Create room",a+'<label>Password</label><input type="password" name="password"><p>If you don\'t set a password this room will be public.</p></div>',[{txt:"create",cb:"on_ctl_multiplayer_create_room",
classes:""},{txt:"back",cb:"on_ctl_multiplayer_close_create_room",classes:""}])};CCTLMultiplayerGui.prototype.showChooseNickName=function(){this._idCurDialog=this.showDialog("Choose nickname",'<input type="text" name="nickname" maxlength="20" value="'+this._szNickName+'">',[{txt:"ok",cb:"on_ctl_multiplayer_send_nickname",classes:""},{txt:"close",cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}])};
CCTLMultiplayerGui.prototype.showGeneralDialog=function(a,g){this._idCurDialog=this.showDialog(a,"",[{txt:"back",cb:g,classes:""}])};CCTLMultiplayerGui.prototype.closeLoadingDialog=function(){this.closeDlg(this._idLoadingDialog)};CCTLMultiplayerGui.prototype.closeCurrentDialog=function(){this.closeDlg(this._idCurDialog)};
CCTLMultiplayerGui.prototype.makeCode=function(){for(var a="",g=0;32>g;g++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a};
CCTLMultiplayerGui.prototype.showDialog=function(a,g,d,e){var c="";e||(e=this.makeCode());c+="<div id='"+e+"' class='"+this._cssClassDomain+"dlg-wrapper'>";c+="<div class='"+this._cssClassDomain+"dlg-block'></div>";c+="<div class='"+this._cssClassDomain+"dlg-content'>";c+="<div class='"+this._cssClassDomain+"dlg-header'>";c=c+("<h1>"+a+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body'>");c+=g;c+="</div>";if(d&&0<d.length){c+="<div class='"+this._cssClassDomain+"dlg-footer'>";for(a=
0;a<d.length;a++)c+="<button type='button' onclick='"+d[a].cb+'("'+e+"\");' class='"+this._cssClassDomain+"-mini "+d[a].classes+"'>"+d[a].txt+"</button>";c+=this.buildExtraFooter();c+="</div>"}c+="</div>";c+="</div>";jQuery("body").append(c);return e};CCTLMultiplayerGui.prototype.buildExtraFooter=function(){return'<div class="'+this._cssClassDomain+'copyright"><a href="http://www.codethislab.com" target="_blank">www.codethislab.com</a></div>'};
CCTLMultiplayerGui.prototype.showLoading=function(a,g){var d="";this._idLoadingDialog=this.makeCode();a||(a="Loading...");d+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";d+="<div class='"+this._cssClassDomain+"dlg-block'></div>";d+="<div class='"+this._cssClassDomain+"dlg-content'>";d+="<div class='"+this._cssClassDomain+"dlg-header'>";d=d+("<h1>"+a+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+
"align-center'>");d+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>';d+="</div>";g&&(d+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",d+="<button type='button' onclick='"+g+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"-mini '>back</button>",d+=this.buildExtraFooter(),d+="</div>");d+="</div>";d+="</div>";jQuery("body").append(d)};CCTLMultiplayerGui.prototype.closeDlg=function(a){jQuery("#"+a).remove()};
CCTLMultiplayerGui.prototype.closeAllDialog=function(){g_oCTLMultiplayer.closeLoadingDialog();g_oCTLMultiplayer.closeCurrentDialog()};CCTLMultiplayerGui.prototype.getNickname=function(){return this._szNickName};var g_oCTLMultiplayer=new CCTLMultiplayerGui,s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var g=a.toLowerCase(),d=window.document,e=d.documentElement;if(void 0===window["inner"+a])a=e["client"+a];else if(window["inner"+a]!=e["client"+a]){var c=d.createElement("body");c.id="vpw-test-b";c.style.cssText="overflow:scroll";var b=d.createElement("div");b.id="vpw-test-d";b.style.cssText="position:absolute;top:-1000px";b.innerHTML="<style>@media("+g+":"+e["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+g+":7px!important}}</style>";c.appendChild(b);e.insertBefore(c,d.head);
a=7==b["offset"+a]?e["client"+a]:window["inner"+a];e.removeChild(c)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}
function isIOS(){var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);a.length;)if(navigator.platform===a.pop())return!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function playSound(a,g,d){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(g),s_aSounds[a].loop(d),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].stop()}function setVolume(a,g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].volume(g)}function setMute(a,g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].mute(g)}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var g=getSize("Width");_checkOrientation(g,a);var d=Math.min(a/CANVAS_HEIGHT,g/CANVAS_WIDTH),e=CANVAS_WIDTH*d;d*=CANVAS_HEIGHT;if(d<a){var c=a-d;d+=c;e+=CANVAS_WIDTH/CANVAS_HEIGHT*c}else e<g&&(c=g-e,e+=c,d+=CANVAS_HEIGHT/CANVAS_WIDTH*c);c=a/2-d/2;var b=g/2-e/2,f=CANVAS_WIDTH/e;if(b*f<-EDGEBOARD_X||c*f<-EDGEBOARD_Y)d=Math.min(a/(CANVAS_HEIGHT-2*
EDGEBOARD_Y),g/(CANVAS_WIDTH-2*EDGEBOARD_X)),e=CANVAS_WIDTH*d,d*=CANVAS_HEIGHT,c=(a-d)/2,b=(g-e)/2,f=CANVAS_WIDTH/e;s_iOffsetX=-1*b*f;s_iOffsetY=-1*c*f;0<=c&&(s_iOffsetY=0);0<=b&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oModeMenu&&s_oModeMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*e,s_oStage.canvas.height=
2*d,canvas.style.width=e+"px",canvas.style.height=d+"px",s_oStage.scaleX=s_oStage.scaleY=2*Math.min(e/CANVAS_WIDTH,d/CANVAS_HEIGHT)):s_bMobile||isChrome()?($("#canvas").css("width",e+"px"),$("#canvas").css("height",d+"px")):(s_oStage.canvas.width=e,s_oStage.canvas.height=d,s_iScaleFactor=Math.min(e/CANVAS_WIDTH,d/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>c?$("#canvas").css("top",c+"px"):$("#canvas").css("top","0px");$("#canvas").css("left",b+"px");fullscreenHandler()}}
function _checkOrientation(a,g){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>g?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(a,g,d){var e=new createjs.Bitmap(a),c=new createjs.Shape;g&&d?c.graphics.beginFill("#fff").drawRect(0,0,g,d):c.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);e.hitArea=c;return e}function createSprite(a,g,d,e,c,b){a=null!==g?new createjs.Sprite(a,g):new createjs.Sprite(a);g=new createjs.Shape;g.graphics.beginFill("#000000").drawRect(-d,-e,c,b);a.hitArea=g;return a}
function pad(a,g,d){a+="";return a.length>=g?a:Array(g-a.length+1).join(d||"0")+a}function randomFloatBetween(a,g,d){"undefined"===typeof d&&(d=2);return parseFloat(Math.min(a+Math.random()*(g-a),g).toFixed(d))}function rotateVector2D(a,g){var d=g.getX()*Math.cos(a)+g.getY()*Math.sin(a),e=g.getX()*-Math.sin(a)+g.getY()*Math.cos(a);g.set(d,e)}function tweenVectorsOnX(a,g,d){return a+d*(g-a)}
function shuffle(a){for(var g=a.length,d,e;0!==g;)e=Math.floor(Math.random()*g),--g,d=a[g],a[g]=a[e],a[e]=d;return a}function bubbleSort(a){do{var g=!1;for(var d=0;d<a.length-1;d++)a[d]>a[d+1]&&(g=a[d],a[d]=a[d+1],a[d+1]=g,g=!0)}while(g)}function compare(a,g){return a.index>g.index?-1:a.index<g.index?1:0}function easeLinear(a,g,d,e){return d*a/e+g}function easeInQuad(a,g,d,e){return d*(a/=e)*a+g}function easeInSine(a,g,d,e){return-d*Math.cos(a/e*(Math.PI/2))+d+g}
function easeInCubic(a,g,d,e){return d*(a/=e)*a*a+g}function getTrajectoryPoint(a,g){var d=new createjs.Point,e=(1-a)*(1-a),c=a*a;d.x=e*g.start.x+2*(1-a)*a*g.traj.x+c*g.end.x;d.y=e*g.start.y+2*(1-a)*a*g.traj.y+c*g.end.y;return d}function formatTime(a){a/=1E3;var g=Math.floor(a/60);a=Math.floor(a-60*g);var d="";d=10>g?d+("0"+g+":"):d+(g+":");return 10>a?d+("0"+a):d+a}function degreesToRadians(a){return a*Math.PI/180}
function checkRectCollision(a,g){var d=getBounds(a,.9);var e=getBounds(g,.98);return calculateIntersection(d,e)}function calculateIntersection(a,g){var d,e,c,b;var f=a.x+(d=a.width/2);var h=a.y+(e=a.height/2);var l=g.x+(c=g.width/2);var k=g.y+(b=g.height/2);f=Math.abs(f-l)-(d+c);h=Math.abs(h-k)-(e+b);return 0>f&&0>h?(f=Math.min(Math.min(a.width,g.width),-f),h=Math.min(Math.min(a.height,g.height),-h),{x:Math.max(a.x,g.x),y:Math.max(a.y,g.y),width:f,height:h,rect1:a,rect2:g}):null}
function getBounds(a,g){var d={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){d.x2=-Infinity;d.y2=-Infinity;var e=a.children,c=e.length,b;for(b=0;b<c;b++){var f=getBounds(e[b],1);f.x<d.x&&(d.x=f.x);f.y<d.y&&(d.y=f.y);f.x+f.width>d.x2&&(d.x2=f.x+f.width);f.y+f.height>d.y2&&(d.y2=f.y+f.height)}Infinity==d.x&&(d.x=0);Infinity==d.y&&(d.y=0);Infinity==d.x2&&(d.x2=0);Infinity==d.y2&&(d.y2=0);d.width=d.x2-d.x;d.height=d.y2-d.y;delete d.x2;delete d.y2}else{if(a instanceof createjs.Bitmap){c=
a.sourceRect||a.image;b=c.width*g;var h=c.height*g}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){c=a.spriteSheet.getFrame(a.currentFrame);b=c.rect.width;h=c.rect.height;e=c.regX;var l=c.regY}else d.x=a.x||0,d.y=a.y||0;else d.x=a.x||0,d.y=a.y||0;e=e||0;b=b||0;l=l||0;h=h||0;d.regX=e;d.regY=l;c=a.localToGlobal(0-e,0-l);f=a.localToGlobal(b-e,h-l);b=a.localToGlobal(b-e,0-l);e=a.localToGlobal(0-e,h-l);d.x=
Math.min(Math.min(Math.min(c.x,f.x),b.x),e.x);d.y=Math.min(Math.min(Math.min(c.y,f.y),b.y),e.y);d.width=Math.max(Math.max(Math.max(c.x,f.x),b.x),e.x)-d.x;d.height=Math.max(Math.max(Math.max(c.y,f.y),b.y),e.y)-d.y}return d}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var g=a.length,d,e;0<g;)e=Math.floor(Math.random()*g),g--,d=a[g],a[g]=a[e],a[e]=d;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);a.dispatchEvent(g)}}};
(function(){function a(a){var d={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in d?document.body.className=d[a.type]:(document.body.className=this[g]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var g="hidden";g in document?document.addEventListener("visibilitychange",a):(g="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(g="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(g="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function compareRow(a,g){return a.row>g.row?1:a.row<g.row?-1:0}function compareCol(a,g){return a.col>g.col?1:a.col<g.col?-1:0}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}
function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}function getParamValue(a){for(var g=window.location.search.substring(1).split("&"),d=0;d<g.length;d++){var e=g[d].split("=");if(e[0]==a)return e[1]}}String.prototype.format=function(){for(var a=this,g=arguments.length;g--;)a=a.replace(new RegExp("\\{"+g+"\\}","gm"),arguments[g]);return a};
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut())}
if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a,g,d,e,c,b;this.init=function(f,h,l){d=g=0;e=f;c=h;b=l;a={}};this.addSprite=function(b,c){a.hasOwnProperty(b)||(a[b]={szPath:c,oSprite:new Image},g++)};this.getSprite=function(b){return a.hasOwnProperty(b)?a[b].oSprite:null};this._onSpritesLoaded=function(){c.call(b)};this._onSpriteLoaded=function(){e.call(b);++d==g&&this._onSpritesLoaded()};this.loadSprites=function(){for(var b in a)a[b].oSprite.oSpriteLibrary=this,a[b].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
a[b].oSprite.src=a[b].szPath};this.getNumSprites=function(){return g}}
function CTextButton(a,g,d,e,c,b,f,h){var l,k,m,n,q,t,w;this._init=function(b,c,a,f,d,e,g,h){l=[];k=[];var t=createBitmap(a),r=Math.ceil(g/20);q=new createjs.Text(f,"bold "+g+"px "+d,"#000000");q.textAlign="center";q.textBaseline="alphabetic";var w=q.getBounds();q.x=a.width/2+r;q.y=Math.floor(a.height/2)+w.height/3+r;n=new createjs.Text(f,"bold "+g+"px "+d,e);n.textAlign="center";n.textBaseline="alphabetic";w=n.getBounds();n.x=a.width/2;n.y=Math.floor(a.height/2)+w.height/3;m=new createjs.Container;
m.x=b;m.y=c;m.regX=a.width/2;m.regY=a.height/2;m.addChild(t,q,n);h.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",t);m.off("pressup",w);h.removeChild(m)};this.setVisible=function(b){m.visible=b};this._initListener=function(){oParent=this;t=m.on("mousedown",this.buttonDown);w=m.on("pressup",this.buttonRelease)};this.addEventListener=function(b,c,a){l[b]=c;k[b]=a};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(k[ON_MOUSE_UP])};this.buttonDown=
function(){m.scaleX=.9;m.scaleY=.9;l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN])};this.setTextPosition=function(b){n.y=b;q.y=b+2};this.setPosition=function(b,c){m.x=b;m.y=c};this.setX=function(b){m.x=b};this.setY=function(b){m.y=b};this.getButtonImage=function(){return m};this.getX=function(){return m.x};this.getY=function(){return m.y};this._init(a,g,d,e,c,b,f,h);return this}
function CToggle(a,g,d,e,c){var b,f,h,l,k=[],m,n,q,t;this._init=function(a,d,e,g){f=!1;h=[];l=[];var k=new createjs.SpriteSheet({images:[e],frames:{width:e.width/2,height:e.height,regX:e.width/2/2,regY:e.height/2},animations:{state_true:[0],state_false:[1]}});b=g;m=createSprite(k,"state_"+b,e.width/2/2,e.height/2,e.width/2,e.height);m.x=a;m.y=d;m.stop();c.addChild(m);this._initListener()};this.unload=function(){s_bMobile?m.off("mousedown",n):(m.off("mousedown",n),m.off("mouseover",q));m.off("pressup",
t);c.removeChild(m)};this._initListener=function(){s_bMobile?n=m.on("mousedown",this.buttonDown):(n=m.on("mousedown",this.buttonDown),q=m.on("mouseover",this.buttonOver));t=m.on("pressup",this.buttonRelease)};this.addEventListener=function(b,c,a){h[b]=c;l[b]=a};this.addEventListenerWithParams=function(b,c,a,f){h[b]=c;l[b]=a;k=f};this.setActive=function(c){b=c;m.gotoAndStop("state_"+b)};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;playSound("click",1,!1);b=!b;m.gotoAndStop("state_"+b);h[ON_MOUSE_UP]&&
h[ON_MOUSE_UP].call(l[ON_MOUSE_UP],k)};this.buttonDown=function(){m.scaleX=.9;m.scaleY=.9;h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN],k)};this.buttonOver=function(b){s_bMobile||f||(b.target.cursor="pointer")};this.setPosition=function(b,c){m.x=b;m.y=c};this.setVisible=function(b){m.visible=b};this._init(a,g,d,e)}
function CGfxButton(a,g,d,e){var c,b,f,h,l,k,m,n;this._init=function(a,d,e,g){c=!1;b=1;f=[];h=[];l=createBitmap(e);l.x=a;l.y=d;l.scaleX=l.scaleY=b;l.regX=e.width/2;l.regY=e.height/2;g.addChild(l);this._initListener()};this.unload=function(){s_bMobile?l.off("mousedown",k):(l.off("mousedown",k),l.off("mouseover",m));l.off("pressup",n);e.removeChild(l)};this.setVisible=function(b){l.visible=b};this.setClickable=function(b){c=!b};this.setScale=function(c){b=c;l.scaleX=l.scaleY=c};this._initListener=function(){s_bMobile?
k=l.on("mousedown",this.buttonDown):(k=l.on("mousedown",this.buttonDown),m=l.on("mouseover",this.buttonOver));n=l.on("pressup",this.buttonRelease)};this.addEventListener=function(b,c,a){f[b]=c;h[b]=a};this.buttonRelease=function(){c||(l.scaleX=b,l.scaleY=b,f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(h[ON_MOUSE_UP]))};this.buttonDown=function(){c||(l.scaleX=.9*b,l.scaleY=.9*b,playSound("click",1,!1),f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN]))};this.buttonOver=function(b){s_bMobile||c||(b.target.cursor=
"pointer")};this.pulseAnimation=function(){createjs.Tween.get(l).to({scaleX:.9*b,scaleY:.9*b},850,createjs.Ease.quadOut).to({scaleX:b,scaleY:b},650,createjs.Ease.quadIn).call(function(){q.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(l).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){q.trebleAnimation()})};this.setPosition=function(b,c){l.x=b;l.y=c};this.setX=function(b){l.x=
b};this.setY=function(b){l.y=b};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};var q=this;this._init(a,g,d,e);return this}
var ON_CONNECTION_ERROR=0,ON_DISCONNECTION=1,ON_LOGIN_SUCCESS=2,ON_MATCHMAKING_CONNECTION_SUCCESS=3,ON_GAMEROOM_CONNECTION_SUCCESS=4,ON_USEROWNERROOM_CREATE_SUCCESS=5,ON_USEROWNERROOM_JOIN_SUCCESS=6,ON_ROOM_INFO_RETURNED=7,ON_BACK_FROM_A_ROOM=8,ERROR_CODE_UNKNOWNROOM="UnknownRoom",ROOM_TYPE_MATCHMAKING="MatchmakingRoom",ROOM_TYPE_USEROWNER="UserOwnerRoom",ROOM_TYPE_GAME="GameRoom";
function CNetworkManager(){var a,g,d,e,c,b,f,h,l,k,m;this._init=function(){a=[];g=[];c=new CNetworkMessageForwarder};this.unload=function(){s_oNetworkManager=null};this.connectToSystem=function(){s_oNetworkManager.addEventListener(ON_LOGIN_SUCCESS,s_oNetworkManager.gotoLobby);g_oCTLMultiplayer.showChooseNickName()};this.login=function(b){f=b;b=this._setValidNick(b);PlayerIO.useSecureApiRequests=!MULTIPLAYER_TEST_LOCAL;PlayerIO.authenticate(GAME_PLAYERIO_ID,"public",{userId:b},{},function(b){e=b;e.multiplayer.useSecureConnections=
!MULTIPLAYER_TEST_LOCAL;MULTIPLAYER_TEST_LOCAL&&(e.multiplayer.developmentServer="localhost:8184",e.multiplayer.createJoinRoom("fakeroom"+Math.random(),"fakeroom",!1,null,null,function(b){b.addMessageCallback("*",c.messageHandler);b.addDisconnectCallback(s_oNetworkManager.callbackDisconnect)},s_oNetworkManager.callbackError));a[ON_LOGIN_SUCCESS]&&a[ON_LOGIN_SUCCESS].call(g[ON_LOGIN_SUCCESS])},s_oNetworkManager.callbackError)};this._setValidNick=function(b){var c=s_oNetworkManager._getRandomCodeNumber();
""===b?f=b="guest-"+c:b=b+"-"+c;return b};this._getRandomCodeNumber=function(){return Math.floor(1E3*Math.random())};this.generateRandomName=function(){var b="xmariox alex max mahuro biajus rob idah fabrix seth ikillyou commander admiral general seasalt emperorofthesea Aspect Kraken Dragon Shiver Dracula Doom Scar Roadkill Cobra Psycho Ranger Ripley Clink Bruise Bowser Creep Cannon Daemon Steel Tempest Hurricane Titanium Tito Lightning IronHeart Sabotage Rex Hydra Terminator Agrippa Gash Blade Katana Gladius Angon Claymore Pike Hammer Club Heart Gauntlet Montante Longbow bow Dagger".split(" "),
c=Math.floor(Math.random()*b.length);b=b[c];if(.5<Math.random()){var a=Math.floor(100*Math.random());if(.5<Math.random()){var f=["-","_"];c=Math.floor(Math.random()*f.length);b+=f[c]}b+=a}return m=b};this.getBotName=function(){return m};this.addEventListener=function(b,c,f){a[b]=c;g[b]=f};this.callbackError=function(b){a[ON_CONNECTION_ERROR]&&a[ON_CONNECTION_ERROR].call(g[ON_CONNECTION_ERROR],b)};this.callbackDisconnect=function(b){a[ON_DISCONNECTION]&&a[ON_DISCONNECTION].call(g[ON_DISCONNECTION],
b)};this.sendMsg=function(b,c){d&&d.send(b,c)};this.disconnect=function(){d&&(d.disconnect(),d=null)};this.isUserA=function(){return 0===parseInt(b)?!0:!1};this.getPlayerOrderID=function(){return b};this.getPlayerNickname=function(){return f};this.getEnemyNickname=function(){return h};this.createRoom=function(b,h){s_oNetworkManager.addEventListener(ON_USEROWNERROOM_CREATE_SUCCESS,this._onRoomCreated);MULTIPLAYER_TEST_LOCAL&&(e.multiplayer.developmentServer="localhost:8184");e.multiplayer.createJoinRoom(b,
ROOM_TYPE_USEROWNER,!0,{id:b,pass:h},{nickname:f},function(b){d=b;b.addMessageCallback("*",c.messageHandler);b.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_USEROWNERROOM_CREATE_SUCCESS]&&a[ON_USEROWNERROOM_CREATE_SUCCESS].call(g[ON_USEROWNERROOM_CREATE_SUCCESS])},s_oNetworkManager.callbackError)};this.joinRoom=function(b){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,this._onRoomJoinedFailed);MULTIPLAYER_TEST_LOCAL&&(e.multiplayer.developmentServer="localhost:8184");e.multiplayer.joinRoom(b,
{nickname:f},function(b){d=b;b.addMessageCallback("*",c.messageHandler);b.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_USEROWNERROOM_JOIN_SUCCESS]&&a[ON_USEROWNERROOM_JOIN_SUCCESS].call(g[ON_USEROWNERROOM_JOIN_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoGameRoom=function(f){MULTIPLAYER_TEST_LOCAL&&(e.multiplayer.developmentServer="localhost:8184");var l=f.getString(0);b=f.getInt(1);h=f.getString(2);e.multiplayer.createJoinRoom(l,ROOM_TYPE_GAME,!1,null,null,function(b){d=
b;b.addMessageCallback("*",c.messageHandler);b.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);g_oCTLMultiplayer.closeAllDialog();a[ON_GAMEROOM_CONNECTION_SUCCESS]&&a[ON_GAMEROOM_CONNECTION_SUCCESS].call(g[ON_GAMEROOM_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoMatchMakingRoom=function(){MULTIPLAYER_TEST_LOCAL&&(e.multiplayer.developmentServer="localhost:8184");e.multiplayer.createJoinRoom("matchmakingroom1",ROOM_TYPE_MATCHMAKING,!0,null,{nickname:f},function(b){d=
b;b.addMessageCallback("*",c.messageHandler);b.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_MATCHMAKING_CONNECTION_SUCCESS]&&a[ON_MATCHMAKING_CONNECTION_SUCCESS].call(g[ON_MATCHMAKING_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.tryCreateUniqueRoom=function(b,c){l=b;k=c;e.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:b},0,0,s_oNetworkManager._onUniqueListRoomSearch,s_oNetworkManager.callbackError)};this._onUniqueListRoomSearch=function(b){0<b.length&&(l+="-"+s_oNetworkManager._getRandomCodeNumber());
s_oNetworkManager.createRoom(l,k)};this._onRoomCreated=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_WAITING_FOR_OPPONENT_IN_ROOM+l,"s_oNetworkManager._onDisconnectFromARoom")};this._onDisconnectFromARoom=function(){a[ON_BACK_FROM_A_ROOM]&&a[ON_BACK_FROM_A_ROOM].call(g[ON_BACK_FROM_A_ROOM]);s_oNetworkManager.disconnect();setTimeout(function(){s_oNetworkManager.gotoLobby()},250)};this._onRoomJoined=function(){};this._onRoomJoinedFailed=function(b){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,
function(){});switch(b.code){case ERROR_CODE_UNKNOWNROOM:g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby")}};this.gotoLobby=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY);e.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,s_oNetworkManager._onListRoom,s_oNetworkManager.callbackError)};this._onListRoom=function(b){for(var c=[],a=0;a<b.length;a++)c[a]={name:b[a].id,"private":0===
b[a].roomData.pass.length?!1:!0};g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showRoomList(c)};this.joinQuickMatch=function(){g_oCTLMultiplayer.showLoading(TEXT_FIND_OPPONENT,"s_oNetworkManager._onDisconnectFromARoom");s_oNetworkManager.gotoMatchMakingRoom()};this.tryJoinRoomWithPass=function(b,c){l=b;k=c;s_oNetworkManager.addEventListener(ON_ROOM_INFO_RETURNED,s_oNetworkManager._checkUserPermissionToJoin);s_oNetworkManager.getRoomInfo(b,c)};this._checkUserPermissionToJoin=function(b){0<b.length?
s_oNetworkManager.joinRoom(b[0].roomData.id,b[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_WRONG_PASSWORD,"s_oNetworkManager._onPasswordFailed"))};this._onPasswordFailed=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showTypeRoomPassword(l)};this.getRoomInfo=function(b,c){e.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:b,pass:c},0,0,s_oNetworkManager._onRoomInfoReturned,s_oNetworkManager.callbackError)};this._onRoomInfoReturned=function(b){a[ON_ROOM_INFO_RETURNED]&&
a[ON_ROOM_INFO_RETURNED].call(g[ON_ROOM_INFO_RETURNED],b)};this._init()}var MSG_ROOM_IS_FULL="room_is_full",MSG_GAME_FOUND="game_found",MSG_SET_WINNER="set_winner",MSG_REMATCH_PANEL="rematch_panel",MSG_REMATCH_ANSWER_RESULTS="rematch_answer_results",MSG_ENEMY_MOVES="enemy_moves",MSG_END_MATCH="end_match",MSG_ACCEPT_REMATCH="accept_rematch",MSG_DISCONNECTION="disconnection",MSG_MOVE="move";
function CNetworkMessageForwarder(){this._init=function(){};this.messageHandler=function(g){switch(g.type){case MSG_ROOM_IS_FULL:a._onFullRoom(g);break;case MSG_GAME_FOUND:a._onGameFound(g);break;case MSG_SET_WINNER:a._onSetWinner(g);break;case MSG_REMATCH_PANEL:a._onRematchPanel(g);break;case MSG_REMATCH_ANSWER_RESULTS:a._onRematchResults(g);break;case MSG_ENEMY_MOVES:a._onEnemyMoves(g)}};this._onFullRoom=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_FULL,
"s_oNetworkManager.gotoLobby")};this._onGameFound=function(a){s_oNetworkManager.gotoGameRoom(a)};this._onSetWinner=function(a){s_oGame.opponentLeftTheGame()};this._onRematchPanel=function(){s_oGame.showRematchQuestion()};this._onRematchResults=function(a){if(a.getBoolean(0))s_oGame.onOpponentAcceptRematch();else s_oGame.onOpponentRefuseRematch()};this._onEnemyMoves=function(a){a=a.getString(0);a=JSON.parse(a);s_oGame.remoteMovePiece(a[MSG_MOVE])};var a=this;this._init()}
function CAreYouSurePanel(a){var g,d,e,c,b,f,h,l;this._init=function(a){f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=0;l=f.on("mousedown",function(){});s_oStage.addChild(f);(new createjs.Tween.get(f)).to({alpha:.7},500);h=new createjs.Container;s_oStage.addChild(h);a=s_oSpriteLibrary.getSprite("msg_box");var k=createBitmap(a);k.regX=a.width/2;k.regY=a.height/2;h.addChild(k);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT+a.height/2;g=h.y;(new createjs.Tween.get(h)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.cubicOut);d=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#000000");d.y=-a.height/2+120;d.textAlign="center";d.textBaseline="middle";d.lineWidth=600;d.outline=5;e=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#ffffff");e.y=d.y;e.textAlign="center";e.textBaseline="middle";e.lineWidth=600;h.addChild(e);c=new CGfxButton(170,80,s_oSpriteLibrary.getSprite("but_yes"),h);c.addEventListener(ON_MOUSE_UP,this._onButYes,this);b=new CGfxButton(-170,80,s_oSpriteLibrary.getSprite("but_no"),
h);b.addEventListener(ON_MOUSE_UP,this._onButNo,this);b.pulseAnimation()};this._onButYes=function(){b.setClickable(!1);c.setClickable(!1);(new createjs.Tween.get(f)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:g},400,createjs.Ease.backIn).call(function(){k.unload();a()})};this._onButNo=function(){b.setClickable(!1);c.setClickable(!1);(new createjs.Tween.get(f)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:g},400,createjs.Ease.backIn).call(function(){k.unload()})};this.changeMessage=
function(b,c){d.text=b;e.text=b;c&&(d.font=" "+c+"px "+PRIMARY_FONT,e.font=" "+c+"px "+PRIMARY_FONT)};this.unload=function(){b.unload();c.unload();s_oStage.removeChild(f);s_oStage.removeChild(h);f.off("mousedown",l)};var k=this;this._init(a)}
function CTreeDecision(a){var g,d,e;this._init=function(c){g=[];for(var b=0;b<SEARCH_DEPTH+1;b++)g[b]=[];d=new TreeModel;e=d.parse(c);g[0][0]=e};this.getRoot=function(){return e};this.initNewNode=function(c){g[c].push(d.parse({rating:0,moves:[],depth:c}));return g[c][g[c].length-1]};this.addNode=function(c,b,a){var f=c+1,d=g[f].length-1;g[f][d].model.moves=a;g[f][d].model.rating=b;g[c][g[c].length-1].addChild(g[f][d])};this.rateNode=function(c,b){c.model.rating=b};this.getNode=function(c,b){return e.all(function(a){return a.model.rating===
c&&a.model.depth===b})};this.getPath=function(c){return c.getPath()};this.getTerminalNodes=function(){return e.all(function(c){return!c.hasChildren()})};this._init(a)}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=1920,EDGEBOARD_X=150,EDGEBOARD_Y=280,FPS_TIME=1E3/24,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="arialrounded",GAME_PLAYERIO_ID="master-chess-e6yiz5o6zk6hiyfnexvrqa",GAME_NAME="masterchess_multiplayer",MULTIPLAYER_TEST_LOCAL=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,MODE_HUMAN=0,MODE_COMPUTER=1,EASY_MODE=0,MEDIUM_MODE=1,HARD_MODE=2,WHITE="white",BLACK="black",PAWN=
"pawn",ROOK="rook",KNIGHT="knight",BISHOP="bishop",QUEEN="queen",KING="king",PLAYER_STATE_WAIT=0,PLAYER_STATE_SELECTED=1,PLAYER_STATE_MOVING=2,BOARD_STATE_STALEMATE=0,BOARD_STATE_CHECK=1,BOARD_STATE_PROMOTION=2,BOARD_STATE_CHECKMATE=3,BOARD_SPECIAL_CASTLING_RIGHT=0,BOARD_SPECIAL_CASTLING_LEFT=1,BOARD_SPECIAL_ENPASSANT=2,NUM_CELL=8,BOARD_LENGTH=815,CELL_LENGTH=BOARD_LENGTH/NUM_CELL,DRAW=-1,TIME_MOVE=1E3,TIME_LOOP_WAIT=1E3,MIN_AI_THINKING=1E3,MAX_AI_THINKING=1500,INFINITE=99999,SEARCH_DEPTH,DRAW_COUNTER=
50,START_SCORE,SCORE_DECREASE_PER_SECOND,SHOW_SCORE,ENABLE_CHECK_ORIENTATION,ENABLE_FULLSCREEN,TIME_AD=12E4,TEXT_PRELOADER_CONTINUE="START",TEXT_DRAW="DRAW",TEXT_WINS="({0} wins)",TEXT_CHECKMATE="CHECKMATE!",TEXT_STALEMATE="STALEMATE!",TEXT_THINKING="THINKING",TEXT_ARE_SURE="ARE YOU SURE?",TEXT_MODE="CHOOSE GAME MODE",TEXT_BLACK="BLACK",TEXT_WHITE="WHITE",TEXT_PROMOTION="SELECT THE PIECE YOU WANT TO PROMOTE YOUR PAWN INTO",TEXT_CHECK="CHECK!",TEXT_CREDITS_DEVELOPED="DEVELOPED BY",TEXT_SHARE_IMAGE=
"200x200.jpg",TEXT_SHARE_TITLE="Congratulations!",TEXT_SHARE_MSG1="You collected <strong>",TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!",TEXT_SHARE_SHARE1="My score is ",TEXT_SHARE_SHARE2=" points! Can you do better?",TEXT_NETWORK_CONNECTING="CONNECTING...",TEXT_WAIT_OPPONENT="WAITING OPPONENT...",TEXT_OPPONENT_LEFT="OPPONENT LEFT!",TEXT_PLAYER_DISCONNECTED="YOU LEFT!",TEXT_REMATCH="do you want the re-match?",TEXT_WRONG_PASSWORD="Wrong Password!",TEXT_ROOM_IS_FULL=
"Room is full!",TEXT_FIND_OPPONENT="finding opponent...",TEXT_CONNECT_TO_LOBBY="Connect to lobby...",TEXT_ROOM_DOESNT_EXIST="Room doesn't exist!",TEXT_WAITING_FOR_OPPONENT_IN_ROOM="waiting for opponent in room: ";
function CPreloader(){var a,g,d,e,c,b,f,h,l,k;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();k=new createjs.Container;s_oStage.addChild(k)};this.unload=function(){k.removeAllChildren();l.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(m);m=s_oSpriteLibrary.getSprite("200x200");f=createBitmap(m);f.regX=.5*m.width;f.regY=.5*m.height;f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2-180;k.addChild(f);h=new createjs.Shape;h.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(f.x-100,f.y-100,200,200,10);k.addChild(h);f.mask=h;
m=s_oSpriteLibrary.getSprite("progress_bar");e=createBitmap(m);e.x=CANVAS_WIDTH/2-m.width/2;e.y=CANVAS_HEIGHT/2+50;k.addChild(e);a=m.width;g=m.height;c=new createjs.Shape;c.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(e.x,e.y,1,g);k.addChild(c);e.mask=c;d=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2+100;d.textBaseline="alphabetic";d.textAlign="center";k.addChild(d);m=s_oSpriteLibrary.getSprite("but_start");l=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,m,TEXT_PRELOADER_CONTINUE,"Arial","#000",40,k);l.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);l.setVisible(!1);b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(b);createjs.Tween.get(b).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(b);k.removeChild(b)})};this._onButStartRelease=function(){$(s_oMain).trigger("show_preroll_ad");s_oMain._onPreloaderComplete()};this.refreshLoader=function(b){d.text=b+"%";100===b&&(l.setVisible(!0),
d.visible=!1,e.visible=!1);c.graphics.clear();b=Math.floor(b*a/100);c.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(e.x,e.y,b,g)};this._init()}
function CCreditsPanel(){var a,g,d,e,c,b,f,h,l;this._init=function(){c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;s_oStage.addChild(c);(new createjs.Tween.get(c)).to({alpha:.7},500);var k=s_oSpriteLibrary.getSprite("msg_box");l=new createjs.Container;l.y=CANVAS_HEIGHT+k.height/2;s_oStage.addChild(l);a=createBitmap(k);a.regX=k.width/2;a.regY=k.height/2;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2;l.addChild(a);f=new createjs.Shape;f.graphics.beginFill("#0f0f0f").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=.01;b=f.on("click",this._onLogoButRelease);l.addChild(f);k=s_oSpriteLibrary.getSprite("but_exit");d=new CGfxButton(1E3,610,k,l);d.addEventListener(ON_MOUSE_UP,this.unload,this);e=new createjs.Text(TEXT_CREDITS_DEVELOPED,"80px "+PRIMARY_FONT,"#402604");e.textAlign="center";e.textBaseline="alphabetic";e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2-100;l.addChild(e);k=s_oSpriteLibrary.getSprite("logo_ctl");g=createBitmap(k);g.regX=k.width/2;g.regY=k.height/2;g.x=CANVAS_WIDTH/
2;g.y=CANVAS_HEIGHT/2;l.addChild(g);h=new createjs.Text("www.codethislab.com","68px "+PRIMARY_FONT,"#402604");h.textAlign="center";h.textBaseline="alphabetic";h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2+130;l.addChild(h);(new createjs.Tween.get(l)).to({y:0},1E3,createjs.Ease.backOut)};this.unload=function(){f.off("click",b);d.unload();d=null;s_oStage.removeChild(c);s_oStage.removeChild(l)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CMain(a){var g,d=0,e=0,c=STATE_LOADING,b;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(b){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=30;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=
!0);s_oSpriteLibrary=new CSpriteLibrary;s_oNetworkManager=new CNetworkManager;b=new CPreloader};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();g=!0};this.soundLoaded=function(){d++;b.refreshLoader(Math.floor(d/e*100))};this._initSounds=function(){var b=[];b.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});b.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"});b.push({path:"./sounds/",
filename:"win",loop:!1,volume:1,ingamename:"win"});e+=b.length;s_aSounds=[];for(var c=0;c<b.length;c++)s_aSounds[b[c].ingamename]=new Howl({src:[b[c].path+b[c].filename+".mp3"],autoplay:!1,preload:!0,loop:b[c].loop,volume:b[c].volume,onload:s_oMain.soundLoaded})};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("local_but","./sprites/local_but.png");s_oSpriteLibrary.addSprite("multiplayer_but","./sprites/multiplayer_but.png");
s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_mod_menu","./sprites/bg_mod_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_vs_man",
"./sprites/vs_man_panel.png");s_oSpriteLibrary.addSprite("but_vs_pc","./sprites/vs_pc_panel.png");s_oSpriteLibrary.addSprite("message","./sprites/message.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_show","./sprites/but_show.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_settings","./sprites/but_settings.png");s_oSpriteLibrary.addSprite("board8",
"./sprites/grid_8.png");s_oSpriteLibrary.addSprite("threat","./sprites/threat.png");s_oSpriteLibrary.addSprite("highlight","./sprites/highlight.png");s_oSpriteLibrary.addSprite("bg_turn","./sprites/player_panel.png");s_oSpriteLibrary.addSprite("audio_icon_big","./sprites/audio_icon_big.png");s_oSpriteLibrary.addSprite("black_bishop","./sprites/pieces/black_bishop.png");s_oSpriteLibrary.addSprite("black_king","./sprites/pieces/black_king.png");s_oSpriteLibrary.addSprite("black_knight","./sprites/pieces/black_knight.png");
s_oSpriteLibrary.addSprite("black_pawn","./sprites/pieces/black_pawn.png");s_oSpriteLibrary.addSprite("black_queen","./sprites/pieces/black_queen.png");s_oSpriteLibrary.addSprite("black_rook","./sprites/pieces/black_rook.png");s_oSpriteLibrary.addSprite("white_bishop","./sprites/pieces/white_bishop.png");s_oSpriteLibrary.addSprite("white_king","./sprites/pieces/white_king.png");s_oSpriteLibrary.addSprite("white_knight","./sprites/pieces/white_knight.png");s_oSpriteLibrary.addSprite("white_pawn","./sprites/pieces/white_pawn.png");
s_oSpriteLibrary.addSprite("white_queen","./sprites/pieces/white_queen.png");s_oSpriteLibrary.addSprite("white_rook","./sprites/pieces/white_rook.png");s_oSpriteLibrary.addSprite("white_king_marker","./sprites/white_king_marker.png");s_oSpriteLibrary.addSprite("black_king_marker","./sprites/black_king_marker.png");s_oSpriteLibrary.addSprite("score_panel","./sprites/score_panel.png");s_oSpriteLibrary.addSprite("toggle_easy","./sprites/toggle_easy.png");s_oSpriteLibrary.addSprite("toggle_medium","./sprites/toggle_medium.png");
s_oSpriteLibrary.addSprite("toggle_hard","./sprites/toggle_hard.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");if(CloudAPI.logos.active()){var b=CloudAPI.logos.list();s_oSpriteLibrary.addSprite("logo_publisher",b.vertical)}e+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){d++;b.refreshLoader(Math.floor(d/
e*100))};this._onPreloaderComplete=function(){CloudAPI.play();b.unload();this.gotoMenu()};this._onAllImagesLoaded=function(){};this.gotoMenu=function(){new CMenu;c=STATE_MENU};this.gotoModeMenu=function(){new CModeMenu;c=STATE_MENU};this.gotoGame=function(b){s_iGameType=b;s_oGame=new CGameSingle(f);c=STATE_GAME};this.gotoGameMulti=function(){s_iGameType=MODE_HUMAN;s_oGame=new CGameMulti(f);c=STATE_GAME};this.gotoGameWithBot=function(){s_oGame=_oGame=new CGameSingleWithBot(f);c=STATE_GAME};this.gotoHelp=
function(){new CHelp;c=STATE_HELP};this.stopUpdate=function(){g=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();g=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(b){if(!1!==g){var a=(new Date).getTime();s_iTimeElaps=a-s_iPrevTime;s_iCntTime+=
s_iTimeElaps;s_iCntFps++;s_iPrevTime=a;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);c===STATE_GAME&&s_oGame.update();s_oStage.update(b)}};s_oMain=this;var f=a;ENABLE_CHECK_ORIENTATION=a.check_orientation;ENABLE_FULLSCREEN=a.fullscreen;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_iGameType,s_aSounds,s_oGame=null,s_oNetworkManager=null,s_bMultiplayer=!1,s_bWeightSquares=!1,s_bEdgeSensitive=!1;
function CMessage(a,g){var d,e,c,b;this._init=function(a,f){s_bMultiplayer?s_oNetworkManager.isUserA()?this.setPosition(!0):this.setPosition(!1):this.setPosition(!0);b=new createjs.Container;b.x=d;b.y=e;s_bMobile&&a===BLACK&&s_iGameType===MODE_HUMAN&&(b.rotation=180);s_oStage.addChild(b);var g=s_oSpriteLibrary.getSprite("message"),h=createBitmap(g);h.regX=g.width/2;h.regY=g.height/2;g=new createjs.Text(f," 40px "+PRIMARY_FONT,"#ffffff");g.textAlign="center";g.textBaseline="top";g.lineWidth=350;g.regY=
g.getBounds().height/2;b.addChild(h,g);createjs.Tween.get(b).to({y:c},750,createjs.Ease.cubicOut)};this.unload=function(){s_oStage.removeChild(b)};this.removeAnimated=function(){b.x>CANVAS_WIDTH/2?createjs.Tween.get(b).to({x:CANVAS_WIDTH+200},500,createjs.Ease.cubicOut).call(function(){f.unload()}):createjs.Tween.get(b).to({x:-200},500,createjs.Ease.cubicOut).call(function(){f.unload()})};this.setPosition=function(b){b?a===WHITE?(d=306,e=-200,c=1580):(d=976,e=CANVAS_HEIGHT+200,c=338):a===WHITE?(d=
976,e=CANVAS_HEIGHT+200,c=338):(d=306,e=-200,c=1580)};var f=this;this._init(a,g)}
function CMenu(){var a,g,d,e,c,b,f,h,l,k,m,n,q,t,w,r,x=null,y=null,C,B;this._init=function(){k=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(k);var l=s_oSpriteLibrary.getSprite("local_but");m=new CGfxButton(CANVAS_WIDTH/2-20,CANVAS_HEIGHT-450,l,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this);l=s_oSpriteLibrary.getSprite("multiplayer_but");n=new CGfxButton(CANVAS_WIDTH/2+350,CANVAS_HEIGHT-450,l,s_oStage);n.addEventListener(ON_MOUSE_UP,this._onButMultiplayerRelease,
this);l=s_oSpriteLibrary.getSprite("but_credits");f=10+l.width/2;h=l.height/2+25;w=new CGfxButton(f,h,l,s_oStage);w.addEventListener(ON_MOUSE_UP,this._onCredits,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)l=s_oSpriteLibrary.getSprite("audio_icon"),d=CANVAS_WIDTH-l.height/2-10,e=l.height/2+25,t=new CToggle(d,e,l,s_bAudioActive,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);l=window.document;var H=l.documentElement;x=H.requestFullscreen||H.mozRequestFullScreen||H.webkitRequestFullScreen||
H.msRequestFullscreen;y=l.exitFullscreen||l.mozCancelFullScreen||l.webkitExitFullscreen||l.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.enabled&&(l=s_oSpriteLibrary.getSprite("but_fullscreen"),c=f+l.width/2+10,b=h,r=new CToggle(c,b,l,s_bFullscreen,s_oStage),r.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));CloudAPI.logos.active()&&(l=s_oSpriteLibrary.getSprite("logo_publisher"),a=l.width/2*.4+10,g=CANVAS_HEIGHT-l.height/2*.4-10,B=new createjs.Container,B.x=a,B.y=g,s_oStage.addChild(B),
C=new CGfxButton(0,0,l,B),C.setScale(.4),C.addEventListener(ON_MOUSE_UP,this._onLogo,this));q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(q);createjs.Tween.get(q).to({alpha:0},1E3).call(function(){q.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){m.unload();m=null;n.unload();n=null;q.visible=!1;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t.unload(),t=null;w.unload();x&&screenfull.enabled&&r.unload();
CloudAPI.logos.active()&&C.unload();s_oStage.removeChild(k);s_oMenu=k=null};this.refreshButtonPos=function(l,k){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||t.setPosition(d-l,k+e);w.setPosition(f+l,k+h);x&&screenfull.enabled&&r.setPosition(c+l,k+b);CloudAPI.logos.active()&&(B.x=a+s_iOffsetX,B.y=g-s_iOffsetY)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButLocalRelease=function(){this.unload();s_bPlayWithBot=s_bMultiplayer=!1;$(s_oMain).trigger("start_session");
s_oMain.gotoModeMenu()};this._onButMultiplayerRelease=function(){$(s_oMain).trigger("start_session");s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this._onGameStart);s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._checkMatchWithBot);s_oNetworkManager.addEventListener(ON_BACK_FROM_A_ROOM,this.clearBotCheck);s_oNetworkManager.connectToSystem()};this._onLogo=function(){CloudAPI.links.active()&&window.open(CloudAPI.links.list().logo)};
this._onGameStart=function(){s_oMenu.clearBotCheck();s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oMenu.unload();s_oMain.gotoGameMulti()};this._checkMatchWithBot=function(){var b=randomFloatBetween(18E3,26E3);l=setTimeout(function(){s_bPlayWithBot=s_bMultiplayer=!0;s_iGameType=MODE_COMPUTER;var b=Math.random();SEARCH_DEPTH=.8<b?3:.6<b?1:2;g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.disconnect();s_oNetworkManager.generateRandomName();s_oMenu.unload();s_oMain.gotoGameWithBot()},b)};this.clearBotCheck=
function(){clearTimeout(l)};this._onCredits=function(){new CCreditsPanel};this.resetFullscreenBut=function(){x&&screenfull.enabled&&r.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?y.call(window.document):x.call(window.document.documentElement);sizeHandler()};s_oMenu=this;this._init()}var s_oMenu=null;
function CModeMenu(){var a,g,d,e,c,b,f,h,l,k,m,n=null,q,t,w,r,x=null,y=null;this._init=function(){var f=createBitmap(s_oSpriteLibrary.getSprite("bg_mod_menu"));s_oStage.addChild(f);f=s_oSpriteLibrary.getSprite("but_exit");d=CANVAS_WIDTH-f.height/2-10;e=f.height/2+25;m=new CGfxButton(d,e,f,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onExit,this);c=CANVAS_WIDTH-f.width/2-125;b=f.height/2+25;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)f=s_oSpriteLibrary.getSprite("audio_icon"),n=new CToggle(c,b,
f,s_bAudioActive,s_oStage),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);f=window.document;var B=f.documentElement;x=B.requestFullscreen||B.mozRequestFullScreen||B.webkitRequestFullScreen||B.msRequestFullscreen;y=f.exitFullscreen||f.mozCancelFullScreen||f.webkitExitFullscreen||f.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.enabled&&(f=s_oSpriteLibrary.getSprite("but_fullscreen"),a=f.width/4+10,g=e,r=new CToggle(a,g,f,s_bFullscreen,s_oStage),r.addEventListener(ON_MOUSE_UP,
this._onFullscreenRelease,this));h=new createjs.Text(TEXT_MODE,"bold 80px "+PRIMARY_FONT,"#ffffff");h.x=CANVAS_WIDTH/2;h.y=400;h.textAlign="center";h.textBaseline="middle";h.lineWidth=600;s_oStage.addChild(h);f=s_oSpriteLibrary.getSprite("but_vs_man");l=new CGfxButton(CANVAS_WIDTH/2,800,f,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onButHumanRelease,this);f=s_oSpriteLibrary.getSprite("message");B=createBitmap(f);B.regX=f.width/2;B.regY=f.height/2;B.x=CANVAS_WIDTH/2;B.y=1532;s_oStage.addChild(B);
f=s_oSpriteLibrary.getSprite("toggle_easy");q=new CToggle(CANVAS_WIDTH/2-130+2,1550,f,!1,s_oStage);q.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,this,EASY_MODE);f=s_oSpriteLibrary.getSprite("toggle_medium");t=new CToggle(CANVAS_WIDTH/2+2,1550,f,!0,s_oStage);t.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,this,MEDIUM_MODE);f=s_oSpriteLibrary.getSprite("toggle_hard");w=new CToggle(CANVAS_WIDTH/2+132,1550,f,!1,s_oStage);w.addEventListenerWithParams(ON_MOUSE_UP,this._onDifficultyToggle,
this,HARD_MODE);f=s_oSpriteLibrary.getSprite("but_vs_pc");k=new CGfxButton(CANVAS_WIDTH/2,1300,f,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onButComputerRelease,this);this._onDifficultyToggle(MEDIUM_MODE);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){l.unload();k.unload();m.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)n.unload(),n=null;x&&screenfull.enabled&&r.unload();s_oModeMenu=null;s_oStage.removeAllChildren()};this._onDifficultyToggle=function(b){switch(b){case EASY_MODE:q.setActive(!0);
t.setActive(!1);w.setActive(!1);f=EASY_MODE;SEARCH_DEPTH=1;break;case MEDIUM_MODE:q.setActive(!1);t.setActive(!0);w.setActive(!1);f=MEDIUM_MODE;SEARCH_DEPTH=2;break;case HARD_MODE:q.setActive(!1),t.setActive(!1),w.setActive(!0),f=HARD_MODE,SEARCH_DEPTH=3}};this.refreshButtonPos=function(f,h){m.setPosition(d-f,h+e);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(c-f,h+b);x&&screenfull.enabled&&r.setPosition(a+f,h+g)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=
!s_bAudioActive};this.resetFullscreenBut=function(){x&&screenfull.enabled&&r.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?y.call(window.document):x.call(window.document.documentElement);sizeHandler()};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onButHumanRelease=function(){this.unload();s_oMain.gotoGame(MODE_HUMAN)};this._onButComputerRelease=function(){this.unload();s_oMain.gotoGame(MODE_COMPUTER,f)};s_oModeMenu=this;this._init()}
var s_oModeMenu=null,CGameBase=function(a){this._bStartGame;this._bCheck;this._iPlayerState;this._iCurPlayer;this._iBlackTime;this._iWhiteTime;this._iBlackScore;this._iWhiteScore;this._iHistoryID;this._iTimeElaps;this._aCell;this._oInterface;this._oEndPanel=null;this._oBoardContainer;this._oInfoPanelContainer;this._oPiecesContainer;this._oKnightContainer;this._oMessage;this._oThinking;this._oBoard;this._oCellActive;this._oAI;SHOW_SCORE=a.show_score;START_SCORE=a.start_score;SCORE_DECREASE_PER_SECOND=
a.score_decrease_per_second};
CGameBase.prototype._init=function(){this._reset();this._oMessage=this._oCellActive=null;var a=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(a);this._oBoardContainer=new createjs.Container;this._oBoardContainer.x=CANVAS_WIDTH/2;this._oBoardContainer.y=CANVAS_HEIGHT/2;this._oBoardContainer.scaleX=this._oBoardContainer.scaleY=1.2;s_oStage.addChild(this._oBoardContainer);this._oInfoPanelContainer=new createjs.Container;s_oStage.addChild(this._oInfoPanelContainer);this._oPiecesContainer=
new createjs.Container;this._oPiecesContainer.x=CANVAS_WIDTH/2;this._oPiecesContainer.y=CANVAS_HEIGHT/2;this._oPiecesContainer.scaleX=this._oPiecesContainer.scaleY=1.2;s_oStage.addChild(this._oPiecesContainer);this._oKnightContainer=new createjs.Container;this._oKnightContainer.x=CANVAS_WIDTH/2;this._oKnightContainer.y=CANVAS_HEIGHT/2;this._oKnightContainer.scaleX=this._oKnightContainer.scaleY=1.2;s_oStage.addChild(this._oKnightContainer);this._oInterface=new CInterface(this._oInfoPanelContainer);
a=s_oSpriteLibrary.getSprite("board8");this._oBoard=new createBitmap(a);this._oBoard.regX=a.width/2;this._oBoard.regY=a.height/2;this._oBoardContainer.addChild(this._oBoard);this._oThinking=new CThinking};CGameBase.prototype._reset=function(){this._bStartGame=!0;this._bCheck=!1;this._iPlayerState=PLAYER_STATE_WAIT;this._iCurPlayer=WHITE;this._iWhiteTime=this._iBlackTime=this._iHistoryID=0;this._iWhiteScore=this._iBlackScore=START_SCORE;this._iTimeElaps=0};
CGameBase.prototype._initBoard=function(){for(var a=0;a<NUM_CELL;a++)this._aCell[1][a].createPiece(this._iHistoryID,BLACK,PAWN);for(a=0;a<NUM_CELL;a++)this._aCell[6][a].createPiece(this._iHistoryID,WHITE,PAWN);this._aCell[0][0].createPiece(this._iHistoryID,BLACK,ROOK);this._aCell[0][7].createPiece(this._iHistoryID,BLACK,ROOK);this._aCell[7][0].createPiece(this._iHistoryID,WHITE,ROOK);this._aCell[7][7].createPiece(this._iHistoryID,WHITE,ROOK);this._aCell[0][1].createPiece(this._iHistoryID,BLACK,KNIGHT);
this._aCell[0][6].createPiece(this._iHistoryID,BLACK,KNIGHT);this._aCell[7][1].createPiece(this._iHistoryID,WHITE,KNIGHT);this._aCell[7][6].createPiece(this._iHistoryID,WHITE,KNIGHT);this._aCell[0][2].createPiece(this._iHistoryID,BLACK,BISHOP);this._aCell[0][5].createPiece(this._iHistoryID,BLACK,BISHOP);this._aCell[7][2].createPiece(this._iHistoryID,WHITE,BISHOP);this._aCell[7][5].createPiece(this._iHistoryID,WHITE,BISHOP);this._aCell[0][3].createPiece(this._iHistoryID,BLACK,QUEEN);this._aCell[0][4].createPiece(this._iHistoryID,
BLACK,KING);this._aCell[7][3].createPiece(this._iHistoryID,WHITE,QUEEN);this._aCell[7][4].createPiece(this._iHistoryID,WHITE,KING)};CGameBase.prototype._playAI=function(a){if(!a){s_oGame._oThinking.show();a=MIN_AI_THINKING+Math.random()*(MAX_AI_THINKING-MIN_AI_THINKING);var g=this._oAI.getMove();null!==g&&setTimeout(function(){s_oGame._oThinking.hide();s_oGame.cellClicked(g.sourcerow,g.sourcecol);s_oGame.cellClicked(g.destrow,g.destcol)},a)}};
CGameBase.prototype.cellClicked=function(a,g){switch(this._iPlayerState){case PLAYER_STATE_WAIT:this._disableAllThreat();if(null!==this._aCell[a][g].getColor()&&this._aCell[a][g].getColor()!==this._iCurPlayer)break;this._selectPiece(a,g);break;case PLAYER_STATE_SELECTED:this._oCellActive.getLogicPos().row===a&&this._oCellActive.getLogicPos().col===g?this._deselectPiece():this._aCell[a][g].getColor()===this._iCurPlayer?(this._deselectPiece(),this._selectPiece(a,g)):this._aCell[a][g].isHighlight()?
this._checkLegalMove(a,g):this._deselectPiece(),playSound("click",1,!1)}};
CGameBase.prototype._checkLegalMove=function(a,g){var d=s_oBoardStateController.copyBoard(this._aCell);s_oBoardStateController.moveCopiedPiece(d,this._oCellActive.getLogicPos().row,this._oCellActive.getLogicPos().col,a,g);d=s_oBoardStateController.findAllChecks(this._iCurPlayer,d);if(0===d.length){switch(s_oBoardStateController.getSpecialMoves(this._oCellActive.getLogicPos().row,this._oCellActive.getLogicPos().col,a,g,this._aCell)){case BOARD_SPECIAL_CASTLING_RIGHT:var e=this._aCell[this._oCellActive.getLogicPos().row][7];
d=this._aCell[this._oCellActive.getLogicPos().row][5];e.shift(d);break;case BOARD_SPECIAL_CASTLING_LEFT:e=this._aCell[this._oCellActive.getLogicPos().row][0];d=this._aCell[this._oCellActive.getLogicPos().row][3];e.shift(d);break;case BOARD_SPECIAL_ENPASSANT:this._aCell[this._oCellActive.getLogicPos().row][g].eatUp()}this._oCellActive.setActive(!1);this._movePiece(a,g);this._deselectPiece();this._iPlayerState=PLAYER_STATE_MOVING}else for(this._disableAllThreat(),e=0;e<d.length;e++)this._aCell[d[e].getLogicPos().row][d[e].getLogicPos().col].threat(!0)};
CGameBase.prototype._selectPiece=function(a,g){this._oCellActive=this._aCell[a][g];this._oCellActive.setActive(!0);for(var d=s_oMovesController.getMovesList(a,g,this._aCell),e=0;e<d.length;e++)this._aCell[d[e].row][d[e].col].highlight(!0);this._iPlayerState=PLAYER_STATE_SELECTED;playSound("click",1,!1)};CGameBase.prototype._deselectPiece=function(){s_oGame._disableAllHighlight();s_oGame._oCellActive.setActive(!1);s_oGame._oCellActive=null;s_oGame._iPlayerState=PLAYER_STATE_WAIT};
CGameBase.prototype.checkGameState=function(){var a=!1;switch(s_oBoardStateController.getState(this._iCurPlayer,this._aCell)){case BOARD_STATE_STALEMATE:this.gameOver(DRAW);this._oMessage=new CMessage(this._iCurPlayer,TEXT_STALEMATE);a=!0;break;case BOARD_STATE_CHECK:this._bCheck=!0;for(var g=s_oBoardStateController.findAllChecks(this._iCurPlayer,this._aCell),d=0;d<g.length;d++)this._aCell[g[d].getLogicPos().row][g[d].getLogicPos().col].threat(!0);this._oMessage=new CMessage(this._iCurPlayer,TEXT_CHECK);
break;case BOARD_STATE_CHECKMATE:a=s_oBoardStateController.getOtherOpponent(this._iCurPlayer),this._oMessage=new CMessage(this._iCurPlayer,TEXT_CHECKMATE),this.gameOver(a),a=!0}return a};CGameBase.prototype.setPieceDepth=function(){for(var a=[],g=0;g<this._oPiecesContainer.children.length;g++){var d=this._oPiecesContainer.children[g];a.push({height:d.y,piece:d})}a.sort(this.compareHeight);for(g=d=0;g<this._oPiecesContainer.children.length;g++)this._oPiecesContainer.setChildIndex(a[g].piece,d++)};
CGameBase.prototype.compareHeight=function(a,g){return a.height<g.height?-1:a.height>g.height?1:0};CGameBase.prototype.getCells=function(){return this._aCell};
CGameBase.prototype.restartGame=function(){s_oGame._oEndPanel.unload();this._oCellActive=null;s_oGame._disableAllHighlight();this._reset();for(var a=0;a<NUM_CELL;a++)for(var g=0;g<NUM_CELL;g++)this._aCell[a][g].removePiece();this._initBoard();s_oGame._oInterface.resetInfo();s_oGame._oInterface.setInfoVisible(!0);s_oGame._oInterface.activePlayer(this._iCurPlayer);this._oMessage&&this._oMessage.unload()};CGameBase.prototype.checkBoard=function(){s_oGame._oEndPanel.hide()};
CGameBase.prototype.pauseGame=function(a){this._bStartGame=!a};CGameBase.prototype._disableAllHighlight=function(){null!==this._oCellActive&&this._oCellActive.setActive(!1);for(var a=0;a<NUM_CELL;a++)for(var g=0;g<NUM_CELL;g++)this._aCell[a][g].highlight(!1),this._aCell[a][g].threat(!1)};CGameBase.prototype._disableAllThreat=function(){for(var a=0;a<NUM_CELL;a++)for(var g=0;g<NUM_CELL;g++)this._aCell[a][g].threat(!1)};
CGameBase.prototype.setAllVisible=function(a){for(var g=0;g<NUM_CELL;g++)for(var d=0;d<NUM_CELL;d++)this._aCell[g][d].setVisible(a)};CGameBase.prototype.isCheck=function(){return this._bCheck};CGameBase.prototype.changePiece=function(a,g){this._aCell[g.row][g.col].changePiece(this._iCurPlayer,a)};CGameBase.prototype.getNewHistoryID=function(){return++this._iHistoryID};CGameBase.prototype._onExitHelp=function(){this._bStartGame=!0};
CGameBase.prototype.gameOver=function(a){this._bStartGame=!1;this._oThinking.hide();a===WHITE?this._iBlackScore=0:a===BLACK?this._iWhiteScore=0:a===DRAW&&(this._iWhiteScore=this._iBlackScore=0);this.setEndPanel(a)};
CGameBase.prototype.update=function(){this._bStartGame&&(null!==this._oThinking&&this._oThinking.update(),this._iTimeElaps+=s_iTimeElaps,this._iTimeElaps>TIME_AD&&(this._iTimeElaps=0,CloudAPI.gameOver()),this.setPieceDepth(),this._iCurPlayer===WHITE?(this._iWhiteTime+=s_iTimeElaps,this._oInterface.refreshWhiteTime(this._iWhiteTime),this._iWhiteScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1E3,0>this._iWhiteScore&&(this._iWhiteScore=0),this._oInterface.refreshWhiteScore(Math.floor(this._iWhiteScore))):
(this._iBlackTime+=s_iTimeElaps,this._oInterface.refreshBlackTime(this._iBlackTime),this._iBlackScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1E3,0>this._iBlackScore&&(this._iBlackScore=0),this._oInterface.refreshBlackScore(Math.floor(this._iBlackScore))))};var CGameSingle=function(a){CGameBase.call(this,a);this._init()};CGameSingle.prototype=Object.create(CGameBase.prototype);CGameSingle.prototype._init=function(){CGameBase.prototype._init();this._startGame()};
CGameSingle.prototype._startGame=function(){this._oInterface.configureInfoPanel(!0);this._setBoard();this._initBoard();this.setPieceDepth();new CMovesController(this._aCell);new CMovesControllerFaster(this._aCell);new CBoardStateController;this._oInterface.activePlayer(this._iCurPlayer);this._oAI=new CAI};
CGameSingle.prototype._setBoard=function(){var a=NUM_CELL,g=CELL_LENGTH,d=-BOARD_LENGTH/2+g/2;this._aCell=[];for(var e=0;e<a;e++){this._aCell[e]=[];for(var c=0;c<a;c++)this._aCell[e][c]=new CCell(d+c*g,d+e*g,null,e,c,this._oBoardContainer,this._oPiecesContainer,this._oKnightContainer)}};CGameSingle.prototype._movePiece=function(a,g){var d=this._aCell[a][g];this._oCellActive.move(d);null!==d.getColor()&&d.eatUp()};
CGameSingle.prototype.onFinishMove=function(){this.setPieceDepth();var a=s_oBoardStateController.checkPromotion(this._aCell);null===a?this.changeTurn():s_iGameType===MODE_HUMAN?new CPromoPanel(this._iCurPlayer,a):this._iCurPlayer===BLACK?(this.changePiece(QUEEN,a),this.changeTurn()):new CPromoPanel(this._iCurPlayer,a)};
CGameSingle.prototype.changeTurn=function(){null!==this._oMessage&&this._oMessage.removeAnimated();this._bCheck=!1;this._iPlayerState=PLAYER_STATE_WAIT;if(this._iCurPlayer===WHITE){this._iCurPlayer=BLACK;var a=this.checkGameState();s_iGameType===MODE_COMPUTER&&this._playAI(a)}else this._iCurPlayer=WHITE,this.checkGameState();this._oInterface.activePlayer(this._iCurPlayer)};CGameSingle.prototype.onExitPromoPanel=function(){this.changeTurn()};
CGameSingle.prototype.unload=function(){this._bStartGame=!1;this._oInterface.unload();null!==this._oEndPanel&&this._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};CGameSingle.prototype.onExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.unload();s_oMain.gotoMenu()};
CGameSingle.prototype.setEndPanel=function(a){this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.setRestartBut(s_oGame.restartGame,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame);setTimeout(function(){s_oGame._oEndPanel.show(a,s_oGame._iBlackTime,s_oGame._iWhiteTime,s_oGame._iBlackScore,s_oGame._iWhiteScore);s_oGame._oInterface.setInfoVisible(!1)},1E3)};
var CGameMulti=function(a){this._oRemotePromoMove=this._oCurMoveToSend=null;CGameBase.call(this,a);this._init()};CGameMulti.prototype=Object.create(CGameBase.prototype);CGameMulti.prototype._init=function(){CGameBase.prototype._init();this._startGame()};
CGameMulti.prototype._startGame=function(){this._oInterface.configureInfoPanel(s_oNetworkManager.isUserA());s_oNetworkManager.isUserA()?s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getEnemyNickname()):(this._oThinking.show(),this._oBoard.rotation=180,s_oInterface.setPlayersInfo(s_oNetworkManager.getEnemyNickname(),s_oNetworkManager.getPlayerNickname()));this._setBoard();this._initBoard();this.setPieceDepth();new CMovesController(this._aCell);new CMovesControllerFaster(this._aCell);
new CBoardStateController;this._oInterface.activePlayer(this._iCurPlayer);s_oNetworkManager.addEventListener(ON_DISCONNECTION,this.playerDisconnectedFromGame)};
CGameMulti.prototype._setBoard=function(){var a=BOARD_LENGTH,g=NUM_CELL,d=CELL_LENGTH,e=-a/2+d/2;this._aCell=[];if(s_oNetworkManager.isUserA())for(a=0;a<g;a++){this._aCell[a]=[];for(var c=0;c<g;c++){var b=e+c*d,f=e+a*d;this._aCell[a][c]=new CCell(b,f,null,a,c,this._oBoardContainer,this._oPiecesContainer,this._oKnightContainer)}}else for(e=a/2-d/2,a=0;a<g;a++)for(this._aCell[a]=[],c=0;c<g;c++)b=e-c*d,f=e-a*d,this._aCell[a][c]=new CCell(b,f,null,a,c,this._oBoardContainer,this._oPiecesContainer,this._oKnightContainer)};
CGameMulti.prototype.changeTurn=function(){null!==this._oMessage&&this._oMessage.removeAnimated();this._bCheck=!1;this._iPlayerState=PLAYER_STATE_WAIT;this._oCurMoveToSend=this._oRemotePromoMove=null;this._iCurPlayer===WHITE?(this._iCurPlayer=BLACK,s_oNetworkManager.isUserA()?this._oThinking.show():this._oThinking.hide()):(this._iCurPlayer=WHITE,s_oNetworkManager.isUserA()?this._oThinking.hide():this._oThinking.show());this._disableAllHighlight();this.checkGameState();this._oInterface.activePlayer(this._iCurPlayer)};
CGameMulti.prototype._movePiece=function(a,g){var d=this._oCellActive.getType(),e=this._aCell[a][g];this._oCurMoveToSend={sourcerow:this._oCellActive.getLogicPos().row,sourcecol:this._oCellActive.getLogicPos().col,destrow:a,destcol:g};this._oCellActive.move(e);null!==e.getColor()&&e.eatUp();e=!1;0!==a&&7!==a||d!==PAWN||(e=!0);e||(d={},d[MSG_MOVE]=this._oCurMoveToSend,s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify(d)))};
CGameMulti.prototype.remoteMovePiece=function(a){var g=a.sourcerow,d=a.sourcecol,e={row:a.destrow,col:a.destcol};a.promo_piece_type&&(this._oRemotePromoMove={cell:e,type:a.promo_piece_type});switch(s_oBoardStateController.getSpecialMoves(g,d,e.row,e.col,this._aCell)){case BOARD_SPECIAL_CASTLING_RIGHT:a=this._aCell[g][5];this._aCell[g][7].shift(a);break;case BOARD_SPECIAL_CASTLING_LEFT:var c=this._aCell[g][0];a=this._aCell[g][3];c.shift(a);break;case BOARD_SPECIAL_ENPASSANT:this._aCell[g][e.col].eatUp()}a=
this._aCell[e.row][e.col];this._aCell[g][d].move(a);null!==a.getColor()&&a.eatUp()};
CGameMulti.prototype.onFinishMove=function(){null!==this._oRemotePromoMove&&this.changePiece(this._oRemotePromoMove.type,this._oRemotePromoMove.cell);this.setPieceDepth();var a=s_oBoardStateController.checkPromotion(this._aCell);null===a?this.changeTurn():s_iGameType===MODE_HUMAN?new CPromoPanel(this._iCurPlayer,a):this._iCurPlayer===BLACK?(this.changePiece(QUEEN,a),this.changeTurn()):new CPromoPanel(this._iCurPlayer,a)};
CGameMulti.prototype.onExitPromoPanel=function(a){this._oCurMoveToSend.promo_piece_type=a;trace(this._oCurMoveToSend);a={};a[MSG_MOVE]=this._oCurMoveToSend;s_oNetworkManager.sendMsg(MSG_MOVE,JSON.stringify(a));this.changeTurn()};CGameMulti.prototype.unload=function(){this._bStartGame=!1;this._oInterface.unload();null!==this._oEndPanel&&this._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren();s_oNetworkManager.addEventListener(ON_DISCONNECTION,function(){})};
CGameMulti.prototype.onExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.unload();s_oMain.gotoMenu();s_oNetworkManager.disconnect()};CGameMulti.prototype.checkBoard=function(){var a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.4)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.on("click",s_oGame.returnToEndPanel,s_oGame,!0,a);s_oStage.addChild(a);this._oEndPanel.hide()};
CGameMulti.prototype.returnToEndPanel=function(a,g){s_oStage.removeChild(g);this._oEndPanel.reShow()};CGameMulti.prototype.setEndPanel=function(a){var g=!1;a===WHITE?s_oNetworkManager.isUserA()&&(g=!0):s_oNetworkManager.isUserA()||(g=!0);s_oNetworkManager.sendMsg(MSG_END_MATCH,g);this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));s_oGame._oEndPanel.show(a,s_oGame._iBlackTime,s_oGame._iWhiteTime,s_oGame._iBlackScore,s_oGame._iWhiteScore);s_oGame._oInterface.setInfoVisible(!1)};
CGameMulti.prototype.showRematchQuestion=function(){this._oEndPanel.setRestartBut(s_oGame._onConfirmRematch,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame)};CGameMulti.prototype._onConfirmRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_WAIT_OPPONENT);s_oNetworkManager.sendMsg(MSG_ACCEPT_REMATCH,"")};
CGameMulti.prototype.onOpponentRefuseRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_home"),ON_MOUSE_UP,this.onExit,this);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_show"),ON_MOUSE_UP,this.checkBoard,this)};CGameMulti.prototype.onOpponentAcceptRematch=function(){s_oNetworkManager.isUserA()||this._oThinking.show();s_oGame.restartGame()};
CGameMulti.prototype.playerDisconnectedFromGame=function(){this._oEndPanel&&this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this);s_oNetworkManager.sendMsg(MSG_DISCONNECTION,"")};
CGameMulti.prototype.opponentLeftTheGame=function(){this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this);s_oNetworkManager.isUserA()?this._oEndPanel.setExplMsg(TEXT_WINS.format(WHITE)):this._oEndPanel.setExplMsg(TEXT_WINS.format(BLACK))};var CGameSingleWithBot=function(a){CGameSingle.call(this,a)};CGameSingleWithBot.prototype=Object.create(CGameSingle.prototype);
CGameSingleWithBot.prototype._startGame=function(){this._oInterface.configureInfoPanel(!0);this._setBoard();this._initBoard();this.setPieceDepth();new CMovesController(this._aCell);new CMovesControllerFaster(this._aCell);new CBoardStateController;this._oInterface.activePlayer(this._iCurPlayer);this._oAI=new CAI;s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getBotName())};
CGameSingleWithBot.prototype._playAI=function(a){if(!a){s_oGame._oThinking.show();a=MIN_AI_THINKING+1E3;a+=Math.random()*(MAX_AI_THINKING+1E3-a);var g=this._oAI.getMove();null!==g&&setTimeout(function(){s_oGame._oThinking.hide();s_oGame.cellClicked(g.sourcerow,g.sourcecol);s_oGame.cellClicked(g.destrow,g.destcol)},a)}};
CGameSingleWithBot.prototype.setEndPanel=function(a){this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));s_oGame._oEndPanel.show(a,s_oGame._iBlackTime,s_oGame._iWhiteTime,s_oGame._iBlackScore,s_oGame._iWhiteScore);s_oGame._oInterface.setInfoVisible(!1);this._oEndPanel.setRestartBut(s_oGame._onConfirmRematch,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame)};
CGameSingleWithBot.prototype._onConfirmRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_WAIT_OPPONENT);var a=randomFloatBetween(200,2E3);if(.33<Math.random()).4<Math.random()?setTimeout(function(){s_oGame._rematch()},a):s_oGame._rematch();else if(.4<Math.random())setTimeout(function(){s_oGame.onBotRefuseRematch()},a);else s_oGame.onBotRefuseRematch()};
CGameSingleWithBot.prototype.onBotRefuseRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this)};CGameSingleWithBot.prototype._rematch=function(){s_oGame.restartGame()};
function CInterface(a){var g,d,e,c,b,f,h,l,k,m,n,q=null,t=null;this._init=function(a){var k=s_oSpriteLibrary.getSprite("but_exit");e=CANVAS_WIDTH-k.height/2-10;c=k.height/2+25;h=new CGfxButton(e,c,k,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onExit,this);a=CANVAS_WIDTH-k.width/2-125;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k=s_oSpriteLibrary.getSprite("audio_icon"),g=a,d=25+k.height/2,l=new CToggle(g,d,k,s_bAudioActive,s_oStage),l.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);a=window.document;
k=a.documentElement;q=k.requestFullscreen||k.mozRequestFullScreen||k.webkitRequestFullScreen||k.msRequestFullscreen;t=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(q=!1);q&&screenfull.enabled&&(k=s_oSpriteLibrary.getSprite("but_fullscreen"),b=k.width/4+10,f=k.height/2+25,n=new CToggle(b,f,k,s_bFullscreen,s_oStage),n.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=
function(){h.unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.unload();m.unload();k.unload();q&&screenfull.enabled&&n.unload();s_oInterface=null};this.refreshButtonPos=function(a,k){h.setPosition(e-a,k+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(g-a,k+d);q&&screenfull.enabled&&n.setPosition(b+a,k+f)};this.refreshWhiteTime=function(b){50<b&&k.refreshTime(formatTime(b))};this.refreshBlackTime=function(b){50<b&&m.refreshTime(formatTime(b))};this.refreshWhiteScore=function(b){k.refreshScore(b)};
this.refreshBlackScore=function(b){m.refreshScore(b)};this.activePlayer=function(b){b===WHITE?(m.active(!1),k.active(!0)):(k.active(!1),m.active(!0))};this.resetInfo=function(){k.refreshTime(formatTime(0));m.refreshTime(formatTime(0));k.refreshScore(START_SCORE);m.refreshScore(START_SCORE)};this.setInfoVisible=function(b){k.setPanelVisible(b);m.setPanelVisible(b)};this.setPlayersInfo=function(b,a){k.setName(b);m.setName(a)};this._onButConfigRelease=function(){new CConfigPanel};this._onButRestartRelease=
function(){s_oGame.restartGame()};this.onExitFromHelp=function(){null.unload()};this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){q&&screenfull.enabled&&n.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?t.call(window.document):q.call(window.document.documentElement);sizeHandler()};this.configureInfoPanel=function(b){var c={x:950,y:1570},
f={x:s_iGameType===MODE_HUMAN&&s_bMobile?330:310,y:350};b?(b=c,c=f):b=f;k=new CInfoTurn(b.x,b.y,WHITE,a);m=new CInfoTurn(c.x,c.y,BLACK,a)};s_oInterface=this;this._init(a);return this}var s_oInterface=null;
function CInfoTurn(a,g,d,e){var c,b,f,h,l,k,m;this._init=function(a,d,e,g){c=new createjs.Container;c.x=a;c.y=d;s_iGameType===MODE_HUMAN&&e===BLACK&&s_bMobile&&!s_bMultiplayer&&(c.rotation=180);g.addChild(c);k=new createjs.Container;a=-324;d=30;e===WHITE?(k.x=a,k.y=-d):(k.x=-a+20,s_iGameType===MODE_HUMAN&&e===BLACK&&s_bMobile&&!s_bMultiplayer?(k.x=a,k.y=-d):k.y=d);c.addChild(k);if(!SHOW_SCORE||s_iGameType===MODE_COMPUTER&&e===BLACK||s_bMultiplayer)k.visible=!1;a=s_oSpriteLibrary.getSprite("score_panel");
d=createBitmap(a);d.regX=a.width/2;d.regY=a.height/2;k.addChild(d);m=new createjs.Text(START_SCORE," 30px "+PRIMARY_FONT,"#ffffff");m.x=90;m.textAlign="right";m.textBaseline="middle";m.lineWidth=200;k.addChild(m);a=s_oSpriteLibrary.getSprite("bg_turn");d=new createjs.SpriteSheet({images:[a],framerate:58,frames:{width:a.width/2,height:a.height,regX:a.width/2/2,regY:a.height/2},animations:{off:[0,0,"on"],on:[1,1,"off"]}});b=createSprite(d,0,a.width/2/2,a.height/2,a.width/2,a.height);b.stop();c.addChild(b);
f=createSprite(d,1,a.width/2/2,a.height/2,a.width/2,a.height);f.stop();f.x=10;f.alpha=0;c.addChild(f);a=s_oSpriteLibrary.getSprite(e+"_king_marker");l=createBitmap(a);l.x=160;l.regX=a.width/2;l.regY=a.height/2;c.addChild(l);h=new createjs.Text("00:00"," 58px "+PRIMARY_FONT,"#ffffff");h.x=-65;h.y=2;h.textBaseline="middle";h.lineWidth=200;c.addChild(h)};this.refreshTime=function(b){h.text=b};this.refreshScore=function(b){m.text=b};this.invert=function(){h.x=0;l.x=-100};this.active=function(a){a?(createjs.Tween.get(b).to({alpha:0},
750,createjs.Ease.cubicOut).to({alpha:1},750,createjs.Ease.cubicIn).call(function(){n.active(a)}),createjs.Tween.get(f).to({alpha:1},750,createjs.Ease.cubicOut).to({alpha:0},750,createjs.Ease.cubicIn)):(b.alpha=1,f.alpha=0,createjs.Tween.removeTweens(b),createjs.Tween.removeTweens(f))};this.unload=function(){e.removeChild(c)};this.setBgVisible=function(a){b.visible=a;k.visible=a};this.setPanelVisible=function(b){c.visible=b};this.setName=function(a){a=new createjs.Text(a," 50px "+PRIMARY_FONT,"#ffffff");
c.y>CANVAS_HEIGHT/2?(a.x=-b.getBounds().width/2,a.textAlign="right"):(a.x=b.getBounds().width/2,a.textAlign="left");a.textBaseline="middle";a.lineWidth=500;c.addChild(a)};this.setPawn=function(b){l.gotoAndStop(b)};var n=this;this._init(a,g,d,e)}
function CThinking(){var a,g,d,e,c,b,f;this._init=function(){a=!0;g=0;d=new createjs.Container;var h=(new createjs.Graphics).beginFill("rgba(0,0,0,0.3)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b=new createjs.Shape(h);f=b.on("click",function(){});e=new createjs.Text(TEXT_THINKING,"bold 60px "+PRIMARY_FONT,"#ffffff");e.x=.5*CANVAS_WIDTH;e.y=.5*CANVAS_HEIGHT-100;e.textAlign="center";e.textBaseline="alphabetic";e.lineWidth=800;c=new createjs.Text("","bold 180px "+PRIMARY_FONT,"#ffffff");c.x=.5*CANVAS_WIDTH-
76;c.y=.5*CANVAS_HEIGHT-50;c.textAlign="left";c.textBaseline="alphabetic";c.lineWidth=800;d.addChild(b,e,c);s_oStage.addChild(d);this.hide()};this.unload=function(){a=!1;b.off("click",f);s_oStage.removeChild(d)};this.isShown=function(){return d.visible};this.show=function(){d.visible=!0};this.hide=function(){d.visible=!1};this.update=function(){a&&(g+=s_iTimeElaps,0<=g&&g<TIME_LOOP_WAIT/4?c.text="":g>=TIME_LOOP_WAIT/4&&g<2*TIME_LOOP_WAIT/4?c.text=".":g>=2*TIME_LOOP_WAIT/4&&g<3*TIME_LOOP_WAIT/4?c.text=
"..":g>=3*TIME_LOOP_WAIT/4&&g<TIME_LOOP_WAIT?c.text="...":g=0)};this._init()}
function CEndPanel(a){var g,d,e,c,b,f,h,l,k,m,n;this._init=function(a){s_oGame.pauseGame(!0);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.7;g=createBitmap(a);g.regX=a.width/2;g.regY=a.height/2;g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2;b=new createjs.Text("","bold 90px "+PRIMARY_FONT,"#ffffff");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-280;b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=800;f=new createjs.Text("","bold 40px "+PRIMARY_FONT,
"#ffffff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2-230;f.textAlign="center";f.textBaseline="alphabetic";f.lineWidth=800;d=new createjs.Container;d.alpha=0;d.visible=!1;d.addChild(h,g,b,f);e=new CInfoTurn(CANVAS_WIDTH/2,1E3,BLACK,d);e.setBgVisible(!1);e.invert();c=new CInfoTurn(CANVAS_WIDTH/2,850,WHITE,d);c.setBgVisible(!1);c.invert();s_oStage.addChild(d)};this.unload=function(){s_oStage.removeChild(d);d.off("mousedown",n);m.unload();l.unload();k.unload();e.unload();c.unload();$(s_oMain).trigger("end_session");
$(s_oMain).trigger("show_interlevel_ad")};this._initListener=function(){n=d.on("mousedown",this._onExit)};this.setRestartBut=function(b,a){var c=s_oSpriteLibrary.getSprite("but_restart");m=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+250,c,d);m.addEventListener(ON_MOUSE_UP,b,a)};this.setHomeBut=function(b,a){var c=s_oSpriteLibrary.getSprite("but_home");l=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+250,c,d);l.addEventListener(ON_MOUSE_UP,b,a)};this.setCheckBut=function(b,a){var c=s_oSpriteLibrary.getSprite("but_show");
k=new CGfxButton(CANVAS_WIDTH/2+180,CANVAS_HEIGHT/2+250,c,d);k.addEventListener(ON_MOUSE_UP,b,a)};this.show=function(a,g,h,l,k){CloudAPI.gameOver();CloudAPI.gameOver();CloudAPI.gameOver();CloudAPI.gameOver();e.refreshTime(formatTime(g));c.refreshTime(formatTime(h));a===WHITE?(playSound("win",1,!1),b.text=TEXT_CHECKMATE,f.text=TEXT_WINS.format(WHITE)):a===BLACK?(s_iGameType===MODE_HUMAN?playSound("win",1,!1):playSound("game_over",1,!1),b.text=TEXT_CHECKMATE,f.text=TEXT_WINS.format(BLACK)):a===DRAW&&
(playSound("game_over",1,!1),b.text=TEXT_STALEMATE,f.text=TEXT_DRAW);d.visible=!0;createjs.Tween.get(d).to({alpha:1},500);$(s_oMain).trigger("save_score",[a,g,h,s_iGameType,k,l]);$(s_oMain).trigger("share_event",[k,s_iGameType,a])};this.hide=function(){d.visible=!1;$(s_oMain).trigger("end_session")};this.reShow=function(){d.visible=!0};this._init(a);return this}
function CCell(a,g,d,e,c,b,f,h){var l,k,m,n,q,t,w,r;this._init=function(b,a,c,f,d,e,g,h){l=f;k=d;m=new createjs.Container;m.x=b;m.y=a;e.addChild(m);n=null;b=s_oSpriteLibrary.getSprite("highlight");w=createBitmap(b);w.regX=b.width/2;w.regY=b.height/2;w.alpha=.8;w.visible=!1;m.addChild(w);b=s_oSpriteLibrary.getSprite("threat");t=createBitmap(b);t.regX=b.width/2;t.regY=b.height/2;t.visible=!1;m.addChild(t);q=new createjs.Shape;q.graphics.beginFill("rgba(158,0,0,0.01)").drawRect(-CELL_LENGTH/2,-CELL_LENGTH/
2,CELL_LENGTH,CELL_LENGTH);r=q.on("mousedown",this._onCellClick);m.addChild(q)};this.unload=function(){b.removeChild(m);q.off("mousedown",r)};this.removePiece=function(){n&&n.unload();n=null};this.setClickableArea=function(b){q.visible=b};this.changePiece=function(b,d){var l=n.getHistory();n.unload();n=new CPiece(a,g,b,d,f,h);n.setHistory(l);n.setNewMoveInHistory(s_oGame.getNewHistoryID(),e,c,d)};this.createPiece=function(b,d,l){n=new CPiece(a,g,d,l,f,h);n.setNewMoveInHistory(b,e,c,l)};this.getPieceContainer=
function(){return n.getContainer()};this.setPiece=function(b){n=b};this.getType=function(){return null!==n?n.getType():null};this.getColor=function(){return null!==n?n.getColor():null};this.getPieceHistory=function(){return null!==n?n.getHistory():[]};this.threat=function(b){t.visible=b};this.highlight=function(b){w.visible=b};this.isHighlight=function(){return w.visible};this._onCellClick=function(){s_oGame.cellClicked(l,k)};this.setActive=function(b){null!==n&&n.setActive(b)};this.setVisible=function(b){m.visible=
b};this.getPos=function(){return{x:a,y:g}};this.getLogicPos=function(){return{row:e,col:c}};this.move=function(b){n.move(b);n=null};this.shift=function(b){n.shift(b);n=null};this.eatUp=function(){n.disappear()};this._init(a,g,d,e,c,b,f,h)}
function CPiece(a,g,d,e,c,b){var f,h,l,k;this._init=function(b,a,c,d,e,g){f=c;h=d;l=[];c=this._getSpriteName();c=s_oSpriteLibrary.getSprite(c);d=c.width/2;g=c.height;c=new createjs.SpriteSheet({images:[c],frames:{width:d,height:g,regX:d/2,regY:g-40},animations:{idle:[0],lit:[1]}});k=createSprite(c,"idle",0,0,0,0);k.x=b;k.y=a;e.addChild(k)};this.unload=function(){c.removeChild(k)};this._getSpriteName=function(){var b=d===WHITE?"white":"black";switch(e){case PAWN:var a="pawn";break;case ROOK:a="rook";
break;case KNIGHT:a="knight";break;case BISHOP:a="bishop";break;case QUEEN:a="queen";break;case KING:a="king"}return b+"_"+a};this.getContainer=function(){return k};this.getType=function(){return h};this.getColor=function(){return f};this.setPos=function(b,a){k.x=b;k.y=a};this.getPos=function(){return{x:k.x,y:k.y}};this.setNewMoveInHistory=function(b,a,c,f){l.push({id:b,row:a,col:c,piece:f})};this.setHistory=function(b){l=[];for(var a=0;a<b.length;a++)l[a]=b[a]};this.getHistory=function(){return l};
this.setActive=function(b){b?k.gotoAndStop("lit"):k.gotoAndStop("idle")};this.move=function(a){var f=a.getPos();h===KNIGHT?(b.addChild(k),(new createjs.Tween.get(k)).to({scaleX:1.3,scaleY:1.3},.4*TIME_MOVE,createjs.Ease.cubicOut).to({scaleX:1,scaleY:1},600)):h===PAWN&&s_oBoardStateController.resetStall();(new createjs.Tween.get(k)).to({x:f.x,y:f.y},TIME_MOVE,createjs.Ease.cubicOut).call(function(){s_oBoardStateController.increaseStallCount();h===KNIGHT&&c.addChild(k);a.setPiece(m);s_oGame.onFinishMove();
m.setNewMoveInHistory(s_oGame.getNewHistoryID(),a.getLogicPos().row,a.getLogicPos().col,h)})};this.shift=function(b){var a=b.getPos();(new createjs.Tween.get(k)).to({x:a.x,y:a.y},1E3,createjs.Ease.cubicOut).call(function(){b.setPiece(m);m.setNewMoveInHistory(s_oGame.getNewHistoryID(),b.getLogicPos().row,b.getLogicPos().col,h)})};this.disappear=function(){(new createjs.Tween.get(k)).to({alpha:0},1E3).call(function(){s_oBoardStateController.resetStall();m.unload()})};var m=this;this._init(a,g,d,e,c,
b)}var DIR_TOPRIGHT="DIR_TOPRIGHT",DIR_RIGHT="DIR_RIGHT",DIR_BOTRIGHT="DIR_BOTRIGHT",DIR_TOPLEFT="DIR_TOPLEFT",DIR_LEFT="DIR_LEFT",DIR_BOTLEFT="DIR_BOTLEFT",DIR_TOP="DIR_TOP",DIR_BOT="DIR_BOT";
function CMovesController(a){var g,d,e,c;this._init=function(b){g=b.length;d=b[0].length;c=[];e=[];for(b=0;b<g;b++){e[b]=[];for(var a=0;a<d;a++)e[b][a]=[]}this._buildMap()};this._buildMap=function(){for(var b=0;b<g;b++)for(var a=0;a<d;a++)e[b][a][DIR_TOPRIGHT]=this._setNeighbor(b,a,DIR_TOPRIGHT),e[b][a][DIR_RIGHT]=this._setNeighbor(b,a,DIR_RIGHT),e[b][a][DIR_BOTRIGHT]=this._setNeighbor(b,a,DIR_BOTRIGHT),e[b][a][DIR_TOPLEFT]=this._setNeighbor(b,a,DIR_TOPLEFT),e[b][a][DIR_LEFT]=this._setNeighbor(b,
a,DIR_LEFT),e[b][a][DIR_BOTLEFT]=this._setNeighbor(b,a,DIR_BOTLEFT),e[b][a][DIR_TOP]=this._setNeighbor(b,a,DIR_TOP),e[b][a][DIR_BOT]=this._setNeighbor(b,a,DIR_BOT)};this._setNeighbor=function(b,a,c){var f=null;switch(c){case DIR_TOPRIGHT:0<b&&a<d-1&&(f={row:b-1,col:a+1});break;case DIR_RIGHT:a<d-1&&(f={row:b,col:a+1});break;case DIR_BOTRIGHT:b<g-1&&a<d-1&&(f={row:b+1,col:a+1});break;case DIR_TOPLEFT:0<b&&0<a&&(f={row:b-1,col:a-1});break;case DIR_LEFT:0<a&&(f={row:b,col:a-1});break;case DIR_BOTLEFT:b<
g-1&&0<a&&(f={row:b+1,col:a-1});break;case DIR_TOP:0<b&&(f={row:b-1,col:a});break;case DIR_BOT:b<g-1&&(f={row:b+1,col:a})}return f};this._getNeighborByDir=function(b,a,c){return e[b][a][c]};this._getAllNeighbor=function(b,a){var c=[],f;for(f in e[b][a])null!==e[b][a][f]&&c.push(e[b][a][f]);return c};this._getMainDiagonal=function(b,a,c){var f=[],d=c[b][a].getColor();this._findInDirection(b,a,DIR_BOTRIGHT,f,99,d,c);this._findInDirection(b,a,DIR_TOPLEFT,f,99,d,c);return f};this._getSecondDiagonal=function(b,
a,c){var f=[],d=c[b][a].getColor();this._findInDirection(b,a,DIR_BOTLEFT,f,99,d,c);this._findInDirection(b,a,DIR_TOPRIGHT,f,99,d,c);return f};this._getRow=function(b,a,c){var f=[],d=c[b][a].getColor();this._findInDirection(b,a,DIR_LEFT,f,99,d,c);this._findInDirection(b,a,DIR_RIGHT,f,99,d,c);return f};this._getCol=function(b,a,c){var f=[],d=c[b][a].getColor();this._findInDirection(b,a,DIR_TOP,f,99,d,c);this._findInDirection(b,a,DIR_BOT,f,99,d,c);return f};this._getStraightByDirAndRadius=function(b,
a,d,e,g){var f=[];c=[];c.push({radius:e,direction:null});var h=g[b][a].getColor();this._findInDirection(b,a,d,f,e,h,g);return f};this._getStraightRowByRadius=function(b,a,d){var f=[];c=[];c.push({radius:d,direction:null});this._findInDirection(b,a,DIR_LEFT,f,d);this._findInDirection(b,a,DIR_RIGHT,f,d);return f};this._getStraightColByRadius=function(b,a,d){var f=[];c=[];c.push({radius:d,direction:null});this._findInDirection(b,a,DIR_TOP,f,d);this._findInDirection(b,a,DIR_BOT,f,d);return f};this._findInDirection=
function(b,a,d,g,k,m,n){--k;if(null!==e[b][a][d]&&0<=k){var f=e[b][a][d].row;b=e[b][a][d].col;m?(a=n[f][b].getColor(),a!==m&&(null===a?(g.push({row:f,col:b}),c.push({radius:k,direction:d}),this._findInDirection(f,b,d,g,k,m,n)):(g.push({row:f,col:b}),c.push({radius:k,direction:d})))):(g.push({row:f,col:b}),c.push({radius:k,direction:d}),this._findInDirection(f,b,d,g,k,m,n))}};this._findTPos=function(b,a,c){var d=[];b=e[b][a][c];null!==b&&(b=e[b.row][b.col][c],null!==b&&(d=c===DIR_TOP||c===DIR_BOT?
this._getStraightRowByRadius(b.row,b.col,1):this._getStraightColByRadius(b.row,b.col,1)));return d};this.getMovesList=function(b,a,c){var d=[];switch(c[b][a].getType()){case PAWN:d=this.getPawnMove(b,a,c);break;case ROOK:d=this.getRookMove(b,a,c);break;case KNIGHT:d=this.getKnightMove(b,a,c);break;case BISHOP:d=this.getBishopMove(b,a,c);break;case QUEEN:d=this.getQueenMove(b,a,c);break;case KING:d=this.getKingMove(b,a,c)}return d};this.getPawnMove=function(b,a,c){var d=c[b][a].getColor(),f=[];if(d===
WHITE){var e=6===b?this._getStraightByDirAndRadius(b,a,DIR_TOP,2,c):this._getStraightByDirAndRadius(b,a,DIR_TOP,1,c);var g=this._getNeighborByDir(b,a,DIR_TOPRIGHT);null!==g&&c[g.row][g.col].getColor()===BLACK&&f.push(g);g=this._getNeighborByDir(b,a,DIR_TOPLEFT);null!==g&&c[g.row][g.col].getColor()===BLACK&&f.push(g);if(3===b)for(b=this._getEnPassant(WHITE,b,a,c),a=0;a<b.length;a++)f.push(b[a])}else if(e=1===b?this._getStraightByDirAndRadius(b,a,DIR_BOT,2,c):this._getStraightByDirAndRadius(b,a,DIR_BOT,
1,c),g=this._getNeighborByDir(b,a,DIR_BOTRIGHT),null!==g&&c[g.row][g.col].getColor()===WHITE&&f.push(g),g=this._getNeighborByDir(b,a,DIR_BOTLEFT),null!==g&&c[g.row][g.col].getColor()===WHITE&&f.push(g),4===b)for(b=this._getEnPassant(BLACK,b,a,c),a=0;a<b.length;a++)f.push(b[a]);for(a=e.length-1;0<=a;a--)null!==c[e[a].row][e[a].col].getColor()&&c[e[a].row][e[a].col].getColor()!==d&&e.splice(a,1);for(a=0;a<f.length;a++)e.push(f[a]);return e};this.getRookMove=function(b,a,c){var d=this._getRow(b,a,c);
b=this._getCol(b,a,c);a=[];for(c=0;c<d.length;c++)a.push(d[c]);for(c=0;c<b.length;c++)a.push(b[c]);return a};this.getKnightMove=function(b,a,c){var d=[];d.push(this._findTPos(b,a,DIR_TOP));d.push(this._findTPos(b,a,DIR_RIGHT));d.push(this._findTPos(b,a,DIR_BOT));d.push(this._findTPos(b,a,DIR_LEFT));for(var f=[],e=0;e<d.length;e++)for(var g=0;g<d[e].length;g++)f.push(d[e][g]);b=c[b][a].getColor();for(e=f.length-1;0<=e;e--)c[f[e].row][f[e].col].getColor()===b&&f.splice(e,1);return f};this.getBishopMove=
function(b,a,c){var d=this._getMainDiagonal(b,a,c);b=this._getSecondDiagonal(b,a,c);a=[];for(c=0;c<d.length;c++)a.push(d[c]);for(c=0;c<b.length;c++)a.push(b[c]);return a};this.getQueenMove=function(b,a,c){var d=this.getRookMove(b,a,c);b=this.getBishopMove(b,a,c);a=[];for(c=0;c<d.length;c++)a.push(d[c]);for(c=0;c<b.length;c++)a.push(b[c]);return a};this.getKingMove=function(b,a,c){var d=this._getAllNeighbor(b,a);if(1===c[b][a].getPieceHistory().length&&!s_oGame.isCheck()){var f=!0;1===c[b][7].getPieceHistory().length?
(null!==c[b][6].getColor()&&(f=!1),null!==c[b][5].getColor()&&(f=!1)):f=!1;f&&d.push({row:b,col:6});f=!0;1===c[b][0].getPieceHistory().length?(null!==c[b][1].getColor()&&(f=!1),null!==c[b][2].getColor()&&(f=!1),null!==c[b][3].getColor()&&(f=!1)):f=!1;f&&d.push({row:b,col:2})}b=c[b][a].getColor();for(a=d.length-1;0<=a;a--)c[d[a].row][d[a].col].getColor()===b&&d.splice(a,1);return d};this._getEnPassant=function(b,a,c,d){var f=[],e=s_oBoardStateController.getOtherOpponent(b),g=this._getNeighborByDir(a,
c,DIR_RIGHT);if(null!==g&&(g=d[g.row][g.col],g.getColor()===e&&g.getType()===PAWN)){g=g.getPieceHistory();var h=d[a][c].getPieceHistory();2===g.length&&h[h.length-1].id<g[1].id&&(b===WHITE?f.push(this._getNeighborByDir(a,c,DIR_TOPRIGHT)):f.push(this._getNeighborByDir(a,c,DIR_BOTRIGHT)))}g=this._getNeighborByDir(a,c,DIR_LEFT);null!==g&&(g=d[g.row][g.col],g.getColor()===e&&g.getType()===PAWN&&(g=g.getPieceHistory(),h=d[a][c].getPieceHistory(),2===g.length&&h[h.length-1].id<g[1].id&&(b===WHITE?f.push(this._getNeighborByDir(a,
c,DIR_TOPLEFT)):f.push(this._getNeighborByDir(a,c,DIR_BOTLEFT)))));return f};this._init(a);s_oMovesController=this}var s_oMovesController;
function CBoardStateController(){var a;this._init=function(){a=0};this.getOtherOpponent=function(a){return a===WHITE?BLACK:WHITE};this.moveCopiedPiece=function(a,d,e,c,b){var f=a[d][e];a[c][b].setCell(f.getColor(),f.getType(),c,b,f.getPieceHistory());f.setCell(null,null,d,e,[])};this.copyBoard=function(a){for(var d=[],e=0;e<a.length;e++){d[e]=[];for(var c=0;c<a[e].length;c++)d[e][c]=new CCopiedCell(a[e][c])}return d};this.getState=function(a,d){if(0!==this.findAllChecks(a,d).length)return this.findCheckMate(a,
d)?BOARD_STATE_CHECKMATE:BOARD_STATE_CHECK;if(this.findStaleMate(a,d))return BOARD_STATE_STALEMATE};this.findCheckMate=function(a,d){for(var e=[],c=0;c<d.length;c++)for(var b=0;b<d[c].length;b++)d[c][b].getColor()===a&&e.push(d[c][b]);for(c=0;c<e.length;c++){var f=s_oMovesController.getMovesList(e[c].getLogicPos().row,e[c].getLogicPos().col,d);for(b=0;b<f.length;b++){var g=this.copyBoard(d);this.moveCopiedPiece(g,e[c].getLogicPos().row,e[c].getLogicPos().col,f[b].row,f[b].col);if(0===this.findAllChecks(a,
g).length)return!1}}return!0};this.findAllChecks=function(a,d){for(var e=this.getOtherOpponent(a),c=[],b=0;b<d.length;b++)for(var f=0;f<d[b].length;f++)d[b][f].getColor()===e&&c.push(d[b][f]);e=[];for(b=0;b<c.length;b++){var g=c[b].getLogicPos();e[b]={list:s_oMovesController.getMovesList(g.row,g.col,d),piece:c[b]}}c=[];for(b=0;b<e.length;b++)for(f=0;f<e[b].list.length;f++)g=e[b].list[f],d[g.row][g.col].getColor()===a&&d[g.row][g.col].getType()===KING&&c.push(e[b].piece);return c};this.findStaleMate=
function(g,d){var e=this.findCheckMate(g,d);if(!e){for(var c=[],b=[],f=0;f<d.length;f++)for(var h=0;h<d[f].length;h++)d[f][h].getColor()===WHITE&&b.push(d[f][h].getType()),d[f][h].getColor()===BLACK&&c.push(d[f][h].getType());if(1===c.length&&1===b.length)return!0;if(1===c.length&&2===b.length||2===c.length&&1===b.length)if(f=b.indexOf(BISHOP)&&c.indexOf(BISHOP),h=b.indexOf(KNIGHT)&&c.indexOf(KNIGHT),0<=f||0<=h)return!0;if(2===c.length&&2===b.length&&(f=b.indexOf(BISHOP)||c.indexOf(BISHOP),0<=f)){c=
[];for(f=0;f<d.length;f++)for(h=0;h<d[f].length;h++)d[f][h].getType()===BISHOP&&c.push((f+h)%2);if(c[0]===c[1])return!0}}a===DRAW_COUNTER&&(e=!0);return e};this.increaseStallCount=function(){a++};this.resetStall=function(){a=0};this.checkPromotion=function(a){for(var d=null,e=0;e<a.length;e++)a[0][e].getType()===PAWN?d={row:0,col:e}:a[7][e].getType()===PAWN&&(d={row:7,col:e});return d};this.getSpecialMoves=function(a,d,e,c,b){a=b[a][d].getType();if(a===KING){d-=c;if(-2===d)return BOARD_SPECIAL_CASTLING_RIGHT;
if(2===d)return BOARD_SPECIAL_CASTLING_LEFT}else if(a===PAWN&&d!==c&&null===b[e][c].getType())return BOARD_SPECIAL_ENPASSANT};this._init();s_oBoardStateController=this}var s_oBoardStateController;
function CCopiedCell(a){var g,d,e,c,b;this._init=function(a){g=a.getColor();d=a.getType();c=a.getLogicPos().row;b=a.getLogicPos().col;a=a.getPieceHistory();e=[];for(var f=0;f<a.length;f++)e[f]=a[f]};this.setCell=function(a,h,l,k,m){g=a;d=h;c=l;b=k;for(a=0;a<m.length;a++)e[a]=m[a]};this.setColor=function(b){g=b};this.setType=function(b){d=b};this.getColor=function(){return g};this.getType=function(){return d};this.getLogicPos=function(){return{row:c,col:b}};this.getPieceHistory=function(){return e};
this._init(a)}
function CPromoPanel(a,g){var d,e,c,b,f,h,l;this._init=function(a,g){b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=0;s_oStage.addChild(b);(new createjs.Tween.get(b)).to({alpha:.7},500);var k=s_oSpriteLibrary.getSprite("msg_box");h=new createjs.Container;h.y=CANVAS_HEIGHT+k.height/2;s_oStage.addChild(h);e=createBitmap(k);e.regX=k.width/2;e.regY=k.height/2;e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2;h.addChild(e);f=new createjs.Shape;f.graphics.beginFill("#0f0f0f").drawRect(0,0,
CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=.01;l=f.on("click",function(){});h.addChild(f);c=new createjs.Text(TEXT_PROMOTION,"40px "+PRIMARY_FONT,"#402604");c.textAlign="center";c.textBaseline="alphabetic";c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2-300;c.lineWidth=700;h.addChild(c);k=new createjs.Container;k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT/2;h.addChild(k);var m=[];m[0]=BISHOP;m[1]=ROOK;m[2]=KNIGHT;m[3]=QUEEN;d=[];for(var n=0;n<m.length;n++){var r=s_oSpriteLibrary.getSprite(a+"_"+m[n]);d[n]=new CToggle(-200+
400/(m.length-1)*n,0,r,!0,k);d[n].addEventListenerWithParams(ON_MOUSE_UP,this._onPieceSelected,this,m[n])}(new createjs.Tween.get(h)).to({y:0},750,createjs.Ease.cubicOut)};this.unload=function(){f.off("click",l);s_oStage.removeChild(b);s_oStage.removeChild(h)};this._onPieceSelected=function(a){s_oGame.changePiece(a,g);var c=s_oSpriteLibrary.getSprite("msg_box");c=CANVAS_HEIGHT+c.height/2;(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:c},500,createjs.Ease.backIn).call(function(){k.unload();
s_oGame.onExitPromoPanel(a)})};this._init(a,g);var k=this}
function CAI(){var a,g,d,e,c;this._init=function(){};this.getMove=function(){var b=this._buildTree();b=c.getNode(b,1);return this._getBestNode(b)};this._getBestNode=function(b){if(0<b.length){for(var a=0;a<b.length;a++){var c=b[a].model.moves;this._makeMove(c);var e=s_oMovesControllerFaster.getState(WHITE,d);e===BOARD_STATE_CHECKMATE?b[a].model.rating+=.5:e===BOARD_STATE_STALEMATE&&(b[a].model.rating-=.5);this._unMakeMove(c)}c=b[0].model.rating;for(a=1;a<b.length;a++)b[a].model.rating>c&&(c=b[a].model.rating);
e=[];for(a=0;a<b.length;a++)b[a].model.rating===c&&e.push(b[a]);b=e[Math.floor(Math.random()*e.length)].model.moves}else b=null;return b};this._buildTree=function(){a=0;c=new CTreeDecision({rating:0,moves:[],depth:0});d=this._copyBoard(s_oGame.getCells());(new Date).getTime();g=this._maxi(0);(new Date).getTime();return g};this._alphaBetaMax=function(b,f,e){a++;if(e===SEARCH_DEPTH)return this._evaluateBoard();var g=this._findAllMoves(BLACK),h=g.moves;g=g.opponentlist;for(var m=h.length-1;0<=m;m--)if(this._makeMove(h[m]),
s_oMovesControllerFaster.isInCheck(BLACK,d,g))this._unMakeMove(h[m]),h.splice(m,1);else{var n=e+1;c.initNewNode(n);n=this._alphaBetaMin(b,f,n);c.addNode(e,n,h[m]);this._unMakeMove(h[m]);if(n>=f)return f;n>b&&(b=n)}return b};this._alphaBetaMin=function(b,f,e){a++;if(e===SEARCH_DEPTH)return this._evaluateBoard();var g=this._findAllMoves(WHITE),h=g.moves;g=g.opponentlist;for(var m=h.length-1;0<=m;m--)if(this._makeMove(h[m]),s_oMovesControllerFaster.isInCheck(WHITE,d,g))this._unMakeMove(h[m]),h.splice(m,
1);else{var n=e+1;c.initNewNode(n);n=this._alphaBetaMax(b,f,n);c.addNode(e,n,h[m]);this._unMakeMove(h[m]);if(n<=b)return b;n<f&&(f=n)}return f};this._evaluateBoard=function(){return 200*(e[BLACK][KING]-e[WHITE][KING])+9*(e[BLACK][QUEEN]-e[WHITE][QUEEN])+5*(e[BLACK][ROOK]-e[WHITE][ROOK])+3*(e[BLACK][BISHOP]-e[WHITE][BISHOP]+e[BLACK][KNIGHT]-e[WHITE][KNIGHT])+(e[BLACK][PAWN]-e[WHITE][PAWN])};this._findAllMoves=function(b){for(var a=[],c=[],e=0;e<NUM_CELL;e++)for(var g=0;g<NUM_CELL;g++)if(null!==d[e][g].type)if(d[e][g].color===
b)for(var m=s_oMovesControllerFaster.getMovesList(e,g,d),n=0;n<m.length;n++){var q=m[n].row,t=m[n].col;a.push({sourcerow:e,sourcecol:g,destrow:q,destcol:t,sourcetype:d[e][g].type,sourcecolor:d[e][g].color,sourcehistory:d[e][g].history,desttype:d[q][t].type,destcolor:d[q][t].color,desthistory:d[q][t].history})}else c.push({row:e,col:g});return{moves:a,opponentlist:c}};this._makeMove=function(b){null!==b.destcolor&&e[b.destcolor][b.desttype]--;d[b.destrow][b.destcol]={color:b.sourcecolor,type:b.sourcetype,
history:b.sourcehistory};d[b.sourcerow][b.sourcecol]={color:null,type:null,history:[]};0!==b.destrow&&7!==b.destrow||b.sourcetype!==PAWN||(d[b.destrow][b.destcol]={color:b.sourcecolor,type:QUEEN,history:b.sourcehistory},e[b.sourcecolor][PAWN]--,e[b.sourcecolor][QUEEN]++)};this._unMakeMove=function(b){null!==b.destcolor&&e[b.destcolor][b.desttype]++;d[b.sourcerow][b.sourcecol]={color:b.sourcecolor,type:b.sourcetype,history:b.sourcehistory};d[b.destrow][b.destcol]={color:b.destcolor,type:b.desttype,
history:b.desthistory};0!==b.destrow&&7!==b.destrow||b.sourcetype!==PAWN||(e[b.sourcecolor][PAWN]++,e[b.sourcecolor][QUEEN]--)};this.debugBoard=function(b){for(var a=[],c=0;c<NUM_CELL;c++){a[c]=[];for(var d=0;d<NUM_CELL;d++)a[c][d]=b[c][d].getType()+"_"+b[c][d].getColor()}};this._copyBoard=function(b){e=[BLACK,WHITE];e[BLACK]=[];e[WHITE]=[];e[BLACK][KING]=0;e[BLACK][QUEEN]=0;e[BLACK][ROOK]=0;e[BLACK][BISHOP]=0;e[BLACK][KNIGHT]=0;e[BLACK][PAWN]=0;e[WHITE][KING]=0;e[WHITE][QUEEN]=0;e[WHITE][ROOK]=0;
e[WHITE][BISHOP]=0;e[WHITE][KNIGHT]=0;e[WHITE][PAWN]=0;for(var a=[],c=0;c<NUM_CELL;c++){a[c]=[];for(var d=0;d<NUM_CELL;d++)a[c][d]={color:b[c][d].getColor(),type:b[c][d].getType(),history:b[c][d].getPieceHistory()},null!==b[c][d].getColor()&&e[a[c][d].color][a[c][d].type]++}return a};this._maxi=function(b){if(b===SEARCH_DEPTH)return this._evaluateBoard();var a=-INFINITE,e=this._findAllMoves(BLACK),g=e.moves;e=e.opponentlist;for(var k=b+1,m=g.length-1;0<=m;m--)if(this._makeMove(g[m]),s_oMovesControllerFaster.isInCheck(BLACK,
d,e))this._unMakeMove(g[m]),g.splice(m,1);else{c.initNewNode(k);var n=this._mini(k);c.addNode(b,n,g[m]);this._unMakeMove(g[m]);n>a&&(a=n)}return a};this._mini=function(b){if(b===SEARCH_DEPTH)return this._evaluateBoard();var a=INFINITE,e=this._findAllMoves(WHITE),g=e.moves;e=e.opponentlist;for(var k=b+1,m=g.length-1;0<=m;m--)if(this._makeMove(g[m]),s_oMovesControllerFaster.isInCheck(WHITE,d,e))this._unMakeMove(g[m]),g.splice(m,1);else{c.initNewNode(k);var n=this._maxi(k);c.addNode(b,n,g[m]);this._unMakeMove(g[m]);
n<a&&(a=n)}return a};this._init()}DIR_TOPRIGHT="DIR_TOPRIGHT";DIR_RIGHT="DIR_RIGHT";DIR_BOTRIGHT="DIR_BOTRIGHT";DIR_TOPLEFT="DIR_TOPLEFT";DIR_LEFT="DIR_LEFT";DIR_BOTLEFT="DIR_BOTLEFT";DIR_TOP="DIR_TOP";DIR_BOT="DIR_BOT";
function CMovesControllerFaster(a){var g,d,e;this._init=function(a){g=a.length;d=a[0].length;e=[];for(a=0;a<g;a++){e[a]=[];for(var b=0;b<d;b++)e[a][b]=[]}this._buildMap()};this._buildMap=function(){for(var a=0;a<g;a++)for(var b=0;b<d;b++)e[a][b][DIR_TOPRIGHT]=this._setNeighbor(a,b,DIR_TOPRIGHT),e[a][b][DIR_RIGHT]=this._setNeighbor(a,b,DIR_RIGHT),e[a][b][DIR_BOTRIGHT]=this._setNeighbor(a,b,DIR_BOTRIGHT),e[a][b][DIR_TOPLEFT]=this._setNeighbor(a,b,DIR_TOPLEFT),e[a][b][DIR_LEFT]=this._setNeighbor(a,b,
DIR_LEFT),e[a][b][DIR_BOTLEFT]=this._setNeighbor(a,b,DIR_BOTLEFT),e[a][b][DIR_TOP]=this._setNeighbor(a,b,DIR_TOP),e[a][b][DIR_BOT]=this._setNeighbor(a,b,DIR_BOT)};this._setNeighbor=function(a,b,f){var c=null;switch(f){case DIR_TOPRIGHT:0<a&&b<d-1&&(c={row:a-1,col:b+1});break;case DIR_RIGHT:b<d-1&&(c={row:a,col:b+1});break;case DIR_BOTRIGHT:a<g-1&&b<d-1&&(c={row:a+1,col:b+1});break;case DIR_TOPLEFT:0<a&&0<b&&(c={row:a-1,col:b-1});break;case DIR_LEFT:0<b&&(c={row:a,col:b-1});break;case DIR_BOTLEFT:a<
g-1&&0<b&&(c={row:a+1,col:b-1});break;case DIR_TOP:0<a&&(c={row:a-1,col:b});break;case DIR_BOT:a<g-1&&(c={row:a+1,col:b})}return c};this._getNeighborByDir=function(a,b,d){return e[a][b][d]};this._getAllNeighbor=function(a,b){var c=[],d;for(d in e[a][b])null!==e[a][b][d]&&c.push(e[a][b][d]);return c};this._getMainDiagonal=function(a,b,d){var c=[],f=d[a][b].color;this._findInDirection(a,b,DIR_BOTRIGHT,c,99,f,d);this._findInDirection(a,b,DIR_TOPLEFT,c,99,f,d);return c};this._getSecondDiagonal=function(a,
b,d){var c=[],f=d[a][b].color;this._findInDirection(a,b,DIR_BOTLEFT,c,99,f,d);this._findInDirection(a,b,DIR_TOPRIGHT,c,99,f,d);return c};this._getRow=function(a,b,d){var c=[],f=d[a][b].color;this._findInDirection(a,b,DIR_LEFT,c,99,f,d);this._findInDirection(a,b,DIR_RIGHT,c,99,f,d);return c};this._getCol=function(a,b,d){var c=[],f=d[a][b].color;this._findInDirection(a,b,DIR_TOP,c,99,f,d);this._findInDirection(a,b,DIR_BOT,c,99,f,d);return c};this._getStraightByDirAndRadius=function(a,b,d,e,g){var c=
[];this._findInDirection(a,b,d,c,e,g[a][b].color,g);return c};this._getStraightRowByRadius=function(a,b,d){var c=[];this._findInDirection(a,b,DIR_LEFT,c,d);this._findInDirection(a,b,DIR_RIGHT,c,d);return c};this._getStraightColByRadius=function(a,b,d){var c=[];this._findInDirection(a,b,DIR_TOP,c,d);this._findInDirection(a,b,DIR_BOT,c,d);return c};this._findInDirection=function(a,b,d,g,l,k,m){--l;if(null!==e[a][b][d]&&0<=l){var c=e[a][b][d].row;a=e[a][b][d].col;k?(b=m[c][a].color,b!==k&&(null===b?
(g.push({row:c,col:a}),this._findInDirection(c,a,d,g,l,k,m)):g.push({row:c,col:a}))):(g.push({row:c,col:a}),this._findInDirection(c,a,d,g,l,k,m))}};this._findTPos=function(a,b,d){var c=[];a=e[a][b][d];null!==a&&(a=e[a.row][a.col][d],null!==a&&(c=d===DIR_TOP||d===DIR_BOT?this._getStraightRowByRadius(a.row,a.col,1):this._getStraightColByRadius(a.row,a.col,1)));return c};this.getMovesList=function(a,b,d){var c=[];switch(d[a][b].type){case PAWN:c=this.getPawnMove(a,b,d);break;case ROOK:c=this.getRookMove(a,
b,d);break;case KNIGHT:c=this.getKnightMove(a,b,d);break;case BISHOP:c=this.getBishopMove(a,b,d);break;case QUEEN:c=this.getQueenMove(a,b,d);break;case KING:c=this.getKingMove(a,b,d)}return c};this.getPawnMove=function(a,b,d){var c=d[a][b].color,e=[];if(c===WHITE){var f=6===a?this._getStraightByDirAndRadius(a,b,DIR_TOP,2,d):this._getStraightByDirAndRadius(a,b,DIR_TOP,1,d);var g=this._getNeighborByDir(a,b,DIR_TOPRIGHT);null!==g&&d[g.row][g.col].color===BLACK&&e.push(g);g=this._getNeighborByDir(a,b,
DIR_TOPLEFT);null!==g&&d[g.row][g.col].color===BLACK&&e.push(g);if(3===a)for(a=this._getEnPassant(WHITE,a,b,d),b=0;b<a.length;b++)e.push(a[b])}else if(f=1===a?this._getStraightByDirAndRadius(a,b,DIR_BOT,2,d):this._getStraightByDirAndRadius(a,b,DIR_BOT,1,d),g=this._getNeighborByDir(a,b,DIR_BOTRIGHT),null!==g&&d[g.row][g.col].color===WHITE&&e.push(g),g=this._getNeighborByDir(a,b,DIR_BOTLEFT),null!==g&&d[g.row][g.col].color===WHITE&&e.push(g),4===a)for(a=this._getEnPassant(BLACK,a,b,d),b=0;b<a.length;b++)e.push(a[b]);
for(b=f.length-1;0<=b;b--)null!==d[f[b].row][f[b].col].color&&d[f[b].row][f[b].col].color!==c&&f.splice(b,1);for(b=0;b<e.length;b++)f.push(e[b]);return f};this.getRookMove=function(a,b,d){var c=this._getRow(a,b,d);a=this._getCol(a,b,d);b=[];for(d=0;d<c.length;d++)b.push(c[d]);for(d=0;d<a.length;d++)b.push(a[d]);return b};this.getKnightMove=function(a,b,d){var c=[];c.push(this._findTPos(a,b,DIR_TOP));c.push(this._findTPos(a,b,DIR_RIGHT));c.push(this._findTPos(a,b,DIR_BOT));c.push(this._findTPos(a,
b,DIR_LEFT));for(var e=[],f=0;f<c.length;f++)for(var g=0;g<c[f].length;g++)e.push(c[f][g]);a=d[a][b].color;for(f=e.length-1;0<=f;f--)d[e[f].row][e[f].col].color===a&&e.splice(f,1);return e};this.getBishopMove=function(a,b,d){var c=this._getMainDiagonal(a,b,d);a=this._getSecondDiagonal(a,b,d);b=[];for(d=0;d<c.length;d++)b.push(c[d]);for(d=0;d<a.length;d++)b.push(a[d]);return b};this.getQueenMove=function(a,b,d){var c=this.getRookMove(a,b,d);a=this.getBishopMove(a,b,d);b=[];for(d=0;d<c.length;d++)b.push(c[d]);
for(d=0;d<a.length;d++)b.push(a[d]);return b};this.getKingMove=function(a,b,d){var c=this._getAllNeighbor(a,b);if(1===d[a][b].history.length&&!s_oGame.isCheck()){var e=!0;1===d[a][7].history.length?(null!==d[a][6].color&&(e=!1),null!==d[a][5].color&&(e=!1)):e=!1;e&&c.push({row:a,col:6});e=!0;1===d[a][0].history.length?(null!==d[a][1].color&&(e=!1),null!==d[a][2].color&&(e=!1),null!==d[a][3].color&&(e=!1)):e=!1;e&&c.push({row:a,col:2})}a=d[a][b].color;for(b=c.length-1;0<=b;b--)d[c[b].row][c[b].col].color===
a&&c.splice(b,1);return c};this._getEnPassant=function(a,b,d,e){var c=[],f=s_oBoardStateController.getOtherOpponent(a),g=this._getNeighborByDir(b,d,DIR_RIGHT);null!==g&&(g=e[g.row][g.col],g.color===f&&g.type===PAWN&&(g=g.history,2===g.length&&(a===WHITE?c.push(this._getNeighborByDir(b,d,DIR_TOPRIGHT)):c.push(this._getNeighborByDir(b,d,DIR_BOTRIGHT)))));g=this._getNeighborByDir(b,d,DIR_LEFT);null!==g&&(g=e[g.row][g.col],g.color===f&&g.type===PAWN&&(g=g.history,2===g.length&&(a===WHITE?c.push(this._getNeighborByDir(b,
d,DIR_TOPLEFT)):c.push(this._getNeighborByDir(b,d,DIR_BOTLEFT)))));return c};this.getState=function(a,b){if(0!==this.findAllChecks(a,b).length)return this.findCheckMate(a,b)?BOARD_STATE_CHECKMATE:BOARD_STATE_CHECK;if(this.findStaleMate(a,b))return BOARD_STATE_STALEMATE};this.findCheckMate=function(a,b){for(var c=[],d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++)b[d][e].color===a&&c.push({row:d,col:e});for(d=0;d<c.length;d++){var g=c[d].row,m=c[d].col,n=s_oMovesControllerFaster.getMovesList(g,m,
b);for(e=0;e<n.length;e++){var q=n[e].row,t=n[e].col;q={sourcerow:g,sourcecol:m,destrow:q,destcol:t,sourcetype:b[g][m].type,sourcecolor:b[g][m].color,sourcehistory:b[g][m].history,desttype:b[q][t].type,destcolor:b[q][t].color,desthistory:b[q][t].history};this._makeMove(b,q);if(0===this.findAllChecks(a,b).length)return!1;this._unMakeMove(b,q)}}return!0};this._makeMove=function(a,b){a[b.destrow][b.destcol]={color:b.sourcecolor,type:b.sourcetype,history:b.sourcehistory};a[b.sourcerow][b.sourcecol]={color:null,
type:null,history:[]};0!==b.destrow&&7!==b.destrow||b.sourcetype!==PAWN||(a[b.destrow][b.destcol]={color:b.sourcecolor,type:QUEEN,history:b.sourcehistory})};this._unMakeMove=function(a,b){a[b.sourcerow][b.sourcecol]={color:b.sourcecolor,type:b.sourcetype,history:b.sourcehistory};a[b.destrow][b.destcol]={color:b.destcolor,type:b.desttype,history:b.desthistory}};this.findStaleMate=function(a,b){var c=this.findCheckMate(a,b);if(!c){for(var d=[],e=[],g=0;g<b.length;g++)for(var m=0;m<b[g].length;m++)b[g][m].color===
WHITE&&e.push(b[g][m].type),b[g][m].color===BLACK&&d.push(b[g][m].type);if(1===d.length&&1===e.length)return!0;if(1===d.length&&2===e.length||2===d.length&&1===e.length)if(g=e.indexOf(BISHOP)&&d.indexOf(BISHOP),m=e.indexOf(KNIGHT)&&d.indexOf(KNIGHT),0<=g||0<=m)return!0;if(2===d.length&&2===e.length&&(g=e.indexOf(BISHOP)||d.indexOf(BISHOP),0<=g)){d=[];for(g=0;g<b.length;g++)for(m=0;m<b[g].length;m++)b[g][m].type===BISHOP&&d.push((g+m)%2);if(d[0]===d[1])return!0}}return c};this.isInCheck=function(a,
b,d){for(var c,e=0;e<d.length;e++){c=s_oMovesControllerFaster.getMovesList(d[e].row,d[e].col,b);for(var f=0;f<c.length;f++){var g=c[f];if(b[g.row][g.col].color===a&&b[g.row][g.col].type===KING)return!0}}return!1};this.findAllChecks=function(a,b){for(var c=s_oBoardStateController.getOtherOpponent(a),d=[],e=0;e<b.length;e++)for(var g=0;g<b[e].length;g++)b[e][g].color===c&&d.push({row:e,col:g});c=[];for(e=0;e<d.length;e++){var m=d[e];c[e]={list:s_oMovesControllerFaster.getMovesList(m.row,m.col,b),piece:d[e]}}d=
[];for(e=0;e<c.length;e++)for(g=0;g<c[e].list.length;g++)m=c[e].list[g],b[m.row][m.col].color===a&&b[m.row][m.col].type===KING&&d.push(c[e].piece);return d};this._init(a);s_oMovesControllerFaster=this}var s_oMovesControllerFaster;
function CMsgBox(a){var g,d,e,c,b;this._init=function(a){d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;d.on("mousedown",function(){});s_oStage.addChild(d);(new createjs.Tween.get(d)).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);var f=s_oSpriteLibrary.getSprite("msg_box"),l=createBitmap(f);l.regX=f.width/2;l.regY=f.height/2;e.addChild(l);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2;c=new createjs.Text(a," 80px "+PRIMARY_FONT,"#ffffff");
c.y=0;c.textAlign="center";c.textBaseline="middle";c.lineWidth=600;e.addChild(c);b=new createjs.Container;b.y=180;e.addChild(b);g=[]};this.unload=function(){s_oStage.removeChild(d);s_oStage.removeChild(e);d.off("mousedown",function(){});for(var a=0;a<g.length;a++)g[a].unload()};this.setMessage=function(a){c.text=a};this.setExplMsg=function(a){a=new createjs.Text(a," 50px "+PRIMARY_FONT,"#ffffff");a.y=-100;a.textAlign="center";a.textBaseline="middle";a.lineWidth=400;e.addChild(a)};this.addButton=function(a,
d,e,k){c.y=-250;var f=new CGfxButton(g.length*(a.width+150),0,a,b);f.addEventListener(d,e,k);g.push(f);b.regX=b.getBounds().width/2-a.width/2};this.show=function(){d.visible=!0;e.visible=!0};this.reShow=function(){d.visible=!0;e.visible=!0};this.hide=function(){d.visible=!1;e.visible=!1};this._init(a)};
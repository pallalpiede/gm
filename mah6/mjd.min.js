!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=!1,window.addEventListener("resize",e.resizeCanvas,!1),window.addEventListener("orientationchange",e.resizeCanvas,!1)}function t(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function s(e){return e?e+"Hidden":"hidden"}function i(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.anchor.set(0,0),this.responsive=null,this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.globalScale=null}function a(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0,this.responsive=null}function o(){this.parent=null,this.managers=null,this.bg=null,this.text=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1}function r(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function l(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.tab1=null,this.tab2=null,this.whichTab=0,this.checkBox=null}function h(e){n.call(this),this.textures=null,this.type=e||h.TYPE_BUTTON,this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null}function u(){this.checked=!1,this.tick=null,this.toggleEvent=null,h.call(this,h.TYPE_CHECKBOX)}function c(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[]}function d(){this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.chain=0,this.multiMatch=0,this.spriteList=null,this.lastHovered=null,this.thinkingTimer=0}function p(){this.managers=null}function g(){this.strings=null}function m(e,t,s){M.debug&&console.log("FontLoaded ",e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=m.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function f(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function y(){this.list=null}function v(){this.pending=0,this.loader=null}function b(){}function _(){this.list=null,this.pending=0}function w(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null}function x(e,t){void 0!=window.ArenaXApi&&null!=window.ArenaXApi&&(this._arenaXapi=ArenaXApi.init(e,t)),void 0!=window.ARK_game_arena_connector&&window.ARK_game_arena_connector.init()}function k(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e}function T(e,t,s,i,a,o,r){this.managers=t,this.symbol=o,this.value=r,this.name="cube_"+this.symbol+"_1",n.call(this),this.create(e,null,this.name,this.managers.textures),this.setPickerData(this.managers.data.get("maskData_1")),this.anchor.set(.5,.5),this.scale.x=T.scale,this.scale.y=T.scale,this.sizex=125*M.tileAssetScale*T.scale,this.sizey=125*M.tileAssetScale*T.scale,this.scalez=.28,this.cx=s,this.cy=i,this.cz=a,this.wobbleCount=0,this.angle=35*Math.PI/180,this.rotate3d(this.angle)}function S(){PIXI.Container.call(this),this.angle=0,this.targetAngle=0,this.speedMatchValue=0,this.speedMatchTime=0,this.multiMatchValue=0,this.levelBonusValues=null,this.world=null,this.tileDescriptions=null,this.puzzleLayout=null,this.tiles=null,this.managers=null,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.cacheSpriteList=[],this.second=!1,this.removeTiles=null,S.turnSpeed=4*Math.PI/180}function A(){this.preloader=null,this.titles=null,this.game=null,this.bm=null}function M(){M.VERSION="v1.41",M.testKeys=!1,M.debug=!1,M.showFPS=!1,M.pauseOnFocusLoss=!1,M.playAgainCount=0,M.playMidRollAd=!1,M.playMidRollAdAfterPause=!1,M.eventChangeAdOnMatch=!1,M.eventChangeAdOnTitlesShow=!1,M.eventChangeAdOnTitlesClose=!1,M.eventChangeAdOnRotate=!1,M.eventChangeAdOnPopup=!0,M.eventChangeAdOnOptions=!0,M.eventChangeAdOnIdle=2e4,M.idleTimer=Number.MAX_VALUE,M.timerStart=470999,M.gameWide=1200,M.gameHigh=900,M.volumeControl=.5,M.click=null,M.hover=null,M.mouseDown=null,M.mouseUp=null,M.swipe=0,M.swipeEnabled=!1,M.showTitleScreenOnStart=!0,M.grabFocusOnStart=!1,M.showHelp=!0,M.forceResize=!1,M.resized=!1,M.resizeConsumed=!1,M.time=0,M.elapsedTime=0,M.muteUntil=-1,M.isPortrait=!0,M.aspectRatio=1,M.countryCode="en-US",M.nowTime=0,M.repeatedGamesLeft=0,M.lowResolutionAssets=void 0,M.tileAssetScale=1,M.suppressBigAnimations=!1,M.pieceScale=.85,M.puzzleOffsetY=0,M._lastTime=0,this.gameControl=null}function P(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function I(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=I.STARTING,this.nextState=-1,this.delay=0,this.won=!1,I.paused=!1,I.requestQuit=!1,I.effects=null,I.timeLeft=0,I.score=0,I.options=null}function z(e){this.game=e,this.managers=null,this.lastMatchTime=-1,this.bg=null,this.buttons=null,this.icons=null,this.sprites=null,this.texts=null,this.timeText=null,this.scoreText=null,this.bm=null,this.container1=null,this.container2=null,this.ignoreClick=null,this.puzzleInput=null,this.puzzle=null}e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.mouseDownHandler),t.plugins.interaction.on("touchmove",e.mouseMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.mouseUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){M.click=e.mouseToStage(t.data.global.x,t.data.global.y)},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(M.swipe=e.deltaX<-20?-1:e.deltaX>20?1:0)},e.mouseOutHandler=function(){M.mouseOut=!0},e.mouseMoveHandler=function(t){M.mouseOut&&(M.mouseOut=!1),M.hover=e.mouseToStage(t.data.global.x,t.data.global.y),e._mouseSwipeStart&&M.swipeEnabled&&E.distanceBetween(e._mouseSwipeStart,M.hover)>=e.swipeDistance&&M.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:M.hover.x-e._mouseSwipeStart.x,deltaY:M.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,M.mouseDown=null)},e.mouseDownHandler=function(t){e._mouseDownWhen=M.nowTime,M.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),!e._mouseSwipeStart&&M.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",M.mouseDown.x,M.mouseDown.y)},e.mouseUpHandler=function(t){var s=0;M.mouseUp&&M.mouseDown&&(s=E.distanceBetween(M.mouseUp,M.mouseDown)),M.mouseDown&&(!M.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||M.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(M.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),M.mouseUp&&M.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:M.mouseUp.x-M.mouseDown.x,deltaY:M.mouseUp.y-M.mouseDown.y}))),e._mouseDownWhen=0,M.mouseDown=e._mouseSwipeStart=null},e.resizeCanvas=function(){null===M.HTMLElement?e._internalResize(window.innerWidth,window.innerHeight):e._internalResize(M.HTMLElement.clientWidth,M.HTMLElement.clientHeight)},e._internalResize=function(e,t){if(M.forceResize||M.width!=e||M.height!=t){if(M.width=e,M.height=t,M.aspectRatio=M.width/M.height,M.isPortrait=M.aspectRatio<1,void 0===M.lowResolutionAssets){var s=Math.max(M.width*M.app.renderer.resolution,M.height*M.app.renderer.resolution),i=s>900;M.lowResolutionAssets=!i}M.tileAssetScale=M.lowResolutionAssets?.5:1;var n=1;M.renderer.resize(M.width,M.height),M.stage.x=Math.round(M.width/2),M.stage.y=Math.round(M.height/2);var a=M.width/M.gameWide,o=M.height/M.gameHigh;M.background.scale.set(n*Math.max(a,o));var r=T.pieceSizePixels*M.tileAssetScale*T.scale*S.maxHalfTilesWide*.5,l=T.pieceSizePixels*M.tileAssetScale*T.scale*S.maxTilesHigh,h=M.width/r,u=M.height/l;M.puzzle.scale.set(n*Math.min(M.pieceScale*h,M.pieceScale*u)),M.topUI.y=-M.height/2,M.topUI.scale.set(n*Math.min(a,o)),M.fullUI.scale.set(n*Math.min(a*M.fullUIScale,o*M.fullUIScale)),M.rightUI.scale.set(n*Math.min(a,o)),M.rightUI.x=.45*M.width,M.rightUI.y=-M.height/2,M.bottomUI.scale.set(1.5*n*Math.min(a,o)),M.resized=!0,M.resizeConsumed=!1,M.forceResize=!1,M.debug&&console.log("\nMahjonggDimensions "+M.width.toString()+" x "+M.height.toString()+" res = "+(M.lowResolutionAssets?"low":"high")),M.debug&&(console.log("aspectRatio:",M.aspectRatio,M.aspectRatio>=1?"landscape":"portrait"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",M.lowResolutionAssets?"low":"high"),console.log("View ratio: ",a,":",o),console.log("stage offset: ",M.stage.x,",",M.stage.y,"\n"))}},e.registerCallback=function(t,s,i){M.debug&&console.log("registerCallback for",t),e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var n=e.callbackList.length-1;n>=0;--n){var a=e.callbackList[n];a.event==t&&(M.debug&&console.log("triggerCallback for",t),a.callback.call(a.arg.context,s,i,a.arg.args))}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var n=e.callbackList[i];if(n.event==t&&n.callback==s){e.callbackList.splice(i,1),M.debug&&console.log("clearCallback for",t);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=M.width/M.gameWide,s=M.height/M.gameHigh,i="aspectRatio: "+M.aspectRatio+" "+(M.aspectRatio>=1?"landscape":"portrait")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(M.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var n=new a(i,M.textStyleMediumTiny);n.create(M.topUI,-0.45,.25,!0),n.anchor.y=1,e._showDebugWindowData=!0}},function(){var e=this,t=function(e){return e instanceof t?e:this instanceof t?void(this._wrapped=e):new t(e)};if(t.userAgent=null,t.getUserAgent=function(){return this.userAgent},t.setUserAgent=function(e){this.userAgent=e},t.isAndroid=function(){return this.getUserAgent().match(/Android/i)},t.isBlackBerry=function(){return this.getUserAgent().match(/BlackBerry/i)},t.isBlackBerryPlayBook=function(){return this.getUserAgent().match(/PlayBook/i)},t.isBlackBerry10=function(){return this.getUserAgent().match(/BB10/i)},t.isIOS=function(){return this.isIPhone()||this.isIPad()||this.isIPod()},t.isIPhone=function(){return this.getUserAgent().match(/iPhone/i)},t.isIPad=function(){return this.getUserAgent().match(/iPad/i)},t.isIPod=function(){return this.getUserAgent().match(/iPod/i)},t.isOpera=function(){return this.getUserAgent().match(/Opera Mini/i)},t.isWindows=function(){return this.isWindowsDesktop()||this.isWindowsMobile()},t.isWindowsMobile=function(){return this.getUserAgent().match(/IEMobile/i)},t.isWindowsDesktop=function(){return this.getUserAgent().match(/WPDesktop/i)},t.isFireFox=function(){return this.getUserAgent().match(/Firefox/i)},t.isNexus=function(){return this.getUserAgent().match(/Nexus/i)},t.isKindleFire=function(){return this.getUserAgent().match(/Kindle Fire/i)},t.isPalm=function(){return this.getUserAgent().match(/PalmSource|Palm/i)},t.isAny=function(){var e=!1,s=Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]});for(var i in s)if("setUserAgent"!==s[i]&&"getUserAgent"!==s[i]&&"isAny"!==s[i]&&"isWindows"!==s[i]&&"isIOS"!==s[i]&&t[s[i]]()){e=!0;break}return e},("function"==typeof window||"object"==typeof window)&&t.setUserAgent(navigator.userAgent),"undefined"!=typeof exports){var s=function(e){return e=void 0===e?!0:e,e?function(e,s,i){var n=e.headers["user-agent"]||"";t.setUserAgent(n),e.SmartPhone=t,"function"==typeof s.locals?s.locals({SmartPhone:t}):s.locals.SmartPhone=t,i()}:t};"undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports=s}else e.SmartPhone=t}.call(this);var C={};C.isPressed=null,C.edgeDown=null,C.edgeUp=null,C.debug=!1,C.create=function(e){C.debug=e||!1,C.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",C.keyDown,!0):document.addEventListener?document.addEventListener("keydown",C.keyDown,!0):window.addEventListener?window.addEventListener("keydown",C.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",C.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",C.keyUp,!0):document.addEventListener?document.addEventListener("keyup",C.keyUp,!0):window.addEventListener?window.addEventListener("keyup",C.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",C.keyUp)},C.destroy=function(){C.isPressed=null,C.edgeDown=null,C.edgeUp=null},C.update=function(){return!0},C.reset=function(e){void 0===e?(C.isPressed=[],C.edgeDown=[],C.edgeUp=[]):(C.isPressed[e]=!1,C.edgeDown[e]=!1,C.edgeUp[e]=!1)},C.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(M.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},C.keyDown=function(e){e.preventDefault();var t=C.getCode(e);C.isPressed[t]||(C.edgeDown[t]=!0),C.isPressed[t]=!0},C.keyUp=function(e){e.preventDefault();var t=C.getCode(e);C.isPressed[t]&&(C.edgeUp[t]=!0),C.isPressed[t]=!1};var L={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},E={};E.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},E.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},E.distance=function(e,t,s,i){var n=s-e,a=i-t;return Math.sqrt(n*n+a*a)},E.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},E.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var n,a=i/2,o=E.normaliseAnglePositive(e-t+i,i);return n=o>a?e+Math.min(i-o,s):0!==o?e-Math.min(o,s):t,E.normaliseAngle(n,i)},E.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},E.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},E.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,n=e.length;n>i;i++)if(e[i][t]==s)return i;return-1},E.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},E.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),n=(Math.floor(t)%60).toString();return n.length<2&&(n="0"+n),i+":"+n},E.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},E.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},E.randomFromList=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},E.makeFunctionForSprite=function(e){return function(t){E.setValuesFromObject(e,t)}},E.focusChangeCallback=null,E.focusChangeContext=null,E._visListener=!1,E._hidden=!1,E._focusIn=function(){E._hidden=!1,M.debug&&console.log("Utils._focusIn hidden =",E._hidden),E.focusChangeContext&&E.focusChangeCallback&&E.focusChangeCallback.call(E.focusChangeContext,E._hidden)},E._focusOut=function(){E._hidden=!0,M.debug&&console.log("Utils._focusOut hidden =",E._hidden),E.focusChangeContext&&E.focusChangeCallback&&E.focusChangeCallback.call(E.focusChangeContext,E._hidden)},E.detectHidden=function(){if(!E._visListener){var e=t(),n=s(e),a=i(e);document.addEventListener(a,function(){document[n]?E._focusOut():E._focusIn()}),window.addEventListener("focus",E._focusIn,!1),window.addEventListener("blur",E._focusOut,!1),E._visListener=!0}},E.isHidden=function(){return document.hidden},E.blanker=null,E.addBlanker=function(e){return null!==E.blanker?void E.blanker.instances++:(E.blanker=new n,E.blanker.create(M.fullUI,"menuAtlas","blanker",e,0,0),E.blanker.anchor.set(.5),E.blanker.scale.set(40),void(E.blanker.instances=1))},E.removeBlanker=function(){E.blanker&&(E.blanker.instances--,E.blanker.instances<=0&&(E.blanker.destroy(),E.blanker=null))},n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,n,a,o){M.debug&&console.log("Sprite.create",s),this.atlas=t,this.key=s,this.textures=i,this.myFilters=null,this.key&&(this.texture=this.textures.get(t,s),!this.texture&&M.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+s)),e.addChild(this),o?(this.pcntx=n||0,this.pcnty=a||0):(this.x=n||0,this.y=a||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){M.debug&&console.log("Sprite.destroy",this.key),this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.responsive=null,this.globalScale=null,this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this)},n.prototype.update=function(e){return M.resized&&(this.getGlobalScale(!0),this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),M.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setFrame=function(e){return this.key!=e&&(this.key=e,this.key)?(this.texture=this.textures.get(this.atlas,e),!0):!1},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),n=this.pickerMaskData[s+i*this.texture.frame.width*4];return n?!0:!1},n.prototype.createCanvasFromTexture=function(){var e=document.createElement("canvas");e.width=this.texture.frame.width,e.height=this.texture.frame.height;var t=e.getContext("2d");return t.drawImage(this.texture.baseTexture.source,this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),e},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,n,a){this.fader=new f,this.fader.setFade(e,t,s,i,n,a)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return M.renderer.render(this,e),M.renderer.extract.pixels(e)},n.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(M.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(M.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},n.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},n.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=M.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*M.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=M.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*M.height:e*this.parent.height}},setx:{set:function(e){this.x=e,this.parent&&this.parent.texture.noFrame?(this.msx=M.width/this.parent.scale.x,this.percentx=e/this.msx):this.percentx=this.parent&&this.parent.parent&&!this.parent.parent.parent?e/M.width:e/this.parent.width}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),a.prototype=Object.create(PIXI.Text.prototype),a.prototype.constructor=a,a.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},a.prototype.destroy=function(){this.responsive=null,PIXI.Text.prototype.destroy.call(this)},a.prototype.update=function(){return M.resized&&(this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),M.resizeConsumed=!0),!0},a.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(M.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(M.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},a.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},a.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(a.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=M.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent==M.window?e*M.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=M.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent==M.window?e*M.height:e*this.parent.height}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),o.prototype.create=function(e,t,s,i,r){this.parent=e,this.managers=t,this.callback=i||null,this.context=r||null,this.timeOut=0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,E.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"menuAtlas","popup",this.managers.textures),this.bg.anchor.set(.5,.5);var l=M.textStyleBoldHugeCentered.clone();l.wordWrapWidth=800;var h=this.managers.locale.get(s)||s;this.text=new a(h,l),this.text.create(this.bg,0,0,!0),this.text.anchor.set(.5,.5),o.tweenIn.step=E.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.tween(o.tweenIn),this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.managers.audio.play("snd_rotate")},o.prototype.addButton=function(e,t){var s=new h(h.TYPE_BUTTON);s.create(this.bg,"introAtlas","play-button",this.managers,0,340,!1,"play-button","play-button-rollover","play-button-down",t||"click1_event"),s.anchor.set(.5,.5);var i=new a(this.managers.locale.get(e),M.textStyleBoldButtonsLarge);i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",this.buttons.push(s)},o.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new h(h.TYPE_BUTTON);i.create(this.bg,"introAtlas","play-button",this.managers,-200,340,!1,"play-button","play-button-rollover","play-button-down","click1_event"),i.anchor.set(.5,.5);var n=new a(this.managers.locale.get(e),M.textStyleBoldButtonsLarge);n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i),i=new h(h.TYPE_BUTTON),i.create(this.bg,"introAtlas","play-button",this.managers,200,340,!1,"play-button","play-button-rollover","play-button-down","click2_event"),i.anchor.set(.5,.5),n=new a(this.managers.locale.get(t),M.textStyleBoldButtonsLarge),n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i)},o.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(o.tweenOut.step=E.makeFunctionForSprite(this.bg),this.bg.tweener.tween(o.tweenOut),this.bg.tweener.owner=this,this.bg.tweener.context=this),this.removeContext=e||null,this.removeArgument=t||null,!0)},o.prototype.destroy=function(){var e,t;if(E.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,M.idleTimer=M.eventChangeAdOnIdle},o.prototype.update=function(e){if(this.doneIn&&(M.eventChangeAdOnPopup&&!this.adShown&&(M.arenaHelper.sendEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),!this.timeOut||this.buttons&&this.buttons.length||(this.timeOut-=M.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var t,s,i;for(t=0,s=this.buttons.length;s>t&&(i=this.buttons[t].update(),1!=this.buttons[t].alpha&&(i=null),!i);t++);if("click1_event"==i){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==i){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}}return!this.doneOut},o.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var O=350;o.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},o.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},r.prototype.create=function(e,t,s,i,o,r){M.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=o,this.onNo=r,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(M.background,"introAtlas","title_bg",t.textures),this.bg.anchor.set(.5,1),this.bg.y=M.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(M.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new h(h.TYPE_BUTTON);l.create(this.panel,"introAtlas","play-button",this.managers,-.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var u=new a(this.managers.locale.get("quit_yes_button_string"),M.textStyleBoldButtons);u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new h(h.TYPE_BUTTON),l.create(this.panel,"introAtlas","play-button",this.managers,.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),u=new a(this.managers.locale.get("quit_no_button_string"),M.textStyleBoldButtons),u.create(l,0,0,!0),u.anchor.set(.5,.5),l.text=u,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l);var c=M.textStyleBold.clone();c.wordWrap=!0,c.wordWrapWidth=800,u=new a(this.managers.locale.get(s),c),u.create(this.panel,0,-.14,!0),u.anchor.set(.5,.5),this.texts.push(u)},r.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,M.resized=!0,M.resizeConsumed=!1,M.swipeEnabled=!0},r.prototype.update=function(){var e,t;if(this.bg.y=M.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(M.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(M.click=null,this.onNo.call(this.context),!1):!0},l.prototype.create=function(e,t){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],E.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(M.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new h(h.TYPE_BUTTON);s.create(this.panel,"introAtlas","play-button",this.managers,0,361,!1,"play-button","play-button-rollover","play-button-down","click_event"),s.anchor.set(.5,.5),this.buttons.push(s);var i;i=t?new a(this.managers.locale.get("help_play_string"),M.textStyleBoldButtonsLarge):new a(this.managers.locale.get("continue_button_string"),M.textStyleBoldButtonsLarge),i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menuAtlas","basic-gameplay-on",this.managers,-.432,-.4322,!0,"basic-gameplay-on","basic-gameplay-on","basic-gameplay-on","click_tab1_event",null,"basic-gameplay-off","basic-gameplay-off-rollover","basic-gameplay-off","click_tab1_event"),s.toggled=!0,this.buttons.push(s),this.tab1={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_TOGGLE),s.create(this.panel,"menuAtlas","max-your-score-button-off",this.managers,-.175,-.4322,!0,"max-your-score-button-on","max-your-score-button-on","max-your-score-button-on","click_tab2_event",null,"max-your-score-button-off","max-your-score-button-off-rollover","max-your-score-button-off","click_tab2_event"),s.toggled=!1,this.buttons.push(s),this.tab2={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",i=new a(this.managers.locale.get("help_page1_text_string"),M.textStyleMedium),i.create(this.panel,-.3,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i),i=new a(this.managers.locale.get("help_page2_text_string"),M.textStyleMedium),i.create(this.panel,-0,-.345,!0),i.anchor.set(.5,.5),this.texts.push(i);
var o=new u;o.create(this.panel,"menuAtlas","check-box",this.managers,208,-315,!1,"check-box","check-box-rollover","check-box","check_toggled_event",27,0),o.anchor.set(0,.5),o.sfx="snd_clickPlay",o.sfxHover="snd_rollOver",this.buttons.push(o),this.checkBox=o,o.setCheck(M.showHelp);var r=M.textStyleMediumTiny.clone();r.wordWrap=!0,r.wordWrapWidth=170,i=new a(this.managers.locale.get("help_show_help_string"),r),i.create(this.panel,264,-315,!1),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list=[];var c=M.textStyleMedium2.clone();c.wordWrap=!0,c.wordWrapWidth=600,i=new a(this.managers.locale.get("help_page1_text1_string"),c),i.create(this.panel,-.1,-.24,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i);var d=new n;d.create(this.panel,"menuAtlas","matching_rules",this.managers.textures,-.28,-.15,!0),d.anchor.set(.5,.5),d.scale.set(.6,.6),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"gameAtlas","time icon",this.managers.textures,.24,.02,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab1.list.push(d),i=new a("2:55",M.textStyleSemiBold),i.create(this.panel,.28,.02,!0),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list.push(i);var p=c.clone();p.wordWrapWidth=700,i=new a(this.managers.locale.get("help_page1_text2_string"),p),i.create(this.panel,-.4,-.02,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),d=new n,d.create(this.panel,"gameAtlas","arrow_lft",this.managers.textures,-.34,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),d=new n,d.create(this.panel,"gameAtlas","arrow_rgt",this.managers.textures,-.18,.2,!0),d.anchor.set(.5,.5),d.scale.set(.4,.4),this.sprites.push(d),this.tab1.list.push(d),i=new a(this.managers.locale.get("help_page1_text3_string"),c),i.create(this.panel,-.1,.14,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),this.tab2.list=[],d=new n,d.create(this.panel,"menuAtlas","x2_speedmatch",this.managers.textures,-.305,-.2,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text1_string"),p),i.create(this.panel,-.2,-.2-.04,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"menuAtlas","x5_multimatch",this.managers.textures,-.305,-.015,!0),d.anchor.set(.5,.5),d.scale.set(.75,.75),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text2_string"),p),i.create(this.panel,-.2,-0.055,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),d=new n,d.create(this.panel,"gameAtlas","reshuffle_button",this.managers.textures,-.305,.17,!0),d.anchor.set(.5,.5),d.scale.set(1.5,1.5),this.sprites.push(d),this.tab2.list.push(d),i=new a(this.managers.locale.get("help_page2_text4_string"),p),i.create(this.panel,-.2,.13,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i);var g=p.clone();g.wordWrapWidth=900,i=new a(this.managers.locale.get("help_page2_text5_string"),g),i.create(this.panel,0,.25,!0),i.anchor.set(.5,0),this.texts.push(i),this.tab2.list.push(i),this.showTab(1,!1),l.tweenIn.step=E.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(l.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},l.prototype.remove=function(e){this.removing||(this.removing=!0,M.debug&&console.log("Help.remove"),l.tweenOut.step=E.makeFunctionForSprite(this.panel),this.panel.tweener.tween(l.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},l.prototype.destroy=function(){var e;if(E.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.tab1=this.tab2=null,this.managers=null,M.resized=!0,M.resizeConsumed=!1},l.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return"click_event"==t||C.isPressed[32]?(M.resetInput(),!1):("check_toggled_event"==t&&(M.showHelp=this.checkBox.checked,this.managers.preloader.loadManager.saveGameStatus()),("click_tab1_event"==t&&!this.tab1.button.toggled||"click_tab2_event"==t&&!this.tab2.button.toggled)&&(this.tab2.button.toggled=this.tab1.button.toggled,this.tab1.button.toggled=!this.tab1.button.toggled,this.showTab(this.tab1.button.toggled?1:0,!1),this.showTab(this.tab1.button.toggled?0:1,!0)),!0)},l.prototype.showTab=function(e,t){var s=0===e?this.tab1.list:this.tab2.list;if(s)for(var i=0;i<s.length;i++)s[i].visible=t};var U=350;l.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:U,easing:"easeInQuad",step:null,finish:function(){}},l.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:U,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},h.TYPE_BUTTON=1,h.TYPE_CHECKBOX=2,h.TYPE_TOGGLE=3,h.TYPE_NOLATCH=4,h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.prototype.create=function(t,s,i,a,o,r,l,h,u,c,d,p,g,m,f,y,v){this.managers=a,n.prototype.create.call(this,t,s,i,this.managers.textures,o,r,l),this.upKey={on:h,off:g},this.overKey={on:u,off:m},this.downKey={on:c,off:f},this.downEvent={on:d,off:y},this.overEvent={on:p,off:v},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,e.registerCallback("mousedown",this.playSfx,{context:this})},h.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.managers=null,n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this._toggled=null,this.sfx=this.sfxHover=null},h.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return s=this.type==h.TYPE_BUTTON||this.type==h.TYPE_NOLATCH?this.downDetected&&null!==M.mouseDown&&i.contains(M.mouseDown.x,M.mouseDown.y)||null!==M.click&&i.contains(M.click.x,M.click.y):null!==M.click&&i.contains(M.click.x,M.click.y),s&&(this.setFrame(this.downKey[this._toggled]),M.mouseDown=M.click=null,e=this.downEvent[this._toggled],t=!0),this.type==h.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&M.hover&&i.contains(M.hover.x,M.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==h.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},h.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},Object.defineProperties(h.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),u.EVENT_CLICK="check_click",u.prototype=Object.create(h.prototype),u.prototype.constructor=u,u.prototype.create=function(e,t,s,i,a,o,r,l,c,d,p,g,m){this.tick=new n,this.tick.create(this,t,"check",i.textures,g,m,!1),this.tick.anchor.set(.5),this.checked=!0,this.toggleEvent=p,h.prototype.create.call(this,e,t,s,i,a,o,r,l,c,d,u.EVENT_CLICK),this.downDetected=!1},u.prototype.destroy=function(){h.prototype.destroy.call(this)},u.prototype.update=function(){var e=h.prototype.update.call(this);return e==u.EVENT_CLICK&&(this.setCheck(!this.checked),this.toggleEvent&&(e=this.toggleEvent)),e},u.prototype.setCheck=function(e){this.checked=e,this.tick.visible=e},c.prototype.create=function(e,t){M.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,E.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(M.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new a(this.managers.locale.get("options_header_string"),M.textStyleBold);s.create(this.panel,0,-.34,!0),s.anchor.set(.5,.5),this.texts.push(s);var i=new h(h.TYPE_BUTTON);i.create(this.panel,"menuAtlas","close",this.managers,.33,-.3,!0,"close","close_rollover","close-down","click_close_event"),i.anchor.set(.5,.5),i.scale.set(2),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i);var o=-.15,r=.16;if(!M.isAndroid||!M.isChromeMobile){o=.15,r=.16,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","sound",this.managers,-.22,o-.35+0*r,!0,"sound","sound_rollover","sound-down","click_sound_event",null,"sound-no","sound-no_rollover","sound-no-down","click_sound_event_mute",null),i.anchor.set(0,.5),i.toggled=!this.managers.audio.mute,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.soundBtn=i;var l=new n;l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,o-.35+0*r,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[0]=l,l=new n,l.create(this.sliderBar[0],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),this.sprites.push(l),l.setx=this.sliderBar[0].width*w.sfxVolume,this.sliderTab[0]=l,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","music",this.managers,-.22,o-.35+1*r,!0,"music","music_rollover","music-down","click_music_event",null,"music-no","music-no_rollover","music-no-down","click_music_event_mute"),i.anchor.set(0,.5),i.toggled=!this.managers.audio.tunesMuted,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.musicBtn=i,l=new n,l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,o-.35+1*r,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[1]=l,l=new n,l.create(this.sliderBar[1],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),l.setx=this.sliderBar[1].width*w.musicVolume,this.sprites.push(l),this.sliderTab[1]=l}i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","help",this.managers,-.22,o-.35+2*r,!0,"help","help_rollover","help-down","click_help_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("help_header_string"),M.textStyleLarge),s.create(this.panel,-.1,o-.35+2*r,!0),s.anchor.set(0,.5),this.texts.push(s),i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","quit",this.managers,-.22,o-.35+3*r,!0,"quit","quit_rollover","quit-down","click_quit_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("options_quit_string"),M.textStyleLarge),s.create(this.panel,-.1,o-.35+3*r,!0),s.anchor.set(0,.5),this.texts.push(s),c.tweenIn.step=E.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(c.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},c.prototype.remove=function(e){this.removing||(this.removing=!0,M.debug&&console.log("Options.remove"),c.tweenOut.step=E.makeFunctionForSprite(this.panel),this.panel.tweener.tween(c.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},c.prototype.destroy=function(){var e;if(E.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,M.resized=!0,M.resizeConsumed=!1,M.swipeEnabled=!0,M.idleTimer=M.eventChangeAdOnIdle},c.prototype.update=function(){var e,t;if(this.doneIn&&M.eventChangeAdOnOptions&&!this.adShown&&(M.arenaHelper.sendEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(null!==M.mouseDown){var i=M.hover;for(null===i&&(i=M.mouseDown),e=0;e<this.sliderBar.length;e++)this.sliderBar[e].getGlobalScale(!0),this.sliderBar[e].bounds=this.sliderBar[e].getBounds(!1),this.sliderBar[e].bounds.contains(i.x,i.y)&&(this.sliderTab[e].pcntx=E.clamp((i.x-this.sliderBar[e].bounds.left)/this.sliderBar[e].globalScale.x/this.sliderBar[e].width,0,1),0===e?(w.sfxVolume=this.sliderTab[e].percentx,this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1))):(this.managers.audio.setMusicVolume(this.sliderTab[e].percentx),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1))),this.managers.preloader.loadManager.saveGameStatus())}if(this.buttons)for(e=0;e<this.buttons.length;e++){var n=this.buttons[e];if(t=n.update(),null!==t)break}switch(null===t&&C.isPressed[L.space_bar]&&(t="click_close_event"),t){case"click_close_event":return M.click=null,C.reset(L.space_bar),M.playMidRollAdAfterPause&&M.arenaHelper.requestMidroll(),!1;case"click_help_event":this.game.showHelp(!1);break;case"click_quit_event":this.game.showConfirm("quit_header_string",this,this.onYesQuit,this.onNoQuit);break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1));break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1));break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1));break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0,_gameGATracker("send","event",M.VERSION,"sound","MJD_HTML5",1))}return!0},c.prototype.onYesQuit=function(){this.destroy(),I.requestQuit=!0,I.options=null},c.prototype.onNoQuit=function(){};var O=350;c.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},c.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},d.prototype.create=function(e,t){this.managers=e,this.puzzle=t,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.chain=1,this.multiMatch=0,this.selectedPiece=null,this.spriteList=[],this.thinkingTimer=0},d.prototype.destroy=function(){if(this.removeHoverPiece(),this._removeSelectedPiece(),this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.spriteList){for(var e=0,t=this.spriteList.length;t>e;e++)this.spriteList[e].destroy();this.spriteList=null}},d.prototype.update=function(){if(this.thinkingTimer+=M.elapsedTime,this.spriteList&&this.spriteList.length>0){for(var e=this.spriteList.length-1;e>=0;--e){var t=this.spriteList[e];t instanceof n?(t.alpha-=.02,t.alpha<=0?(t.destroy(),this.spriteList.splice(e,1)):t.update()):t instanceof PIXI.Container&&(t.y-=4,0===t.children.length&&(t.destroy(),this.spriteList.splice(e,1)))}return this.spriteList.length>0}return!1},d.prototype.clickedPiece=function(e){if(this.puzzle.tornadoRemove)return!1;if(this.puzzle.tileOpen(e)){if(this.selectedPiece){if(e!=this.selectedPiece)if(this.managers.audio.play("snd_clickTile"),e.symbol==this.selectedPiece.symbol){this._matchedPieces(e);var t=this._chainBonusScoring(e);this._multiBonusScoring(e);var s=0;t&&(s+=this.puzzle.speedMatchValue*this.chain),I.score+=(0|e.value)+s+this.puzzle.multiMatchValue*this.multiMatch,M.debug&&console.log("chain =",this.chain,"value =",e.value,"speedMatchValue =",this.puzzle.speedMatchValue,"score =",I.score);var i=16;this.managers.audio.play(this.chain<=i?["snd_match"+Math.min(this.chain,i).toString()]:["snd_correct1","snd_correct2"]),this.lastMatchTime=M.time,this.lastMatchType=e.symbol}else this._deselectPiece(this.selectedPiece),this._selectPiece(e)}else this.managers.audio.play("snd_clickTile"),this._selectPiece(e);return!0}return e&&e.wobble(),this.managers.audio.playDelayed(["snd_error1","snd_error2","snd_error3"],.1,this.cancelIfSwipe,this),!1},d.prototype.createHoveredPiece=function(e){this.hoveredPiece={sprite:e,fallSpeed:0}},d.prototype.createDroppedPiece=function(e){this.dropPiece={sprite:e,fallSpeed:0}},d.prototype.showDropAndHoverPieces=function(){if(this.dropPiece){var e=this.dropPiece.sprite.y;this.dropPiece.sprite.y=z.SelectionPreviewY,z.SelectionPreviewBotY=this.dropPiece.sprite.y+this.dropPiece.sprite.height,this.dropPiece.sprite.y=e,M.isPortrait?(this.dropPiece.sprite.y=z.SelectionPreviewBotY,this.dropPiece.fallSpeed=0):(this.dropPiece.sprite.y+=this.dropPiece.fallSpeed,this.dropPiece.fallSpeed++,this.dropPiece.sprite.y>z.SelectionPreviewBotY&&(this.dropPiece.sprite.y=z.SelectionPreviewBotY,this.dropPiece.fallSpeed=0)),this.dropPiece.sprite.update()}this.hoveredPiece&&(this.hoveredPiece.sprite.y=z.SelectionPreviewY,this.hoveredPiece.sprite.update())},d.prototype.cancelIfSwipe=function(e){return e&&null!==M.mouseDown?!0:M.swipeEnabled&&0!==M.swipe?!0:!1},d.prototype._selectPiece=function(e){this.selectedPiece=e,this.selectedPiece.addFilter(z.brighter),this.dropPiece&&(this.dropPiece.sprite.destroy(),this.dropPiece=null);var t=new n;t.create(M.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=T.scale/M.tileAssetScale,this.createDroppedPiece(t),this.removeHoverPiece()},d.prototype._deselectPiece=function(e){e&&e.removeFilter(z.brighter),this._removeSelectedPiece()},d.prototype._removeSelectedPiece=function(){this.dropPiece&&(this.dropPiece.sprite&&this.dropPiece.sprite.destroy(),this.dropPiece=null)},d.prototype._matchedPieces=function(e){M.debug&&console.log("Matched symbol",e.symbol),this.puzzle.fadeTile(this.selectedPiece,this.puzzle.removeTile),this._selectPiece(e),this.puzzle.fadeTile(e,this.puzzle.removeTile),this._removeSelectedPiece(),this.removeHoverPiece(),this.selectedPiece=null,I.levelMatches++,this.thinkingTimer>1e4&&_gameGATracker("send","event",M.VERSION,"hard_thinking","MJD_HTML5",Math.round(this.thinkingTimer/1e3)),this.thinkingTimer=0},d.prototype.showHoveredPiece=function(e){if(e)if(this.selectedPiece&&this.selectedPiece==e)this.lastHovered&&(this.lastHovered.removeFilter(z.brighter2),this.lastHovered=null);else if(this.lastHovered&&this.lastHovered!==e&&(this.lastHovered.removeFilter(z.brighter2),this.lastHovered=null),e.addFilter(z.brighter2),this.lastHovered=e,!this.hoveredPiece||!this.hoveredPiece.piece||this.hoveredPiece.piece.symbol!=e.symbol){this.hoveredPiece&&this.removeHoverPiece();var t=new n;t.create(M.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=T.scale/M.tileAssetScale,this.hoveredPiece={piece:e,sprite:t,fallSpeed:0}}},d.prototype.removeHoverPiece=function(){if(this.lastHovered&&(this.lastHovered.removeFilter(z.brighter2),this.lastHovered=null),this.hoveredPiece){if(this.sprites){var e=this.hoveredPiece.sprite;this.sprites.push(e),this.hoveredPiece.sprite.addFader(-.1,1,this.destroySprite,this,e,0)}else this.hoveredPiece.sprite.destroy();this.hoveredPiece=null}},d.prototype._chainBonusScoring=function(e){var t=!1;if(-1!==this.lastMatchTime&&M.time<=this.lastMatchTime+1e3*this.puzzle.speedMatchTime){this.chain++,t=!0;var s,i=this.chain.toString(),a="noglowtext/SM"+i[0];i.length>1&&(s="noglowtext/SM"+i[1]);var o=new PIXI.Container;e.parent.addChild(o),o.x=e.x,o.y=e.y,o.tz=-1e3,M.lowResolutionAssets&&o.scale.set(.5),this.spriteList&&this.spriteList.push(o);var r=new n;r.create(o,"gameAtlas","noglowtext/speedmatch",this.managers.textures,0,0,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),r=new n,r.create(o,"gameAtlas",a,this.managers.textures,29.5,-15.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),s&&(r=new n,r.create(o,"gameAtlas",s,this.managers.textures,77.5,-15.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r)),e.parent.reSort()}else this.chain=1;return t},d.prototype._multiBonusScoring=function(e){if(e.symbol==this.lastMatchType){this.multiMatch+=0===this.multiMatch?2:1;var t,s=this.multiMatch.toString(),i="noglowtext/MM"+s[0];s.length>1&&(t="noglowtext/MM"+s[1]);var a=new PIXI.Container;e.parent.addChild(a),a.x=e.x,a.y=e.y,a.tz=-1e3,M.lowResolutionAssets&&a.scale.set(.5),this.spriteList&&this.spriteList.push(a);var o=new n;o.create(a,"gameAtlas","noglowtext/multimatch",this.managers.textures,0,150,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),o=new n,o.create(a,"gameAtlas",i,this.managers.textures,30.5,140.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),t&&(o=new n,o.create(a,"gameAtlas",t,this.managers.textures,78.5,140.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o)),e.parent.reSort()}else this.multiMatch=0},p.prototype.create=function(e){this.managers=e},p.prototype.destroy=function(){this.managers=null},p.prototype.loadGameStatus=function(){M.debug&&console.log("loadGameStatus");var e=localStorage.MahjonggDimensions_status;if(e){var t=JSON.parse(e);return M.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute,"show help =",t.showHelp),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),w.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),M.showHelp=t.showHelp,!0}return M.debug&&console.log("Game data is not available in localStorage."),!1},p.prototype.saveGameStatus=function(){M.debug&&console.log("saveGameStatus");var e={sfxVolume:w.sfxVolume,musicVolume:w.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted,showHelp:M.showHelp},t=JSON.stringify(e);return localStorage.MahjonggDimensions_status=t,!0},g.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},g.prototype.get=function(e){if(!this.dataManager)return M.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=E.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(M.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},g.prototype.onLocaleChanged=function(){M.countryCode=M.arenaHelper.getLocale();for(var e=[{value:"en",localization:"en-US",name:"English"},{value:"de",localization:"de-DE",name:"Deutsch"},{value:"es",localization:"es-ES",name:"Espaol"},{value:"fr",localization:"fr-FR",name:"Franais"},{value:"it",localization:"it-IT",name:"Italiano"}],t=0;t<e.length;t++)if(e[t].value===M.countryCode){M.countryCode=e[t].localization;break}var s=this.dataManager.get("localizations");M.debug&&console.log("available languages: ",s),s&&s.availableLocales&&-1==E.indexOfStringNoCase(s.availableLocales,M.countryCode)&&(M.debug&&console.log("language is not available: ",M.countryCode),M.countryCode="en-US"),M.debug&&console.log("language code = ",M.countryCode),this.dataManager.loadData("strings",M.arenaHelper.getAbsoluteURL("")+"data/locale/"+M.countryCode+"/strings.json"),this.strings=null},m.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];m.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(M.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else M.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(M.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),M.debug&&console.log("All fonts loaded or failed."),!0)},m.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var n=i.offsetWidth;return i.parentNode.removeChild(i),n},f.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},f.prototype.setFade=function(e,t,s,i,n,a){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=n,null!==a&&(this.trigger=a,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))},f.prototype.reached=function(e){return this.fadeValue==e},f.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,M.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,M.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},y.REMOVE_TILE=1,y.PRELOADER=2,y.definitions=[{},{first:1,last:30,baseKey:"match/matchEffect",endKey:"",numPrecedingZeroes:4,scale:2.2},{first:0,last:67,baseKey:"frame_",endKey:"_delay-0.03s",numPrecedingZeroes:0,scale:1,repeat:!0}],y.prototype.create=function(e){this.textureManager=e,this.list=[]},y.prototype.destroy=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=null},y.prototype.add=function(e,t,s,i,a){var o=new n,r=y.definitions[e];o.create(t.parent,s,this.getKeyName(e,r.first),this.textureManager,t.x+i,t.y+a,!1),t.parent.setChildIndex(o,t.parent.getChildIndex(t)),o.anchor.set(t.anchor.x,t.anchor.y),o.scale.set(r.scale,r.scale),o.fxType=e,o.fxFrameNumber=r.first,o.repeat=r.repeat===!0?!0:!1,o.tz=t.tz,M.lowResolutionAssets&&e!=y.PRELOADER&&o.scale.set(.5*o.scale.x,.5*o.scale.y),this.list.push(o)},y.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(t.fxFrameNumber>y.definitions[t.fxType].last){if(!t.repeat){t.destroy(),this.list.splice(e,1);continue}t.fxFrameNumber=0}var s=this.getKeyName(t.fxType,Math.floor(t.fxFrameNumber));t.setFrame(s),t.update(),t.fxFrameNumber+=.06*M.elapsedTime}return this.list.length},y.prototype.getKeyName=function(e,t){var s=y.definitions[e];return s.numPrecedingZeroes>0?s.baseKey+E.padToLength(t.toString(),s.numPrecedingZeroes,"0",!1)+s.endKey:s.baseKey+t.toString()+s.endKey},v.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},v.prototype.destroy=function(){this.pending=0,this.loader=null},v.prototype.addImage=function(e,t){this.loader.add(e,t),M.debug&&console.log("Textures.addImage ",e,t),this.pending++},v.prototype.startLoading=function(e,t){var s=this;M.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,M.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():M.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},v.prototype.loadImage=function(e,t,s,i){M.debug&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){M.debug&&console.log("Texture loaded!"),s.call(i)}).load()},v.prototype.get=function(e,t,s){if(e){var i=PIXI.loader.resources[e];if(!i)return null;if(i.textures[t])return i.textures[t]}if(s)return null;M.debug&&console.log("texture created from canvas",e,t);var n=PIXI.loader.resources[t];if(!n)return null;var a=PIXI.Texture.fromCanvas(PIXI.loader.resources[t]);return PIXI.loader.resources[t].texture=a,a},v.prototype.set=function(e,t){M.debug&&PIXI.loader.resources[e]&&PIXI.loader.resources[e]!=t&&console.log("WARNING: Textures.set is overwriting image in cache",e),PIXI.loader.resources[e]=t,M.debug&&console.log("image added to cache",e,t.width,"x",t.height)},b.createTweens=function(e,t,s,i,o,r){isNaN(i)&&(i=0),isNaN(o)&&(o=0);for(var l=[],u=[],c=0;c<e.length;c++){var d=e[c];if(d.button){var p=new h(h.TYPE_BUTTON);if(p.create(t,d.atlas,d.key,s,d.x+i,d.y+o,!1,d.key,d.button.over,d.button.down,d.button.clickEvent),p.anchor.x=p.anchor.y=.5,void 0!==d.visible&&(p.visible=d.visible),p.sfx=d.button.sfx,p.sfxHover=d.button.sfxHover,void 0!==d.button.text){var g=new a(s.locale.get(d.button.text),r||M.textStyleBoldButtons);g.create(p,0,0,!0),g.anchor.set(.5,.5),p.text=g}void 0!==d.fade&&p.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=E.makeFunctionForSprite(p),p.tweener=new Tweenable,p.tweener.tween(d.tween),p.tweener.owner=p),u.push(p)}else{var m=new n;m.create(t,d.atlas,d.key,s.textures,d.x+i,d.y+o,!1),m.anchor.x=m.anchor.y=.5,void 0!==d.visible&&(m.visible=d.visible),void 0!==d.fade&&m.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=E.makeFunctionForSprite(m),m.tweener=new Tweenable,m.tweener.tween(d.tween),m.tweener.owner=m),l.push(m)}}return{sprites:l,buttons:u}},_.prototype.create=function(){this.list=[]},_.prototype.destroy=function(){this.list=null},_.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];M.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var n=this,a=new XMLHttpRequest;return a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&(i.isReady=!0,i.data=JSON.parse(a.responseText),s&&s(),n.pending--)},a.send(null),this.pending++,i.src=t,i},_.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(M.debug&&console.log("DataManager.get(): data not in cache",e),null)},_.prototype.set=function(e,t){if(this.list[e])return void(M.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return M.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,M.debug&&console.log("DataManager.set(): data added to cache",e)},w.sfxVolume=.75,w.musicVolume=1,w.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.mute=!1,this.tunesMuted=!1,w.sfxVolume=.75,w.musicVolume=.5},w.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null},w.prototype.loadAudio=function(e,t,s){for(var i=[],n=0,a=s.length;a>n;n++)i.push(t+"."+s[n]);this.pending++,M.debug&&console.log("AudioManager.loadAudio ",e,t);var o=this;this.list[e]=new Howl({src:i,onload:function(){o.pending--}})},w.prototype.play=function(e){if(this.mute||M.isAndroid&&M.isChromeMobile)return null;if(Array.isArray(e)){var t=E.randomFromList(e);return this._playOne(t)}return this._playOne(e)
},w.prototype._playOne=function(e){if(M.isAndroid&&M.isChromeMobile)return null;if(e&&this.list&&this.list[e]&&M.muteUntil<=M.time){var t=this.list[e];if("loaded"!=t._state)return M.debug&&console.log("AudioManager.playOne",e,"SFX not loaded!"),null;t.volume(w.sfxVolume);var s=t.play();return M.debug&&(console.log("AudioManager.playOne",e,"=",s),s||console.log("SFX not playable!")),t}return null},w.prototype.playDelayed=function(e,t,s,i){return M.isAndroid&&M.isChromeMobile?null:(Array.isArray(e)&&(e=E.randomFromList(e)),void(e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:M.time+1e3*t,cancelCallback:s,context:i})))},w.prototype.update=function(){if(!M.isAndroid||!M.isChromeMobile)for(var e=M.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];if(s&&s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time))this.delayed.splice(t,1);else if(e>s.time){var i=this.list[s.key];i.play(),this.delayed.splice(t,1)}}},w.prototype.visibilityMute=function(e){M.isAndroid&&M.isChromeMobile||(M.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0))},w.prototype.setMute=function(e,t){if(!M.isAndroid||!M.isChromeMobile){M.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()}},w.prototype.muteTunes=function(e,t){M.isAndroid&&M.isChromeMobile||(M.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus())},w.prototype.startTune=function(e,t){M.isAndroid&&M.isChromeMobile||(this.gameTune&&this.stopTune(),this.list[e].loop(!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(w.musicVolume*M.volumeControl),void 0!==t?this.muteTunes(t,!0):this.muteTunes(this.tunesMuted,!0))},w.prototype.stopTune=function(){M.isAndroid&&M.isChromeMobile||this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},w.prototype.setMusicVolume=function(e){M.isAndroid&&M.isChromeMobile||(w.musicVolume=e,this.gameTune&&this.gameTune.volume(w.musicVolume*M.volumeControl))},w.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0},x.prototype.addPauseAndResumeActions=function(e,t){this._arenaXapi?(this._arenaXapi.addAction("GAME_PAUSE",e),this._arenaXapi.addAction("GAME_RESUME",t)):(window.ARK_game_arena_connector.registerAction("pause",e),window.ARK_game_arena_connector.registerAction("resume",t))},x.prototype.requestMidroll=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"PAUSE_READY",payload:null}):window.ARK_game_arena_connector.fireEventToArena("pause_ready")},x.prototype.handleMidrollStart=function(){},x.prototype.handleMidrollFinish=function(){},x.prototype.sendEventChange=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"EVENT_CHANGE",payload:null}):window.ARK_game_arena_connector.fireEventToArena("event_change")},x.prototype.sendGameStart=function(){this._arenaXapi?this._arenaXapi.dispatch({type:"GAME_START",payload:null}):window.ARK_game_arena_connector.fireEventToArena("game_start")},x.prototype.sendGameEnd=function(e){this._arenaXapi?(this._arenaXapi.dispatch({type:"CHANGE_SCORE",payload:e}),this._arenaXapi.dispatch({type:"GAME_END",payload:null})):(window.ARK_game_arena_connector.changeScore(e),window.ARK_game_arena_connector.fireEventToArena("game_end"))},x.prototype.shouldShowGameEnd=function(){return this._arenaXapi?!0:"true"==window.ARK_game_arena_connector.showGameEnd()},x.prototype.getAbsoluteURL=function(e){return this._arenaXapi?[this._arenaXapi.assetOriginUrl,e].join(""):e},x.prototype.getLocale=function(){return this._arenaXapi?this._arenaXapi.locale:window.ARK_game_arena_connector.getParam("locale","en-US")},x.prototype.destroy=function(){this._arenaXapi&&(this._arenaXapi.removeAction("GAME_PAUSE"),this._arenaXapi.removeAction("GAME_RESUME"))},k.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new v,this.textureManager.create(),this.dataManager=new _,this.dataManager.create(),this.localeManager=new g,this.audioManager=new w,this.loadManager=new p,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers()),this.textureManager.addImage("introAtlas",this.baseUrl+"images/_reduced/high/introAtlas.json"),this.textureManager.startLoading(this.preloaderReady,this)},k.prototype.preloaderReady=function(){var e=this;this.bg=new n,this.bg.create(M.background,"introAtlas","title_bg",this.textureManager),this.bg.anchor.set(.5,1),this.bg.y=M.height/2/this.bg.parent.scale.y,this.effects=new y,this.effects.create(this.textureManager),this.effects.add(y.PRELOADER,M.fullUI,"introAtlas",0,0);var t=this.lowResolution?"images/_reduced/low/":"images/_reduced/high/";this.textureManager.addImage("gameAtlas",this.baseUrl+t+"gameAtlas.json"),this.textureManager.addImage("menuAtlas",this.baseUrl+t+"menuAtlas.json"),this.textureManager.startLoading(),this.loadAudioAssets(),this.dataManager.loadData("level1",this.baseUrl+"data/mahjongg_leveldata_0.txt"),this.dataManager.loadData("level2",this.baseUrl+"data/mahjongg_leveldata_1.txt"),this.dataManager.loadData("level3",this.baseUrl+"data/mahjongg_leveldata_2.txt"),this.dataManager.loadData("symbol_offsets",this.baseUrl+"data/symbol_offsets.json"),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){M.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)}),this.levels=3},k.prototype.loadAudioAssets=function(){this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/music_loop",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickPlay",this.baseUrl+"sounds/play_button_press",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rollOver",this.baseUrl+"sounds/menu_rollover_generic",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickTile",this.baseUrl+"sounds/click_tile",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct1",this.baseUrl+"sounds/correct_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct2",this.baseUrl+"sounds/correct_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match1",this.baseUrl+"sounds/tilematch1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match2",this.baseUrl+"sounds/tilematch2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match3",this.baseUrl+"sounds/tilematch3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match4",this.baseUrl+"sounds/tilematch4",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match5",this.baseUrl+"sounds/tilematch5",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match6",this.baseUrl+"sounds/tilematch6",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match7",this.baseUrl+"sounds/tilematch7",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match8",this.baseUrl+"sounds/tilematch8",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match9",this.baseUrl+"sounds/tilematch9",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match10",this.baseUrl+"sounds/tilematch10",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match11",this.baseUrl+"sounds/tilematch11",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match12",this.baseUrl+"sounds/tilematch12",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match13",this.baseUrl+"sounds/tilematch13",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match14",this.baseUrl+"sounds/tilematch14",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match15",this.baseUrl+"sounds/tilematch15",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match16",this.baseUrl+"sounds/tilematch16",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error1",this.baseUrl+"sounds/error_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error2",this.baseUrl+"sounds/error_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error3",this.baseUrl+"sounds/error_sound_3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rotate",this.baseUrl+"sounds/rotate",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_startSting",this.baseUrl+"sounds/game_opening_sting",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_endSting",this.baseUrl+"sounds/level_end",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle1",this.baseUrl+"sounds/reshuffle_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle2",this.baseUrl+"sounds/reshuffle_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timerWarning",this.baseUrl+"sounds/timer_warning",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timeUp",this.baseUrl+"sounds/out_of_time_sting",["mp3","mp4","ogg"])},k.prototype.cleanUp=function(){this.root=null,this.effects&&(this.effects.destroy(),this.effects=null),this.bg&&(this.bg.destroy(),this.bg=null)},k.prototype.update=function(){this.effects&&this.effects.update()},k.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.cleanUp(),!0):!1},k.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},T.prototype=Object.create(n.prototype),T.prototype.constructor=T,T.scale=.75,T.pieceSizePixels=188,T.prototype.destroy=function(){this.name=null,this.managers=null,this.symbol=null,n.prototype.destroy.call(this)},T.prototype.update=function(e){if(e&&(this.wobbleCount=0),this.wobbleCount>0)if(this.wobbleCount--,0===this.wobbleCount)this.x=this.startX,this.y=this.startY;else{var t=this.wobbleCount>10?4:2;this.x=this.startX+Math.random()*t-t/2,this.y=this.startY+Math.random()*t-t/2}n.prototype.update.call(this)},T.prototype.clone=function(){var e=new T(this.parent,this.managers,this.cx,this.cy,this.cz,this.symbol,this.value);return e.name=this.name,e.create(this.parent,null,e.name,e.managers.textures),e.setPickerData(e.managers.data.get("maskData_1")),e.anchor.set(this.anchor.x,this.anchor.y),e.scale.set(this.scale.x,this.scale.y),e.sizex=this.sizex,e.sizey=this.sizey,e.scalez=this.scalez,e.rotate3d(this.angle),e},T.prototype.copyLocation=function(e){e.cx=this.cx,e.cy=this.cy,e.cz=this.cz,e.rotate3d(e.angle)},T.prototype.setPicture=function(e){this.setFrame("cube_"+this.symbol+"_"+e.toString()),this.setPickerData(this.managers.data.get("maskData_"+e.toString()))},T.prototype.rotate3d=function(e){void 0!==e&&(this.angle=e);var t=Math.round(180*this.angle/Math.PI),s=t-t%10+5;e=s*Math.PI/180;var i=Math.sin(e),n=Math.cos(e);this.tx=this.cx*n-this.cz*i,this.tz=this.cx*i+this.cz*n,this.x=this.tx*this.sizex,this.y=(this.cy+M.puzzleOffsetY-this.tz*this.scalez)*this.sizey,this.tz+=.001*this.y,this.setPicture(Math.round(180*e/Math.PI/10+5)%9+1)},T.prototype.picked=function(e,t){return this.pixelPicker(e,t)>0},T.prototype.wobble=function(){0===this.wobbleCount&&(this.startX=this.x,this.startY=this.y,this.wobbleCount=20)},S.prototype=Object.create(PIXI.Container.prototype),S.prototype.constructor=S,S.maxTilesHigh=6,S.maxHalfTilesWide=12,S.prototype.create=function(t,s,i,n){this.world=t,this.managers=s,this.tileDescriptions=i.ignoreMeContainer.levels.level.TileImages.tile,this.parent=M.puzzle,this.x=0,this.y=0,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.second=!1,this.createTiles(this.tileDescriptions,this.cacheSpriteList),this.removeTiles=[],this.tiles=[];var a=parseFloat(i.ignoreMeContainer.levels.level.nScale);M.pieceScale=a;var o=parseFloat(i.ignoreMeContainer.levels.level.yOff);M.puzzleOffsetY=o,e.resizeCanvas(),this.puzzleLayout=i.ignoreMeContainer.levels.level.TileStructure,this.resetPuzzle("1","-"),this.multiMatchValue=n.ignoreMeContainer.config.nMultiMatchValue.__text||0,this.speedMatchValue=n.ignoreMeContainer.config.nSpeedMatchValue.__text||0,this.speedMatchTime=n.ignoreMeContainer.config.nSpeedMatchTime.__text||0,this.levelBonusValues=JSON.parse("["+n.ignoreMeContainer.config.aLevelCompleteBonuses.__text+"]");for(var r,l,h=0,u=0;;){if(0===u){if(h>=this.tileDescriptions.length)break;u=this.tileDescriptions[h]._num||0,r=this.tileDescriptions[h]._name,l=this.tileDescriptions[h]._value,h++}this.addTileToPuzzle(r,l,this.puzzleLayout,"1","-"),u--}M.puzzle.addChild(this),M.forceResize=!0},S.prototype.destroy=function(){var e;if(PIXI.Container.prototype.destroy.call(this),this.levelBonusValues=null,this.tileDescriptions=null,this.world=null,this.tiles){for(e=0;e<this.tiles.length;e++)this.tiles[e].destroy({texture:!0,baseTexture:!0});this.tiles=null}if(this.managers=null,this.puzzleLayout=null,this.cacheSpriteList){for(e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}},S.prototype.update=function(){var e;if(this.cacheSpriteList&&this.cacheSpriteList.length>0&&this.second){for(M.debug&&console.log("Puzzle.prototype destroying cacheSpriteList items",this.cacheSpriteList.length),e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}this.second=!0,this.removePendingTiles();var t=!1;for(this.angle!=this.targetAngle&&(this.angle=E.rotateTo(this.angle,this.targetAngle,S.turnSpeed*M.elapsedTime*.06),this.rotate(this.angle),t=!0),e=this.tiles.length-1;e>=0;--e)this.tiles[e].update(t);return this.tornadoRemove&&this.tornado(),this.angle!=this.targetAngle||this.tornadoRemove?!0:!this.puzzleLocked()},S.prototype.setTargetAngle=function(e,t){this.targetAngle=E.normaliseAngle(e),t&&(this.angle=this.targetAngle,this.rotate(this.angle))},S.prototype.adjustTargetAngle=function(e){return this.angle==this.targetAngle?(this.targetAngle=E.normaliseAngle(this.targetAngle+e),!0):!1},S.prototype.isTurning=function(){return this.angle!=this.targetAngle},S.prototype.rotate=function(e){for(var t=E.normaliseAnglePositive(e),s=this.tiles.length-1;s>=0;--s)this.tiles[s].rotate3d(t);this.reSort()},S.prototype.reSort=function(){this.children.sort(function(e,t){return e.tz=e.tz||0,t.tz=t.tz||0,t.tz-e.tz})},S.prototype.createTiles=function(e,t){for(var s=[],i=1;9>=i;i++){var a=new n,o="tile_"+E.padToLength(i.toString(),5,"0",!1);a.create(this,"gameAtlas",o,this.managers.textures),s.push(a);var r=a.getPixels();this.managers.data.set("maskData_"+i.toString(),r)}for(var l=this.managers.data.get("symbol_offsets"),h=0;h<e.length;h++){var u=new n,c=e[h]._name.replace("s","");u.create(this,"gameAtlas",c,this.managers.textures);for(var d=0;d<s.length;d++){var p="cube_"+e[h]._name+"_"+(d+1).toString();if(!this.managers.textures.get(null,p,!1)){var g=u.createCanvasFromTexture(),m=u.createCanvasFromTexture(),f=s[d].createCanvasFromTexture(),y=f.width/2,v=f.height/2,b=f.getContext("2d");b.save(),b.scale(.5*l.scalex[0][d],.5),b.transform(1,l.skewy[0][d],0,1,0,0),b.drawImage(g,y+l.offx[0][d]*M.tileAssetScale-g.width/2,v+l.offy[0][d]*M.tileAssetScale-g.height/2),b.restore(),b.save(),b.scale(.5*l.scalex[1][d],.5),b.transform(1,l.skewy[1][d],0,1,0,0),b.drawImage(m,y+l.offx[1][d]*M.tileAssetScale-m.width/2,v+l.offy[1][d]*M.tileAssetScale-m.height/2),b.restore(),this.managers.textures.set(p,f)}var _=new n;_.create(M.puzzle,null,p,this.managers.textures,0,0,!0),t.push(_)}u.destroy()}for(i=0;i<s.length;i++)s[i].destroy()},S.prototype.tilePicker=function(e,t){for(var s=[],i=null,n=null,a=this.tiles.length-1;a>=0;--a)n=this.tiles[a],!n.fader&&n.picked(e,t)&&s.push(n);if(s.length>0){for(a=s.length-1;a>=0;--a)n=s[a],(!i||i.tz>n.tz)&&(i=n);return i}return null},S.prototype.tileOpen=function(e){var t=e.cx,s=e.cy,i=e.cz;return this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i-1)||this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i-1)},S.prototype.spaceOpen=function(e,t,s){for(var i=this.tiles.length-1;i>=0;--i){var n=this.tiles[i];if(!n.fader&&n.cx==e&&n.cy==t&&n.cz==s)return!1}return!0},S.prototype.removeTile=function(e){this.removeTiles||(this.removeTiles=[]),this.removeTiles.push(e)},S.prototype.removePendingTiles=function(){if(this.removeTiles&&0!==this.removeTiles.length){for(var e=this.removeTiles.length-1;e>=0;--e){var t=this.removeTiles[e];if(!(t.children.length>0)){var s=this.tiles.indexOf(t);-1!=s&&(t.destroy(),this.tiles.splice(s,1)),this.removeTiles.splice(e,1)}}M.eventChangeAdOnMatch&&M.arenaHelper.sendEventChange(),this.reSort()}},S.prototype.fadeTile=function(e,t){I.effects.add(y.REMOVE_TILE,e,"gameAtlas",0,0),e.addFader(-0.1,1,t,this,e,-.5),this.reSort()},S.prototype.resetPuzzle=function(e,t){for(var s=this.puzzleLayout.layer,i=0;i<s.length;i++)for(var n=s[i].row,a=0;a<n.length;a++)for(var o=n[a],r=0;r<o.length;r++)o.charAt(r)==t&&(o=this.puzzleLayout.layer[i].row[a]=E.replaceAt(o,r,e))},S.prototype.addTileToPuzzle=function(e,t,s,i,n){var a,o,r;do a=Math.floor(Math.random()*s._x),o=Math.floor(Math.random()*s._z),r=Math.floor(Math.random()*s._y);while(s.layer[o].row[r].charAt(a)!==i);this.tiles.push(new T(this,this.managers,a-(s._x-1)/2,-(s._z-1-o),r-(s._y-1)/2,e,t)),s.layer[o].row[r]=E.replaceAt(s.layer[o].row[r],a,n)},S.prototype.matchingPair=function(e,t){for(var s=t.length-1;s>=0;--s)if(t[s].symbol==e.symbol)return!0;return!1},S.prototype.puzzleLocked=function(){for(var e=[],t=this.tiles.length;--t>=0;){var s=this.tiles[t];if(this.tileOpen(s)){if(this.matchingPair(s,e))return!1;e.push(s)}}return!0},S.prototype.finished=function(e){if(!this.tiles||0===this.tiles.length)return!0;if(e){for(var t=this.tiles.length-1;t>=0;--t)if(!this.tiles[t].fader)return!1;return!0}return!1},S.prototype.reshuffle=function(){for(var e=1e3,t=this.tiles.length;e-->0;){var s=Math.floor(Math.random()*t),i=Math.floor(Math.random()*t);if(s!=i){var n=this.tiles[s].clone();this.tiles[i].copyLocation(n),this.tiles[s].copyLocation(this.tiles[i]),this.tiles[s].destroy(),this.tiles[s]=this.tiles[i].clone(),this.tiles[i].destroy(),this.tiles[i]=n}}M.debug&&console.log("Puzzle pieces reshuffled"),this.setTargetAngle(this.targetAngle,!0)},S.prototype.highestTile=function(){for(var e=null,t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.fader||s.tornadoRemove||(!e||s.cy<e.cy&&e.tz>s.tz)&&(e=s)}return e},S.prototype.tornado=function(){if(this.setTargetAngle(this.angle+S.turnSpeed),!this.lastTornadoPiece||M.time-this.lastTornadoPiece>100){this.lastTornadoPiece=M.time;var e=this.highestTile();e&&(M.suppressBigAnimations?e.cy=-100:e.tornadoRemove=!0)}for(var t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.tornadoRemove&&(s.cy-=.2),s.cy<-13&&(s.destroy(),this.tiles.splice(t,1))}0===this.tiles.length&&(this.tornadoRemove=!1)},S.prototype.contains=function(e){var t=this.getBounds();return t.contains(e.x,e.y)},A.GameStates={NONE:-1,PRELOAD:0,TITLES:1,PLAY:2},A.pageHidden=!1,A.prototype.create=function(){this.preloader=new k(M.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,M.lowResolutionAssets),this.lastState=A.GameStates.NONE,this.state=A.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null},A.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,M.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case A.GameStates.PRELOAD:this.preloader.update(),this.preloader.allLoaded()&&(this.state=A.GameStates.TITLES,E.focusChangeCallback=this.onFocusChange,E.focusChangeContext=this,E.detectHidden(),A.pageHidden=E.isHidden(),this.preloader.loadManager.loadGameStatus(),t=!0);break;case A.GameStates.TITLES:s&&(C.create(),e.clearCallbacks(),this.resetInput(),M.showTitleScreenOnStart?(this.titles=new P,this.titles.create(this.preloader)):this.state=A.GameStates.PLAY,this.preloader.audioManager.stopTune()),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,this.state=A.GameStates.PLAY);break;case A.GameStates.PLAY:s&&(M.arenaHelper.sendGameStart(),this.resetInput(),this.game=new I,this.game.create(this.preloader.getManagers(),this.preloader.levels)),this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,this.state=A.GameStates.TITLES)}}while(t);M.mouseDown&&M.getFocus(),M.render()},A.prototype.resetInput=function(){C.reset(),M.resetInput()},A.prototype.onFocusChange=function(e){e||M.getFocus(),(M.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(e?(this.bm&&this.bm.removing&&(this.bm.destroy(),this.bm=null),!this.bm&&this.game&&(this.bm=new o,this.bm.create(M.fullUI,this.preloader.getManagers(),"click_to_continue_string"))):(this.bm&&this.bm.remove(this,"bm")&&(M.mouseDown=null,M.mouseUp=null),I.paused=null!==I.options),M.time=1e3*Math.floor(M.time/1e3)+999,this.preloader.audioManager.visibilityMute(e),M.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},M.timeStarted=Date.now(),M.HTMLElement=null,M.prototype.createGame=function(t,s,i){new e,M.arenaHelper||(M.arenaHelper=new x),M.app=new PIXI.Application(t||M.gameWide,s||M.gameHigh,{autoResize:!0}),M.renderer=M.app.renderer,M.debug&&(M.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")));var n=null;null!==i&&(n=document.getElementById(i)),M.HTMLElement=n,n?n.appendChild(M.app.view):document.body.appendChild(M.app.view),M.getFocus(),M.suppressBigAnimations=M.renderer instanceof PIXI.CanvasRenderer?!0:!1,M.debug&&console.log("Main.suppressBigAnimations =",M.suppressBigAnimations),M.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,M.debug&&console.log("Main.android device =",M.isAndroid),M.isChromeMobile=M.isAndroid,M.debug&&console.log("Main.isChromeMobile =",M.isChromeMobile),M.stage=M.app.stage,M.stage.x=M.gameWide/2,M.stage.y=M.gameHigh/2,M.background=new PIXI.Sprite,M.background.anchor.set(.5),M.stage.addChild(M.background),M.puzzle=new PIXI.Sprite,M.puzzle.anchor.set(.5,.5),M.stage.addChild(M.puzzle),M.bottomUI=new PIXI.Sprite,M.bottomUI.anchor.set(.5,1),M.stage.addChild(M.bottomUI),M.rightUI=new PIXI.Sprite,M.rightUI.anchor.set(.5),M.stage.addChild(M.rightUI),M.topUI=new PIXI.Sprite,M.topUI.anchor.set(.5,0),M.stage.addChild(M.topUI),M.fullUI=new PIXI.Sprite,M.fullUI.anchor.set(.5,.5),M.fullUIScale=1,M.stage.addChild(M.fullUI),e.resizeCanvas(),e.pixiListeners(M.renderer),_gameGATracker("create","UA-68188765-19","auto"),M.nowTime=Date.now(),M.time=0,M.repeatedGamesLeft=M.playAgainCount,this.gameControl=new A,this.gameControl.create(),new m(["mjd_font1","mjd_font2","mjd_font3"],this.playGame,this)},M.prototype.playGame=function(){M.debug&&console.log("starting game loop");var t=null;M.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=function(){M._lastTime=M.nowTime,M.nowTime=Date.now(),M.elapsedTime=Math.min(M.nowTime-M._lastTime,50),M.time+=M.elapsedTime,requestAnimationFrame(i),t&&t.begin(),s.gameControl.update(),M.resizeConsumed&&(M.resized=!1,M.resizeConsumed=!1),e.resizeCanvas(),t&&t.end()};requestAnimationFrame(i)},M.createTextStyles=function(e){var t=e.get("text_styles");M.textStyleBold=M.wrapTextStyle(t.textStyleBold),M.textStyleBoldHugeCentered=M.wrapTextStyle(t.textStyleBoldHugeCentered),M.textStyleBoldButtons=M.wrapTextStyle(t.textStyleBoldButtons),M.textStyleBoldButtonsLarge=M.wrapTextStyle(t.textStyleBoldButtonsLarge),M.textStyleBoldButtonTitles=M.wrapTextStyle(t.textStyleBoldButtonTitles),M.textStyleBoldLargeCentered=M.wrapTextStyle(t.textStyleBoldLargeCentered),M.textStyleMedium=M.wrapTextStyle(t.textStyleMedium),M.textStyleMedium2=M.wrapTextStyle(t.textStyleMedium2),M.textStyleMediumTiny=M.wrapTextStyle(t.textStyleMediumTiny),M.textStyleVersionTiny=M.wrapTextStyle(t.textStyleVersionTiny),M.textStyleLarge=M.wrapTextStyle(t.textStyleLarge),M.textStyleSemiBold=M.wrapTextStyle(t.textStyleSemiBold)},M.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return E.setValuesFromObject(t,e),t},M.render=function(){M.renderer.render(M.stage),!M.HTMLElement||M.HTMLElement.clientWidth==M.width&&M.HTMLElement.clientHeight==M.height||e.resizeCanvas()},M.resetInput=function(){e.resetInput(),M.click=null,M.hover=null,M.mouseDown=null,M.mouseUp=null,M.swipe=0},M.getFocus=function(){M.app&&M.app.view&&(M.debug&&console.log("Main.getFocus - grab keyboard focus"),M.grabFocusOnStart&&(M.app.view.setAttribute("tabindex","0"),M.app.view.focus()),window.focus()),C.create()},P.ready=!1;var O=400,H=50;P.pieces=[{atlas:"introAtlas",key:"logo_panel",x:0,y:-90,alpha:0,fade:.05},{atlas:"introAtlas",key:"logo_tiles",x:0,y:-131,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+4*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_m",x:-216,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+0*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_a",x:-161,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+1*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_h",x:-109,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+2*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_j",x:-60,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+3*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_n",x:67,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+5*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:128,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+6*H,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:190,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:O+7*H,easing:"bounce"}},{atlas:"introAtlas",key:"logo_dimensions",x:-10,y:-28,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:O+8*H,easing:"bounce"}},{atlas:"introAtlas",key:"play-button",x:4,y:130,button:{over:"play-button-rollover",down:"play-button-down",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){P.ready=!0},duration:O+8*H,easing:"bounce"}}],P.prototype.create=function(t){P.ready=!1,this.preloader=t,this.managers=this.preloader.getManagers(),this.bg=new n,this.bg.create(M.background,"introAtlas","title_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=M.height/2/this.bg.parent.scale.y,this.version=null,this.version=new a(M.VERSION,M.textStyleVersionTiny),this.version.anchor.y=1,this.version.create(M.bottomUI,-0.49,.493,!0),M.fullUIScale=1.6,M.forceResize=!0;var s=b.createTweens(P.pieces,M.fullUI,this.managers,0,0,M.textStyleBoldButtonTitles);this.sprites=s.sprites,this.buttons=s.buttons,e.registerCallback("mousedown",this.startTune,{context:this}),this.fader=new f,this.fader.setFade(.1),M.debug&&console.log("titles are fading in"),M.eventChangeAdOnTitlesShow&&M.arenaHelper.sendEventChange()},P.prototype.startTune=function(){e.clearCallback("mousedown",this.startTune),M.debug&&console.log("Titles.startTune"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(M.debug&&console.log("retry loadAudioAssets from input gesture"),this.preloader.loadAudioAssets()),M.debug&&console.log("play the tune..."),this.managers.audio.startTune("game_tune"))},P.prototype.destroy=function(){var e;if(M.fullUIScale=1,M.forceResize=!0,this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},P.prototype.update=function(){var e,t="";if(!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.y=M.height/2/this.bg.parent.scale.y,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&P.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.version&&this.version.update(),this.fader.reached(1)&&(0!==M.eventChangeAdOnIdle&&(M.idleTimer-=M.elapsedTime,M.idleTimer<0&&(M.arenaHelper.sendEventChange(),M.idleTimer=Number.MAX_VALUE)),("click_start"==t||C.isPressed[32])&&(_gameGATracker("send","event",M.VERSION,"start_game","MJD_HTML5",1),M.idleTimer=M.eventChangeAdOnIdle,M.hover=null,M.click=null,C.reset(32),this.fader.setFade(-.05),M.eventChangeAdOnTitlesClose&&M.arenaHelper.sendEventChange(),M.debug&&console.log("Titles: start fading out"))),!0},I.frameCount=0,I.paused=!1,I.requestQuit=!1,I.effects=null,I.score=0,I.highScore=0,I.timeLeft=0,I.options=null,I.levelMatches=0,I.STARTING=0,I.PLAYING=1,I.WON_LEVEL=2,I.FINAL_MESSAGE=3,I.NEXT_LEVEL=4,I.TIME_UP=5,I.NO_MOVES=6,I.GAME_WON=7,I.WAIT_DELAY=8,I.REMOVE_MSG_QUIT=9,I.QUIT_REQUEST=10,I.prototype.create=function(e,t){this.managers=e,this.numLevels=t,I.paused=!1,I.requestQuit=!1,I.score=0,I.levelMatches=0,I.timeLeft=M.timerStart,I.effects=new y,I.effects.create(this.managers.textures),this.level=0,this.help=null,this.confirm=null,this.bm=null,this.state=I.PLAYING,this.nextState=-1,this.delay=0,this.won=!1,M.arenaHelper.addPauseAndResumeActions(I.pauseGame.bind(this),I.resumeGame.bind(this)),this.managers.audio.play("snd_startSting"),M.showHelp&&this.showHelp(!0)},I.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),I.effects&&(I.effects.destroy(),I.effects=null),I.options&&(I.options.destroy(),I.options=null),this.managers=null},I.prototype.update=function(){var e=!0;if(I.frameCount++,this.confirm){if(this.confirm.update())return e;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return e;var t=this;this.help.remove(function(){t.help=null})}if(I.paused&&I.options)return I.options.update()?e:(I.options.remove(I.optionsDestroyed),e);I.requestQuit&&(I.requestQuit=!1,this.state=I.QUIT_REQUEST),M.puzzle.alpha<1&&(M.puzzle.alpha+=.2);var s;do{s=!1;var i=this.lastState!=this.state;switch(this.lastState=this.state,this.state){case I.PLAYING:i&&(_gameGATracker("send","event",M.VERSION,"start_level_"+(this.level+1),"MJD_HTML5",Math.round(I.timeLeft/1e3)),this.world=new z(this),this.world.create(this.managers,this.level),I.levelMatches=0,M.idleTimer=M.eventChangeAdOnIdle),this.world.update()?0!==M.eventChangeAdOnIdle&&(M.idleTimer-=M.elapsedTime,M.idleTimer<0&&(M.arenaHelper.sendEventChange(),M.idleTimer=Number.MAX_VALUE)):this.state=this.world.levelBeaten()?I.WON_LEVEL:this.world.timeUp()?I.TIME_UP:I.NO_MOVES;break;case I.WON_LEVEL:if(i){this.managers.audio.play("snd_endSting");var n=this.world.getLevelBonus();I.score+=n,_gameGATracker("send","event",M.VERSION,"win_level_"+Math.min(this.level+1,this.numLevels),"MJD_HTML5",I.score);var a=this.managers.locale.get("gvp_level_good_job_text_string")+"\n"+(n>0?"+"+n.toString():"");this.bm=new o,this.bm.create(M.fullUI,this.managers,a),this.bm.timeOut=1e3}this.world&&this.world.updateScore(),this.bm.update()||(this.state=I.NEXT_LEVEL,1===this.level&&0===M.repeatedGamesLeft&&M.playMidRollAd&&M.arenaHelper.requestMidroll());break;case I.NEXT_LEVEL:if(i){if(this.level++,this.level>this.numLevels-1){this.state=I.GAME_WON,this.won=!0,s=!0;break}this.world.destroy(),this.state=I.PLAYING,s=!0}break;
case I.TIME_UP:this.managers.audio.play("snd_timeUp"),this.bm=new o,I.score>I.highScore&&(I.highScore=I.score);var r=this.managers.locale.get("gvp_level_times_up_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+I.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+I.highScore.toString();this.bm.create(M.fullUI,this.managers,r),this.world.puzzle.tornadoRemove=!0,this.level==this.numLevels-1&&_gameGATracker("send","event",M.VERSION,"final_level_lose","MJD_HTML5",1),M.repeatedGamesLeft>0&&this.bm.addButton("play_again_string"),this.state=I.FINAL_MESSAGE;break;case I.NO_MOVES:this.managers.audio.play("snd_error2"),this.bm=new o,I.score>I.highScore&&(I.highScore=I.score);var l=this.managers.locale.get("gvp_level_no_more_move_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+I.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+I.highScore.toString();this.bm.create(M.fullUI,this.managers,l),this.world.puzzle.tornadoRemove=!0,this.level==this.numLevels-1&&_gameGATracker("send","event",M.VERSION,"final_level_lose","MJD_HTML5",1),M.repeatedGamesLeft>0&&this.bm.addButton("play_again_string"),this.state=I.FINAL_MESSAGE;break;case I.GAME_WON:_gameGATracker("send","event",M.VERSION,"win_game_timer","MJD_HTML5",Math.round(I.timeLeft/1e3)),this.bm=new o,I.score>I.highScore&&(I.highScore=I.score);var h=this.managers.locale.get("game_over_win_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+I.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+I.highScore.toString();this.bm.create(M.fullUI,this.managers,h),M.repeatedGamesLeft>0&&this.bm.addButton("play_again_string"),this.state=I.FINAL_MESSAGE;break;case I.QUIT_REQUEST:if(i){_gameGATracker("send","event",M.VERSION,"quit_game","MJD_HTML5",I.score),_gameGATracker("send","event",M.VERSION,"quit_game_timer","MJD_HTML5",Math.round((M.nowTime-M.timeStarted)/1e3)),_gameGATracker("send","event",M.VERSION,"submit_score","MJD_HTML5",I.score),this.level==this.numLevels-1&&_gameGATracker("send","event",M.VERSION,"final_level_quit","MJD_HTML5",1),0===I.score&&_gameGATracker("send","event",M.VERSION,"abandon","MJD_HTML5",1),this.bm=new o,I.score>I.highScore&&(I.highScore=I.score);var u=this.managers.locale.get("game_over_lose_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+I.score.toString()+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+I.highScore.toString();this.bm.create(M.fullUI,this.managers,u),this.world.puzzle.tornadoRemove=!0,this.state=I.FINAL_MESSAGE,M.repeatedGamesLeft>0&&this.bm.addButton("play_again_string")}break;case I.FINAL_MESSAGE:if(i){var c=Math.min(this.level+1,this.numLevels);this.bm.timeOut=5e3,this.won?_gameGATracker("send","event","Game Complete",c,I.score):_gameGATracker("send","event","Game Over",c,I.score),_gameGATracker("send","event",M.VERSION,"level_"+c+"_matches","MJD_HTML5",I.levelMatches)}this.world&&this.world.puzzle.tornadoRemove&&this.world.puzzle.update(),this.bm.update()||(this.bm.destroy(),this.bm=null,_gameGATracker("send","event",M.VERSION,"submit_score","MJD_HTML5",I.score),M.arenaHelper.sendGameEnd(I.highScore),this.delay=M.repeatedGamesLeft>0?100:4e3,this.state=I.WAIT_DELAY,this.nextState=I.REMOVE_MSG_QUIT);break;case I.WAIT_DELAY:this.world&&(this.world.updateScore(),this.world.puzzle.tornadoRemove&&this.world.puzzle.update()),this.delay=Math.max(this.delay-M.elapsedTime,0),0===this.delay?(this.state=this.nextState,s=!0):this.bm&&this.bm.update();break;case I.REMOVE_MSG_QUIT:i&&this.bm&&this.bm.remove(this,"bm"),this.bm?this.bm.update()||(this.bm=null):M.repeatedGamesLeft>0&&(this.world.destroy(),e=!1)}}while(s);return I.effects.update(),e},I.prototype.showHelp=function(e){this.help=new l,this.help.create(this.managers,e)},I.prototype.showConfirm=function(e,t,s,i){this.confirm=new r,this.confirm.create(this,this.managers,e,t,s,i)},I.prototype.pauseToggle=function(){I.paused=!I.paused,M.debug&&console.log(I.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),I.paused?(I.options=new c,I.options.create(this,this.managers),_gameGATracker("send","event",M.VERSION,"help","MJD_HTML5",1)):I.options&&(I.options.destroy(),I.options=null)},I.pauseGame=function(){M.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),I.paused=!0},I.resumeGame=function(){M.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),I.paused=null!==I.options},I.optionsDestroyed=function(){I.options=null,I.paused=!1},z.brighter=null,z.brighter2=null,z.prototype.create=function(e,t){this.managers=e,M.swipeEnabled=!0,z.SelectionPreviewX=504,z.SelectionPreviewY=206,z.SelectionPreviewBotY=216,z.brighter=new PIXI.filters.ColorMatrixFilter,z.brighter.brightness(1.5,!0),z.brighter2=new PIXI.filters.ColorMatrixFilter,z.brighter2.brightness(1.2,!0),this.bg=new n,this.bg.create(M.background,"gameAtlas","game_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=M.height/2/this.bg.parent.scale.y,this.icons=[],this.buttons=[],this.sprites=[],this.texts=[],this.puzzle=new S,this.puzzle.create(this,this.managers,this.managers.data.get("level"+(t+1).toString()),this.managers.data.get("level1")),this.puzzle.setTargetAngle(30*Math.PI/180,!0),this.puzzle.adjustTargetAngle(90*Math.PI/180),this.puzzleInput=new d,this.puzzleInput.create(this.managers,this.puzzle),this._createUI(),M.resized=!0,M.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.reshuffled=!1,this.bm=null},z.prototype.destroy=function(){this.managers=null,this.bg&&(this.bg.destroy(),this.bg=null);var e;if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.icons){for(e=0;e<this.icons.length;e++)this.icons[e].destroy();this.icons=null}if(this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.puzzleInput&&(this.puzzleInput.destroy(),this.puzzleInput=null),this.puzzle&&(this.puzzle.destroy(),this.puzzle=null),z.brighter=null,z.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.container1&&(this.container1.destroy(),this.container1=null),this.container2&&(this.container2.destroy(),this.container2=null),this.reshuffleBtn=null,this.ignoreClick=null,this.game=null},z.prototype.update=function(){if(this._background(),this._userInput(),this.puzzle){if(!this._timerUpdate())return!1;if(!this._finishedOrStuck())return!1}var e=!this.puzzle.finished(!1);return this.container1&&this.container1.update(),this.container2&&this.container2.update(),this._userInterface()?!0:e},z.prototype.levelBeaten=function(){return this.puzzle?this.puzzle.finished(!1):!0},z.prototype.timeUp=function(){return I.timeLeft<=0},z.prototype.updateScore=function(){if(I.score>this.scoreText._visibleScore){var e=I.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e,this.scoreText.text=this.scoreText._visibleScore.toString()}},z.prototype._createUI=function(){var e=new h(h.TYPE_NOLATCH);e.create(M.topUI,"gameAtlas","pause_button",this.managers,516,63,!1,"pause_button","pause_button-rollover","pause_button-down","click_pause_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.buttons.push(e),e=new h(h.TYPE_BUTTON),e.create(M.topUI,"gameAtlas","reshuffle_button",this.managers,336,63,!1,"reshuffle_button","reshuffle_button-rollover","reshuffle_button-down","click_reshuffle_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.reshuffleBtn=e,this.buttons.push(e);var t=new n;t.create(M.topUI,"gameAtlas","time icon",this.managers.textures,-540,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var s=new a("",M.textStyleSemiBold);s.create(M.topUI,-480,63,!1),s.anchor.y=.5,this.texts.push(s),this.timeText=s,t=new n,t.create(M.topUI,"gameAtlas","score icon",this.managers.textures,-150,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t),s=new a(I.score.toString(),M.textStyleSemiBold),s.create(M.topUI,-90,63,!1),s.anchor.y=.5,this.texts.push(s),this.scoreText=s,this.scoreText._visibleScore=I.score,e=new h(h.TYPE_BUTTON),e.create(M.bottomUI,"gameAtlas","arrow_lft",this.managers,-.43,.45,!0,"arrow_lft","arrow_lft-rollover","arrow_lft","click_left_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e),e=new h(h.TYPE_BUTTON),e.create(M.bottomUI,"gameAtlas","arrow_rgt",this.managers,.43,.45,!0,"arrow_rgt","arrow_rgt-rollover","arrow_rgt","click_right_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e);var i;i=new n,i.create(M.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),i.anchor.x=i.anchor.y=.5,i.scale.x=1.3,i.scale.y=1.2,i.alpha=.5,this.container1=i,i=new n,i.create(M.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),i.anchor.x=i.anchor.y=.5,i.scale.x=1.3,i.scale.y=1.2,i.alpha=.5,this.container2=i,i=new n,i.create(M.topUI,null,"cube_s1_1",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),i.anchor.x=i.anchor.y=.5,i.scale.x=i.scale.y=T.scale/M.tileAssetScale,this.puzzleInput.createHoveredPiece(i),i=new n,i.create(M.topUI,null,"cube_s1_1",this.managers.textures,z.SelectionPreviewX,z.SelectionPreviewY,!1),i.y+=i.height,i.anchor.x=i.anchor.y=.5,i.scale.x=i.scale.y=T.scale/M.tileAssetScale,this.puzzleInput.createDroppedPiece(i),this.container1.visible=this.container2.visible=M.isPortrait?!1:!0,this.container2&&(this.container2.y=z.SelectionPreviewBotY=i.y)},z.prototype._timerUpdate=function(){if(this.bm)this.bm.update("bm");else if(!this.puzzle.tornadoRemove&&!I.paused){if(I.timeLeft-=M.elapsedTime,this.timeUp())return!1;var e=E.timeToString(I.timeLeft);this.timeText.text!=e&&(this.timeText.text=e),I.timeLeft/1e3<10&&(I.timeLeft%1e3<500?16711680!=this.timeText.tint&&(I.timeLeft/1e3<5&&this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16711680):16777215!=this.timeText.tint&&(this.managers.audio.play(["snd_timerWarning"]),this.timeText.tint=16777215))}return!0},z.prototype._finishedOrStuck=function(){if((!this.puzzle.update()||M.testKeys&&C.isPressed[L.key_l])&&!this.puzzle.finished(!0)){if(this.reshuffled)return this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]),!1;for(;this.puzzle.puzzleLocked()||M.testKeys&&C.isPressed[L.key_l];)C.isPressed[L.key_l]=!1,this._reshuffle()}return!0},z.prototype._background=function(){this.bg.y=M.height/2/this.bg.parent.scale.y,this.bg.update()},z.prototype._userInterface=function(){C.update(),this.container1.visible=this.container2.visible=M.isPortrait?!1:!0;for(var e,t=this.puzzleInput.update(),s=0;s<this.buttons.length&&(e=this.buttons[s].update(),null===e||void 0===e);s++);switch(e){case"click_pause_event":this.puzzleInput.removeHoverPiece(),this.game.pauseToggle();break;case"click_reshuffle_event":this._reshuffleClick();break;case"click_left_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),M.eventChangeAdOnRotate&&M.arenaHelper.sendEventChange();break;case"click_right_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),M.eventChangeAdOnRotate&&M.arenaHelper.sendEventChange()}for(s=0;s<this.icons.length;s++)this.icons[s].update();for(s=0;s<this.sprites.length;s++)this.sprites[s].update();for(this.updateScore(),s=0;s<this.texts.length;s++)this.texts[s].update();return this.puzzleInput.showDropAndHoverPieces(),this.container1&&(this.container1.y=z.SelectionPreviewY),this.container2&&(this.container2.y=z.SelectionPreviewBotY),t},z.prototype._userInput=function(){if(!this.bm&&!this.puzzle.tornadoRemove){(M.swipe<0||C.isPressed[L.left_arrow]||C.isPressed[L.key_a]||C.isPressed[L.key_q])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),M.eventChangeAdOnRotate&&M.arenaHelper.sendEventChange()),M.swipe=0,M.idleTimer=M.eventChangeAdOnIdle),(M.swipe>0||C.isPressed[L.right_arrow]||C.isPressed[L.key_d]||C.isPressed[L.key_e])&&(this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),M.eventChangeAdOnRotate&&M.arenaHelper.sendEventChange()),M.swipe=0,M.idleTimer=M.eventChangeAdOnIdle);var t;if(null!==M.mouseDown||null!==M.click||null===M.hover||isNaN(M.hover.x)||isNaN(M.hover.y)||!this.puzzle.contains(M.hover)||(t=this.puzzle.tilePicker(M.hover.x,M.hover.y),M.hover=null,t?this.puzzleInput.showHoveredPiece(t):this.puzzleInput.removeHoverPiece()),null!==M.click){M.idleTimer=M.eventChangeAdOnIdle;var s=!1;this.ignoreClick&&E.distanceBetween(this.ignoreClick,M.click)<10&&I.frameCount-this.ignoreClick.when<30&&(s=!0),s||(t=this.puzzle.tilePicker(M.click.x,M.click.y),t&&this.puzzleInput.clickedPiece(t)),M.click=null,this.ignoreClick=null}null!==M.mouseDown&&(M.idleTimer=M.eventChangeAdOnIdle,t=this.puzzle.tilePicker(M.mouseDown.x,M.mouseDown.y),this.ignoreClick=M.mouseDown,this.ignoreClick.when=I.frameCount,t&&this.puzzleInput.clickedPiece(t)&&(M.mouseDown=null)),M.testKeys&&C.isPressed[L.key_r]&&this._reshuffleClick(),M.testKeys&&C.isPressed[L.key_t]&&(this.puzzle.tornadoRemove=!0),M.testKeys&&C.isPressed[L.key_x]&&(I.timeLeft=1),M.testKeys&&(C.isPressed[L.key_v]||M.mouseDown&&M.mouseDown.x<30&&M.mouseDown.y<30)&&e.debugWindowData()}},z.prototype.destroySprite=function(e){var t=this.sprites.indexOf(e);-1!==t&&this.sprites.splice(t,1),e.destroy()},z.prototype._reshuffle=function(){_gameGATracker("send","event",M.VERSION,"shuffle","MJD_HTML5",1),this.managers.audio.playDelayed(["snd_reshuffle2"],1.5),this.puzzle.reshuffle(),this.reshuffled=!0},z.prototype._reshuffleClick=function(){this.puzzleInput.removeHoverPiece(),this.reshuffled?this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]):(this.managers.audio.play(["snd_reshuffle1"]),this.bm=new o,this.bm.create(M.fullUI,this.managers,"gvp_level_reshuffle_text_string",this._reshuffle,this),this.bm.timeOut=2500,this.reshuffleBtn&&(this.reshuffleBtn.visible=!1))},z.prototype.getLevelBonus=function(){return this.puzzle.levelBonusValues?this.puzzle.levelBonusValues[this.game.level]:0},M.debug&&console.time("Game create"),M.arenaHelper=new x(null),(new M).createGame(),M.debug&&console.timeEnd("Game create")}();
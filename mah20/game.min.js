/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.24',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',settings:{initialIntroPlayButtonTextScale:0,initialIntroPlayButtonScale:0},_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ig.System.SCALE.CRISP(canvas,ctx);var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){console.log('script <'+script.src+'> is LOADED');ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw("Unresolved (or circular?) dependencies. "+"Most likely there's a name/path mismatch for one of the listed modules "+"or a previous syntax error prevents a module from loading:\n"+
unresolved.join('\n'));}else if(ig._waitForOnload===0&&ig._loadQueue.length===0&&!modulesLoaded&&getBrowserName()==='msie'&&getBrowserVersion()==9){ig._DOMReady();}},_DOMReady:function(ev){console.log('_DOMReady.1');if(!ig.modules['dom.ready'].loaded){console.log('_DOMReady.2');if(!document.body){console.log('_DOMReady.3');return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
console.log('_DOMReady.4, ig._waitForOnload = '+ig._waitForOnload+', globalInit = '+(ig.globalInit!=null));if(ig._waitForOnload===0&&typeof(ig.globalInit)==='function'){console.log('_DOMReady.5');document.removeEventListener('DOMContentLoaded',ig._DOMReady);window.removeEventListener('load',ig._DOMReady);var gi=ig.globalInit;ig.globalInit=null;setTimeout(gi,20);}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||(window.screen.deviceXDPI&&window.screen.logicalXDPI?window.screen.deviceXDPI/window.screen.logicalXDPI:1);if(navigator.userAgent.match(/Android/i)){ig.ua.pixelRatio=1.25;}
ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};var bigger=ig.ua.viewport.width>ig.ua.viewport.height?ig.ua.viewport.width:ig.ua.viewport.height;if(navigator.userAgent.match(/(iPad|iPhone|iPod)/i)&&(bigger*ig.ua.pixelRatio)>2048){ig.ua.pixelRatio=ig.ua.pixelRatio/(bigger*ig.ua.pixelRatio/2048)}
ig.ua.useHD=bigger>960?true:false;navigator.userAgent.match(/iPod/i)?ig.ua.useHD=false:false;if(navigator.userAgent.match(/iPod/i)){ig.ua.useHD=false;}
ig.ua.performancePixelRatio=ig.ua.pixelRatio;ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||/mobile/i.test(navigator.userAgent);ig.ua.touchDevice=(('ontouchstart'in window)||(window.navigator.msMaxTouchPoints));},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;var lastClassId=0;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;Class.classId=prototype.classId=++lastClassId;return Class;};if(window.ImpactMixin){ig.merge(ig,window.ImpactMixin);}})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',rotateAngle:0,description:{},targetX:0,targetY:0,targetW:0,targetH:0,staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path,description){if(path===null&&description&&description.imageData){this.path=null;this.data=description.imageData;this.width=this.data.width;this.height=this.data.height;this.loaded=true;}else{this.path=path;this.description=description||{};this.description.resourceType='image';ig.addResource(this);ig.Image.cache[this.path]=this;}},load:function(image){this.data=image;this.onload();},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');scaledCtx.drawImage(this.data,0,0,this.width,this.height,0,0,widthScaled,heightScaled);this.data=scaled;this.width=widthScaled;this.height=heightScaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height,scaleX,scaleY){if(!this.loaded){return;}
scaleX=scaleX?scaleX:1;scaleY=scaleY?scaleY:1;var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=Math.floor((width?width:this.width)*scale);height=Math.floor((height?height:this.height)*scale);this.targetX=Math.floor(ig.system.getDrawPos(targetX));this.targetY=Math.floor(ig.system.getDrawPos(targetY));this.targetW=Math.floor(width*scaleX);this.targetH=Math.floor(height*scaleX);if(this.rotateAngle!==0){ig.system.context.save();ig.system.context.translate(this.targetX+this.targetW/2,this.targetY+this.targetH/2);this.targetX=-this.targetW/2;this.targetY=-this.targetH/2;ig.system.context.rotate(this.rotateAngle);}
ig.system.context.drawImage(this.data,Math.floor(sourceX),Math.floor(sourceY),width,height,this.targetX,this.targetY,this.targetW,this.targetH);if(this.rotateAngle!==0){ig.system.context.restore();}
ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,scaleSourceX,scaleSourceY,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;scaleSourceX=scaleSourceX?scaleSourceX:1;scaleSourceY=scaleSourceY?scaleSourceY:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
var sX=Math.round(Math.floor(Math.floor(tile*tileWidth)%this.width)*scale),sY=Math.round(Math.floor(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale),sW=Math.round(tileWidthScaled),sH=Math.round(tileHeightScaled),X=Math.round(ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0)),Y=Math.round(ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0)),W=Math.round(tileWidthScaled*scaleSourceX),H=Math.round(tileHeightScaled*scaleSourceY)
if(sX<this.data.width&&sY<this.data.height){ig.system.context.drawImage(this.data,sX,sY,sW,sH,X,Y,W,H);}
if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;},getDrawParams:function(layoutType,targetWidth,targetHeight){var params={sourceX:0,sourceY:0,sourceWidth:this.width,sourceHeight:this.height};var scale=1;if(layoutType==='cover'){var widthScale=this.width/targetWidth;var heightScale=this.height/targetHeight;if(widthScale<heightScale){if(widthScale<1){scale=targetWidth/this.width;}
var fullHeight=this.height*scale;params.sourceHeight=this.height*widthScale;params.sourceY=Math.round((fullHeight-targetHeight)/2);}else{if(heightScale<1){scale=targetHeight/this.height;var fullWidth=this.width*scale;params.sourceWidth=this.width*heightScale;params.sourceX=Math.round((fullWidth-targetWidth)/2);}else{scale=targetHeight/this.height;params.sourceWidth=targetWidth;var fullWidth=this.width*scale;params.sourceX=Math.round((fullWidth-targetWidth)/2);}}}else{}
return params;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},getTextWidth:function(text){return this._widthForLine(text);},getFontHeight:function(){return this.height;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},drawText:function(text,x,y,params){return this.draw(text,x,y,params.align);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]<128&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:'left',RIGHT:'right',CENTER:'center'};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);console.log("LOADER LOAD");},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,timeframe:333,prevTime:0,currTime:0,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.timeframe=Math.round(1000/this.fps);this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)==='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.clearRect(0,0,this.realWidth,this.realHeight);},run:function(){this.currTime=Date.now();if(this.currTime-this.prevTime<this.timeframe){return;}
window.ArkBench.startTimeTest('system.run');this.prevTime=this.currTime;ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}
window.ArkBench.finishTimeTest('system.run');},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',false);canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',true);canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0,eventTime:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);if(window.navigator.msPointerEnabled){ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),false);ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),false);ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),false);ig.system.canvas.style.msTouchAction='none';}else{if("ontouchstart"in document.documentElement){ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),false);ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),false);ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchcancel',this.keyup.bind(this),false);}
if(ARK_getDeviceType()=='pc'){ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),false);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),false);ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),false);}}},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.changedTouches?event.changedTouches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;this.mouse.eventTime=Date.now();},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){if(ig.game&&ig.game.initialized&&typeof(ig.game.rawInputHandler)==='function'){ig.game.rawInputHandler(event);}
var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.stopPropagation();event.preventDefault();if(event.type==='touchstart'||event.type==='mousedown'){this.mousemove(event);}}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchend'||event.type=='touchcancel'||event.type=='mouseup'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);element.addEventListener('touchcancel',function(ev){that.touchEnd(ev,action);},false);element.addEventListener('MSPointerDown',function(ev){that.touchStart(ev,action);},false);element.addEventListener('MSPointerUp',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return!!this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};ig.startEngine=function(canvasId,fps,width,height,scale){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;};ig.startGame=function(gameClass,loaderClass){var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height,description){this.width=width;this.height=height;this.image=new ig.Image(path,description);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.frame=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f-0.0001);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY,scaleX,scaleY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,scaleX,scaleY,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,scaleX,scaleY,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},boundingShape:"none",init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=x;this.pos.y=this.last.y=y;ig.merge(this,settings);if(settings&&settings.boundingShape){this.boundingShape=settings.boundingShape;}},reset:function(x,y,settings){var proto=this.constructor.prototype;this.pos.x=x;this.pos.y=y;this.last.x=x;this.last.y=y;this.vel.x=proto.vel.x;this.vel.y=proto.vel.y;this.accel.x=proto.accel.x;this.accel.y=proto.accel.y;this.health=proto.health;this._killed=proto._killed;this.standing=proto.standing;this.type=proto.type;this.checkAgainst=proto.checkAgainst;this.collides=proto.collides;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){},inside:function(x,y){switch(this.boundingShape){case"box":return((this.pos.x<=x)&&(x<=this.pos.x+this.size.x)&&(this.pos.y<=y)&&(y<=this.pos.y+this.size.y));case"circle":return(((x-this.pos.x)*(x-this.pos.x)+(y-this.pos.y)*(y-this.pos.y))<(this.size.x>=this.size.y?this.size.x/2:this.size.y/2));default:return false;}}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(totalWidth,totalHeight),this.chunkSize);var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;chunk.retinaResolutionEnabled=false;var chunkContext=chunk.getContext('2d');ig.System.scaleMode(chunk,chunkContext);var screenContext=ig.system.context;ig.system.context=chunkContext;for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=screenContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX+=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY+=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){ig.system.clear();this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/plugins/ark-loader.js
ig.baked=true;ig.module('plugins.ark-loader').defines(function(){ArkLoader=ig.Class.extend({_language:null,_queue:null,_resources:[],_priorityResources:[],_queueForXmlFiles:[],_loadedXmlFiles:{},RESOURCES_PREFIX:'assets/',IMAGES_RESOURCE_PATH_PREFIX:'images/',FONTS_RESOURCE_PATH_PREFIX:'fonts/',HD_PREFIX:'HD/HD_',SD_PREFIX:'SD/SD_',init:function(basePath){ArkLoader.instance=this;this._queue=new createjs.LoadQueue(false,basePath?basePath:'');},staticInstantiate:function(){return(ArkLoader.instance?ArkLoader.instance:null);},addListener:function(eventName,callback){this._queue.on(eventName,callback);},addResources:function(res,dontProcessPath){var resources=res;var dpp=(dontProcessPath===true);if(typeof(res)==='function'){resources=res();}
if(resources.length){for(var i=0;i<resources.length;++i){this.addResource(resources[i],dpp);}}else{this.addResource(resources,dpp);}},addResource:function(res,dontProcessPath){if(dontProcessPath!==true){res.src=this.getResourceBasePathByDescription(res)+res.src;}
if(res.src.indexOf('.xml')>0){this._queueForXmlFiles.push(res);}else{if(res.highPriority===true){this._priorityResources.push(res);}else{this._resources.push(res);}}},getResourceBasePathByDescription:function(description){var localizedSubPath=null;if(description.localized===true){localizedSubPath=LocalizationManager.getLocalizedImageBasePath(description.src);}
if(description.resourceType==='image'){description.type=createjs.LoadQueue.IMAGE;var checkHD=(description.hd!=null);var hdsdSubPath=(checkHD?(ig.ua.useHD?this.HD_PREFIX:this.SD_PREFIX):'');var res=this.RESOURCES_PREFIX+this.IMAGES_RESOURCE_PATH_PREFIX+hdsdSubPath;return localizedSubPath!=null?localizedSubPath+hdsdSubPath:res;}else if(description.resourceType==='font'){var checkHD=(description.hd!=null);return this.RESOURCES_PREFIX+this.FONTS_RESOURCE_PATH_PREFIX+(checkHD?(ig.ua.useHD?this.HD_PREFIX:this.SD_PREFIX):'');}
return'';},load:function(){var file=null;while(this._priorityResources.length>0){file=this._priorityResources.pop();this._queue.loadFile(file,true);}
while(this._resources.length>0){file=this._resources.pop();this._queue.loadFile(file,true);}},loadXMLFiles:function(cb){if(cb){this.realLoadComplete=cb;}
this._actualXMLResource=null;if(this._queueForXmlFiles.length>0){this._actualXMLResource=this._queueForXmlFiles.pop();ARK_gameJQ.ajax({url:this._actualXMLResource.src,async:false,cache:true,dataType:'text',context:this,success:function(data,textStatus,jqXHR){this._loadedXmlFiles[this._actualXMLResource.id?this._actualXMLResource.id:this._actualXMLResource.src]=data;this.loadXMLFiles();},error:function(jqXHR,textStatus,errorDescription){console.log('--------------------------     FAIL XML!!!');this.loadXMLFiles();}});}else{this.realLoadComplete();}},getResource:function(resId,raw){return this._loadedXmlFiles.hasOwnProperty(resId)?this._loadedXmlFiles[resId]:this._queue.getResult(resId,raw);},reset:function(fullReset){this._resources=[];if(fullReset===true){this._loadedXmlFiles={};this._queue.removeAllEventListeners();this._queue.removeAll();this._queue.reset();}}});});

// lib/plugins/ark-impact-loader.js
ig.baked=true;ig.module('plugins.ark-impact-loader').requires('plugins.ark-loader').defines(function(){ArkImpactLoader=ig.Class.extend({endTime:0,fadeToWhiteTime:200,fadeToGameTime:800,logoWidth:316,logoHeight:106,_language:'',_arkLoader:null,_progress:0,MAX_PROGRES_FOR_LOAD_PHASE:0.85,loadCallbacks:[],loadErrors:[],retryCounter:0,hasLoadingErrors:false,MAX_RETRY_ATTEMPTS:2,progressPhase:'LOAD_RESORUCES',init:function(gameClass,impactResources){this._gameClass=gameClass;this._arkLoader=new ArkLoader();this._language=LocalizationManager?LocalizationManager.getActualLocale():'';var loadDescription;for(var i=0;i<impactResources.length;i++){if(typeof(impactResources[i].path)!=='string'){continue;}
impactResources[i].description.id=impactResources[i].path;this._arkLoader.addResources(impactResources[i].description);this.loadCallbacks.push(impactResources[i]);}
this._arkLoader.addListener('complete',this.onLoad.bind(this));this._arkLoader.addListener('error',this.onError.bind(this));this._arkLoader.addListener('progress',this.onProgress.bind(this));this._arkLoader.addListener('fileload',this.onResourceLoaded.bind(this));},onResourceLoaded:function(loadEvent){var itemLoaded=false;var i=0;for(;i<this.loadCallbacks.length;++i){if(this.loadCallbacks[i].path===loadEvent.item.id){this.loadCallbacks[i].load(loadEvent.result);itemLoaded=true;break;}}
if(itemLoaded){this.loadCallbacks.splice(i,1);}},load:function(){this._intervalId=setInterval(this.draw.bind(this),50);this._arkLoader.load();},onProgress:function(loadEvent){this._progress=loadEvent.progress*this.MAX_PROGRES_FOR_LOAD_PHASE;},onLoad:function(loadEvent){this._arkLoader.reset();if(this.hasLoadingErrors){console.log('this.retryCounter = '+this.retryCounter);if(++this.retryCounter>this.MAX_RETRY_ATTEMPTS){console.log('show Internet Connection Error');this.showLoadingErrorScreen();}else{setTimeout(this.retryLoad.bind(this),20);}}else{this._arkLoader.loadXMLFiles(this.end.bind(this));}},onError:function(loadEvent){console.log('loading error: type = '+loadEvent.type+', error = '+loadEvent.error);console.log('error loading item: <'+(typeof(loadEvent.item)==='string'?loadEvent.item:loadEvent.item.src)+'>, event = '+loadEvent);this.loadErrors.push(loadEvent.item);this.hasLoadingErrors=true;},retryLoad:function(clearErrorCounter){if(clearErrorCounter===true){this.retryCounter=0;}
this._arkLoader.addResources(this.loadErrors,true);this.loadErrors=[];this.hasLoadingErrors=false;this._arkLoader.load();},end:function(){console.log('LOADING DONE, initializing the Game');clearInterval(this._intervalId);ig.system.setGame(this._gameClass);ig.system.setDelegate(this);},showLoadingErrorScreen:function(){},run:function(){if(ig.game.initialized===false&&this.progressPhase==='LOAD_RESORUCES'){this.progressPhase='GAME_INIT_IN_PROGRESS';console.log('progressPhase = GAME_INIT_IN_PROGRESS');}else if(ig.game.initialized===true&&this.progressPhase==='GAME_INIT_IN_PROGRESS'){this.progressPhase='GAME_INIT_DONE';ig.system.context.clearRect(0,0,ig.system.width,ig.system.height);this.endTime=Date.now();console.log('progressPhase = GAME_INIT_DONE');}
if(this.progressPhase==='GAME_INIT_DONE'){var t=Date.now()-this.endTime;var alpha=1;if(t<this.fadeToWhiteTime){alpha=t.map(0,this.fadeToWhiteTime,0,1);}
else if(t<this.fadeToGameTime){ig.game.run();alpha=t.map(this.fadeToWhiteTime,this.fadeToGameTime,1,0);}else{ig.system.setDelegate(ig.game);return;}
ig.system.context.fillStyle='rgba(90,117,143,'+alpha+')';ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);}else if(this.progressPhase==='GAME_INIT_IN_PROGRESS'){ig.game.doNextInitPhase();this._progress=this.MAX_PROGRES_FOR_LOAD_PHASE+ig.game.getInitializationProgress()*(1-this.MAX_PROGRES_FOR_LOAD_PHASE);this.draw();}},draw:function(){}});});

// lib/plugins/ark-font.js
ig.baked=true;ig.module('plugins.ark-font').defines(function(){ArkFont=ig.Class.extend({fontName:'',fontSize:-1,targetCanvasContext:null,scaleFactor:0,fontSizeUnit:'px',align:'left',init:function(params){this.fontName=params.fontName;this.fontSize=params.fontSize;if(params.fontSizeUnit){this.fontSizeUnit=params.fontSizeUnit;}
if(params.align){this.align=params.align;}
this.targetCanvasContext=params.targetCanvasContext?params.targetCanvasContext:ig.system.context;},setTargetCanvasContext:function(targetCanvasContext){this.targetCanvasContext=targetCanvasContext;},scale:function(scaleFactor){this.scaleFactor=scaleFactor;},getName:function(){return this.fontName;},getSize:function(){return this.fontSize;},getTextWidth:function(text,params){return-1;},getFontHeight:function(params){return-1;},drawText:function(text,x,y,params){},createTextLabel:function(text){return null;}});ArkTextLabel=ig.Class.extend({text:'',iamge:null,xOffset:0,yOffset:0,init:function(text,image,xOffset,yOffset){this.text=text;this.image=image;this.xOffset=xOffset||0;this.yOffset=yOffset||0;},getWidth:function(){return this.image.width;},getHeight:function(){return this.image.height;},draw:function(x,y){this.image.draw(x+this.xOffset,y+this.yOffset);}});});

// lib/plugins/ark-fonts-impact-bitmap.js
ig.baked=true;ig.module('plugins.ark-fonts-impact-bitmap').requires('plugins.ark-font','plugins.ark-loader').defines(function(){ArkImpactBitmapFont=ArkFont.extend({fontImage:null,sourceFontSize:null,color:null,widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,init:function(params){this.parent(params);this.fontImage=new ArkLoader().getResource(params.src,false);this._loadMetrics(this.fontImage);if(params.sourceFontSize&&params.sourceFontSize!==this.fontSize){this.sourceFontSize=params.sourceFontSize;}
if(params.color){this.color=params.color;}
this.applyParams();},applyParams:function(){if(typeof(this.color)==='string'){var canvas=document.createElement('canvas');canvas.width=this.fontImage.width;canvas.height=this.fontImage.height;var cc=canvas.getContext('2d');cc.fillStyle=this.color;cc.fillRect(0,0,canvas.width,canvas.height);cc.globalCompositeOperation='destination-in';cc.drawImage(this.fontImage,0,0);this.fontImage=canvas;}},createTextLabel:function(text){return null;},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},getTextWidth:function(text){return this._widthForLine(text);},getFontHeight:function(){return this.fontImage.height;},heightForString:function(text){return text.split('\n').length*(this.fontImage.height+this.lineSpacing);},drawText:function(text,x,y,params){return this.draw(text,x,y,params?params.align:ig.Font.ALIGN.LEFT);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.fontImage.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){this.targetCanvasContext.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){this.targetCanvasContext.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.fontImage.height-2)*scale;this.targetCanvasContext.drawImage(this.fontImage,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY-charHeight),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]<128&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});});

// lib/plugins/ark-fonts-fnt-reader.js
ig.baked=true;ig.module('plugins.ark-fonts-fnt-reader').defines(function(){FntXMLDescriptorReader=ig.Class.extend({face:'',size:-1,bold:false,italic:false,stretchH:-1,smooth:false,aa:false,padding:[0,0,0,0],spacing:[0,0],outline:0,lineHeight:-1,base:-1,scaleW:-1,scaleH:-1,charsCount:0,chars:{},init:function(xmlNode){var info=ARK_gameJQ(xmlNode).find('info');this.face=info.attr('face');this.size=new Number(info.attr('size')).valueOf();this.stretchH=new Number(info.attr('stretchH')).valueOf();var paddings=info.attr('padding').split(',');var padding=[];for(var i=0;i<paddings.length;++i){padding.push(new Number(paddings[i]).valueOf());}
this.padding=padding;var spacings=info.attr('spacing').split(',');var spacing=[];for(var i=0;i<spacings.length;++i){spacing.push(new Number(spacings[i]).valueOf());}
this.spacing=spacing;this.outline=new Number(info.attr('outline')).valueOf();var common=ARK_gameJQ(xmlNode).find('common');this.lineHeight=new Number(common.attr('lineHeight')).valueOf();this.base=new Number(common.attr('base')).valueOf();this.scaleW=new Number(common.attr('scaleW')).valueOf();this.scaleH=new Number(common.attr('scaleH')).valueOf();var charsEl=ARK_gameJQ(xmlNode).find('chars');this.charsCount=new Number(charsEl.attr('count')).valueOf();function parseChar(index,charEl){var jqEl=ARK_gameJQ(charEl);var charObj={id:new Number(jqEl.attr('id')).valueOf(),x:new Number(jqEl.attr('x')).valueOf(),y:new Number(jqEl.attr('y')).valueOf(),width:new Number(jqEl.attr('width')).valueOf(),height:new Number(jqEl.attr('height')).valueOf(),xoffset:new Number(jqEl.attr('xoffset')).valueOf(),yoffset:new Number(jqEl.attr('yoffset')).valueOf(),xadvance:new Number(jqEl.attr('xadvance')).valueOf()};this.chars[charObj.id]=charObj;}
ARK_gameJQ(xmlNode).find('char').each(parseChar.bind(this));}});});

// lib/plugins/ark-fonts-fnt-bitmap.js
ig.baked=true;ig.module('plugins.ark-fonts-fnt-bitmap').requires('plugins.ark-font','plugins.ark-loader','plugins.ark-fonts-fnt-reader').defines(function(){ArkFntBitmapFont=ArkFont.extend({fontImage:null,fontDesecriptor:null,CHAR_SPACE:32,CHAR_TAB:9,CHAR_NEWLINE:10,CHAR_CARRIAGE_RETURN:13,init:function(params){this.parent(params);this.fontImage=new ArkLoader().getResource(params.src,false);this.fontDescriptor=new FntXMLDescriptorReader(new ArkLoader().getResource(params.fontDescriptorSrc,false));if(params.color){this.color=params.color;}
this.applyParams();},applyParams:function(){if(typeof(this.color)==='string'){var canvas=document.createElement('canvas');canvas.width=this.fontImage.width;canvas.height=this.fontImage.height;var cc=canvas.getContext('2d');cc.fillStyle=this.color;cc.fillRect(0,0,canvas.width,canvas.height);cc.globalCompositeOperation='destination-in';cc.drawImage(this.fontImage,0,0);this.fontImage=canvas;}},createTextLabel:function(text,align){var textW=this.getTextWidth(text);var textH=this.getFontHeight();var canvas=document.createElement('canvas');canvas.width=textW;canvas.height=textH;var cc=canvas.getContext('2d');if(typeof(text)!='string'){text=text.toString();}
if(this.alpha!=null&&this.alpha!==1){cc.globalAlpha=this.alpha;}
var numChars=text.length;var lastWhiteSpace=-1;var lastCharId=-1;var currentX=0;var currentY=0;var charLocations=[];var charId;var charLocation;var charDesc=null;var xOffset=0;for(var i=0;i<numChars;++i){charId=text.charCodeAt(i);charDesc=this.fontDescriptor.chars[charId];if(charDesc==null){console.log('No font image for character: code = '+charId+' char = <'+String.fromCharCode(charId)+'> in text: <'+text+'>');continue;}
if(charId===this.CHAR_SPACE||this.charId===this.CHAR_TAB){currentX+=charDesc.xadvance;continue;}
charLocation={charId:charId,dx:currentX+charDesc.xoffset,dy:currentY+charDesc.yoffset,sx:charDesc.x,sy:charDesc.y,w:charDesc.width,h:charDesc.height};currentX+=charDesc.xadvance;charLocations.push(charLocation);}
if(align===ig.Font.ALIGN.RIGHT||align===ig.Font.ALIGN.CENTER){var width=currentX;xOffset-=(align===ig.Font.ALIGN.CENTER)?width/2:width;}
numChars=charLocations.length;for(i=0;i<numChars;++i){charLocation=charLocations[i];cc.drawImage(this.fontImage,charLocation.sx,charLocation.sy,charLocation.w,charLocation.h,ig.system.getDrawPos(charLocation.dx),ig.system.getDrawPos(charLocation.dy),charLocation.w,charLocation.h);}
if(this.alpha!=null&&this.alpha!=1){cc.globalAlpha=1;}
ig.Image.drawCount+=1;var textAsImage=new ig.Image(null,{imageData:canvas});return new ArkTextLabel(text,textAsImage,xOffset,-this.fontDescriptor.base);},getTextWidth:function(text){if(typeof(text)!='string'){text=text.toString();}
var numChars=text.length;var currentX=0;var charId;var charDesc=null;for(var i=0;i<numChars;++i){charId=text.charCodeAt(i);charDesc=this.fontDescriptor.chars[charId];if(charDesc==null){continue;}
currentX+=charDesc.xadvance;}
return currentX;},getFontHeight:function(){return this.fontDescriptor.base;},drawText:function(text,x,y,params){return this.draw(text,x,y,params?params.align:ig.Font.ALIGN.LEFT);},draw:function(text,x,y,align){y-=this.fontDescriptor.base;if(typeof(text)!='string'){text=text.toString();}
if(this.alpha!=null&&this.alpha!==1){this.targetCanvasContext.globalAlpha=this.alpha;}
var numChars=text.length;var lastWhiteSpace=-1;var lastCharId=-1;var currentX=0;var currentY=0;var charLocations=[];var charId;var charLocation;var charDesc=null;for(var i=0;i<numChars;++i){charId=text.charCodeAt(i);charDesc=this.fontDescriptor.chars[charId];if(charDesc==null){console.log('No font image for character: code = '+charId+' char = <'+String.fromCharCode(charId)+'> in text: <'+text+'>');continue;}
if(charId===this.CHAR_SPACE||this.charId===this.CHAR_TAB){currentX+=charDesc.xadvance;continue;}
charLocation={charId:charId,dx:currentX+charDesc.xoffset,dy:currentY+charDesc.yoffset,sx:charDesc.x,sy:charDesc.y,w:charDesc.width,h:charDesc.height};currentX+=charDesc.xadvance;charLocations.push(charLocation);}
if(align===ig.Font.ALIGN.RIGHT||align===ig.Font.ALIGN.CENTER){var width=currentX;x-=(align===ig.Font.ALIGN.CENTER)?width/2:width;}
numChars=charLocations.length;for(i=0;i<numChars;++i){charLocation=charLocations[i];this.targetCanvasContext.drawImage(this.fontImage,charLocation.sx,charLocation.sy,charLocation.w,charLocation.h,ig.system.getDrawPos(x+charLocation.dx),ig.system.getDrawPos(y+charLocation.dy),charLocation.w,charLocation.h);}
if(this.alpha!=null&&this.alpha!=1){this.targetCanvasContext.globalAlpha=1;}
ig.Image.drawCount+=text.length;}});});

// lib/plugins/ark-fonts-system.js
ig.baked=true;ig.module('plugins.ark-fonts-system').requires('plugins.ark-font').defines(function(){ArkSystemFont=ArkFont.extend({targetCanvasContext:null,outlineWidth:0,outlineStyle:null,shadowX:0,shadowY:0,shadowBlur:-1,shadowColor:'#000000',color:null,init:function(params){this.parent(params);this.setParams(params);},setParams:function(params){if(params.color){this.color=params.color;}
if(params.outlineWidth){this.outlineWidth=params.outlineWidth;}
if(params.outlineStyle){this.outlineStyle=params.outlineStyle;}
if(params.shadowBlur){this.shadowBlur=params.shadowBlur;if(params.shadowX){this.shadowX=params.shadowX;}
if(params.shadowY){this.shadowY=params.shadowY;}
if(params.shadowColor){this.shadowColor=params.shadowColor;}}},getTextWidth:function(text,params){this.targetCanvasContext.save();if(this.scaleFactor>0){this.targetCanvasContext.scale=this.scaleFactor;}
this.targetCanvasContext.font=this.fontSize+this.fontSizeUnit+' '+this.fontName;if(this.shadowBlur>=0){this.targetCanvasContext.shadowBlur=this.shadowBlur;this.targetCanvasContext.shadowColor=this.shadowColor;this.targetCanvasContext.shadowOffsetX=this.shadowX;this.targetCanvasContext.shadowOffsetY=this.shadowY;}
if(this.color!=null){this.targetCanvasContext.fillStyle=this.color;}
if(this.outlineWidth>0&&this.outlineStyle!=null){this.targetCanvasContext.lineWidth=this.outlineWidth;this.targetCanvasContext.strokeStyle=this.outlineStyle;}
var w=this.targetCanvasContext.measureText(text).width;this.targetCanvasContext.restore();return w;},getFontHeight:function(params){this.targetCanvasContext.save();if(this.scaleFactor>0){this.targetCanvasContext.scale=this.scaleFactor;}
this.targetCanvasContext.font=this.fontSize+this.fontSizeUnit+' '+this.fontName;if(this.shadowBlur>=0){this.targetCanvasContext.shadowBlur=this.shadowBlur;this.targetCanvasContext.shadowColor=this.shadowColor;this.targetCanvasContext.shadowOffsetX=this.shadowX;this.targetCanvasContext.shadowOffsetY=this.shadowY;}
this.targetCanvasContext.textBaseline='alphabetic';this.targetCanvasContext.textAlign=(params&&params.align?params.align:this.align);if(this.color!=null){this.targetCanvasContext.fillStyle=this.color;}
if(this.outlineWidth>0&&this.outlineStyle!=null){this.targetCanvasContext.lineWidth=this.outlineWidth;this.targetCanvasContext.strokeStyle=this.outlineStyle;}
var fs=this.targetCanvasContext.font;var pixelSize=fs.substr(0,fs.indexOf('px'));var h=new Number(pixelSize).valueOf();this.targetCanvasContext.restore();return h;},drawText:function(text,x,y,params){this.targetCanvasContext.save();if(this.scaleFactor>0){this.targetCanvasContext.scale=this.scaleFactor;}
this.targetCanvasContext.font=this.fontSize+this.fontSizeUnit+' '+this.fontName;if(this.shadowBlur>=0){this.targetCanvasContext.shadowBlur=this.shadowBlur;this.targetCanvasContext.shadowColor=this.shadowColor;this.targetCanvasContext.shadowOffsetX=this.shadowX;this.targetCanvasContext.shadowOffsetY=this.shadowY;}
this.targetCanvasContext.textBaseline='alphabetic';this.targetCanvasContext.textAlign=(params&&params.align?params.align:this.align);if(this.color!=null){this.targetCanvasContext.fillStyle=this.color;this.targetCanvasContext.fillText(text,x,y);}
if(this.outlineWidth>0&&this.outlineStyle!=null){this.targetCanvasContext.lineWidth=this.outlineWidth;this.targetCanvasContext.strokeStyle=this.outlineStyle;this.targetCanvasContext.strokeText(text,x,y);}
this.targetCanvasContext.restore();},createTextLabel:function(text){return this.parent(text);}});});

// lib/plugins/ark-fonts.js
ig.baked=true;ig.module('plugins.ark-fonts').requires('plugins.ark-loader','plugins.ark-fonts-impact-bitmap','plugins.ark-fonts-fnt-bitmap','plugins.ark-fonts-system').defines(function(){ArkFontManager=ig.Class.extend({registeredBitmapFontData:{},bitmapFonts:{},systemFonts:{},init:function(){ArkFontManager.instance=this;},staticInstantiate:function(){return(ArkFontManager.instance?ArkFontManager.instance:null);},registerFont:function(fontType,fontData){if(fontType==='bitmap-impact'){fontData.resourceType='font';var fontFamilyKeyName=fontType+'-'+fontData.fontName;var fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName];if(fontFamilyData==null){fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName]=[];}
fontFamilyData.push(fontData);new ArkLoader().addResources(fontData);}else if(fontType==='bitmap-fnt'){fontData.resourceType='font';var fontFamilyKeyName=fontType+'-'+fontData.fontName;var fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName];if(fontFamilyData==null){fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName]=[];}
fontFamilyData.push(fontData);new ArkLoader().addResources(fontData);new ArkLoader().addResources({id:fontData.fontDescriptorSrc,src:fontData.fontDescriptorSrc,resourceType:'font'});}},requireFont:function(fontId,fontType,fontName,fontSize,optionalParams){var fontProperties={fontName:fontName,fontSize:fontSize};if(typeof(optionalParams)==='object'){ig.merge(fontProperties,optionalParams);}
if(fontType==='system'){this.systemFonts[fontId]=new ArkSystemFont(fontProperties);}else if(fontType==='bitmap-impact'){var fontFamilyKeyName=fontType+'-'+fontName;var fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName];if(fontFamilyData==null){console.err('No such registered font: '+fontName+', exiting.');return;}
var lowBoundIndex=0;var exactSizeMatch=false;for(var i=0;i<fontFamilyData.length;++i){if(fontFamilyData[i].fontSize<fontSize){lowBoundIndex=i;}else if(fontFamilyData[i].fontSize===fontSize){ig.merge(fontProperties,fontFamilyData[i]);this.bitmapFonts[fontId]=new ArkImpactBitmapFont(fontProperties);}}}else if(fontType==='bitmap-fnt'){var fontFamilyKeyName=fontType+'-'+fontName;var fontFamilyData=this.registeredBitmapFontData[fontFamilyKeyName];if(fontFamilyData==null){console.err('No such registered font: '+fontName+', exiting.');return;}
var lowBoundIndex=0;var exactSizeMatch=false;for(var i=0;i<fontFamilyData.length;++i){if(fontFamilyData[i].fontSize<fontSize){lowBoundIndex=i;}else if(fontFamilyData[i].fontSize===fontSize){ig.merge(fontProperties,fontFamilyData[i]);this.bitmapFonts[fontId]=new ArkFntBitmapFont(fontProperties);}}}},getFont:function(fontId){var i;for(i in this.bitmapFonts){if(this.bitmapFonts.hasOwnProperty(i)){if(i===fontId){return this.bitmapFonts[i];}}}
for(i in this.systemFonts){if(this.systemFonts.hasOwnProperty(i)){if(i===fontId){return this.systemFonts[i];}}}
return null;}});});

// lib/game/mjd-loader.js
ig.baked=true;ig.module('game.mjd-loader').requires('plugins.ark-impact-loader','plugins.ark-loader','plugins.ark-fonts').defines(function(){var popup_quit_bg=new ig.Image('popup_quit_bg',{src:'popup_quit_bg.png',highPriority:true});var popup_quit_btn=new ig.Image('popup_quit_btn',{src:'popup_quit_btn.png',highPriority:true});var backgroundImg=new ig.Image('bg',{src:'bg.jpg',highPriority:true});ArkGameLoader=ArkImpactLoader.extend({preloaderImage:new ig.Image("preloader",{src:"preloader.png",hd:true,highPriority:true}),preloaderX:0,preloaderY:0,spinnerRemoved:false,bgCanvas:null,bgCanvasEl:null,bgCanvasCtx:null,bgDrawParams:null,localizedText:{'en-US':{'no_internet_connection.error.message1':'CAN NOT LOAD NEXT STAGE,','no_internet_connection.error.message2':'PLEASE CHECK YOUR INTERNET CONNECTION','no_internet_connection.retry.button':'RETRY'},'de-DE':{'no_internet_connection.error.message1':'NCHSTE STUFE KONNTE NICHT GELADEN WERDEN.','no_internet_connection.error.message2':'BITTE BERPRFE DEINE INTERNETVERBINDUNG','no_internet_connection.retry.button':'NOCHMAL'},'fr-FR':{'no_internet_connection.error.message1':'IMPOSSIBLE DE CHARGER LE NIVEAU SUIVANT,','no_internet_connection.error.message2':'VEUILLEZ VRIFIER VOTRE CONNEXION INTERNET','no_internet_connection.retry.button':'RESSAYER'},'it-IT':{'no_internet_connection.error.message1':'IMPOSSIBILE CARICARE IL LIVELLO SUCCESSIVO,','no_internet_connection.error.message2':'VERIFICA LA TUA CONNESSIONE INTERNET','no_internet_connection.retry.button':'RIPROVA'},'es-ES':{'no_internet_connection.error.message1':'NO SE PUEDE CARGAR LA SIGUIENTE FASE.','no_internet_connection.error.message2':'COMPRUEBA TU CONEXIN A INTERNET.','no_internet_connection.retry.button':'VOLVER A INTENTAR'}},init:function(gameClass,resources){this.parent(gameClass,resources);ig.game={delta:0,_delta:0};this.ARK_CUI_popupNoIntenet(this.retryHandler.bind(this));this.injectCSS();this.bgCanvas=ARK_gameJQ('#bgCanvas');},injectCSS:function(){var loadWebFontsCSS="<style>@font-face { font-family: 'AgencyFBBoldFont';"
+"src: url('assets/fonts/agencyb.eot'); "
+"src: url('assets/fonts/agencyb.eot?#iefix') format('embedded-opentype'),"
+"url('assets/fonts/agencyb.woff') format('woff'),"
+"url('assets/fonts/agencyb.ttf') format('truetype');"
+"font-weight: bold; font-style: normal; } </style>'";ARK_gameJQ('html > head').append(loadWebFontsCSS);},ARK_CUI_popupNoIntenet:function(retryHandler){new ArkFontManager().requireFont('NoInternetConnectionFont','system','Arial',44,{color:'#ffffff'});var currentLocale=LocalizationManager.getActualLocale();var localizedBundle=this.localizedText[currentLocale];if(localizedBundle==null){localizedBundle=this.localizedText['en-US'];}
var popup_noInternet_bg={image:new ig.Image('popup_quit_bg',{src:'popup_quit_bg.png',highPriority:true}),name:'popup_noInternet_bg',top:'50%',left:'50%',width:851,height:383,pivot:{h:'50%',v:'50%'}};var popup_noInternet_btn={image:new ig.Image('popup_quit_btn',{src:'popup_quit_btn.png',highPriority:true}),name:'popup_noInternet_btn',top:266,left:'50%',width:212,height:83,pivot:{h:'50%',v:'50%'},state:{'normal':0,'over':1,'down':1},click:function(){if(typeof(retryHandler)==='function'){setTimeout(retryHandler,20);}},scale:{x:currentLocale==='es-ES'?1.8:1.1,y:1},over:function(){},out:function(){},up:function(){}};var text1={name:'popup_noInternet_text1',text:localizedBundle['no_internet_connection.error.message1'],font:new ArkFontManager().getFont('NoInternetConnectionFont'),top:125,left:'50%',scale:0.74,align:ig.Font.ALIGN.CENTER};var text2={name:'popup_noInternet_text2',text:localizedBundle['no_internet_connection.error.message2'],font:new ArkFontManager().getFont('NoInternetConnectionFont'),top:175,left:'50%',scale:0.74,align:ig.Font.ALIGN.CENTER};var popup_noInternet_btn_text={name:'popup_noInternet_btn_text',text:localizedBundle['no_internet_connection.retry.button'],font:new ArkFontManager().getFont('NoInternetConnectionFont'),top:280,left:'50%',scale:0.74,align:ig.Font.ALIGN.CENTER};var popup_cont={container:[popup_noInternet_bg,text1,text2,popup_noInternet_btn,popup_noInternet_btn_text],name:'popup_noInternet',top:'50%',left:'50%',width:851,height:383,pivot:{h:'50%',v:'50%'},scale:0.8};ig.modules['plugins.ark-ui'].body().addItem(popup_cont);ig.modules['plugins.ark-ui'].body().hide('popup_noInternet');function popup_noInternet_resize(info){var scale={x:info.scale,y:info.scale}
ig.modules['plugins.ark-ui'].body()._findItem('popup_noInternet').scale=scale;ig.modules['plugins.ark-ui'].body().resize();}
var resize=new ARK_onResize({gameWidth:900/ig.ua.pixelRatio,gameHeight:680/ig.ua.pixelRatio,maxScale:2,callback:popup_noInternet_resize,forcedPixelRatio:ig.ua.pixelRatio})},showLoadingErrorScreen:function(){ig.modules['plugins.ark-ui'].body().show('popup_noInternet');},retryHandler:function(){console.log('retryHandler');ig.modules['plugins.ark-ui'].body().hide('popup_noInternet');this.retryLoad(true);},removeSpinner:function(){this.bgCanvas.css({'background-image':'url(assets/images/bg.jpg)','background-size':'cover'});ARK_gameJQ('#loadspinner').css('visibility','hidden').remove();this.spinnerRemoved=true;},draw:function(){if(ig.game._delta==undefined){ig.game._delta=new Date().getTime();}
var curTime=new Date().getTime();ig.game.delta=(curTime-ig.game._delta)/1000;ig.game._delta=curTime;if(backgroundImg.loaded&&this.preloaderImage.loaded&&this.spinnerRemoved===false){this.removeSpinner();}
if(!this.spinnerRemoved){return;}
ig.system.context.clearRect(0,0,ig.system.width,ig.system.height);this.preloaderX=Math.round((ig.system.width-this.preloaderImage.width)/2);this.preloaderY=Math.round((ig.system.height-this.preloaderImage.height)/2);var loadedProgressWidth=Math.round(this.preloaderImage.width*this._progress);ig.system.context.globalAlpha=0.4;this.preloaderImage.draw(this.preloaderX,this.preloaderY,0,0,this.preloaderImage.width,this.preloaderImage.height);ig.system.context.globalAlpha=1;this.preloaderImage.draw(this.preloaderX,this.preloaderY,0,0,loadedProgressWidth,this.preloaderImage.height);if(this.progressPhase==='LOAD_RESORUCES'){ig.modules['plugins.ark-ui'].body().update();ig.modules['plugins.ark-ui'].body().draw();ig.input.clearPressed();}}});});

// lib/game/ark-game-boot.js
ig.baked=true;ig.module('game.ark-game-boot').defines(function(){ig.globalInit=function(){ARK_gameJQ('#loadspinner').css('visibility','hidden');startPreloadAnimation(true,function(){ARK_gameJQ('#loadspinner').css('visibility','visible');var versionContent=ARK_gameJQ('#gameVersion > div > span:last-child');if(versionContent.length>0&&versionContent[0].textContent&&versionContent[0].textContent.indexOf('@')>=0){ARK_gameJQ('#gameVersion').hide();}
var onResize=function(info){var domSize={width:info.width+'px',height:info.height+'px'};var canvasSize={width:info.width*ig.ua.pixelRatio,height:info.height*ig.ua.pixelRatio};if(navigator.userAgent.match(/CPU OS 6/i)&&canvasSize.width==2048){canvasSize.width=2046;}
ARK_gameJQ('#bgCanvas').css(domSize).attr(canvasSize);ARK_gameJQ('.ARK_gameContainer').css(domSize);ARK_gameJQ('#gameCanvas').css(domSize);if(ig.system&&ig.system.resize){ig.system.resize(canvasSize.width,canvasSize.height,1);}
if(ig.game&&ig.game.initialized){var scale=ig.game.inputScale;var touchSize={width:(info.width*ig.ua.pixelRatio)*scale,height:(info.height*ig.ua.pixelRatio)*scale};ARK_gameJQ('#touchCanvas').attr(touchSize);ig.game.onResize();}
if(ig.game&&ig.modules['plugins.ark-ui']){ig.modules['plugins.ark-ui'].body().resize();}
if(!isFirefoxBrowser()&&!isChromeBrowser()&&isAndroid()&&!navigator.userAgent.match(/(Chrome)/i)){ARK_gameJQ('canvas').css({'opacity':0.0001});}
if(ig.system&&ig.system.delegate!=null){ig.system.run();}};var runGame=function(locale){if(!locale)
{return}
ig.modules['plugins.ark-ui'].body().init();ig.startGame(ArkGame,ArkGameLoader);};var width=ig.ua.viewport.width*ig.ua.pixelRatio;if(navigator.userAgent.match(/CPU OS 6/i)&&width===2048){width=2046;}
ig.startEngine('#gameCanvas',30,width,ig.ua.viewport.height*ig.ua.pixelRatio,1);ig.system.resizeManager=new ARK_onResize({callback:onResize,forcedPixelRatio:ig.ua.pixelRatio});ig.system.drawMode=ig.System.DRAW.SUBPIXEL;ig.system.scaleMode=ig.System.SCALE.SMOOTH;ARK_game_arena_connector.init();LocalizationManager.init({locale:ARK_game_arena_connector.getParam('locale','en-US'),localeChangedCallback:runGame});});};});

// lib/plugins/ark-anytween.js
ig.baked=true;ig.module('plugins.ark-anytween').defines(function(){ArkTweenAnimationManager=ig.Class.extend({pause:false,init:function(){ArkTweenAnimationManager.instance=this;this.pause=false;},staticInstantiate:function(){return(ArkTweenAnimationManager.instance?ArkTweenAnimationManager.instance:null);},setPause:function(pause){this.pause=pause;},getPause:function(){return this.pause;},update:function(){createjs.Tween.tick(Math.round(ig.system.tick*1000),this.pause);}});});

// lib/plugins/ark-eventbus.js
ig.baked=true;ig.module('plugins.ark-eventbus').defines(function(){ARK_eventbus=new cobu.EventBus();});

// lib/plugins/primitives.js
ig.baked=true;ig.module('plugins.primitives').requires('impact.system').defines(function(){ig.System.inject({fillRect:function(x,y,width,height,color,opacity){opacity=opacity!=undefined?opacity:1;if(opacity!=0){this.context.globalAlpha=opacity;this.context.beginPath();this.context.fillStyle=color;this.context.rect(x,y,width,height);this.context.fill();this.context.globalAlpha=1;}},drawLine:function(x1,y1,x2,y2,color,lineWidth,dash){this.context.beginPath();if(lineWidth){this.context.lineWidth=lineWidth;}
if(dash){this.context.setLineDash(dash);}
this.context.strokeStyle=color;this.context.moveTo(x1,y1);this.context.lineTo(x2,y2);this.context.stroke();}});});

// lib/plugins/ark-ui.js
ig.baked=true;ig.module('plugins.ark-ui').requires('plugins.primitives').defines(function(){var ARK_ui=this;ARK_ui.init=function(){ARK_ui._itemList=new Array();ARK_ui._containerList=[{name:'root',alpha:1,top:0,left:0,scale:{x:1,y:1},width:ig.system.width,height:ig.system.height}];ARK_ui.jq=ARK_gameJQ?ARK_gameJQ:$;ARK_ui.tree=new Array();ig.input.initMouse();ig.input.bind(ig.KEY.MOUSE1,'click');ARK_ui.deviceDrawMethod=hasTouchScreen()?ARK_ui.drawOnTouch:ARK_ui.drawWithMouse;};ARK_ui.update=function(){var objectFound=false;ARK_ui._containerList.forEach(function(obj,id){obj.alpha==undefined?obj.alpha=1:false;obj.fade==undefined?obj.fade=0:false;if(ig.game.delta){obj.alpha+=(obj.fade*ig.game.delta);}
obj.alpha>=1||obj.alpha<=0?obj.fade=0:false;obj.alpha>=1?obj.alpha=1:false;obj.alpha<=0?obj.alpha=0:false;})
ARK_ui.jq.each(ARK_ui._itemList.reverse(),function(index,value){if(value.fadeValue!=undefined){if(value.fadeValue=='in'){value.fadeIn()}
if(value.fadeValue=='out'){value.fadeOut();}}
value._mouseOn=false;if(!value.visible){return};if(!objectFound){ARK_ui._mouseOnObject(value);};if(value._mouseOn){objectFound=true;};if(typeof(value.update)=='function'){value.update();};});};ARK_ui.drawOnTouch=function(index,value){if(!value||!value.visible){return;};if(ig.input.pressed('click')&&value._mouseOn){value.mouseState='down';if(value.click!=null){if(ig.game==null||(ig.game!=null&&(ig.game.currentStateName==='game_play'&&ig.game.cubeApear===0||ig.game.currentStateName!=='game_play'))){value.click();}}}else if(ig.input.state('click')&&value.mouseState==='down'){value.mouseState='over';if(value.over!=null){value.over();}}else if((value.mouseState==='down'||value.mouseState==='over')&&!ig.input.state('click')){value.mouseState='normal';if(value.up!=null){value.up();}}
value.draw(value.mouseState);};ARK_ui.drawWithMouse=function(index,value){if(!value||!value.visible){return;};if(ig.input.pressed('click')){console.log(value.name+' = '+value._mouseOn);}
if(ig.input.pressed('click')&&value._mouseOn){value.mouseState='down';if(value.click!=null){if(ig.game==null||(ig.game!=null&&(ig.game.currentStateName==='game_play'&&ig.game.cubeApear===0||ig.game.currentStateName!=='game_play'))){value.click();}}}else if(!ig.input.state('click')&&value.mouseState!=='down'&&value._mouseOn){value.mouseState='over';if(value.over!=null){value.over();}}else if(value.mouseState==='over'&&!value._mouseOn){value.mouseState='normal';}else if(value.mouseState==='down'&&!ig.input.state('click')){value.mouseState='normal';if(value.up!=null){value.up();}}
value.draw(value.mouseState);};ARK_ui.draw=function(){ARK_ui.jq.each(ARK_ui._itemList.reverse(),ARK_ui.deviceDrawMethod);};ARK_ui.addItem=function(object){var objectType=['image','animation','text','color','container','staticText'];ARK_ui.jq.each(objectType,function(index,value){if(object[value]!=undefined){object.type=objectType=value;return false;}else if(index==objectType.length-1){console.log('specify object type');};});object.right==undefined&&object.left==undefined?object.left=0:false;object.bottom==undefined&&object.top==undefined?object.top=0:false;object.pivot==undefined?object.pivot={h:0,v:0}:false;object.visible==undefined?object.visible=true:false;object.mouseState='normal';object.location==undefined?object.location='root':false;object.name==undefined?object.name='ID'+new Date().getTime():false;object.scale==undefined?object.scale={x:1,y:1}:(typeof object.scale=="number"?object.scale={x:object.scale,y:object.scale}:false);object.alpha==undefined?object.alpha=1:false;object.hitArea===undefined?object.hitArea='full':false;object.hitAreaOffsets===undefined?object.hitAreaOffsets=[0,0,0,0]:false;object.parent===undefined?object.parent=ARK_ui._containerList[0]:false;ARK_ui.jq.each([object.width,object.height,object.top,object.right,object.bottom,object.left,object.pivot.h,object.pivot.v],function(index,value){if(typeof(value)=='string'&&value.indexOf('%')==-1){value=parseFloat(value);};});if(object.fadeValue!=undefined){if(object.fadeValue=='in'){object.alpha=0;}else if(object.fadeValue=='out'){object.alpha=1;}
object.fadeTimer=new ig.Timer(object.fadeTime?object.fadeTime:1);object.fadeIn=function(){if(object.fadeTimer.delta()<=0){object.alpha=1+(object.fadeTimer.delta()/object.fadeTime);}else{object.fadeValue='stop';}};object.fadeOut=function(){if(object.fadeTimer.delta()<=0){object.alpha=0-(object.fadeTimer.delta()/object.fadeTime);}else{object.fadeValue='stop';}};}
object.srcParam=new Object();ARK_ui.jq.each(['width','height','top','right','bottom','left','h','v'],function(index,value){if(typeof(object[value])=='string'&&object[value].indexOf('%')!=-1){object.srcParam[value]=object[value];};if(typeof(object.pivot[value])=='string'&&object.pivot[value].indexOf('%')!=-1){object.srcParam[value]=object.pivot[value];};});object.srcPos=[object.top,object.right,object.bottom,object.left];if(objectType!='container'){object=ARK_ui._percentToPixel(object,ig.system.width,ig.system.height);}
switch(object.type){case'image':object.width==undefined||object.width=='full'?object.width=object.image.width:false;object.height==undefined||object.height=='full'?object.height=object.image.height:false;object.state==undefined?object.state={'normal':0,'over':0,'down':0}:false;if(object.width<=0){object.width=1;}
if(object.height<=0){object.height=1;}
object.scaleOrigin==undefined?object.scaleOrigin={x:(object.right==undefined?object.left-object.pivot.h:ig.system.width-object.right-(object.width-object.pivot.h))+object.width/2,y:(object.bottom==undefined?object.top-object.pivot.v:ig.system.height-object.bottom-(object.height-object.pivot.v))+object.height/2}:false;object.draw=function(state){var alpha=object.alpha*object.parent.alpha;if(alpha!==1){ig.system.context.globalAlpha=alpha;}
if(object.scale.x<0){console.log(object.name)}
var dX=0;var dY=0;var absoluteScaleX=object.scale.x*object.parent.scale.x
var absoluteScaleY=object.scale.y*object.parent.scale.y
if(object.right==undefined)
{dX=object.left-(object.pivot.h*(absoluteScaleX))}
else
{dX=ig.system.width-object.right-((object.width*absoluteScaleX)-(object.pivot.h*absoluteScaleX))}
if(object.bottom==undefined)
{dY=object.top-(object.pivot.v*absoluteScaleY)}else
{dY=ig.system.height-object.bottom-((object.height*absoluteScaleY)-(object.pivot.v*absoluteScaleY))}
object.image.drawTile(dX,dY,object.state[state],Math.max(object.width,0),Math.max(object.height,0),absoluteScaleX,absoluteScaleY);if(alpha!==1){ig.system.context.globalAlpha=1;}};break;case'animation':object.width==undefined||object.width=='full'?object.width=object.animation.width:false;object.height==undefined||object.height=='full'?object.height=object.animation.height:false;if(object.width<=0){object.width=1;}
if(object.height<=0){object.height=1;}
if(object.state==undefined){;console.log('animation must have .state');return}
var srcAnim=object.animation;object.animation=new Object();ARK_ui.jq.each(object.state,function(indexS,valueS){if(typeof(valueS.frame)=='string'){var stateArr=valueS.frame.split('-');var output=new Array();ARK_ui.jq.each(stateArr,function(indexV,valueV){if(indexV==0){return};var min=parseInt(stateArr[indexV-1]);var max=parseInt(stateArr[indexV]);if(min<max){for(var i=min;i<=max;i++){if(i!=output[output.length-1]){output.push(i);};};}else{for(var i=min;i>=max;i--){if(i!=output[output.length-1]){output.push(i);};};};});object.state[indexS].frame=output;};object.animation[indexS]=new ig.Animation(srcAnim,valueS.speed,object.state[indexS].frame);});object.draw=function(state){object.animation[state].draw(object.right==undefined?object.left-object.pivot.h:ig.system.width-object.right-(object.width-object.pivot.h),object.bottom==undefined?object.top-object.pivot.v:ig.system.height-object.bottom-(object.height-object.pivot.v));};object.update=function(){ARK_ui.jq.each(object.animation,function(index,value){value.update();});};break;case'text':if(object.width<=0||object.width==undefined){object.width=object.font.getTextWidth(object.text);}
if(object.height<=0||object.height==undefined){object.height=object.font.getFontHeight();}
object.draw=function(){if(object.font){var alpha=object.alpha*object.parent.alpha;if(alpha!==1){ig.system.context.globalAlpha=alpha;}
var posX=object.right==undefined?object.left-(object.pivot.h*object.parent.scale.x):ig.system.width-object.right-(object.width-(object.pivot.h*object.parent.scale.x))+(object.width*(1-object.parent.scale.x))
var posY=object.bottom==undefined?object.top-(object.pivot.v*object.parent.scale.y):ig.system.height-object.bottom-(object.height-(object.pivot.v*object.parent.scale.y))+(object.height*(1-object.parent.scale.y))
var absoluteScaleX=object.scale.x*object.parent.scale.x;var absoluteScaleY=object.scale.y*object.parent.scale.y;ig.system.context.save();ig.system.context.translate(posX-(posX*absoluteScaleX),posY-(posY*absoluteScaleY));ig.system.context.scale(absoluteScaleX,absoluteScaleY);object.font.drawText(object.text==undefined?"":object.text,posX,posY,{align:object.align==undefined?ig.Font.ALIGN.LEFT:object.align});ig.system.context.restore();if(alpha!==1){ig.system.context.globalAlpha=1;}}};break;case'staticText':if(object.width<=0||object.width==undefined){object.width=object.font.getTextWidth(object.staticText);}
if(object.height<=0||object.height==undefined){object.height=object.font.getFontHeight();}
object.textLabel=object.font.createTextLabel(object.staticText==undefined?"":object.staticText,object.align==undefined?ig.Font.ALIGN.LEFT:object.align);object.draw=function(){if(object.font){var alpha=object.alpha*object.parent.alpha;if(alpha!==1){ig.system.context.globalAlpha=alpha;}
var posX=object.right==undefined?object.left-(object.pivot.h*object.parent.scale.x):ig.system.width-object.right-(object.width-(object.pivot.h*object.parent.scale.x))+(object.width*(1-object.parent.scale.x))
var posY=object.bottom==undefined?object.top-(object.pivot.v*object.parent.scale.y):ig.system.height-object.bottom-(object.height-(object.pivot.v*object.parent.scale.y))+(object.height*(1-object.parent.scale.y))
var absoluteScaleX=object.scale.x*object.parent.scale.x;var absoluteScaleY=object.scale.y*object.parent.scale.y;ig.system.context.save();ig.system.context.translate(posX-(posX*absoluteScaleX),posY-(posY*absoluteScaleY));ig.system.context.scale(absoluteScaleX,absoluteScaleY);object.textLabel.draw(posX,posY);ig.system.context.restore();if(alpha!==1){ig.system.context.globalAlpha=1;}}};break;case'color':if(object.width<=0){object.width=1;}
if(object.height<=0){object.height=1;}
object.scaleOrigin==undefined?object.scaleOrigin={x:(object.right==undefined?object.left-object.pivot.h:ig.system.width-object.right-(object.width-object.pivot.h)),y:(object.bottom==undefined?object.top-object.pivot.v:ig.system.height-object.bottom-(object.height-object.pivot.v))}:false;object.draw=function(){var alpha=object.alpha*object.parent.alpha;if(object.scale.x!=1||object.scale.y!=1){ig.system.context.save();ig.system.context.translate(object.scaleOrigin.x,object.scaleOrigin.y);ig.system.context.scale(object.scale.x,object.scale.y);ig.system.context.translate(-object.scaleOrigin.x,-object.scaleOrigin.y);}
ig.system.fillRect(object.right==undefined?object.left-object.pivot.h:ig.system.width-object.right-(object.width-object.pivot.h),object.bottom==undefined?object.top-object.pivot.v:ig.system.height-object.bottom-(object.height-object.pivot.v),object.width,object.height,object.color,alpha);if(object.scale.x!=1||object.scale.y!=1){ig.system.context.restore();}};break;case'container':ARK_ui._containerList.push(object);ARK_ui.jq.each(object.container,function(index,value){value.scale==undefined?value.scale={x:1,y:1}:(typeof value.scale=="number"?value.scale={x:value.scale,y:value.scale}:false);value.location==undefined?value.location='root':false;value.location=object.location+'.'+object.name;value.parent=object;if(object.fadeValue!=undefined){value.fadeValue=object.fadeValue;value.fadeTime=object.fadeTime;}
ARK_ui.addItem(value);});ARK_ui._updateRelativePosition();return
break;default:return;};ARK_ui._itemList.push(object);ARK_ui.resize();};ARK_ui.updateContainersScale=function(){ARK_ui.jq.each(ARK_ui._containerList,function(indexC,containerObj){if(containerObj&&containerObj.scale!=undefined){ARK_ui.jq.each(containerObj.container,function(index,value){value.scaleOrigin={x:(containerObj.right==undefined?containerObj.left-containerObj.pivot.h:ig.system.width-containerObj.right-(containerObj.width-containerObj.pivot.h))+containerObj.width/2,y:(containerObj.bottom==undefined?containerObj.top-containerObj.pivot.v:ig.system.height-containerObj.bottom-(containerObj.height-containerObj.pivot.v))+containerObj.height/2};});}});};ARK_ui.resize=function(){ARK_ui._containerList[0].width=ig.system.width;ARK_ui._containerList[0].height=ig.system.height;ARK_ui.jq.each([ARK_ui._containerList,ARK_ui._itemList],function(indexL,valueL){ARK_ui.jq.each(valueL,function(index,value){if(value.srcParam!=undefined){ARK_ui.jq.each(['width','height','top','right','bottom','left','h','v'],function(indexS,valueS){if(value.srcParam[valueS]!=undefined){if(valueS=='h'||valueS=='v'){value.pivot[valueS]=value.srcParam[valueS];}else{value[valueS]=value.srcParam[valueS];}}});var parrent=value.location.split('.')[value.location.split('.').length-1];ARK_ui.jq.each(ARK_ui._containerList,function(indexC,valueC){if(valueC.name==parrent){if(value.srcPos!=undefined){ARK_ui.jq.each(['top','right','bottom','left'],function(indexS,valueS){var direction='width'
if(valueS=='top'||valueS=='bottom'){direction='height'}
if(value.srcParam[valueS]!=undefined&&value.srcParam[valueS].indexOf('%')!=-1){value.srcPos[indexS]=valueC[direction]*(parseFloat(value.srcParam[valueS])/100);}});}
value=ARK_ui._percentToPixel(value,valueC.width,valueC.height);}});}});});ARK_ui._updateRelativePosition();}
ARK_ui.show=function(nameList){ARK_ui._showhide(nameList,true);}
ARK_ui.hide=function(nameList){ARK_ui._showhide(nameList,false);}
ARK_ui.fadeIn=function(nameList,fadeTime){ARK_ui._fadeInOut(nameList,"in",fadeTime);}
ARK_ui.fadeOut=function(nameList,fadeTime){ARK_ui._fadeInOut(nameList,"out",fadeTime);}
ARK_ui.remove=function(nameList){nameList=nameList.replace(/ /g,'');nameList=nameList.split(',');ARK_ui.jq.each(nameList,function(indexN,valueN){ARK_ui.jq.each(ARK_ui._itemList,function(indexL,valueL){if(valueN==valueL.name||valueL.location.indexOf(valueN)!=-1){ARK_ui._itemList[indexL]=undefined;}});});ARK_ui._itemList=ARK_ui._clearArray(ARK_ui._itemList);}
ARK_ui._clearArray=function(innerArr){var outArr=new Array();ARK_ui.jq.each(innerArr,function(index,value){if(value!=undefined){outArr.push(value);}});return outArr;}
ARK_ui._percentToPixel=function(object,width,height){ARK_ui.jq.each(['width','height','top','right','bottom','left','h','v'],function(index,value){if(typeof(object[value])=='string'&&object[value].indexOf('%')!=-1){if(value=='height'||value=='top'||value=='bottom'){object[value]=height*(parseFloat(object[value])/100);}
if(value=='width'||value=='left'||value=='right'){object[value]=width*(parseFloat(object[value])/100);}};if(typeof(object.pivot[value])=='string'&&object.pivot[value].indexOf('%')!=-1){object.pivot[value]=(value=='v'?object.height:object.width)*(parseFloat(object.pivot[value])/100);};});return object}
ARK_ui._updateRelativePosition=function(){ARK_ui.jq.each(ARK_ui._itemList,function(indexI,valueI){var rect=[0,0,0,0],width=ig.system.width,height=ig.system.height;ARK_ui.jq.each(valueI.location.split('.'),function(indexL,valueL){if(valueL!='root'){ARK_ui.jq.each(ARK_ui._containerList,function(indexC,valueC){if(valueC.name==valueL){if(valueC.left!=undefined){rect[3]+=valueC.left-valueC.pivot.h;rect[1]+=(width-valueC.width-valueC.left)+valueC.pivot.h;}else{rect[1]+=valueC.right-valueC.pivot.h;rect[3]+=(width-valueC.width-valueC.right)+valueC.pivot.h;}
if(valueC.top!=undefined){rect[0]+=valueC.top-valueC.pivot.v;rect[2]+=(height-valueC.height-valueC.top)+valueC.pivot.v;}else{rect[2]+=valueC.bottom-valueC.pivot.v;rect[0]+=(height-valueC.height-valueC.bottom)+valueC.pivot.v;}
var isX=valueI.srcParam.left!=undefined||valueI.srcParam.right!=undefined?1:valueC.scale.x;var isY=valueI.srcParam.top!=undefined||valueI.srcParam.bottom!=undefined?1:valueC.scale.y;width=ig.system.width-rect[3]-rect[1];height=ig.system.height-rect[0]-rect[2];if(valueI.left!=undefined){valueI.left=rect[3]+(valueI.srcPos[3]*isX)+(valueI.srcParam.left==undefined?(valueC.pivot.h*(1-valueC.scale.x)):0)}else{valueI.right=rect[1]+(valueI.srcPos[1]*isX)+(valueI.srcParam.right==undefined?(valueC.pivot.h*(1-valueC.scale.x)):0)}
if(valueI.top!=undefined){valueI.top=rect[0]+(valueI.srcPos[0]*isY)+(valueI.srcParam.top==undefined?(valueC.pivot.v*(1-valueC.scale.y)):0)}else{valueI.bottom=rect[2]+(valueI.srcPos[2]*isY)+(valueI.srcParam.bottom==undefined?(valueC.pivot.v*(1-valueC.scale.y)):0)}}});}});});}
ARK_ui._fadeInOut=function(arr,fadeValue,fadeTime){arr=arr.replace(/ /g,'');arr=arr.split(',');ARK_ui.jq.each(arr,function(indexN,valueN){ARK_ui.jq.each(ARK_ui._itemList,function(indexL,valueL){if(valueN==valueL.name||valueL.location.indexOf(valueN)!=-1){valueL.fadeValue=fadeValue;valueL.fadeTime=fadeTime||1;if(valueL.fadeValue=='in'){valueL.alpha=0;}else if(valueL.fadeValue=='out'){valueL.alpha=1;}
valueL.fadeTimer=new ig.Timer(valueL.fadeTime);valueL.fadeIn=function(){if(this.fadeTimer.delta()<=0){this.alpha=1+(this.fadeTimer.delta()/this.fadeTime);}else{this.fadeValue='stop';}};valueL.fadeOut=function(){if(this.fadeTimer.delta()<=0){this.alpha=0-(this.fadeTimer.delta()/this.fadeTime);}else{this.fadeValue='stop';}};}});});}
ARK_ui._showhide=function(arr,sh){arr=arr.replace(/ /g,'');arr=arr.split(',');ARK_ui.jq.each(arr,function(indexN,valueN){ARK_ui.jq.each(ARK_ui._itemList,function(indexL,valueL){if(valueN==valueL.name||valueL.location.indexOf(valueN)!=-1){valueL.visible=sh;}});});}
ARK_ui._mouseOnObject=function(object){if((object.type==='text'||object.type==='staticText')&&object.touchable!==true){return;}
var mouseX=ig.input.mouse.x,mouseY=ig.input.mouse.y,xMin=0,yMin=0;var absoluteScaleX=object.scale.x*object.parent.scale.x
var absoluteScaleY=object.scale.y*object.parent.scale.y
if(object.right==undefined)
{xMin=object.left-(object.pivot.h*(absoluteScaleX))}
else
{xMin=ig.system.width-object.right-((object.width*absoluteScaleX)-(object.pivot.h*absoluteScaleX))}
if(object.bottom==undefined)
{yMin=object.top-(object.pivot.v*absoluteScaleY)}else
{yMin=ig.system.height-object.bottom-((object.height*absoluteScaleY)-(object.pivot.v*absoluteScaleY))}
var xMax=(xMin+object.width*absoluteScaleX)+object.hitAreaOffsets[2]*object.parent.scale.x,yMax=(yMin+object.height*absoluteScaleY)+object.hitAreaOffsets[3]*object.parent.scale.y;xMin+=object.hitAreaOffsets[0]*object.parent.scale.x;yMin+=object.hitAreaOffsets[1]*object.parent.scale.y;object._mouseOn=false;if(mouseX>=xMin&&mouseX<=xMax&&mouseY>=yMin&&mouseY<=yMax&&object.hitArea!==null){object._mouseOn=true;};};ARK_ui._findItem=function(name){var item;ARK_ui.jq.each(ARK_ui._itemList,function(index,value){if(name==value.name){item=value;return false;}});ARK_ui.jq.each(ARK_ui._containerList,function(index,value){if(name==value.name){item=value;return false;}});return item;}
return ARK_ui});

// lib/plugins/ark-ui-components.js
ig.baked=true;ig.module('plugins.ark-ui-components').requires('plugins.ark-ui').defines(function(){ArkSlider=ig.Class.extend({x:0,y:0,enabled:true,sliderImage:null,guidelineImage:null,moveCallback:null,guidelineWidth:0,name:null,initialized:false,sliderLogicPosition:1,guidelineSpec:null,sliderSpec:null,init:function(params){this.name=params.name;this.moveCallback=params.moveCallback;this.guidelineWidth=params.guidelineImage.width;this.enabled=params.enabled;if(typeof(params.initialSliderPosition)==='number'){this.sliderLogicPosition=params.initialSliderPosition;}
this.guidelineSpec={image:params.guidelineImage,name:this.name+'-guildeline',top:'50%',left:0,width:params.guidelineImage.width,height:params.guidelineImage.height,pivot:{v:'50%',h:0},state:{'normal':0,'over':0,'down':0},hitAreaOffsets:[-5,-15,5,15],sliderContainer:this,visible:this.enabled,alpha:this.enabled?1:0,click:function(){var correctedPositionX=ig.input.mouse.x;if(correctedPositionX<this.left){correctedPositionX=this.left;}
if(correctedPositionX>this.left+this.width*this.parent.scale.x){correctedPositionX=this.left+this.width*this.parent.scale.x;}
this.sliderContainer.sliderLogicPosition=(correctedPositionX-this.left)/(this.width*this.parent.scale.x);if(this.sliderContainer.moveCallback){this.sliderContainer.moveCallback(this.sliderContainer.sliderLogicPosition);console.log('guideline click: sliderLogicPosition = '+this.sliderContainer.sliderLogicPosition);}}};this.sliderSpec={image:params.sliderImage,name:this.name+'-slider',top:'50%',left:0,width:params.sliderImage.width,height:params.sliderImage.height,state:{'normal':0,'over':0,'down':0},sliderContainer:this,pivot:{v:'50%',h:'50%'},hitAreaOffsets:[-10,-10,10,15],visible:this.enabled,alpha:this.enabled?1:0,up:function(){this.sliderMove=false;},click:function(){this.sliderMove=true;},update:function(){var guildline=ig.modules['plugins.ark-ui'].body()._findItem(this.sliderContainer.name+'-guildeline');if(this.sliderMove===true){this.left=ig.input.mouse.x;if(this.left<guildline.left){this.left=guildline.left;}
if(this.left>guildline.left+guildline.width*this.parent.scale.x){this.left=guildline.left+guildline.width*this.parent.scale.x;}
this.sliderContainer.sliderLogicPosition=(this.left-guildline.left)/(guildline.width*this.parent.scale.x);if(this.sliderContainer.moveCallback){this.sliderContainer.moveCallback(this.sliderContainer.sliderLogicPosition);}}else{this.left=guildline.left+guildline.width*this.parent.scale.x*this.sliderContainer.sliderLogicPosition;}}};},getGuidelineSpec:function(opts){ig.merge(this.guidelineSpec,opts);return this.guidelineSpec;},getSliderSpec:function(opts){ig.merge(this.sliderSpec,opts);return this.sliderSpec;}});});

// lib/plugins/ark-tileimage.js
ig.baked=true;ig.module('plugins.ark-tileimage').requires('impact.image').defines(function(){ArkTileImage=ig.Class.extend({image:null,width:0,height:0,tileIndex:0,tileWidth:0,tileHeight:0,init:function(path,tileIndex,tileWidth,tileHeight){this.image=ig.Image.cache[path];this.width=this.image.width;this.height=this.image.height;this.tileIndex=tileIndex;this.tileWidth=tileWidth;this.tileHeight=tileHeight;},resize:function(scale){this.image.resize(scale);},draw:function(targetX,targetY,sourceX,sourceY,width,height,scaleX,scaleY){this.image.drawTile(targetX,targetY,this.tileIndex,this.tileWidth,this.tileHeight);}});});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','game.mjd-loader','game.ark-game-boot','plugins.ark-fonts','plugins.ark-anytween','plugins.ark-loader','plugins.ark-eventbus','plugins.ark-ui-components','plugins.ark-tileimage','plugins.ark-fonts-fnt-reader').defines(function(){var TILES_COUNT=77;new ArkLoader().addResources([{id:'popup_quit_bg',src:'popup_quit_bg.png',resourceType:'image'},{id:'popup_quit_btn',src:'popup_quit_btn.png',resourceType:'image'}]);for(var i=1;i<TILES_COUNT;i++){new ig.Image('s'+i,{src:'s'+i+'.png',hd:true});}
new ig.Image('slider_guildline',{src:'slider_guildline.png'});new ig.Image('slider_slider',{src:'slider_slider.png'});new ig.Image('bullet',{src:'bullet.png'});new ArkLoader().addResources([{id:'mahjongg_leveldata_0',src:'assets/levels/mahjongg_leveldata_0.xml'},{id:'mahjongg_leveldata_1',src:'assets/levels/mahjongg_leveldata_1.xml'},{id:'mahjongg_leveldata_2',src:'assets/levels/mahjongg_leveldata_2.xml'}],true);new ArkFontManager().registerFont('bitmap-fnt',{src:'agencybold-40.png',fontDescriptorSrc:'agencybold-40.xml',fontName:'AgencyFBBoldFont',fontSize:40});new ArkFontManager().registerFont('bitmap-fnt',{src:'agencybold-60.png',fontDescriptorSrc:'agencybold-60.xml',fontName:'AgencyFBBoldFont',fontSize:60});new ArkFontManager().registerFont('bitmap-fnt',{src:'agencybold-70.png',fontDescriptorSrc:'agencybold-70.xml',fontName:'AgencyFBBoldFont',fontSize:70});new ArkFontManager().registerFont('bitmap-fnt',{src:'agencybold-120.png',fontDescriptorSrc:'agencybold-120.xml',fontName:'AgencyFBBoldFont',fontSize:120});new ArkFontManager().registerFont('bitmap-fnt',{src:'arialbold-22.png',fontDescriptorSrc:'arialbold-22.xml',fontName:'ArialBold',fontSize:22});var fontPrefix='';if(ig.ua.useHD!==true){fontPrefix='sd_';}
new ArkFontManager().registerFont('bitmap-fnt',{src:fontPrefix+'multimatch.png',fontDescriptorSrc:fontPrefix+'multimatch.xml',fontName:'multimatch',fontSize:35});new ArkFontManager().registerFont('bitmap-fnt',{src:fontPrefix+'speedmatch.png',fontDescriptorSrc:fontPrefix+'speedmatch.xml',fontName:'speedmatch',fontSize:35});var soundSprite={url:'assets/sounds/audio-spriteY',map:{'silence':[0,1],'makeAudioWorks':[20.8,0.1],'game_opening_sting':[1.7,5],'click_tile':[8.9,0.5],'level_end':[10.95,2],'out_of_time_sting':[13.96,6],'play_button_press':[20.8,0.3],'reshuffle_1':[22.96,2.5],'rotate':[26.96,0.8],'sfx_multimatch':[29,1.5],'tilematch1':[31.8,2],'tilematch10':[34.85,2.5],'tilematch11':[38.85,2.5],'tilematch12':[42.85,2.5],'tilematch13':[46.85,2.5],'tilematch14':[50.85,2.5],'tilematch15':[53.85,2.5],'tilematch16':[56.85,2.5],'tilematch2':[59.85,2.5],'tilematch3':[63.85,2.5],'tilematch4':[67.85,2.5],'tilematch5':[71.85,2.5],'tilematch6':[75.75,2.5],'tilematch7':[79.85,2.5],'tilematch8':[83.85,2.5],'tilematch9':[87.8,2.5],'correct_sound_1':[91.75,2.5],'correct_sound_2':[95.75,2.5],'correct_sound_3':[99.75,2.5],'error_sound_1':[103.7,1.2],'error_sound_2':[105.7,1.5],'error_sound_3':[108.7,1.2],'timer_warning':[111.7,1.8]}};var musicFileList={'music_loop':'assets/sounds/music_loop'};ARK_game_soundLib=new ARK_soundLib({soundSpriteUrl:soundSprite.url,soundSpriteMap:soundSprite.map,musicList:musicFileList,loadInProgress:function(percent){},loadDone:function(){}});ArkGame=ig.Game.extend({startScreenLogo:new ig.Image('MJD_logo',{src:'MJD_logo.png',hd:true}),uiButtons:new ig.Image('uiButtons',{src:'HD_help_options_quit_sound.png'}),uiRotateArrowL:new ig.Image('uiRotateArrowL',{src:'HD_rotateArrowL.png'}),uiRotateArrowR:new ig.Image('uiRotateArrowR',{src:'HD_rotateArrowR.png'}),help_speedmatch:new ig.Image('help_speedmatch',{src:'help_icon_04.png',localized:true}),help_multimatch:new ig.Image('help_multimatch',{src:'help_icon_05.png',localized:true}),popup_close:new ig.Image('popupClose',{src:'HD_popup_close.png'}),popup_help_bg:new ig.Image('popup_help_bg',{src:'popup_help_bg.png'}),popup_win_bg:new ig.Image('popup_win_bg',{src:'popup_win_bg.png'}),popup_lose_bg:new ig.Image('popup_lose_bg',{src:'popup_lose_bg.png'}),popup_options_bg:new ig.Image('popup_options_bg',{src:'popup_options_bg.png'}),popup_options_bullet:new ig.Image('popup_options_bullet',{src:'bullet.png'}),popup_quit_bg:new ig.Image('popup_quit_bg',{src:'popup_quit_bg.png'}),popup_quit_btn:new ig.Image('popup_quit_btn',{src:'popup_quit_btn.png'}),popup_chrome_btn:new ig.Image('popup_chrome_btn',{src:'popup_chrome_btn.png'}),popup_help_image_1:new ig.Image('popup_help_image_1',{src:'HD_help_1.png'}),popup_help_image_2:new ig.Image('popup_help_image_2',{src:'HD_help_2.png'}),popup_help_image_3:new ig.Image('popup_help_image_3',{src:'HD_help_3.png'}),popup_help_image_4:new ig.Image('popup_help_image_4',{src:'HD_help_4.png'}),popup_help_image_5:new ig.Image('popup_help_image_5',{src:'HD_help_5.png'}),popup_help_image_6:new ig.Image('popup_help_image_6',{src:'HD_help_6.png'}),popup_help_image_7:new ig.Image('popup_help_image_7',{src:'HD_help_7.png'}),popup_help_image_8:new ig.Image('popup_help_image_8',{src:'HD_help_8.png'}),popup_help_lbtn:new ig.Image('popup_help_lbtn',{src:'popup_help_lbtn.png'}),popup_help_rbtn:new ig.Image('popup_help_rbtn',{src:'popup_help_rbtn.png'}),logoWhite:new ig.Image('logoWhite',{src:'logo-white.svg'}),cubeWhite:new ig.Image('cube_white',{src:'cube_white.png',hd:true}),cubeWhiteSelect:new ig.Image('cube_white_select',{src:'cube_white_select.png',hd:true}),cubeDestroy:new ig.AnimationSheet('cube_destroy',119,131,{src:'cube_destroy.png'}),cubeDestroyS:new ig.AnimationSheet('cube_destroyS',119,131,{src:'cube_destroy_small.png'}),playAgainButton:new ig.Image('playAgain',{src:'playAgain.png'}),objectsList:new Array(),degree:0,needDegree:0,time:640,gameInFocus:true,rotateCubeRight:function(){ig.game.needDegree+=90;ig.game.playSound('rotate');ARK_game_arena_connector.fireEventToArena('event_change');},rotateCubeLeft:function(){ig.game.needDegree-=90;ig.game.playSound('rotate');ARK_game_arena_connector.fireEventToArena('event_change');},inputScale:0.5,inputMask:new Object(),cubeApear:0,levelStartX:0,levelStartY:0,reshuffleLeft:0,levelStartXCallibration:0,levelStartYCallibration:0,levelLimit:[0,0,0,0],selectedCube:undefined,absoluteDegree:0,score:0,popupIsOpen:false,currentLevel:0,lastMatchTime:0,speedMatchComboMult:0,multimatchComboMult:0,lastMatchTileName:null,matchScore:100,lastTimerValue:-1,initialized:false,LAST_LEVEL_INDEX:2,CUBE_PROPERTIES:{cube:{image:null,normal:null,select:null,}},CUBE_HD_PROPERTIES:{cube:{info:{0:[0,0,224,224,0,0],15:[224,0,224,224,0,0],30:[448,0,224,224,0,0],45:[672,0,224,224,0,0],60:[896,0,224,224,0,0],75:[1120,0,224,224,0,0]}}},CUBE_SD_PROPERTIES:{cube:{info:{0:[0,0,112,112,0,0],15:[112,0,112,112,0,0],30:[224,0,112,112,0,0],45:[336,0,112,112,0,0],60:[448,0,112,112,0,0],75:[560,0,112,112,0,0]}}},timeWarningTicker:{},levelData:[],turnSoundOff:navigator.userAgent.match(/Windows Phone/i)||navigator.userAgent.match(/(Silk)/i)||(isAndroid()&&!isChromeBrowser()),prerenderedCubeTilesCache:{},scoreBG:new ig.Image('score_bg',{src:'score_bg.png'}),initialSoundOn:true,initializationProgress:0,initPhases:null,initPhaseIndex:0,freeSpeedmatchBonusAnimations:[],freeMultimatchBonusAnimations:[],usedSpeedmatchBonusAnimations:[],usedMultimatchBonusAnimations:[],init:function(){initVersionVisibilityHandling();this.perormanceMultiplayer=navigator.userAgent.match(/Trident/i)?1:ig.ua.performancePixelRatio===ig.ua.pixelRatio?1:2;ARK_game_soundLib.init();this.initialSoundOn=ARK_game_soundLib.soundStatus();console.log('initialSoundOn = '+this.initialSoundOn);this.CUBE_PROPERTIES.cube.image=ig.game.cubeWhite;this.CUBE_PROPERTIES.cube.normal=ig.game.cubeWhite;this.CUBE_PROPERTIES.cube.select=ig.game.cubeWhiteSelect;ig.merge(this.CUBE_PROPERTIES,ig.ua.useHD?this.CUBE_HD_PROPERTIES:this.CUBE_SD_PROPERTIES);arkCubePositionList.degree=ig.ua.useHD?arkCubePositionList.degreeHD:arkCubePositionList.degreeSD;this.soundsEnabled=true;addPageVisibilityListener(this.pageVisibilityHander.bind(this));ARK_gameJQ(document).keydown(function(e){console.log(e);if(ig.game.needDegree==ig.game.degree){if(e.keyCode===65||e.keyCode===37){ig.game.rotateCubeLeft();}
if(e.keyCode===68||e.keyCode===39){ig.game.rotateCubeRight();}}});ARK_eventbus.on("tilesMatch").register(this.onTilesMatch.bind(this));ARK_eventbus.on("deleteCube").register(this.onCubeDelete.bind(this));ig.game.openPopup=function(name){ig.game.popupIsOpen=true;ig.game.openPopupName=name;ig.modules['plugins.ark-ui'].body().show('over');ig.modules['plugins.ark-ui'].body().show(name);ig.modules['plugins.ark-ui'].body()._findItem(name).alpha=0;ig.modules['plugins.ark-ui'].body()._findItem(name).fade=2;ig.modules['plugins.ark-ui'].body()._findItem('over').alpha=0;ig.modules['plugins.ark-ui'].body()._findItem('over').fade=2;};ig.game.closePopup=function(name){if(ig.game.openPopupName===name){ig.game.openPopupName=null;}
ig.game.popupIsOpen=false;ig.modules['plugins.ark-ui'].body()._findItem(name).alpha=1;ig.modules['plugins.ark-ui'].body()._findItem(name).fade=-2;ig.modules['plugins.ark-ui'].body()._findItem('over').alpha=1;ig.modules['plugins.ark-ui'].body()._findItem('over').fade=-2;setTimeout(function(){if(ig.game.popupIsOpen===false){ig.modules['plugins.ark-ui'].body().hide('over');ig.modules['plugins.ark-ui'].body().hide(name);ARK_renderCubesData.renderTouchCanvas=true;}},1100)};this.tweenAnimationManager=new ArkTweenAnimationManager();this.initPhases=[this.createFont1Phase.bind(this),this.createFont2Phase.bind(this),this.createFont3Phase.bind(this),this.createFont4Phase.bind(this),this.createFont5Phase.bind(this),this.createFont6Phase.bind(this),this.createFont7Phase.bind(this),this.createFont8Phase.bind(this),this.createFont9Phase.bind(this),this.createFont10Phase.bind(this),this.createFont11Phase.bind(this),this.createUIPhase.bind(this),this.createLevelPhase.bind(this)];this.touchCanvas=document.getElementById('touchCanvas');this.touchCanvasContext=this.touchCanvas.getContext('2d');ARK_game_arena_connector.registerAction('pause',this.pause.bind(this,false));ARK_game_arena_connector.registerAction('resume',this.unpause.bind(this,false));},startGame:function(){if(ig.game.initialSoundOn){ig.game.playSound('game_opening_sting');}
ig.system.resizeManager.width=0;ig.modules['plugins.ark-ui'].body().hide('uiPlayButton');ig.modules['plugins.ark-ui'].body().hide('uiPlayButtonText');createjs.Tween.removeTweens(ig.game.playButtonAnimationData);ig.modules['plugins.ark-ui'].body().hide('uiMJDLogo');if(ig.system.height<ig.system.width){ig.modules['plugins.ark-ui'].body().show('uiCont');ig.modules['plugins.ark-ui'].body().hide('uiContV');}else{ig.modules['plugins.ark-ui'].body().hide('uiCont');ig.modules['plugins.ark-ui'].body().show('uiContV');}
ig.modules['plugins.ark-ui'].body().show('rotateLeft');ig.modules['plugins.ark-ui'].body().show('rotateRight');ig.modules['plugins.ark-ui'].body().show('scoreCont');ig.modules['plugins.ark-ui'].body().show('timeCont');ig.game.setGameState('game_play');ARK_game_arena_connector.fireEventToArena('game_start');if(ARK_game_soundLib.canPlayMusic()){if(ARK_game_soundLib.musicStatus()){ARK_game_soundLib.playMusic({musicName:'music_loop',looping:true});}}else{var showCorrectSoundButton=function(){if(ig.game.initialSoundOn){if(ig.system.height<ig.system.width){ig.modules['plugins.ark-ui'].body().hide('uiSoundOn');ig.modules['plugins.ark-ui'].body().show('uiSoundOff');}else{ig.modules['plugins.ark-ui'].body().hide('uiSoundOnV');ig.modules['plugins.ark-ui'].body().show('uiSoundOffV');}}else{if(ig.system.height<ig.system.width){ig.modules['plugins.ark-ui'].body().show('uiSoundOn');ig.modules['plugins.ark-ui'].body().hide('uiSoundOff');}else{ig.modules['plugins.ark-ui'].body().show('uiSoundOnV');ig.modules['plugins.ark-ui'].body().hide('uiSoundOffV');}}};showCorrectSoundButton();setTimeout(showCorrectSoundButton,600);}},getInitializationProgress:function(){return this.initializationProgress;},doNextInitPhase:function(){if(this.initPhaseIndex<this.initPhases.length){this.initPhases[this.initPhaseIndex++]();}},createFont1Phase:function(){new ArkFontManager().requireFont('AgencyBold40Yellow','bitmap-fnt','AgencyFBBoldFont',40,{color:'#ffca0b'});ig.game.initializationProgress=0.05;},createFont2Phase:function(){new ArkFontManager().requireFont('AgencyBold40White','bitmap-fnt','AgencyFBBoldFont',40,{color:'#ffffff'});ig.game.initializationProgress=0.1;},createFont3Phase:function(){new ArkFontManager().requireFont('TimeValueWhite','bitmap-fnt','AgencyFBBoldFont',40,{color:'#ffffff'});ig.game.initializationProgress=0.15;},createFont4Phase:function(){new ArkFontManager().requireFont('TimeValueRed','bitmap-fnt','AgencyFBBoldFont',40,{color:'#ff0000'});ig.game.initializationProgress=0.2;},createFont5Phase:function(){new ArkFontManager().requireFont('AgencyBold60White','bitmap-fnt','AgencyFBBoldFont',60,{color:'#ffffff'});ig.game.initializationProgress=0.25;},createFont6Phase:function(){new ArkFontManager().requireFont('AgencyBoldSettings','bitmap-fnt','AgencyFBBoldFont',70,{color:'#66FFFF'});ig.game.initializationProgress=0.3;},createFont7Phase:function(){new ArkFontManager().requireFont('AgencyBold70Blue','bitmap-fnt','AgencyFBBoldFont',70,{color:'#407489'});ig.game.initializationProgress=0.35;},createFont8Phase:function(){new ArkFontManager().requireFont('AgencyBold120Brown','bitmap-fnt','AgencyFBBoldFont',120,{color:'#993f02'});ig.game.initializationProgress=0.4;},createFont9Phase:function(){new ArkFontManager().requireFont('AgencyBold120Blue','bitmap-fnt','AgencyFBBoldFont',120,{color:'#39668c'});ig.game.initializationProgress=0.45;},createFont10Phase:function(){new ArkFontManager().requireFont('ArialBold23White','system','Arial',26,{color:'#ffffff'});ig.game.initializationProgress=0.5;},createFont11Phase:function(){new ArkFontManager().requireFont('ArialBold23Aqua','bitmap-fnt','ArialBold',22,{color:'#08ecef'});ig.game.initializationProgress=0.55;},createUIPhase:function(){createUI();ig.game.initializationProgress=0.85;},createLevelPhase:function(){if(ig.ua.useHD){var scale=2;if(navigator.userAgent.match(/Android/i)){ig.game.cubeDestroy.image.resize(0.01);ig.game.cubeDestroyS.image.resize(scale);ig.game.cubeDestroyS.width=ig.game.cubeDestroyS.width*scale;ig.game.cubeDestroyS.height=ig.game.cubeDestroyS.height*scale;}else{ig.game.cubeDestroyS.image.resize(0.01);ig.game.cubeDestroy.image.resize(scale);ig.game.cubeDestroy.width=ig.game.cubeDestroy.width*scale;ig.game.cubeDestroy.height=ig.game.cubeDestroy.height*scale;}}
this.gameStates={};this.gameStates['start_screen']=function(){};this.gameStates['nextLevelLoad_screen']=function(){};this.gameStates['gamend_screen']=function(){renderCubes();};this.gameStates['game_play']=function(){if(ig.game.delta>2){return;}
if(ig.game.time>=0&&!ig.game.popupIsOpen&&ig.game.cubeApear===0&&ig.game.gameInFocus){ig.game.time-=ig.game.delta;var min=Math.floor(Math.ceil(ig.game.time)/60)
var sec=Math.round(Math.ceil(ig.game.time)-(min*60));var uiTime=ig.modules['plugins.ark-ui'].body()._findItem('uiTime');uiTime.text=min+':'+(sec<10?'0'+sec:sec);if(min===0&&sec<=10&&sec>0){uiTime.font=sec%2===0?new ArkFontManager().getFont('TimeValueRed'):new ArkFontManager().getFont('TimeValueWhite');if(this.timeWarningTicker[sec]==undefined){ig.game.playSound('timer_warning');this.timeWarningTicker[sec]=true;}}}
if(ig.game.time<=0&&ig.game.time!=-1){ig.game.time=0;this.onGameEnd(false);}
if(ig.game.needDegree!=ig.game.degree){var dir=400;ig.game.needDegree<ig.game.degree?dir=-400:false;var plusDeg=dir*ig.game.delta;ig.game.absoluteDegree+=plusDeg;var stableDeg=Math.round(ig.game.absoluteDegree/15)*15;if(ig.game.needDegree<0){if(stableDeg<ig.game.needDegree&&ig.game.degree>ig.game.needDegree){ig.game.degree=ig.game.absoluteDegree=ig.game.needDegree;}else{ig.game.degree=stableDeg;}}else{if(stableDeg>ig.game.needDegree&&ig.game.degree<ig.game.needDegree){ig.game.degree=ig.game.absoluteDegree=ig.game.needDegree;}else{ig.game.degree=stableDeg;}}}
renderCubes();};this.setGameState('start_screen');this.playButtonAnimationData={color:16777215,shadowColor:16777215,shadowOffset:0};createjs.Tween.get(this.playButtonAnimationData,{loop:true}).to({color:2348031,shadowColor:5299455,shadowOffset:2},10000000*8).on('change',function(){var hexColor='#'+new Number(Math.round(this.target.color)).toString(16);var hexShadowColor='#'+new Number(Math.round(this.target.shadowColor)).toString(16);new ArkFontManager().getFont('FontForStartButton').setParams({color:hexColor,shadowColor:hexShadowColor,shadowX:this.target.shadowOffset,shadowY:this.target.shadowOffset});});var speedMatchFont=new ArkFontManager().getFont('SpeedMatch');this.speedMatchLabelWidth=speedMatchFont.getTextWidth('SPEED MATCH');var multiMatchFont=new ArkFontManager().getFont('MultiMatch');this.multiMatchLabelWidth=multiMatchFont.getTextWidth('MULTI MATCH');this.currentLevel=0;this.levelsData=[];for(var i=0;i<=this.LAST_LEVEL_INDEX;++i){this.levelsData.push(this.prepareLevelData(i,new ArkLoader().getResource('mahjongg_leveldata_'+i)));}
this.cleanUnusedTileImagesAfterLoad();this.createLevel(this.currentLevel);canvasTouch();cubePosition(ig.game.objectsList,ig.game.levelInfo);new ArkLoader().reset(true);ig.game.soundSystemInitWatcher=setInterval(function(){if(ARK_game_soundLib.variables.initDone){clearInterval(ig.game.soundSystemInitWatcher);ig.game.initialized=true;ig.game.initializationProgress=1;}},200);},createCubePrototype:function(){var cubeProto={destroy:{active:false,animation:null,x:-13,y:-50},tile:{image:null},cube:{image:ig.game.cubeWhite,normal:ig.game.cubeWhite,select:ig.game.cubeWhiteSelect},position:[0,0,0],opacity:0,fading:-10,scale:1,endAnimationSpeed:0,endAnimationPosition:0,rotate:0};cubeProto.positionOnScreen={};if(navigator.userAgent.match(/Android/i)){cubeProto.destroy.animation=new ig.Animation(ig.game.cubeDestroyS,0.08,[0,1,2,3,4,5,6,7,8,9,10]);}else{cubeProto.destroy.animation=new ig.Animation(ig.game.cubeDestroy,0.04,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]);}
return cubeProto;},reset:function(){this.timeWarningTicker={};this.setScore(0);this.currentLevel=0;this.time=640;this.lastMatchTime=0;this.speedMatchComboMult=0;this.multimatchComboMult=0;this.lastMatchTileName=null;ig.game.reshuffleUsed=false;var anotherReshuffle=ig.modules['plugins.ark-ui'].body()._findItem('uiReshuffle');anotherReshuffle.state['normal']=5;anotherReshuffle.state['over']=11;anotherReshuffle.state['down']=11;anotherReshuffle=ig.modules['plugins.ark-ui'].body()._findItem('uiReshuffleV');anotherReshuffle.state['normal']=5;anotherReshuffle.state['over']=11;anotherReshuffle.state['down']=11;var uiTime=ig.modules['plugins.ark-ui'].body()._findItem('uiTime');uiTime.font=new ArkFontManager().getFont('TimeValueWhite');},restart:function(){ig.modules['plugins.ark-ui'].body().hide('gameend_screen');ig.game.unmuteSound();ig.game.playSound('game_opening_sting');this.reset();this.createLevel(this.currentLevel);ig.system.resizeManager.width=0
cubePosition(ig.game.objectsList,ig.game.levelInfo);eachXYZ(ig.game.objectsList,function(obj){obj.endAnimationSpeed=0;});this.setGameState('game_play');if(ARK_game_soundLib.musicStatus()&&ARK_game_soundLib.canPlayMusic()&&!ig.game.turnSoundOff){ARK_game_soundLib.playMusic({musicName:'music_loop',looping:true});}},rawInputHandler:function(rawEvent){if(this.currentStateName==='start_screen'){ARK_game_soundLib.playInitialSound('play_button_press');this.rawInputHandler=null;}},onResize:function(){var stopThisFN=false;ARK_renderCubesData.prevKnowDegree=Math.random()
var speedMatchFont=new ArkFontManager().getFont('SpeedMatch');this.speedMatchLabelWidth=speedMatchFont.getTextWidth('SPEED MATCH');var multiMatchFont=new ArkFontManager().getFont('MultiMatch');this.multiMatchLabelWidth=multiMatchFont.getTextWidth('MULTI MATCH');var targetWidth=(ig.system.width>640?ig.system.width:640);var bonusesScale=1;if(ARK_getDeviceType()==='pc'){bonusesScale=ig.system.width/1500;}else{bonusesScale=ig.system.width/targetWidth;}
var i,bonusObject;for(i=0;i<this.freeSpeedmatchBonusAnimations.length;++i){bonusObject=this.freeSpeedmatchBonusAnimations[i];bonusObject.factorLabel.scale.x=bonusesScale;bonusObject.factorLabel.scale.y=bonusesScale;bonusObject.bonusText.scale.x=bonusesScale;bonusObject.bonusText.scale.y=bonusesScale;}
for(i=0;i<this.freeMultimatchBonusAnimations.length;++i){bonusObject=this.freeMultimatchBonusAnimations[i];bonusObject.factorLabel.scale.x=bonusesScale;bonusObject.factorLabel.scale.y=bonusesScale;bonusObject.bonusText.scale.x=bonusesScale;bonusObject.bonusText.scale.y=bonusesScale;}
for(i=0;i<this.usedSpeedmatchBonusAnimations.length;++i){bonusObject=this.usedSpeedmatchBonusAnimations[i];bonusObject.factorLabel.scale.x=bonusesScale;bonusObject.factorLabel.scale.y=bonusesScale;bonusObject.bonusText.scale.x=bonusesScale;bonusObject.bonusText.scale.y=bonusesScale;}
for(i=0;i<this.usedMultimatchBonusAnimations.length;++i){bonusObject=this.usedMultimatchBonusAnimations[i];bonusObject.factorLabel.scale.x=bonusesScale;bonusObject.factorLabel.scale.y=bonusesScale;bonusObject.bonusText.scale.x=bonusesScale;bonusObject.bonusText.scale.y=bonusesScale;}
var scaleX=(ig.system.width*0.82)/(ig.game.levelLimit[1]-ig.game.levelLimit[3]);var scaleY=(ig.system.height*0.85)/(ig.game.levelLimit[2]-ig.game.levelLimit[0]);ig.game.levelInfo.scale=scaleX<scaleY?scaleX:scaleY;if(ig.system.width/ig.ua.pixelRatio==640&&ig.system.height/ig.ua.pixelRatio==480){ig.game.levelInfo.scale=ig.game.levelInfo.scale*0.8;}
function scaleCanvas(img,scale,loadCallback){var canvas=document.createElement('canvas');canvas.width=img.width*scale;canvas.height=img.height*scale;var canvas_ctx=canvas.getContext('2d');canvas_ctx.drawImage(img,0,0,Math.floor(img.width),Math.floor(img.height),0,0,Math.floor(canvas.width),Math.floor(canvas.height));var image=null;try{image=new Image();if(loadCallback){image.onload=loadCallback;}
image.src=canvas.toDataURL("image/png");;}catch(e){console.log('scaleCanvas Exception: '+e.name);}
return image;}
if(isAndroid()){ig.game.tilesAreReadyToUse=false;ig.game.alphasAreReadyToUse=false;preScale();}else{ig.game.tilesAreReadyToUse=true;ig.game.alphasAreReadyToUse=true;}
function preScaleReadyWaiter(e){--ig.game.tilesToScale;if(ig.game.tilesToScale===0){ig.game.tilesAreReadyToUse=true;console.log('ig.game.tilesAreReadyToUse = '+ig.game.tilesAreReadyToUse);}}
function preScaleAlphaReadyWaiter(e){--ig.game.alphasToScale;if(ig.game.alphasToScale===0){ig.game.alphasAreReadyToUse=true;console.log('ig.game.alphasAreReadyToUse = '+ig.game.alphasAreReadyToUse);}}
function preScale(){if(ig.game.levelInfo.scale==Infinity||stopThisFN){return}
ig.game.tilesToScale=0;var cubesForScale=[];for(var cube in ig.game.prerenderedCubeTilesCache){cube=ig.game.prerenderedCubeTilesCache[cube];cube.scaleLib=new Object();if(cube.originalData==undefined){cube.originalData=cube.data;}
if(cube.scaleLibDeg==undefined){cube.scaleLibDeg=new Object();}
if(cube.scaleLib[ig.game.levelInfo.scale]==undefined){cubesForScale.push(cube);}
cube.data=cube.scaleLib[ig.game.levelInfo.scale];}
ig.game.tilesToScale=cubesForScale.length;console.log('ig.game.tilesToScale = '+ig.game.tilesToScale);var cube=null;for(var i=0;i<cubesForScale.length;++i){cube=cubesForScale[i];cube.scaleLib[ig.game.levelInfo.scale]=scaleCanvas(cube.originalData,ig.game.levelInfo.scale);cube.data=cube.scaleLib[ig.game.levelInfo.scale];}
cubesForScale=[];var inputScale=(ig.game.levelInfo.scale*ig.game.inputScale).toFixed(3);for(var alpha_ID in ig.game.inputMask){if(ig.game.inputMask[alpha_ID].scaleLib==undefined){var image=new Image();image.src=ig.game.inputMask[alpha_ID].src;ig.game.inputMask[alpha_ID]=new Object();ig.game.inputMask[alpha_ID].originalData=image;ig.game.inputMask[alpha_ID].scaleLib=new Object();}
var alpha=ig.game.inputMask[alpha_ID];if(alpha.scaleLib[inputScale]==undefined){cubesForScale.push(alpha);}}
var alpha=null;ig.game.alphasToScale=cubesForScale.length;console.log('ig.game.alphasToScale = '+ig.game.alphasToScale);for(var i=0;i<cubesForScale.length;++i){alpha=cubesForScale[i];alpha.scaleLib[inputScale]=scaleCanvas(alpha.originalData,inputScale);}}
if(ig.game.currentStateName==='game_play'){if(ig.system.height<ig.system.width){ig.modules['plugins.ark-ui'].body().show('uiCont');ig.modules['plugins.ark-ui'].body().hide('uiContV');}else{ig.modules['plugins.ark-ui'].body().hide('uiCont');ig.modules['plugins.ark-ui'].body().show('uiContV');}}
ARK_renderCubesData.sX=(ig.system.width/2)-(ig.game.levelStartX*ig.game.levelInfo.scale);ARK_renderCubesData.sY=(ig.system.height/2)-(ig.game.levelStartY*ig.game.levelInfo.scale);ARK_renderCubesData.tc_scale=(ig.game.levelInfo.scale*ig.game.inputScale).toFixed(3);ARK_renderCubesData.selectedCubeY=-(((ig.system.height/2)-(ig.game.levelStartY*ig.game.levelInfo.scale))/ig.game.levelInfo.scale)+(70/ig.game.levelInfo.scale);},cleanUnusedTileImagesAfterLoad:function(){var i,j,k;var x,y,z;var levelData;var allTileNames={};for(i=1;i<TILES_COUNT;i++){allTileNames['s'+i]=true;}
for(i=0;i<=this.LAST_LEVEL_INDEX;++i){levelData=this.levelsData[i];for(x=0;x<levelData.boardSizeX;++x){for(y=0;y<levelData.boardSizeY;++y){for(z=0;z<levelData.boardSizeZ;++z){if(levelData.gameItems[x][y][z]){allTileNames[levelData.gameItems[x][y][z].name]=false;}}}}}
for(var tn in allTileNames){if(!allTileNames.hasOwnProperty(tn)){continue;}
if(allTileNames[tn]===true){ig.Image.cache[tn].data=null;delete ig.Image.cache[tn];}}},cleanUnusedTileImagesAfterLevelComplete:function(){},prepareLevelData:function(levelIndex,currentXML){var levelData={countTiles:-1,tiles:[],gameItems:[],boardSizeX:-1,boardSizeY:-1,boardSizeZ:-1,uniqueTiles:[]};var x,y,z,tile;levelData.boardSizeX=x=parseInt(ARK_gameJQ(currentXML).find('TileStructure').attr('x'));levelData.boardSizeY=y=parseInt(ARK_gameJQ(currentXML).find('TileStructure').attr('y'));levelData.boardSizeZ=z=parseInt(ARK_gameJQ(currentXML).find('TileStructure').attr('z'));if(levelIndex===0){if(ARK_gameJQ(currentXML).find('nTimeBonus')){this.timeBonus=parseInt(ARK_gameJQ(currentXML).find('nTimeBonus').text());}
if(ARK_gameJQ(currentXML).find('aLevelCompleteBonuses')){var completeBonues=ARK_gameJQ(currentXML).find('aLevelCompleteBonuses').text().split(',');this.levelCompleteBonuses={};for(var i in completeBonues){this.levelCompleteBonuses[i]=parseInt(completeBonues[i],10);}}
if(ARK_gameJQ(currentXML).find('nSpeedMatchTime')){this.speedMatchTime=1000*parseInt(ARK_gameJQ(currentXML).find('nSpeedMatchTime').text());}else{this.speedMatchTime=5000;}
if(ARK_gameJQ(currentXML).find('nSpeedMatchValue')){this.speedMatchValue=parseInt(ARK_gameJQ(currentXML).find('nSpeedMatchValue').text());}else{this.speedMatchValue=25;}
if(ARK_gameJQ(currentXML).find('nMultiMatchValue')){this.multiMatchValue=parseInt(ARK_gameJQ(currentXML).find('nMultiMatchValue').text());}else{this.multiMatchValue=250;}}
ARK_gameJQ(currentXML).find('TileImages').each(function(){ARK_gameJQ(this).find('tile').each(function(index){tile={name:ARK_gameJQ(this).attr('name'),num:parseInt(ARK_gameJQ(this).attr('num'))};levelData.tiles[index]=tile;});});levelData.gameItems=new Array(x);for(var i=0;i<x;i++){levelData.gameItems[i]=new Array(y);for(var j=0;j<y;j++){levelData.gameItems[i][j]=new Array(z);}}
var posZ,posY,posX;var RendomNumberColor,selectTile;ARK_gameJQ(currentXML).find('layer').each(function(){posZ=parseInt(ARK_gameJQ(this).attr('id'));ARK_gameJQ(this).find('row').each(function(){posX=ARK_gameJQ(this).text().split('');posY=ARK_gameJQ(this).index();for(var i=0;i<posX.length;i++){if(posX[i]!=0){RendomNumberColor=Math.floor(Math.random()*(levelData.tiles.length));selectTile=levelData.tiles[RendomNumberColor];selectTile.num--;if(selectTile.num===0){levelData.tiles.splice(RendomNumberColor,1);}
levelData.countTiles++;levelData.gameItems[i][posY][posZ]={};levelData.gameItems[i][posY][posZ].name=selectTile.name;levelData.gameItems[i][posY][posZ].x=i;levelData.gameItems[i][posY][posZ].y=posY;levelData.gameItems[i][posY][posZ].z=posZ;}}});});return levelData;},createLevel:function(levelIndex,levelData){console.log('createLevel');var levelData=ig.game.levelsData[levelIndex];ig.game.reshuffleUsed=false;ig.game.tilesAreReadyToUse=false;ig.game.alphasAreReadyToUse=false;var anotherReshuffle=ig.modules['plugins.ark-ui'].body()._findItem('uiReshuffle');anotherReshuffle.state['normal']=5;anotherReshuffle.state['over']=11;anotherReshuffle.state['down']=11;anotherReshuffle=ig.modules['plugins.ark-ui'].body()._findItem('uiReshuffleV');anotherReshuffle.state['normal']=5;anotherReshuffle.state['over']=11;anotherReshuffle.state['down']=11;ig.game.cubeApear=2000;ig.game.reshuffleLeft<=0?ig.game.reshuffleLeft=1:false;if(levelIndex!=0){}
this.boardSizeX=levelData.boardSizeX;this.boardSizeY=levelData.boardSizeY;this.boardSizeZ=levelData.boardSizeZ;ig.game.countTiles=levelData.countTiles;this.levelInfo={x:levelData.boardSizeX,y:levelData.boardSizeY,z:levelData.boardSizeZ,tileCount:0,scale:1};ig.game.objectsList=[];var emptyCube=true;for(var x=0;x<this.levelInfo.x;x++){ig.game.objectsList[x]=new Array();for(var y=0;y<this.levelInfo.y;y++){ig.game.objectsList[x][y]=new Array();for(var z=0;z<this.levelInfo.z;z++){emptyCube=true;if(levelData.gameItems[x]&&levelData.gameItems[x][y]&&levelData.gameItems[x][y][z]){emptyCube=false;}
if(emptyCube){ig.game.objectsList[x][y][z]=null;}else{this.levelInfo.tileCount++;var cube=this.createCubePrototype();cube.position[0]=x;cube.position[1]=y;cube.position[2]=z;var alphaName='x'+x+'y'+y+'z'+z
if(ig.game.inputMask[alphaName]==undefined){ig.game.inputMask[alphaName]=new getAlphaMask({image:this.CUBE_PROPERTIES.cube.image.data,color:[x,y,z]});}
cube.alpha=ig.game.inputMask[alphaName];cube.tile.image=new ig.Image(levelData.gameItems[x][y][z].name);cube.id=levelData.gameItems[x][y][z].name;cube.preRenderedImage={'image':null,'normal':null,'select':null,};var normalCubeTileImage=this.prerenderedCubeTilesCache[cube.id+'-normal'];if(normalCubeTileImage==null){normalCubeTileImage=this.combineCubeTileImages(this.CUBE_PROPERTIES.cube.normal,cube.tile.image);this.prerenderedCubeTilesCache[cube.id+'-normal']=normalCubeTileImage;}
var selectCubeTileImage=this.prerenderedCubeTilesCache[cube.id+'-select'];if(selectCubeTileImage==null){selectCubeTileImage=this.combineCubeTileImages(ig.game.cubeWhiteSelect,cube.tile.image);this.prerenderedCubeTilesCache[cube.id+'-select']=selectCubeTileImage;}
cube.preRenderedImage['normal']=normalCubeTileImage;cube.preRenderedImage['select']=selectCubeTileImage;cube.preRenderedImage['image']=normalCubeTileImage;ig.game.objectsList[x][y][z]=cube;}}}}
if(levelIndex!=0){ig.game.closePopup('popup_nextLevel');}
fillPlaySpace(false,false);},combineCubeTileImages:function(cubeImage,tileImage){var tileTransform=[[0.64,0.23,0,1,8,53],[0.83,-0.17,0,1,113,81],[0.84,0.175,0,1,235,60],[0.63,-0.22,0,1,364,80],[0.97,0.11,0,1,470,68],[0.4,-0.26,0,1,613,76],[1.04,0.04,0,1,710,73],[0.12,-0.24,0,1,859,71],[0.12,0.25,0,1,918,42],[1.04,-0.03,0,1,956,78],[0.39,0.26,0,1,1131,46],[0.98,-0.11,0,1,1206,81]]
var canvas=document.createElement('canvas');canvas.width=cubeImage.width;canvas.height=cubeImage.height;var cc=canvas.getContext('2d');cc.drawImage(cubeImage.data,0,0);var scale=ig.ua.useHD?1:0.5;tileTransform.forEach(function(value,index){cc.setTransform(value[0],value[1],value[2],value[3],value[4]*scale,value[5]*scale);cc.drawImage(tileImage.data,0,0);})
var combinedImage=new ig.Image(null,{imageData:canvas});return combinedImage;},checkSpeedMatch:function(){var speedMatch=false;var curTime=Date.now();if(curTime-this.lastMatchTime<this.speedMatchTime){var numberSounds=16;this.speedMatchComboMult++;if(this.speedMatchComboMult<=(numberSounds-1)){var countSpeedMatch=this.speedMatchComboMult+1;var soundsName='tilematch'+countSpeedMatch;ig.game.playSound(soundsName);}else{var randomSound=Math.floor(Math.random()*3)+1;var soundName='correct_sound_'+randomSound;ig.game.playSound(soundName);}
if(this.speedMatchTimer){clearTimeout(this.speedMatchTimer);}
this.speedMatchTimer=setTimeout(function(){if(Date.now()-this.lastMatchTime>this.speedMatchTime){this.speedMatchComboMult=0;}},this.speedMatchTime);speedMatch=true;}else{this.speedMatchComboMult=0;speedMatch=false;}
this.lastMatchTime=curTime;return speedMatch;},checkMultiMatch:function(matchTileName){var multimatch=false;if(this.lastMatchTileName&&this.lastMatchTileName===matchTileName){this.multimatchComboMult++;ig.game.playSound('sfx_multimatch');multimatch=true;}else{this.multimatchComboMult=0;multimatch=false;}
this.lastMatchTileName=matchTileName;return multimatch;},tileAsString:function(tile){return'[id = '+tile.id+', x = '+tile.position[0]+', y = '+tile.position[1]+', z = '+tile.position[2]+']';},onTilesMatch:function(message,matchData){var tile1=matchData.tile1;var tile2=matchData.tile2;var tilesDesc=this.tileAsString(tile1)+' and '+this.tileAsString(tile2);this.updateScore(this.matchScore,'Tiles match: '+tilesDesc);var speedmatch=false;var multimatch=false;if(this.checkSpeedMatch()){this.updateScore(this.speedMatchComboMult*this.speedMatchValue+(this.speedMatchComboMult>0?1:0)*this.speedMatchValue,'Speedmatch for tiles: '+tilesDesc+', speedMatchComboMult = '+this.speedMatchComboMult);this.startSpeedMatchAnimation(this.speedMatchComboMult+1,tile1,tile2);speedmatch=true;}
if(this.checkMultiMatch(tile1.id)){this.updateScore(this.multimatchComboMult*this.multiMatchValue,'Multimatch for tiles: '+tilesDesc+', multimatchComboMult = '+this.multimatchComboMult);this.startMultiMatchAnimation(this.multimatchComboMult+1,tile1,tile2,speedmatch);multimatch=true;}
if(!speedmatch&&!multimatch){ig.game.playSound('tilematch1');}},setScore:function(newValue){this.score=newValue;ig.modules['plugins.ark-ui'].body()._findItem('uiScore').text=''+Math.round(ig.game.score).toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,'$1.');},updateScore:function(deltaValue,reason){this.setScore(this.score+Math.round(deltaValue));ARK_game_arena_connector.changeScore(this.score,reason);},onCubeDelete:function(){--ig.game.levelInfo.tileCount;if(ig.game.levelInfo.tileCount<=0){ig.modules['plugins.ark-ui'].body().show('over');ig.modules['plugins.ark-ui'].body()._findItem('over').alpha=0;if(ig.game.openPopupName!=null){ig.game.closePopup(ig.game.openPopupName);}
if(ig.game.currentLevel!=ig.game.LAST_LEVEL_INDEX){setTimeout(function(){ig.game.openPopup('popup_nextLevel')},500);}
ig.game.lastMatchTime=0;if(ig.game.currentLevel>1){ig.game.updateScore(ig.game.levelCompleteBonuses[ig.game.currentLevel-2]);}
ig.game.playSound('level_end');if(ig.game.currentLevel===ig.game.LAST_LEVEL_INDEX){ig.game.onGameEnd(true);}else{setTimeout(function(){ig.game.levelInfo.scale=0;ARK_game_arena_connector.fireEventToArena('pause_ready');ig.game.createLevel(++ig.game.currentLevel);ig.system.resizeManager.width=0;cubePosition(ig.game.objectsList,ig.game.levelInfo);},2000);}}},onGameEnd:function(win){if(ARK_game_soundLib.canPlayMusic()){ARK_game_soundLib.stopMusic('music_loop');}
var showGameEndInstantly=true;this.setGameState('gamend_screen');if(win===true){this.updateScore(this.time*this.timeBonus,'Time bonus (sec): '+this.time);ig.game.openPopup('popup_win');showGameEndInstantly=false;}else if(win===false){ig.game.playSound('out_of_time_sting');ig.game.openPopup('popup_lose');showGameEndInstantly=false;}
ig.game.muteSound();if(showGameEndInstantly){this.showGameEnd();}else{setTimeout(this.showGameEnd.bind(this),3000);}},showGameEnd:function(){this.showGameEndReally();},showGameEndReally:function(){ARK_game_arena_connector.fireEventToArena('game_end');if(ARK_game_arena_connector.showGameEnd()){ig.game.closePopup('popup_quit');ig.modules['plugins.ark-ui'].body()._findItem('popup_quit').fade=-20;ig.modules['plugins.ark-ui'].body()._findItem('gameend_score').text=Math.round(ig.game.score).toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,'$1.');ig.modules['plugins.ark-ui'].body().show('gameend_screen');ig.game.closePopup('popup_win');ig.game.closePopup('popup_lose');}else{ARK_gameJQ('.ARK_gameContainer').addClass('hide_game_anim');}},runWithInternet:function(callback){var inetFail=false;var firstTime=true;var loadComplete=function(){console.log('loadComplete, inetFail = '+inetFail);if(inetFail){if(firstTime===true){ig.game.closePopup('popup_win');ig.game.closePopup('popup_lose');ig.game.openPopup('popup_noInternet2');}else{ig.modules['plugins.ark-ui'].body().show('popup_noInternet2');}
firstTime=false;}else{ig.game.closePopup('popup_noInternet2');if(typeof(callback)==='function'){callback();}}};var noInternet=function(){inetFail=true;console.log('noInternet');};var checkInternet=function(){console.log('checkInternet: START, firstTime = '+firstTime+', inetFail = '+inetFail);inetFail=false;if(firstTime===false){ig.modules['plugins.ark-ui'].body().hide('popup_noInternet2');}
var loader=new ArkLoader();loader.reset(true);loader.addListener('complete',loadComplete);loader.addListener('error',noInternet);loader.addResources({id:'index.html',src:'index.html?nocache='+Date.now()});console.log('checkInternet: try to load index.html');loader.load();};ig.modules['plugins.ark-ui'].body()._findItem('popup_noInternet_btn2').click=checkInternet;setTimeout(checkInternet,20);},setGameState:function(gameStateName){this.currentState=this.gameStates[gameStateName];this.currentStateName=gameStateName;},update:function(){this.tweenAnimationManager.update();ig.modules['plugins.ark-ui'].body().update();},draw:function(){this.parent();if(ig.game._delta==undefined){ig.game._delta=new Date().getTime();}
var curTime=new Date().getTime();ig.game.delta=(curTime-ig.game._delta)/1000;ig.game._delta=curTime;this.currentState();ig.modules['plugins.ark-ui'].body().draw();},startSpeedMatchAnimation:function(xFactor,tile1,tile2){var degree=ig.game.degree;while(degree<0){degree+=360;}
while(degree>=360){degree-=360;}
var animationObject;if(this.freeSpeedmatchBonusAnimations.length>0){animationObject=this.freeSpeedmatchBonusAnimations.pop();this.usedSpeedmatchBonusAnimations.push(animationObject);}else{animationObject=this.usedSpeedmatchBonusAnimations.splice(0,1);}
var animDistance=150;var animTime=1600;animationObject.factorLabel.text='X'+xFactor;animationObject.factorLabel.alpha=1;animationObject.factorLabel.left=tile1.ppX;animationObject.factorLabel.top=tile1.ppY;animationObject.bonusText.alpha=1;animationObject.bonusText.left=tile1.ppX;animationObject.bonusText.top=tile1.ppY+(animationObject.bonusText.font.getFontHeight()+5)*animationObject.bonusText.scale.y;createjs.Tween.get(animationObject.factorLabel,{override:true}).to({top:animationObject.factorLabel.top-animDistance,alpha:0},animTime).call(function(){ig.modules['plugins.ark-ui'].body().hide(this.name);for(var i=0;i<ig.game.usedSpeedmatchBonusAnimations.length;++i){if(ig.game.usedSpeedmatchBonusAnimations[i]===this.animationHolder){ig.game.usedSpeedmatchBonusAnimations.splice(i,1);break;}}
ig.game.freeSpeedmatchBonusAnimations.push(this.animationHolder);});createjs.Tween.get(animationObject.bonusText,{override:true}).to({top:animationObject.bonusText.top-animDistance,alpha:0},animTime).call(function(){ig.modules['plugins.ark-ui'].body().hide(this.name);});ig.modules['plugins.ark-ui'].body().show(animationObject.factorLabel.name);ig.modules['plugins.ark-ui'].body().show(animationObject.bonusText.name);},getSpeedMatchAnimationUITemplate:function(index){var speedMatchFactor={name:'speedMatchFactor'+index,text:'X',font:new ArkFontManager().getFont('SpeedMatch'),top:0,left:0,align:ig.Font.ALIGN.CENTER};var speedMatchText={name:'speedMatchText'+index,text:LocalizationManager.getText('game_play.speedmatch.bonus.name'),font:new ArkFontManager().getFont('SpeedMatch'),top:0,left:0,align:ig.Font.ALIGN.CENTER};return[speedMatchFactor,speedMatchText];},startMultiMatchAnimation:function(xFactor,tile1,tile2,combineWithSpeedmatch){console.log('MultiMatchAnimation: xFactor = '+xFactor);var degree=ig.game.degree;while(degree<0){degree+=360;}
while(degree>=360){degree-=360;}
var animationObject;if(this.freeMultimatchBonusAnimations.length>0){animationObject=this.freeMultimatchBonusAnimations.pop();this.usedMultimatchBonusAnimations.push(animationObject);}else{animationObject=this.usedMultimatchBonusAnimations.splice(0,1);}
var animDistance=150;var animTime=1600;var yOffset=(combineWithSpeedmatch===true?-2*(animationObject.bonusText.font.getFontHeight()+5)*animationObject.bonusText.scale.y:0);console.log('yOffset = '+yOffset);animationObject.factorLabel.text='X'+xFactor;animationObject.factorLabel.alpha=1;animationObject.factorLabel.left=tile1.ppX;animationObject.factorLabel.top=tile1.ppY+yOffset;animationObject.bonusText.alpha=1;animationObject.bonusText.left=tile1.ppX;animationObject.bonusText.top=tile1.ppY+(animationObject.bonusText.font.getFontHeight()+5)*animationObject.bonusText.scale.y+yOffset;createjs.Tween.get(animationObject.factorLabel,{override:true}).to({top:animationObject.factorLabel.top-animDistance,alpha:0},animTime).call(function(){ig.modules['plugins.ark-ui'].body().hide(this.name);for(var i=0;i<ig.game.usedMultimatchBonusAnimations.length;++i){if(ig.game.usedMultimatchBonusAnimations[i]===this.animationHolder){ig.game.usedMultimatchBonusAnimations.splice(i,1);break;}}
ig.game.freeMultimatchBonusAnimations.push(this.animationHolder);console.log('multimatch pools: used = '+ig.game.usedMultimatchBonusAnimations.length+', free = '+ig.game.freeMultimatchBonusAnimations.length);});createjs.Tween.get(animationObject.bonusText,{override:true}).to({top:animationObject.bonusText.top-animDistance,alpha:0},animTime).call(function(){ig.modules['plugins.ark-ui'].body().hide(this.name);});ig.modules['plugins.ark-ui'].body().show(animationObject.factorLabel.name);ig.modules['plugins.ark-ui'].body().show(animationObject.bonusText.name);},getMultiMatchAnimationUITemplate:function(index){var multiMatchFactorLabel={name:'multiMatchFactor'+index,text:'X',font:new ArkFontManager().getFont('MultiMatch'),top:0,left:'50%',align:ig.Font.ALIGN.CENTER};var multiMatchText={name:'multiMatchText'+index,text:LocalizationManager.getText('game_play.multimatch.bonus.name'),font:new ArkFontManager().getFont('MultiMatch'),top:40,left:'50%',align:ig.Font.ALIGN.CENTER};return[multiMatchFactorLabel,multiMatchText];},pause:function(isUserAction){ig.game.gameInFocus=false;eachXYZ(ig.game.objectsList,function(obj){obj.fading=-2;});ARK_gameJQ('#focusDrop').show();this.muteSound();this.muteMusic();},unpause:function(isUserAction){ig.game.gameInFocus=true;eachXYZ(ig.game.objectsList,function(obj){obj.fading=2;});ARK_gameJQ('#focusDrop').hide();this.unmuteSound();this.unmuteMusic();ARK_gameJQ("#game_gameContainer").focus();if(ig.ua.mobile)
{setTimeout((function(){ig.game.rotateCubeLeft();renderCubes();}).bind(this),100)}},playSound:function(soundName){if(ig.game.turnSoundOff||!this.soundsEnabled){return}
if(ARK_game_soundLib.soundStatus){ARK_game_soundLib.playSound(soundName);}},muteSound:function(){this.soundsEnabled=false;},muteMusic:function(){if(ARK_game_soundLib.canPlayMusic()&&ARK_game_soundLib.musicStatus()){ARK_game_soundLib.stopMusic('music_loop');}},unmuteSound:function(){this.soundsEnabled=true;},unmuteMusic:function(){if(ig.game.turnSoundOff){return}
if(ARK_game_soundLib.canPlayMusic()&&ARK_game_soundLib.musicStatus()){ARK_game_soundLib.playMusic({musicName:'music_loop',looping:true});}},pageVisibilityHander:function(pageStatus){if(pageStatus==='visible'){this.unpause(false);}else{this.pause(false);}}});});
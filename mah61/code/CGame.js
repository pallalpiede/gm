CGame=function(e){this.Papa=e,this.game=this.Papa.game,this.cache=this.Papa.cache,this.scale=this.Papa.scale,this.dT=1/Base.UPS,this.BaseGroup=this.Papa.MenuGroup,this.MainPanel=null,this.DownPanel=null,this.PauseWnd=null,this.CoinsWnd=null,this.ResultsWnd=null,this.ChoiceWnd=null,this.PauseFlag=!1,this.Tweens=new CTweens,this.LevelThreads=new CThreadManager,this.FXThreads=new CThreadManager,this.Prizes=[],this.Dust=[],this.ExplParts=[],this.PopUps=[],this.ExplGlows=[],this.Dust=[],this.FishFXs=[],this.Anims=[],this.LinesXY=[],this.Kills=[],this.KillsIndex=0,this.ShoutOuts=[{index:-1,type:0,scale:1,texts:[sgLang.nice[Base.Lang],sgLang.good[Base.Lang]],shake:!1},{type:0,scale:1.1,index:-1,texts:[sgLang.well[Base.Lang],sgLang.great[Base.Lang],sgLang.awesome[Base.Lang]],shake:!1},{type:0,scale:1,index:-1,texts:[sgLang.well[Base.Lang],sgLang.great[Base.Lang],sgLang.awesome[Base.Lang]],shake:!0}],this.ConfFrames=["conf0.png","conf1.png","conf2.png","conf3.png"],Base.Score=0,this.IDCntr=0,this.BgGroup=this.Papa.BgGroup,this.StaticGroup=this.Papa.StaticGroup,this.GameGroup=this.Papa.GameGroup,this.GameTopGroup=this.Papa.GameTopGroup,this.TopGroup=this.Papa.TopGroup,this.MenuGroup=this.Papa.MenuGroup,this.MenuTopGroup=this.Papa.MenuTopGroup,this.WndGroup=this.Papa.WndGroup,this.WndTopGroup=this.Papa.WndTopGroup,this.BgGroup.scale.set(Base.Scale),this.GameGroup.scale.set(Base.Scale),this.GameTopGroup.scale.set(Base.Scale),this.TopGroup.scale.set(Base.Scale),this.MenuGroup.scale.set(Base.Scale),this.MenuTopGroup.scale.set(Base.Scale),this.WndGroup.scale.set(Base.Scale),this.WndTopGroup.scale.set(Base.Scale),this.BgImg=this.game.make.image(0,0,"gfx","bg.png"),this.BgImg.anchor.set(0),this.BgGroup.add(this.BgImg),this.BgFreenzyImg=this.game.make.image(0,0,"gfx","blueBG.png"),this.BgGroup.add(this.BgFreenzyImg),Base.CellDiam=(Base.Width-2*Base.FieldMarg)/Base.GameCols;var t=Base.CellDiam;for(s=0;s<Base.GameCols;s++)Base.Lines[s]=Base.FieldMarg+t/2+s*t,(a=this.game.make.image(Base.Lines[s],Base.Y_bott,"atlas","startpointBlock.png")).anchor.set(.5),this.BgGroup.add(a);for(var s=0;s<Base.GameCols-1;s++){this.LinesXY.push({x:Base.Lines[s]+t/2,y:125});var a=this.game.make.image(this.LinesXY[s].x,this.LinesXY[s].y,"atlas","lineOnBG.png");a.anchor.set(.5,0),this.BgGroup.add(a)}this.FreenzyPanelImg=this.game.make.image(Base.Width/2,0,"atlas","frenzyPanel.png"),this.FreenzyPanelImg.anchor.set(.5,0),this.MenuGroup.add(this.FreenzyPanelImg);var i=Base.LangParams[Base.LangIndex].h_frenzy+"px FontVector";this.FreenzyText=this.game.add.text(Base.Width/2,50,"xxxx",{font:i,fill:"#502b08",align:"center"}),this.FreenzyText.anchor.set(.5,.5),this.MenuGroup.add(this.FreenzyText),this.MainPanel=new CMainPanel(this,this.LevelThreads,this.MenuGroup),this.MainPanel.create(),this.DownPanel=new CDownPanel(this,this.LevelThreads,this.MenuGroup),this.DownPanel.create(),this.FreenzySliderBgImg=this.game.make.image(Base.Width/2,109,"atlas","frenzyLine.png"),this.MenuGroup.add(this.FreenzySliderBgImg),this.FreenzySliderImg=this.game.make.image(Base.Width/2,109,"atlas","frenzyLine2.png"),this.MenuGroup.add(this.FreenzySliderImg),this.Frenzy=new CFrenzy(this,this.BgGroup,this.LevelThreads),this.Frenzy.init(this.FreenzySliderImg,this.FreenzySliderBgImg,this.BgFreenzyImg,this.FreenzyPanelImg,this.FreenzyText),this.ButtonsHaltFlag=!1,this.Y_field=115,this.Y_booster=825,this.Xm=0,this.Ym=0,this.ActiveFlag=!1,this.Sounds=this.Papa.Sounds,this.PauseFlag=!1,this.Field=new CField(this,this.LevelThreads,this.GameGroup),this.Field.init(),this.CoinsGame=0,this.correctCoord(),this.TextSmallPop=null,this.TextPopUp=new CTextPopUp(this,this.MenuGroup,this.FXThreads);i=Math.floor(70*Base.LangParams[Base.LangIndex].scale)+"px FontVector";var n=this.game.add.text(200,370,"xxx",{font:i,fill:"#ffffff",align:"center"});n.setShadow(0,3,"rgba(0,0,0,0.2)"),n.shadowBlur=2,this.MenuGroup.add(n),this.TextPopUp.init(n),this.game.camera.roundPx=!1,this.Shake=new CCameraShake(this.game.camera,this.FXThreads)},CGame.prototype.Clear=function(){this.LevelThreads.create(),this.FXThreads.create(),this.PauseFlag=!1,this.IDCntr=0,this.GamesCntr=0},CGame.prototype.Create=function(){this.Clear(),this.game.input.onDown.add(this.OnDown,this),this.ActiveFlag=!0,this.State=0,Base.Score=0,this.CoinsGame=0,this.Field.create(),Base.HelpFlag&&this.Field.setHelp(),this.Papa.makeDelayCall(1,this.startGame,this,null),Base.makeScreenAdjust(this.game),sdkHandler.trigger("start")},CGame.prototype.clearBeforeNewGame=function(){this.Frenzy.kill(),Base.Score=0,this.CoinsGame=0,this.updateScore()},CGame.prototype.OnReplay=function(){this.GamesCntr++,this.clearBeforeNewGame(),this.Field.Replay(),sdkHandler.trigger("gameStart")},CGame.prototype.OnNoChoice=function(){this.setResults()},CGame.prototype.OnContinue=function(){this.Field.Continue()},CGame.prototype.setFreenzy=function(){return this.PlaySnd(Base.SndFrenzy),!this.Frenzy.ActiveFlag&&(this.Frenzy.create(Base.Width/2),!0)},CGame.prototype.StopFreenzy=function(){this.Frenzy.stop()},CGame.prototype.makeShoutOut=function(e,t){var s=this.ShoutOuts[e],a=Math.floor(s.texts.length*Math.random());this.TextPopUp.create(Base.Width/2,Base.Height/2-50,this.ShoutOuts[e].type,this.ShoutOuts[e].texts[a],this.ShoutOuts[e].scale,550),t&&(this.Shake.create([5,2],70,1),this.PlaySnd(Base.SndShake))},CGame.prototype.makeNoCoinsText=function(e,t){if(null==this.TextSmallPop){this.TextSmallPop=new CTextPopUp(this,this.MenuTopGroup,this.FXThreads);var s=this.game.add.text(0,0,"xxx",{font:"40px FontVector",fill:"#ffffff",align:"center"});this.MenuTopGroup.add(s),this.TextSmallPop.init(s)}this.TextSmallPop.ActiveFlag||(this.TextSmallPop.create(e,Base.Height-65,1,sgLang.nocoin[Base.Lang],1,0),this.TextSmallPop.setWidthMax(t))},CGame.prototype.makeShoutOutHiScore=function(){this.TextPopUp.create(Base.Width/2,Base.Height/2-50,1,sgLang.newhs[Base.Lang],.9,470),this.PlaySnd(Base.SndWin),this.Shake.create([5,2],70,1),this.PlaySnd(Base.SndShake)},CGame.prototype.setChoice=function(){this.PauseFlag||(null==this.ChoiceWnd&&(this.ChoiceWnd=new CWndChoice(this,this.FXThreads,this.WndGroup,this.WndTopGroup),this.ChoiceWnd.init()),this.ChoiceWnd.create(),this.MainPanel.PauseOn(),this.PauseFlag=!0)},CGame.prototype.setResults=function(){!1!==this.Field.loose&&sdkHandler.trigger("gameOver",{score:Base.Score,callback:function(){null==this.ResultsWnd&&(this.ResultsWnd=new CWndResults(this,this.FXThreads,this.WndGroup,this.WndTopGroup),this.ResultsWnd.init()),this.ResultsWnd.create(),this.MainPanel.PauseOn(),this.PauseFlag=!0}},this)},CGame.prototype.setPause=function(){this.PauseFlag||(null==this.PauseWnd&&(this.PauseWnd=new CWndPause(this,this.FXThreads,this.WndGroup,this.WndTopGroup),this.PauseWnd.init()),this.PauseWnd.create(),globalButtonHelper.pauseResumeBtn.obj.visible=!1,globalButtonHelper.pauseReplayBtn.obj.visible=!1,sdkHandler.trigger("beforePlayButtonDisplay",{callback:function(){globalButtonHelper.pauseResumeBtn.obj.visible=!0,globalButtonHelper.pauseReplayBtn.obj.visible=!0}},this),this.MainPanel.PauseOn(),this.PauseFlag=!0)},CGame.prototype.setCoinsWnd=function(){this.PauseFlag||(null==this.CoinsWnd&&(this.CoinsWnd=new CWndCoins(this,this.FXThreads,this.WndGroup,this.WndTopGroup),this.CoinsWnd.init()),this.CoinsWnd.create(),this.MainPanel.PauseOn(),this.PauseFlag=!0)},CGame.prototype.PauseOff=function(){this.PauseFlag=!1,this.MainPanel.PauseOff()},CGame.prototype.updateScore=function(){this.MainPanel.setScore(Base.Score)},CGame.prototype.updateCoins=function(){this.MainPanel.setCoins(Base.Coins),this.DownPanel.OnCoinsChange(Base.Coins),this.Papa.saveAll()},CGame.prototype.correctCoord=function(){this.X0=(Base.WidthGame/Base.Scale-Base.Width)/2,this.BgGroup.x=this.X0,this.StaticGroup.x=this.X0,this.GameGroup.x=this.X0,this.GameTopGroup.x=this.X0,this.TopGroup.x=this.X0,this.MenuGroup.x=this.X0,this.MenuTopGroup.x=this.X0,this.WndGroup.x=this.X0,this.WndTopGroup.x=this.X0,this.BgImg.scale.set(1,Base.HeightGame/960),this.BgFreenzyImg.scale.set(1,Base.HeightGame/960),this.DownPanel&&this.DownPanel.OnResize(),this.PauseWnd&&this.PauseWnd.OnResize(),this.ResultsWnd&&this.ResultsWnd.OnResize(),this.ChoiceWnd&&this.ChoiceWnd.OnResize(),this.CoinsWnd&&this.CoinsWnd.OnResize()},CGame.prototype.OnGameHeightChange=function(){this.correctCoord()},CGame.prototype.startGame=function(){Base.MusicFlag&&game.sound._sounds[0].play("",0,1,!0),this.Field.startPlay(),sdkHandler.trigger("gameStart")},CGame.prototype.addCoins=function(e){Base.Coins+=e,this.updateCoins()},CGame.prototype.spendCoins=function(e){Base.Coins-=e,this.updateCoins()},CGame.prototype.MakeBooster=function(e){return!!this.Field.applyBooster(e)&&(this.spendCoins(Base.BoostersPrice[e]),!0)},CGame.prototype.OnFieldGameover=function(){},CGame.prototype.OnBoosterEnd=function(e){this.DownPanel.OnActionOver(e)},CGame.prototype.UpdateSoundButton=function(){},CGame.prototype.clearGameProgress=function(){Base.HiScore=0,Base.Coins=0},CGame.prototype.PlaySnd=function(e){this.Papa.PlaySnd(e)},CGame.prototype.StopSnd=function(e){this.Papa.StopSnd(e)},CGame.prototype.addExplGlow=function(e,t,s,a,i,n,h,o,r,l){for(var p=null,u=0;u<this.ExplGlows.length;u++)if(!this.ExplGlows[u].ActiveFlag){p=this.ExplGlows[u];break}return null==p&&(p=new CExplGlow(this,this.FXThreads),this.ExplGlows.push(p)),p.create(e,t,s,a,i,n,h,o,r,l),p},CGame.prototype.addExplGlow2=function(e,t,s,a,i,n,h,o,r,l){for(var p=null,u=0;u<this.ExplGlows.length;u++)if(!this.ExplGlows[u].ActiveFlag){p=this.ExplGlows[u];break}return null==p&&(p=new CExplGlow(this,this.FXThreads),this.ExplGlows.push(p)),p.setScreenSplash(e,t,s,a,i,n,h,o,r,l),p},CGame.prototype.addScorePop=function(e,t,s,a,i,n){for(var h=null,o=0;o<this.PopUps.length;o++)if(this.PopUps[o].ActiveFlag&&this.PopUps[o].Row==i&&this.PopUps[o].Col==n)return(h=this.PopUps[o]).setNumber(s),h;return a?this.addPopUp(e,t,0,s,.8,16777215,0,1):this.addPopUp(e,t,0,s,.3,16777130,0,.7)},CGame.prototype.addPopUp=function(e,t,s,a,i,n,h,o){for(var r=null,l=0;l<this.PopUps.length;l++)if(!this.PopUps[l].ActiveFlag){r=this.PopUps[l];break}return null==r&&(r=new CPopNum(this,this.MenuGroup,this.FXThreads),this.PopUps.push(r)),r.create(e,t,s,a,i,n,h,o,null,null),r},CGame.prototype.addFishFX=function(e,t,s,a,i,n){for(var h=null,o=0;o<this.FishFXs.length;o++)if(!this.FishFXs[o].ActiveFlag){h=this.FishFXs[o];break}return null==h&&(h=new CFishAnimFX(this,this.MenuTopGroup,this.FXThreads),this.FishFXs.push(h)),h.create(e,t,.4,s,a,i,n),h},CGame.prototype.addDustParticle=function(e,t,s,a,i,n,h){for(var o=null,r=0;r<this.Dust.length;r++)if(!this.Dust[r].ActiveFlag){o=this.Dust[r];break}return null==o&&(o=new CDustParticle(this,this.FXThreads),this.Dust.push(o)),o.create(e,t,s,a,i,n,this.StaticGroup,h),o},CGame.prototype.addExplParticle=function(e,t,s,a,i,n,h,o,r,l){for(var p=null,u=0;u<this.ExplParts.length;u++)if(!this.ExplParts[u].ActiveFlag){p=this.ExplParts[u];break}return null==p&&(p=new CExplParticle(this,this.FXThreads),this.ExplParts.push(p)),p.create(e,t,s,a,i,n,h,o,r,l),p},CGame.prototype.OnDown=function(e){this.Xm=e.x/Base.Scale-(Base.WidthGame/Base.Scale-Base.Width)/2,this.Ym=e.y/Base.Scale,this.PauseFlag||(this.Ym>this.Y_booster?this.DownPanel.OnClick(this.Xm,this.Ym):this.Ym>this.Y_field&&this.Field.OnClick(this.Xm,this.Ym))},CGame.prototype.getID=function(){return this.IDCntr++,this.IDCntr-1},CGame.prototype.Close=function(){this.ActiveFlag=!1,this.Papa.removeThread(this)},CGame.prototype.getNoFrameImg=function(e,t,s,a,i){for(var n=null,h=0;h<a.children.length;h++)if(!1===a.children[h].alive&&a.children[h]instanceof Phaser.Image&&a.children[h].type==Phaser.IMAGE){n=a.children[h];break}return null==n?(n=this.game.make.image(e,t,s,null),a.add(n)):(n.revive(),n.x=e,n.y=t,n.key!=s&&n.loadTexture(s)),n.Order=i,n},CGame.prototype.getText=function(e,t,s,a,i,n,h){var o=new Phaser.Text(this.game,0,0,"text");return o.font=s,o.fontSize=a,o.fill=i,o.anchor.set(.5),h.add(o),o.Order=0,o},CGame.prototype.getImg=function(e,t,s,a,i,n){for(var h=null,o=0;o<i.children.length;o++)if(!1===i.children[o].alive&&i.children[o]instanceof Phaser.Image&&i.children[o].type==Phaser.IMAGE&&i.children[o].key===s){h=i.children[o];break}return null==h?(h=this.game.make.image(e,t,s,a),i.add(h)):(h.revive(),h.x=e,h.y=t,null!=a&&(h.frameName=a)),h.Order=n,h},CGame.prototype.getZeroImg=function(e,t,s,a,i){var n=this.getImg(e,t,s,a,i,0);return n.alpha=1,n.rotation=0,n.scale.set(1),n.anchor.set(.5),n},CGame.prototype.getBitmapText=function(e,t,s,a,i,n){for(var h=null,o=0;o<n.children.length;o++)if(!1===n.children[o].alive&&n.children[o]instanceof Phaser.BitmapText&&n.children[o].type==Phaser.BITMAPTEXT&&n.children[o].key===s){h=n.children[o];break}return null==h?((h=this.game.make.bitmapText(e,t,s,a,i)).anchor.set(.5),n.add(h)):(img.revive(),h.x=e,h.y=t,h.alpha=1,h.rotation=0,h.fontSize=s,h.anchor.set(.5),h.setText(a)),h.tint=16777215,h.Order=0,h},CGame.prototype.getButton=function(e,t,s,a,i,n,h){for(var o=null,r=0;r<h.children.length;r++)if(!1===h.children[r].alive&&h.children[r]instanceof Phaser.Button&&h.children[r].type==Phaser.BUTTON&&h.children[r].key===s){o=h.children[r];break}return null==o?(o=this.game.make.button(e,t,s,i,n,a[0],a[1],a[2],a[3]),h.add(o)):(o.revive(),o.x=e,o.y=t,o.setFrames(a[0],a[1],a[2],a[3]),o.onInputUp.removeAll(),o.onInputUp.add(i,n)),o.Order=0,o},CGame.prototype.makeConfeti=function(e,t){for(var s=8,a=1e3,i=0;i<3;i++){for(var n=i*(Math.PI/s)/2,h=n,o=2*Math.PI/s,r=0;r<s;r++){var l=Math.floor(Math.random()*this.ConfFrames.length);-1==l&&l++,l>=this.ConfFrames.length&&(l=0);var p=a+400*Math.random(),u=Math.PI/10+Math.random()*Math.PI/8;Math.random()>.5&&(u=-u),this.addExplParticle(e+10*Math.cos(h),t+10*Math.sin(h),this.ConfFrames[l],0,.5+.2*Math.random(),p*Math.cos(h),p*Math.sin(h),Math.PI*Math.random(),u,this.MenuGroup).setGravity(40),h=(n+=o)+.3*o*Math.random()}s-=2,a-=250}},CGame.prototype.update=function(){this.Tweens.update(),this.FXThreads.update(),this.PauseFlag||this.LevelThreads.update()};
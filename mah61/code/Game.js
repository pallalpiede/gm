Base.Game=function(e){this.Score=0,this.dT=0,this.TManager=null,this.SizeCorrectCntr=0,this.SecondTimeCntr=0,this.Sounds=null,this.BgImg=null,this.CurrWnd=null,this.GamesCntr=0,this.CurrTime=0,this.LastTime=0,this.DelayCalls=null,this.DelayCallsNum=0},Base.Game.prototype={init:function(){this.BgImg=null},create:function(){this.dT=1/Base.UPS,this.BgImg=this.game.add.image(-20,-20,"gfx","bg.png"),this.BgImg.tint=15658734,this.BgImg.anchor.set(0),this.BgImg.scale.set((Base.WidthGame+40)/this.BgImg.width,(Base.HeightGame+40)/this.BgImg.height),this.BgImg.visible=!1,this.BgGroup=this.game.add.group(),this.StaticGroup=this.game.add.group(),this.GameGroup=this.game.add.group(),this.GameTopGroup=this.game.add.group(),this.TopGroup=this.game.add.group(),this.MenuGroup=this.game.add.group(),this.MenuTopGroup=this.game.add.group(),this.WndGroup=this.game.add.group(),this.WndTopGroup=this.game.add.group(),Base.MobileFlag&&(this.OrientGroup=this.game.add.group(),this.OrientBgImg=this.game.make.image(0,0,"gfx","bg.png"),this.OrientBgImg.anchor.setTo(0,0),this.OrientGroup.add(this.OrientBgImg),this.OrientImg=this.game.make.image(0,0,"orient"),this.OrientImg.anchor.setTo(.5),this.OrientGroup.add(this.OrientImg),this.OrientGroup.visible=!1),this.WrongOrientFlag=!1,this.Sounds=Base.Sounds,this.TManager=new CThreadManager(this),this.TManager.create(),this.music=this.add.audio("music",1,!0),this.Sounds[Base.SndButton]=this.add.audio("button"),this.Sounds[Base.SndAttach]=this.add.audio("attach"),this.Sounds[Base.SndMerge0]=this.add.audio("merge0"),this.Sounds[Base.SndMerge1]=this.add.audio("merge1"),this.Sounds[Base.SndMerge2]=this.add.audio("merge2"),this.Sounds[Base.SndPrize]=this.add.audio("prize"),this.Sounds[Base.SndCoin]=this.add.audio("coin"),this.Sounds[Base.SndFrenzy]=this.add.audio("frenzy"),this.Sounds[Base.SndWin]=this.add.audio("win"),this.Sounds[Base.SndTrow]=this.add.audio("trow"),this.Sounds[Base.SndLoose]=this.add.audio("lose"),this.Sounds[Base.SndWindow]=this.add.audio("window"),this.Sounds[Base.SndShake]=this.add.audio("shake"),this.Sounds[Base.SndCount]=this.add.audio("count"),this.getSavedData(),window.sgLang=this.game.cache.getJSON("language"),Base.WrongOrientFlag&&this.setWrongOrient(!0),this.game.onPause.add(this.OnPause,this),this.game.onResume.add(this.OnResume,this),this.DoGame()},OnPause:function(){Base.FreezeFlag=!0,this.CurrWnd.setPause()},OnResume:function(){Base.FreezeFlag=!1},OnBlur:function(){Base.MusicFlag&&this.MuteMusic(!0)},OnFocus:function(){Base.MusicFlag&&this.MuteMusic(!1)},OnDownFirst:function(e){this.MuteMusic(!Base.MusicFlag),this.game.input.onDown.remove(this.OnDownFirst,this)},setWrongOrient:function(e){e?(Base.WrongOrientFlag=!0,this.OrientBgImg.scale.set((Base.WidthGame+40)/640,(Base.HeightGame+40)/960),this.OrientBgImg.alpha=.8,this.OrientImg.x=Base.WidthGame/2,this.OrientImg.y=Base.HeightGame/2.3,this.OrientGroup.visible=!0,this.freezeGameGlobal()):(this.OrientGroup.visible=!1,Base.WrongOrientFlag=!1,this.unFreezeGameGlobal())},freezeGameGlobal:function(){Base.FreezeFlag||(this.game.input.enabled=!1,Base.FreezeFlag=!0,Base.MusicFlag&&this.MuteMusic(!0))},unFreezeGameGlobal:function(){Base.FreezeFlag&&(Base.sgFreezeFlag||Base.WrongOrientFlag||(this.game.input.enabled=!0,Base.FreezeFlag=!1,Base.MusicFlag&&this.MuteMusic(!1)))},freezeGame:function(){Base.sgFreezeFlag=!0,this.freezeGameGlobal()},unfreezeGame:function(){Base.sgFreezeFlag=!1,this.unFreezeGameGlobal()},getScore:function(){return Base.Score},runGame:function(){null!==this.BgImg&&(this.BgImg.visible=!0,this.game.input.onDown.add(this.OnDownFirst,this),this.DoGame())},startOver:function(){null!=this.CurrWnd&&this.CurrWnd.OnReplay()},getSavedData:function(){sdkHandler.trigger("restore",{key:"2048-lines",callback:function(e){e&&(Base.Saves=JSON.parse(e))}},this),Base.HiScore=Base.Saves.highscore,Base.Coins=Base.Saves.coins,Base.SoundFlag=Base.Saves.sound,Base.MusicFlag=Base.Saves.music,Base.HelpFlag=Base.Saves.help},saveAll:function(){Base.Saves.highscore=Base.HiScore,Base.Saves.coins=Base.Coins,Base.Saves.sound=Base.SoundFlag,Base.Saves.music=Base.MusicFlag,Base.Saves.help=Base.HelpFlag,sdkHandler.trigger("save",{key:"2048-lines",value:JSON.stringify(Base.Saves),callback:function(e){}},this)},MuteMusic:function(e){e?this.music.isPlaying&&this.music.pause():this.music.paused?this.music.resume():this.music.isPlaying||this.music.play("",0,1,!0)},PlaySnd:function(e){return Base.SoundFlag?this.Sounds[e].play():null},StopSnd:function(e){this.Sounds[e].stop()},removeThread:function(e,s){this.TManager.removeThread(e,s)},DoGame:function(){var e=this.TManager.getCachedThread(CGame);null==e&&(e=new CGame(this)),e.Create(),this.TManager.saveThread(e),this.TManager.addThread(e,e.update),this.CurrWnd=e},makeDelayCall:function(e,s,i,a){null==this.DelayCalls&&(this.DelayCalls=[]);for(var t=null,n=0;n<this.DelayCallsNum;n++)if(!this.DelayCalls[n].ActiveFlag){t=this.DelayCalls[n];break}if(null==t)for(n=0;n<this.DelayCalls.length;n++)if(!this.DelayCalls[n].ActiveFlag){t=this.DelayCalls[n],this.DelayCallsNum=n+1;break}return null==t&&(t=new CDelayCall(this),this.DelayCalls[this.DelayCallsNum]=t,this.DelayCallsNum++),t.Create(e,s,a,!0,!0,i,this.TManager),t},getImg:function(e,s,i,a,t){for(var n=null,h=0;h<t.children.length;h++)if(!1===t.children[h].alive&&t.children[h]instanceof Phaser.Image&&t.children[h].key===i){n=t.children[h];break}return null==n?(n=this.game.make.image(e,s,i,a),t.add(n)):(n.revive(),n.x=e,n.y=s,null!=a&&(n.frameName=a)),n},AdjustSize:function(){null!==this.BgImg&&this.BgImg.scale.set((Base.WidthGame+40)/640,(Base.HeightGame+40)/960),null!=this.CurrWnd&&this.CurrWnd.OnGameHeightChange()},update:function(){if(this.CurrTime=this.game.time.now,Base.RealTimeInt=.001*(this.CurrTime-this.LastTime),Base.RealTimeInt>1&&(Base.RealTimeInt=this.game.time.physicsElapsed),Base.RealTimeInt>.1&&(Base.RealTimeInt=.1),this.LastTime=this.CurrTime,this.SecondTimeCntr-=Base.RealTimeInt,this.SecondTimeCntr<0){this.SecondTimeCntr=.25;var e=Math.max(window.innerWidth,document.documentElement.clientWidth),s=Math.max(window.innerHeight,document.documentElement.clientHeight);s!=Base.HeightWnd||e!=Base.WidthWnd?(this.SizeCorrectCntr=0,Base.makeScreenAdjust(this.game),Base.WrongOrientFlag&&(this.OrientBgImg.scale.set((Base.WidthGame+40)/640,(Base.HeightGame+40)/960),this.OrientImg.x=Base.WidthGame/2,this.OrientImg.y=Base.HeightGame/2.3)):this.SizeCorrectCntr++,Base.MobileFlag&&(Base.WrongOrientFlag?e<s&&this.setWrongOrient(!1):e>s&&this.setWrongOrient(!0))}Base.FreezeFlag||this.TManager.update()}};
!function(t,e,i){"use strict";var n=function(){};n.Play=function(t,e,i,n){void 0===n&&(n=1),e.isMute||(t.resources.sounds[i].volume(n),t.resources.sounds[i].play())},n.Stop=function(t,e){t.resources.sounds[e].stop()},n.PlayBGM=function(t,e,i,a){void 0===a&&(a=1),n.Stop(t,i),e.isMute||(t.resources.sounds[i].loop(!0),t.resources.sounds[i].volume(a),t.resources.sounds[i].play())},n.PauseMuteBGM=function(t,e){t.resources.sounds[e].volume(0)},n.PlayMuteBGM=function(t,e,i){void 0===i&&(i=1),t.resources.sounds[e].volume(i)};var a,o=function(t){function i(i,a,o,s){var r=this;void 0===s&&(s=e.Texture.EMPTY),t.call(this),this.onTexture=e.Texture.EMPTY,this.offTexture=e.Texture.EMPTY,this.enable=!0,this.isToggleButton=!1,this.toggle=!1,this.sprite=new e.Sprite(o),this.sprite.anchor.set(.5),this.collider=new e.Graphics,this.collider.beginFill(255,.4),this.collider.drawRect(-this.sprite.width/2,-this.sprite.height/2,this.sprite.width,this.sprite.height),this.collider.endFill(),this.collider.alpha=0,s!=e.Texture.EMPTY&&(this.isToggleButton=!0,this.toggle=!0,this.onTexture=o,this.offTexture=s);var h=!1,l=0;this.collider.interactive=!0,this.collider.on("pointertap",(function(){r.enable&&(r.emit("buttontap"),n.Play(i,a,"button"))})),this.collider.on("pointerdown",(function(){r.enable&&(h=!0)})),this.collider.on("pointerup",(function(){h=!1})),this.collider.on("pointerupoutside",(function(){h=!1}));this.task.on("buttonAnimationTask",(function(t){if(r.enable){var e=t.delta,i=l/5;r.sprite.scale.set(1-i*(1-.85)),h?l<5?l+=e:l=5:l>0?l-=e:l=0}})),this.addChild(this.sprite),this.addChild(this.collider)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getToggle=function(){return this.toggle},i.prototype.setToggle=function(t){this.toggle=t,this.change_sprite(t?this.onTexture:this.offTexture)},i.prototype.setInteractive=function(t){this.collider.interactive=t},i.prototype.switchToggle=function(){var t=!this.toggle;return this.setToggle(t),t},i.prototype.change_sprite=function(t){this.sprite.texture=t},i.prototype.getEnable=function(){return this.enable},i.prototype.setEnable=function(t){this.enable=t,this.sprite.tint=t?16777215:7368816},i}(t.Container);!function(t){t[t.Linear=0]="Linear",t[t.Decel=1]="Decel",t[t.Accel=2]="Accel",t[t.Cubic=3]="Cubic",t[t.Over=4]="Over",t[t.Under=5]="Under",t[t.OverAbs=6]="OverAbs",t[t.UnderAbs=7]="UnderAbs",t[t.OverFew=8]="OverFew",t[t.UnderFew=9]="UnderFew",t[t.Cosine=10]="Cosine",t[t.Decel2=11]="Decel2",t[t.Accel2=12]="Accel2"}(a||(a={}));var s=function(t){function i(e,i,n){var o=this;void 0===n&&(n=!0),t.call(this),this.play=!0,this.next=null,this.playUnit=1,this.animPosition={state:{enable:!1,frame:0,end:30,ease:a.Linear,loop:1},from:{x:0,y:0},to:{x:0,y:0},relative:{from:!1,to:!1}},this.animScale={state:{enable:!1,frame:0,end:30,ease:a.Linear,loop:1},from:{x:0,y:0},to:{x:1,y:1}},this.animAlpha={state:{enable:!1,frame:0,end:30,ease:a.Linear,loop:1},from:0,to:1},this.animRotation={state:{enable:!1,frame:0,end:30,ease:a.Linear,loop:1},from:0,to:1},this.animWait={state:{enable:!1,frame:0,end:30,ease:a.Linear,loop:1}},this.target=i,this.task.on("clearInVoid",(function(){o.animPosition.state.enable||o.animScale.state.enable||o.animAlpha.state.enable||o.animRotation.state.enable||o.animWait.state.enable||(o.emit("endAnim_all"),o.next?o.next.Play():o.emit("endFlipbook"),n&&(o.clear(),o.destroy()))}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.positionTask=function(){var t=this,e=!1;this.task.on("positionTask",(function(i){if(t.play&&t.animPosition.state.enable){e||(t.animPosition.relative.from&&(t.animPosition.from.x+=t.target.x,t.animPosition.from.y+=t.target.y),t.animPosition.relative.to&&(t.animPosition.to.x+=t.target.x,t.animPosition.to.y+=t.target.y),e=!0);var n=i.delta;0!=t.animPosition.state.loop&&t.animPosition.state.frame>t.animPosition.state.end*t.animPosition.state.loop&&(t.animPosition.state.frame=t.animPosition.state.end*t.animPosition.state.loop);var a=t.animPosition.state.frame/t.animPosition.state.end,o=t.looper(a);t.target.x=t.easer(t.animPosition.from.x,t.animPosition.to.x,t.fx(o,t.animPosition.state.ease)),t.target.y=t.easer(t.animPosition.from.y,t.animPosition.to.y,t.fx(o,t.animPosition.state.ease)),Math.floor(a)>=t.animPosition.state.loop&&0!=t.animPosition.state.loop?(t.animPosition.state.enable=!1,t.animPosition.state.frame=0,t.emit("endAnim_position")):t.animPosition.state.frame+=n/t.playUnit}}))},i.prototype.setFramePosition=function(t){this.animPosition.state.frame=60*t},i.prototype.animatePosition=function(t,i,n,a,o,s){void 0===o&&(o=1),void 0===s&&(s=!1),s&&!this.animPosition.relative.from&&(this.target.position=new e.Point(t.x,t.y)),this.animPosition.state.enable=!0,this.animPosition.state.frame=0,this.animPosition.from=t,this.animPosition.to=i,this.animPosition.state.end=60*n,this.animPosition.state.ease=a,this.animPosition.state.loop=o,this.positionTask()},i.prototype.animateVector=function(t,e,i,n,a){void 0===n&&(n=1),void 0===a&&(a=!1);this.animPosition.relative={from:!0,to:!0},this.animatePosition({x:0,y:0},t,e,i,n,a)},i.prototype.animateVectorFrom=function(t,e,i,n,a){void 0===n&&(n=1),void 0===a&&(a=!1);this.animPosition.relative={from:!0,to:!0},this.animatePosition(t,{x:0,y:0},e,i,n,a)},i.prototype.animateMoveto=function(t,e,i,n,a){void 0===n&&(n=1),void 0===a&&(a=!1);this.animPosition.relative={from:!0,to:!1},this.animatePosition({x:0,y:0},t,e,i,n,a)},i.prototype.animateMoveFrom=function(t,e,i,n,a){void 0===n&&(n=1),void 0===a&&(a=!1);this.animPosition.relative={from:!1,to:!0},this.animatePosition(t,{x:0,y:0},e,i,n,a)},i.prototype.scaleTask=function(){var t=this;this.task.on("scaleTask",(function(e){if(t.play&&t.animScale.state.enable){var i=e.delta;0!=t.animScale.state.loop&&t.animScale.state.frame>t.animScale.state.end*t.animScale.state.loop&&(t.animScale.state.frame=t.animScale.state.end*t.animScale.state.loop);var n=t.animScale.state.frame/t.animScale.state.end,a=t.looper(n);t.target.scale.set(t.easer(t.animScale.from.x,t.animScale.to.x,t.fx(a,t.animScale.state.ease)),t.easer(t.animScale.from.y,t.animScale.to.y,t.fx(a,t.animScale.state.ease))),Math.floor(n)>=t.animScale.state.loop&&0!=t.animScale.state.loop?(t.animScale.state.enable=!1,t.animScale.state.frame=0,t.emit("endAnim_scale")):t.animScale.state.frame+=i/t.playUnit}}))},i.prototype.setFrameScale=function(t){this.animScale.state.frame=60*t},i.prototype.animateScaleXY=function(t,i,n,a,o,s){void 0===o&&(o=1),void 0===s&&(s=!1),s&&(this.target.scale=new e.Point(t.x,t.y)),this.animScale.state.enable=!0,this.animScale.state.frame=0,this.animScale.from=t,this.animScale.to=i,this.animScale.state.end=60*n,this.animScale.state.ease=a,this.animScale.state.loop=o,this.scaleTask()},i.prototype.animateScale=function(t,e,i,n,a,o){void 0===a&&(a=1),void 0===o&&(o=!1);var s={x:t,y:t},r={x:e,y:e};this.animateScaleXY(s,r,i,n,a,o)},i.prototype.alphaTask=function(){var t=this;this.task.on("alphaTask",(function(e){if(t.play&&t.animAlpha.state.enable){var i=e.delta;0!=t.animAlpha.state.loop&&t.animAlpha.state.frame>t.animAlpha.state.end*t.animAlpha.state.loop&&(t.animAlpha.state.frame=t.animAlpha.state.end*t.animAlpha.state.loop);var n=t.animAlpha.state.frame/t.animAlpha.state.end,a=t.looper(n);t.target.alpha=t.easer(t.animAlpha.from,t.animAlpha.to,t.fx(a,t.animAlpha.state.ease)),Math.floor(n)>=t.animAlpha.state.loop&&0!=t.animAlpha.state.loop?(t.animAlpha.state.enable=!1,t.animAlpha.state.frame=0,t.emit("endAnim_alpha")):t.animAlpha.state.frame+=i/t.playUnit}}))},i.prototype.setFrameAlpha=function(t){this.animAlpha.state.frame=60*t},i.prototype.animateAlpha=function(t,e,i,n,a,o){void 0===a&&(a=1),void 0===o&&(o=!1),o&&(this.target.alpha=t),this.animAlpha.state.enable=!0,this.animAlpha.state.frame=0,this.animAlpha.from=t,this.animAlpha.to=e,this.animAlpha.state.end=60*i,this.animAlpha.state.ease=n,this.animAlpha.state.loop=a,this.alphaTask()},i.prototype.rotationTask=function(){var t=this;this.task.on("rotationTask",(function(e){if(t.play&&t.animRotation.state.enable){var i=e.delta;0!=t.animRotation.state.loop&&t.animRotation.state.frame>t.animRotation.state.end*t.animScale.state.loop&&(t.animRotation.state.frame=t.animRotation.state.end*t.animRotation.state.loop);var n=t.animRotation.state.frame/t.animRotation.state.end,a=t.looper(n);t.target.rotation=t.easer(t.animRotation.from,t.animRotation.to,t.fx(a,t.animRotation.state.ease)),Math.floor(n)>=t.animRotation.state.loop&&0!=t.animRotation.state.loop?(t.animRotation.state.enable=!1,t.animRotation.state.frame=0,t.emit("endAnim_rotation")):t.animRotation.state.frame+=i/t.playUnit}}))},i.prototype.setFrameRotation=function(t){this.animRotation.state.frame=60*t},i.prototype.animateRotation=function(t,e,i,n,a,o){void 0===a&&(a=1),void 0===o&&(o=!1),o&&(this.target.rotation=t),this.animRotation.state.enable=!0,this.animRotation.state.frame=0,this.animRotation.from=2*t*Math.PI,this.animRotation.to=2*e*Math.PI,this.animRotation.state.end=60*i,this.animRotation.state.ease=n,this.animRotation.state.loop=a,this.rotationTask()},i.prototype.waitTask=function(){var t=this;this.task.on("waitTask",(function(e){if(t.play&&t.animWait.state.enable){var i=e.delta;t.animWait.state.frame>=t.animWait.state.end*t.animWait.state.loop&&0!=t.animWait.state.loop?(t.animWait.state.enable=!1,t.animWait.state.frame=0,t.emit("endAnim_wait")):t.animWait.state.frame+=i/t.playUnit}}))},i.prototype.setFrameWait=function(t){this.animWait.state.frame=60*t},i.prototype.Wait=function(t,e,i){void 0===e&&(e=1),this.animWait.state.enable=!0,this.animWait.state.frame=0,this.animWait.state.end=60*t,this.animWait.state.loop=e,this.waitTask()},i.prototype.setFrameAll=function(t){this.animPosition.state.frame=60*t,this.animScale.state.frame=60*t,this.animAlpha.state.frame=60*t,this.animRotation.state.frame=60*t,this.animWait.state.frame=60*t},i.prototype.clear=function(){this.task.clear()},i.Flipbook=function(t,e){void 0===e&&(e=1);for(var i=0;i<t.length;i++)i<t.length-1&&t[i].Next(t[i+1]),t[i].SetUnitSpeed(e);return t[t.length-1]},i.prototype.Next=function(t){this.next=t,this.next.Stop()},i.prototype.Play=function(){this.play=!0},i.prototype.Stop=function(){this.play=!1},i.prototype.SetUnitSpeed=function(t){this.playUnit=t},i.prototype.easer=function(t,e,i){return(e-t)*i+t},i.prototype.fx=function(t,e){switch(t<0&&(t=0),t>1&&(t=1),e){case a.Linear:return t;case a.Accel:return t*t;case a.Decel:return-t*t+2*t;case a.Cubic:return-2*t*t*t+3*t*t;case a.Over:return-5*t*t*t+6*t*t;case a.Under:return-5*t*t*t+9*t*t-3*t;case a.OverAbs:return 1-Math.abs(1-(-5*t*t*t+6*t*t));case a.UnderAbs:return Math.abs(-5*t*t*t+9*t*t-3*t);case a.OverFew:return-3*t*t*t+4*t*t;case a.UnderFew:return-3*t*t*t+5*t*t-1*t;case a.Cosine:return.5*(Math.cos(Math.PI*(t-1))+1);case a.Accel2:return t*t*t*t;case a.Decel2:return-t*t*t*t+4*t*t*t-6*t*t+4*t}return t},i.prototype.looper=function(t){return 1-Math.abs(1-t/2%1*2)},i}(t.Container),r=function(t){function i(i,n,a){var o=this;void 0===a&&(a=0),t.call(this),this.alphaAnimation=0,this.fade=0,this.stopFadeIn=1,this.stopFadeOut=0,this.speed=1,this.graphics=new e.Graphics,this.graphics.beginFill(n),this.graphics.drawRect(0,0,i.vars.additional.width,i.vars.additional.height),this.graphics.endFill(),this.setAlpha(a),this.addChild(this.graphics),this.task.on("fader",(function(t){var e=t.delta/60;o.graphics.alpha=o.alphaAnimation,1==o.fade&&(o.alphaAnimation<o.stopFadeIn?o.alphaAnimation+=e*o.speed:(o.alphaAnimation=o.stopFadeIn,o.fade=0,o.emit("endFadeIn"))),-1==o.fade&&(o.alphaAnimation>o.stopFadeOut?o.alphaAnimation-=e*o.speed:(o.alphaAnimation=o.stopFadeOut,o.fade=0,o.emit("endFadeOut")))}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setAlpha=function(t){this.alphaAnimation=t,this.graphics.alpha=t},i.prototype.fadeIn=function(t,e){void 0===e&&(e=1),this.fade=1,this.speed=1/t,this.stopFadeIn=e},i.prototype.fadeOut=function(t,e){void 0===e&&(e=0),this.fade=-1,this.speed=1/t,this.stopFadeOut=e},i.prototype.setInteractive=function(t){var e=this;this.graphics.interactive=t,t&&this.graphics.on("pointertap",(function(){e.emit("graphictap")}))},i}(t.Container),h=function(t){function i(i,n,h){var l=this;void 0===h&&(h=!0),t.call(this);var c=new e.Sprite(i.resources.images.asobikata),d=new e.Point(i.vars.additional.width/2,i.vars.additional.height/2),p=new o(i,n,i.resources.spritesheets.ui["next.png"]);p.on("buttontap",(function(){m()})),p.x=d.x,p.y=i.vars.additional.height-p.height/2-25;var u=new s(i,p);u.animateScale(1,1.1,.8,a.Decel,0),this.addChild(u);var f=new r(i,0,0),m=function(){h?(p.setInteractive(!1),f.fadeIn(.2),f.on("endFadeIn",(function(){l.emit("nextScene")}))):l.emit("nextScene")};this.addChild(c),this.addChild(p),this.addChild(f)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),l=function(t){function i(i){t.call(this);var n=new e.Sprite(i.resources.images.haikei);this.addChild(n)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),c=function(){};c.Index=function(t){return Math.floor(t.length*Math.random())},c.Int=function(t){return this.RangeInt(0,t)},c.RangeInt=function(t,e){return Math.floor((e-t+1)*Math.random()+t)},c.Float=function(t){return this.RangeFloat(0,t)},c.RangeFloat=function(t,e){return(e-t)*Math.random()+t};var d=function(t){function i(i,n,a,o){t.call(this);var s=i.vars.env.languages;if(!(s.length<2)){var r=new p(i,n,i.resources.spritesheets.langui.button,i.resources.spritesheets.langui.close);r.scale.set(.8);var h=r.width/2+a,l=r.height/2+o;a<=0&&(h=i.vars.additional.width-r.width/2+a),o<=0&&(l=i.vars.additional.height-r.height/2+o),r.position.set(h,l);var c=new e.Graphics;c.beginFill(0,.75),c.drawRect(0,0,i.vars.additional.width,i.vars.additional.height),c.endFill(),c.interactive=!0;for(var d=new e.Sprite(i.resources.spritesheets.langui.pop),u=new e.Sprite(i.resources.spritesheets.langui.title),f=i.vars.api.getLanguage(),m=[],v=function(t){var a=s[t],o=f==a,r=new p(i,n,i.resources.spritesheets.langui[o?"select":"other"]),h=new e.Sprite(i.resources.spritesheets.lang[a]);h.anchor.set(.5);r.y=180*(t-(s.length-1)/2),r.on("buttontap",(function(){o||i.vars.additional.root.emit("changeLang",a)})),r.sprite.addChild(h),m.push(r)},g=0;g<s.length;g++)v(g);d.anchor.set(.5),u.anchor.set(.5),d.scale.set(.8),d.position.set(i.vars.additional.width/2,i.vars.additional.height/2),u.y=-380,c.visible=!1,d.visible=!1,r.on("buttontap",(function(){var t=!r.SwitchToggle();c.visible=t,d.visible=t})),this.addChild(c),this.addChild(r),d.addChild(u),this.addChild(d);for(var y=0;y<m.length;y++)d.addChild(m[y]);return this}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),p=function(t){function i(i,a,o,s){var r=this;void 0===s&&(s=e.Texture.EMPTY),t.call(this),this.onTexture=e.Texture.EMPTY,this.offTexture=e.Texture.EMPTY,this.enable=!0,this.toggle=!1,this.sprite=new e.Sprite(o),this.sprite.anchor.set(.5),this.collider=new e.Graphics,this.collider.beginFill(255,.4),this.collider.drawRect(-this.sprite.width/2,-this.sprite.height/2,this.sprite.width,this.sprite.height),this.collider.endFill(),this.collider.alpha=0,s!=e.Texture.EMPTY&&(this.toggle=!0,this.onTexture=o,this.offTexture=s);var h=!1,l=0;this.collider.interactive=!0,this.collider.on("pointertap",(function(){r.enable&&(r.emit("buttontap"),n.Play(i,a,"button"))})),this.collider.on("pointerdown",(function(){r.enable&&(h=!0)})),this.collider.on("pointerup",(function(){h=!1})),this.collider.on("pointerupoutside",(function(){h=!1}));this.task.on("buttonAnimationTask",(function(t){var e=t.delta,i=l/5;r.sprite.scale.set(1-i*(1-.85)),l=h?l<5?l+e:5:l>0?l-e:0})),this.addChild(this.sprite),this.addChild(this.collider)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.SetToggle=function(t){this.toggle=t,this.sprite.texture=t?this.onTexture:this.offTexture},i.prototype.SwitchToggle=function(){var t=!this.toggle;return this.SetToggle(t),t},i}(t.Container),u=function(t){function i(i,n,a,o,s){void 0===o&&(o=0),void 0===s&&(s=30),t.call(this);var r=new e.Point(2*i.width,2*i.height),h=new e.Text("ver. "+i.vars.env.version,new e.TextStyle({fill:o,fontSize:s}));h.position.set(r.x*n,r.y*a),h.pivot.set(h.width*n,h.height*a),this.addChild(h)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),f=function(t){function i(i,h,p){var f=this;t.call(this),n.Stop(i,"bgm");var m=new e.Point(i.vars.additional.width/2,i.vars.additional.height/2);this.addChild(new l(i));var v=new r(i,0,1);v.fadeOut(.1),v.on("endFadeOut",(function(){g()}));var g=function(){var t=new e.Sprite(i.resources.images.rogo);t.anchor.set(.5,1),t.x=m.x,t.y=t.height+75;var n=new s(i,t);n.animateAlpha(0,1,.5,a.Decel,1,!0),f.addChild(n);for(var r=[7,2,19,18,17,14,15,4,6,16,11,12,20,3,13,8,9,10,1,5],l=[],p=0,g=-2;g<=1;g++)for(var y=function(t){var n=new e.Sprite(i.resources.spritesheets.title_sweets["s0"+r[p]+".png"]);n.interactive=!1,n.anchor.set(.5,1),n.x=m.x+125*t,n.y=.5*i.vars.additional.height+125*-g+125,n.on("pointertap",(function(){A(n)})),l.push(n),p++},w=-2;w<=2;w++)y(w);var x=new o(i,h,i.resources.spritesheets.ui["start.png"]);x.on("buttontap",(function(){x.setInteractive(!1),I()})),x.x=m.x,x.y=i.vars.additional.height-x.height/2-25,x.alpha=0;var C=new o(i,h,i.resources.spritesheets.ui["sound_on.png"],i.resources.spritesheets.ui["sound_off.png"]);C.setToggle(!h.isMute),C.x=i.vars.additional.width-C.width/2,C.y=i.vars.additional.height-C.height/2;for(var S=1.5*i.vars.additional.height,b=0;b<l.length;b++)l[b].y-=S;var A=function(t){t.interactive=!1;var e=new s(i,t);e.animateScaleXY({x:1,y:1},{x:1,y:.9},.05,a.Decel),f.addChild(e);var n=new s(i,t);n.animateScaleXY({x:1,y:.9},{x:.9,y:1.05},.15,a.Decel,2),n.animateVector({x:0,y:.08*-t.height},.15,a.Decel,2),f.addChild(n);var o=new s(i,t);o.animateScaleXY({x:1,y:.9},{x:1,y:1},.1,a.Decel),f.addChild(o);var r=new s(i,t);r.animateScaleXY({x:1,y:1},{x:1,y:.97},.05,a.Decel,2),f.addChild(r),s.Flipbook([e,n,o,r]).on("endFlipbook",(function(){t.interactive=!0}))},_=l[12],P=new s(i,_);P.animateVector({x:0,y:S},1,a.Accel),P.setFrameAll(.5),f.addChild(P),P.on("endAnim_all",(function(){A(_)}));for(var T=function(t){if(12!=t){var e=Math.floor(t/5);setTimeout((function(){var e=l[t],n=new s(i,e);n.animateVector({x:0,y:S},1,a.Accel),n.setFrameAll(.5),f.addChild(n),n.on("endAnim_all",(function(){A(e)}))}),350+100*e+c.Int(100))}},k=0;k<l.length;k++)T(k);var L=function(){var e;(e=new s(i,t)).animateScaleXY({x:1,y:1},{x:1.025,y:.975},.08,a.Decel),f.addChild(e),e.on("endAnim_all",(function(){var e=new s(i,t);e.animateVector({x:0,y:-12},.3,a.Decel,2),f.addChild(e);var n=new s(i,t);n.animateScaleXY({x:1.025,y:.975},{x:1,y:1.025},.35,a.Accel),f.addChild(n);var o=new s(i,t);o.Wait(.25),f.addChild(o);var r=new s(i,t);r.animateScaleXY({x:1,y:1.025},{x:1.05,y:.95},.08,a.Decel),f.addChild(r);var h=new s(i,t);h.animateScaleXY({x:1.05,y:.95},{x:1,y:1},.08,a.Decel),f.addChild(h);var l=new s(i,t);l.animateScaleXY({x:1,y:1},{x:1.02,y:.98},.1,a.Decel,2),f.addChild(l),s.Flipbook([n,o,r,h,l])})),setTimeout((function(){L()}),3e3)},M=function(t){setTimeout((function(){for(var t=[],e=0;e<l.length;e++)l[e].interactive&&t.push(l[e]);t.length>0&&A(t[c.Index(t)]),M(c.RangeInt(50,1e3))}),t)};setTimeout((function(){for(var t=0;t<l.length;t++)l[t].interactive=!0;L(),M(200);var e=new s(i,x);e.animateAlpha(0,1,.2,a.Linear),e.animateScale(1,1.1,.8,a.Decel,0),f.addChild(e)}),2200),C.on("buttontap",(function(){var t=!C.switchToggle();h.isMute=t}));var I=function(){v.fadeIn(.25),v.on("endFadeIn",(function(){f.emit("nextScene")}))};f.addChild(new u(i,.5,0,853762)),f.addChild(C),f.addChild(t);for(var F=l.length-1;F>=0;F--)f.addChild(l[F]);f.addChild(x),f.addChild(new d(i,h,10,-10)),f.swapChildren(x,v)};this.addChild(v)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),m=function(t){function i(i,n,a,o,s){var r=this;void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=0),t.call(this),this.play=!1,this.time=0,this.second=0,this.minute=0,this.allFrame=0,this.margin=0,this.textures=[],this.timerSprites=[],this._$=i,this.textures=n;for(var h=0;h<5;h++){var l=new e.Sprite(this.getNumberImage(2==h?10:0));l.anchor.set(.5),this.timerSprites.push(l),this.addChild(l)}this.Update(),this.setTime(60*o+s);var c=0;this.task.on("timerTask",(function(t){if(r.play){for(var e=1*t.delta;c>=60;)a?r.removeTime1():r.addTime1(),c-=60;r.allFrame+=e,c+=e}})),this.pivot.set(this.width/2,this.height/2)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getAllFrame=function(){return this.allFrame},i.prototype.getNumberImage=function(t){return(t<0||t>10)&&(t=10),this.textures[t]},i.prototype.setMargin=function(t){this.margin=t,this.Update()},i.prototype.Update=function(){for(var t=0,e=0;e<5;e++){var i=this.timerSprites[e];i.x=t+i.width/2,t+=i.width+this.margin+(1==e||2==e?this.margin:0)}this.pivot.set(this.width/2,this.height/2)},i.getImageTextures=function(t,e,i){for(var n=new Array(11),a=0;a<=10;a++)n[a]=t.resources.image[e+a+i];return n},i.getSpritesheetTextures=function(t,e,i){for(var n=new Array(11),a=0;a<=10;a++)n[a]=t[e+a+i];return n},i.prototype.drawTime=function(t,e){this.timerSprites[0].texture=this.getNumberImage(t<10?0:Math.floor(t/10)),this.timerSprites[1].texture=this.getNumberImage(t%10),this.timerSprites[3].texture=this.getNumberImage(e<10?0:Math.floor(e/10)),this.timerSprites[4].texture=this.getNumberImage(e%10)},i.prototype.setTime=function(t){t>5999&&(t=5999),t<0&&(t=0),this.time=t,this.second=this.time%60,this.minute=Math.floor(this.time/60),this.drawTime(this.minute,this.second)},i.prototype.getTime=function(){return this.time},i.prototype.addTime1=function(){this.setTime(++this.time)},i.prototype.removeTime1=function(){this.setTime(--this.time)},i.prototype.Play=function(){this.play=!0},i.prototype.Stop=function(){this.play=!1},i}(t.Container),v=function(t){function e(e){var i=this;t.call(this),n.PauseMuteBGM(e,"bgm"),e.vars.api.viewRewardAdAsync().then((function(t){n.PlayMuteBGM(e,"bgm"),i.emit("complete"),i.destroy()})).catch((function(t){t.type===e.vars.enum.errors.AdSkipped?(n.PlayMuteBGM(e,"bgm"),i.emit("failed"),i.emit("skip"),i.destroy()):(n.PlayMuteBGM(e,"bgm"),i.emit("failed"),i.emit("error"),i.destroy())}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(t.Container),g=function(t){function i(e,n,a){t.call(this),this.number=0,this.numberBfr=0,this.sprites=[],this.textures=[],this.size=60,this.margin=0,this.align=i.Align.CENTER,this.$=e,this.color=16777215,this.textures=n,this.setNumber(a)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.getImageTextures=function(t,e,i){for(var n=new Array(10),a=0;a<=9;a++)n[a]=t.resources.image[e+a+i];return n},i.getSpritesheetTextures=function(t,e,i){for(var n=new Array(10),a=0;a<=9;a++)n[a]=t[e+a+i];return n},i.prototype.setSize=function(t){this.size=t,this.Update()},i.prototype.setMargin=function(t){this.margin=t,this.Update()},i.prototype.setAlign=function(t){this.align=t},i.prototype.getNumberSprite=function(t){var i=new e.Sprite(this.textures[t]);return i.anchor.set(0,1),i.scale.set(this.size/i.height),i},i.prototype.getColor=function(){return this.color},i.prototype.setColor=function(t){this.color=t;for(var e=0;e<this.sprites.length;e++)this.sprites[e].tint=t;this.Update()},i.prototype.getNumber=function(){return this.number},i.prototype.DrawNumber=function(t){var e=this;this.Clear(),(t=Math.floor(t))<0&&(t=0);for(var n=""+t,a=0,o=0;o<n.length;o++){var s=this.getNumberSprite(parseInt(n[o]));s.tint=this.color,s.x+=a,a+=s.width+this.margin*this.size*.02,this.sprites.push(s),this.addChild(s)}this.pivot.set(function(){switch(e.align){case i.Align.LEFT:return 0;case i.Align.CENTER:return e.width/2;case i.Align.RIGHT:return e.width}}(),this.height/2)},i.prototype.setNumber=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=1),this.numberBfr=this.number,this.number=t,e<=0?this.DrawNumber(t):this.animate(e,i)},i.prototype.Update=function(){this.setNumber(this.number)},i.prototype.Clear=function(){for(var t=0;t<this.sprites.length;t++)this.sprites[t].destroy();this.sprites.splice(0)},i.prototype.animate=function(t,e){var i=this;this.task.clear();var n=0;this.task.on("animation",(function(a){var o=a.delta;n>e&&(n=e);var s=n/e,r=function(t,e,i){return(e-t)*i+t}(i.numberBfr,i.number,function(e){switch(t){case 1:return e;case 2:return-e*e+2*e;case 3:return-2*e*e*e+3*e*e}return 1}(s));i.DrawNumber(r),s>=1?(i.emit("endAnimation"),i.task.clear()):n+=o/60}))},i}(t.Container);g.Align={RIGHT:"right",CENTER:"center",LEFT:"left"};var y=function(){};y.Plus=function(t,i){return new e.Point(t.x+i.x,t.y+i.y)},y.PlusA=function(t,i){return new e.Point(t.x+i,t.y+i)},y.Minus=function(t,i){return new e.Point(t.x-i.x,t.y-i.y)},y.Multi=function(t,i){return new e.Point(t.x*i,t.y*i)},y.Invert=function(t){return new e.Point(-t.x,-t.y)},y.Length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},y.Distance=function(t,e){return y.Length(y.Minus(e,t))},y.ZERO=new e.Point(0,0),y.ONE=new e.Point(1,1);var w=function(t){function e(e,i){t.call(this),this.target=e,this.textures=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.getSpritesheetTextures=function(t,e,i,n,a){for(var o=new Array(a-n+1),s=0;s<=a-n;s++)o[s]=t[e+(n+s)+i];return o},e.prototype.play=function(t){var e=this;this.task.clear();var i=this.textures.length,n=0;this.task.on("animation",(function(a){var o=a.delta;if(n>=t)return e.emit("finish"),e.task.clear(),void e.destroy();var s=Math.floor(n/t*i);e.target.texture=e.textures[s],n+=o/60}))},e}(t.Container),x=function(t){function i(i,n,a,o){var r=this;t.call(this),this.id=0,this._visible=!0,this.selected=!1,this.shaking=!1,this.$=i,this.panel=n,this.id=a,a=a<0?0:a>30?30:a,this.pos=o,this.container=new e.Container,this.sprite=new e.Sprite(this.getTexture(a)),this.selectSprite=new e.Sprite(this.getTexture(a,1)),this.selectSprite.alpha=0,this.selectAnimationScale=new s(i,this.container,!1),this.selectAnimationAlpha=new s(i,this.selectSprite,!1),this.sprite.interactive=!0,this.sprite.on("pointertap",(function(){r._visible&&r.emit("tiletap")})),this.container.addChild(this.sprite),this.container.addChild(this.selectSprite);var h=new e.Point(.5,1);this.container.pivot.set(this.container.width*h.x,this.container.height*h.y),this.container.x=88*h.x,this.container.y=88*h.y,this.addChild(this.container),this.addChild(this.selectAnimationAlpha),this.addChild(this.selectAnimationScale)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.shake=function(){var t=this,e=0;this.sprite.texture=this.getTexture(this.id,2),this.shaking=!0,this.endAnimation(),this.task.clear();this.task.on("shake",(function(i){var n=i.delta,a=7*Math.sin(4*Math.PI/.3*e);t.sprite.x=a,e>=.3&&(t.task.clear(),t.sprite.x=0,t.sprite.texture=t.getTexture(t.id,0),t.shaking=!1,t.selected&&t.startAnimation()),e+=n/60}))},i.prototype.getTexture=function(t,e){if(void 0===e&&(e=0),0!=t){var i="k_c";return 1==e?i="s_c":2==e&&(i="a_c"),this.$.resources.spritesheets.sweets[i+t+".png"]}},i.prototype.getId=function(){return this.id},i.prototype.setId=function(t){this.id=t,this.setTexture(t)},i.prototype.setTexture=function(t){this.sprite.texture=this.getTexture(t),this.selectSprite.texture=this.getTexture(t,1)},i.prototype.isSpace=function(){return-1==this.id},i.prototype.getPos=function(){return this.pos},i.prototype.setVisible=function(t){this.isSpace()||(this._visible=t,this.setTexture(t?this.id:0))},i.prototype.TallAnimation=function(t){var e=this;void 0===t&&(t=function(){});var i=new s(this.$,this.container);i.animateScaleXY({x:1,y:1},{x:1.2,y:.5},.1,a.Decel),this.addChild(i),i.on("endAnim_all",(function(){var i=new s(e.$,e.container);i.animateScaleXY({x:1.2,y:.5},{x:.8,y:1.2},.1,a.Accel),e.addChild(i),i.on("endAnim_all",(function(){var i=new s(e.$,e.container);i.animateScaleXY({x:.8,y:1.2},{x:1,y:1},.1,a.Over),e.addChild(i),i.on("endAnim_all",(function(){t()}))}))}))},i.prototype.startAnimation=function(){this.selected&&(this.selectAnimationAlpha.clear(),this.selectAnimationScale.clear(),this.selectAnimationAlpha.animateAlpha(0,1,.65,a.Decel,0),this.selectAnimationScale.animateScale(1,1.1,.65,a.Decel,0))},i.prototype.endAnimation=function(){this.selectAnimationAlpha.clear(),this.selectAnimationScale.clear(),this.selectSprite.alpha=0,this.container.scale.set(1)},i.prototype.setSelect=function(t){var e=this;this.shaking||this.selected==t||(this.selected?this.endAnimation():this.TallAnimation((function(){e.startAnimation()}))),this.selected=t},i.prototype.Clear=function(t,i){var n=this;void 0===i&&(i=!1),this.id=-1;var o=function(i){void 0===i&&(i=new e.Point(0,0));var o=new s(n.$,n.container);o.animateAlpha(1,0,.1,a.Linear),n.addChild(o);var r=y.Plus(y.Plus(n.panel.position,n.position),i),h=new C(n.$,n.panel,new e.Point(r.x,r.y-n.sprite.height/2));t.addChild(h),o.on("endAnim_all",(function(){n.container.visible=!1}))};if(i){var r=new e.Sprite(this.$.resources.spritesheets.ui["fork.png"]);r.anchor.set(.5,.55),r.position=this.container.position.clone(),r.y+=-190,r.rotation=.25;var h=new s(this.$,r);h.animateAlpha(0,1,.08,a.Linear,1,!0),this.addChild(h);setTimeout((function(){var t=new s(n.$,r);t.animateRotation(.125/Math.PI,0,.1,a.Cubic),t.animateVector({x:0,y:50},.2,a.Accel),n.addChild(t),t.on("endAnim_all",(function(){var t=new s(n.$,n.container);t.animateVector({x:0,y:-50},.2,a.Decel),n.addChild(t),r.texture=n.$.resources.spritesheets.ui["fork2.png"];var i=new s(n.$,r);i.animateVector({x:0,y:-50},.2,a.Decel),n.addChild(i),setTimeout((function(){var t=new s(n.$,r);t.animateAlpha(1,0,.1,a.Linear),n.addChild(t),o(new e.Point(0,-50)),n.emit("endEatAnimation")}),150)}))}),200),this.addChild(r)}else o()},i}(t.Container),C=function(t){function i(i,n,o){var r=this;t.call(this),this.tileSize=new e.Point(88,88),this.$=i,this.panel=n,this.tileScale=n.tileScale,this.tileSize=new e.Point(this.tileSize.x*this.tileScale,this.tileSize.y*this.tileScale);var h=new e.Sprite(i.resources.spritesheets.ui["particle_light.png"]);h.anchor.set(.5),h.blendMode=e.BLEND_MODES.ADD,h.position=o;var l=new s(i,h);l.animateAlpha(1,0,.4,a.Decel),l.animateScale(.75,2,.4,a.Linear),this.addChild(l);for(var c=function(t){var n=2*Math.PI*t/12,h=new e.Sprite(i.resources.spritesheets.ui["star.png"]);switch(h.anchor.set(.5),h.rotation=n,h.position=o,t%4){case 0:h.scale.set(.4);break;case 2:h.scale.set(.3);break;default:h.scale.set(.15)}var l=y.Multi(new e.Point(Math.sin(n),-Math.cos(n)),30);h.position=y.Plus(h.position,l);var c=new s(i,h);c.animateVector({x:l.x,y:l.y},.2,a.Cubic),r.addChild(c),setTimeout((function(){var t=new s(i,h);t.animateAlpha(1,0,.15,a.Decel),r.addChild(t)}),150),r.addChild(h)},d=0;d<12;d++)c(d);this.addChild(h)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),S=function(t){function i(i,n){var a=this;t.call(this),this.tileSize=new e.Point(88,88),this.getTileCenter=function(t){return new e.Point(a.panel.position.x+t.x*a.tileSize.x+a.tileSize.x/2,a.panel.position.y+t.y*a.tileSize.y+a.tileSize.y/2)},this.$=i,this.panel=n,this.tileScale=n.tileScale,this.tileSize=new e.Point(this.tileSize.x*this.tileScale,this.tileSize.y*this.tileScale)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getVector=function(t,i){return new e.Point(i.x-t.x,i.y-t.y)},i.prototype.getLength=function(t){return Math.abs(t.x)+Math.abs(t.y)},i.prototype.DrawLine3=function(t,e,i,n,a){var o=this;void 0===a&&(a=1);var s=0;s+=this.getLength(this.getVector(t,e)),s+=this.getLength(this.getVector(e,i)),s+=this.getLength(this.getVector(e,n));var r=function(){o.DrawLine(i,n,a*s)};this.DrawLine(t,e,a*s,(function(){o.DrawLine(e,i,a*s,r)}))},i.prototype.DrawLine=function(t,i,n,a){var o=this;void 0===a&&(a=function(){});var s=e.BLEND_MODES.ADD;if(t.y==i.y){var r=t.x<=i.x?1:-1,h=Math.abs(i.x-t.x),l=new e.Sprite(this.$.resources.spritesheets.ui["kesusen2.png"]);l.blendMode=s,l.anchor.set(.5,0);var c=l.height;l.scale.set(.75*this.tileScale,0);var d=.16*l.width;l.position=this.getTileCenter(t),l.position.x-=d/2*r,l.rotation=-Math.PI/2*r;var p=function(t){l.scale.y=t*o.tileSize.x/c+d/c},u=0;return this.task.on("scaling",(function(t){var e=t.delta;p(u),u>h&&(p(h),o.task.clear(),a()),u+=e/60*n})),this.addChild(l),l}if(t.x==i.x){var f=t.y<=i.y?1:-1,m=Math.abs(i.y-t.y),v=new e.Sprite(this.$.resources.spritesheets.ui["kesusen2.png"]);v.blendMode=s,v.anchor.set(.5,0);var g=v.height;v.scale.set(.75*this.tileScale,0);var y=.16*v.width;v.position=this.getTileCenter(t),v.position.y-=y/2*f,v.rotation=-1==f?Math.PI:0;var w=function(t){v.scale.y=t*o.tileSize.y/g+y/g},x=0;return this.task.on("scaling",(function(t){var e=t.delta;w(x),x>m&&(w(m),o.task.clear(),a()),x+=e/60*n})),this.addChild(v),v}return new e.Point(0,0)},i}(t.Container),b=function(t){function i(i,o,r,h,l){var d=this;if(void 0===l&&(l=1),t.call(this),this.board=[],this.remain=0,this.startGame=!1,this.lineLight=[],this.hammerMode=!1,this.$=i,this.size=r,this.selected=new e.Point(-1,-1),this.remain=this.size.x*this.size.y,this.tileScale=l,this.particleContainer=h,this.lineLight=new Array(4),this.resetLineLight(),r.x*r.y%2!=1){for(var p=0,u=0,f=!1,m=!1,g=0;g<this.size.y;g++){var y=[];p=0;for(var w=function(t){var r=new e.Point(t,g),h=new x(i,d,1,r);h.scale.set(l),h.position.set(p,u);var w=new e.Point(.5,1);h.pivot.set(h.width*w.x,h.height*w.y),h.x+=h.width*w.x,h.y+=h.height*w.y,p+=88*d.tileScale,t==d.size.x-1&&(u+=88*d.tileScale),y.push(h);var C=h.position;h.alpha=0;setTimeout((function(){h.alpha=1;var t=new s(i,h);t.animatePosition({x:C.x,y:-i.vars.additional.height},{x:C.x,y:C.y},1,a.Accel),t.setFrameAll(.7),d.addChild(t);var e=new s(i,h);e.animateScaleXY({x:1,y:1},{x:1,y:.85},.08,a.Decel,2),d.addChild(e);var n=new s(i,h);n.animateScaleXY({x:1,y:1},{x:.95,y:1.05},.2,a.Decel),n.animateVector({x:0,y:-10},.15,a.Decel),d.addChild(n);var o=new s(i,h);o.animateScaleXY({x:.95,y:1.05},{x:1,y:1},.1,a.Accel),o.animateVector({x:0,y:10},.2,a.Accel),d.addChild(o),s.Flipbook([t,e,n,o])}),300+70*(d.size.y-1-g)+c.Int(100)),h.on("tiletap",(function(){if(!f){if(d.hammerMode){if(m)return;m=!0,d.emit("begin_eat");var t=new v(i);t.on("complete",(function(){d.emit("use_eat");setTimeout((function(){f=!0;var t=d.getTile(r),e=d.findTile(t.getId()),a=c.Int(e.length-1);e[a]==t&&(a=(a+1)%e.length);d.getTilePosition(t.getPos()),d.getTilePosition(e[a].getPos());d.ClearPair(t.getPos(),e[a].getPos(),!0),t.on("endEatAnimation",(function(){f=!1,n.Play(i,o,"seikai"),d.emit("used_eat"),d.hammerMode=!1}))}),2500)})),t.on("failed",(function(){d.emit("failed_eat"),m=!1})),d.addChild(t)}else if(d.isSelect()&&d.getTile(d.selected).getId()==d.getTile(r).getId()){var e=d.selected;if(e!=r)if(d.isConnect(e,r)){f=!0,d.getTile(r).TallAnimation(),d.emit("seikai",d.lineLight);setTimeout((function(){f=!1,d.Unselect(),d.emit("seikaiCleared",{pos1:e,pos2:r}),d.ClearPair(e,r),n.Play(i,o,"seikai")}),300)}else d.getTile(d.selected).shake(),d.getTile(r).shake(),d.Select(r);else d.Unselect()}else d.Select(r);n.Play(i,o,"sentaku")}})),d.addChild(h)},C=0;C<d.size.x;C++)w(C);this.board.push(y)}this.generatePanel(1)}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.generatePanel=function(t){var i,n=this;this.startGame=!1;for(var a=new Array(this.size.y),o=0;o<a.length;o++){var s=new Array(this.size.x);a[o]=s;for(var r=0;r<s.length;r++)a[o][r]=0,this.board[o][r].setId(0)}for(var h=function(){for(var t,i=[],a=0;a<n.size.x*n.size.y;a++){var o=a%n.size.x,s=Math.floor(a/n.size.x),r=new e.Point(o,s);g(r)||i.push(r)}for(var h=0;h<i.length;h++){var l=c.Int(i.length-1);t=[i[l],i[h]],i[h]=t[0],i[l]=t[1]}return i},l=function(){for(var t,i=new e.Point(n.size.x-2,n.size.y-2),a=[],o=0;o<a.length;o++){var s=o%i.x+1,r=Math.floor(o/i.x)+1,l=new e.Point(s,r);g(l)||a.push(l)}for(var d=0;d<a.length;d++){var p=c.Int(a.length-1);t=[a[p],a[d]],a[d]=t[0],a[p]=t[1]}return 0==a.length&&(a=h()),a},d=function(t){if(w(t))return t;var e=[],i=function(i,n){var a=v(t,i,n);y(a)||e.push(a)};i(1,0),i(-1,0),i(0,1),i(0,-1);var n=c.Int(e.length-1);return e[n]},p=new Array(30),u=0;u<p.length;u++)p[u]=u+1;for(var f=0;f<p.length;f++){var m=c.Int(p.length-1);i=[p[m],p[f]],p[f]=i[0],p[m]=i[1]}for(var v=function(t,i,n){return new e.Point(t.x+i,t.y+n)},g=function(t){return 0!=n.board[t.y][t.x].getId()},y=function(t){return function(t){return t.x<0||t.x>=n.size.x||t.y<0||t.y>=n.size.y}(t)||g(t)},w=function(t){return y(v(t,1,0))&&y(v(t,-1,0))&&y(v(t,0,1))&&y(v(t,0,-1))},x=function(t){return y(v(t,1,0))||y(v(t,-1,0))||y(v(t,0,1))||y(v(t,0,-1))},C=0,S=function(){return p[C]},b=function(){var t=C;return++C>=p.length&&(C=0),p[t]},A=function(t,e){a[t.y][t.x]=e,n.board[t.y][t.x].setId(-1)},_=0,P=function(t){A(t,S());for(var e=h(),i=0,a=e[i];!n.isConnect(t,a)||t.equals(a);)a=e[++i];return A(a,b()),_+=n.getLength(t,a),a},T=function(t){if(A(t,S()),!x(t))return P(t);for(var e=h(),i=0,a=e[i];!n.isConnect(t,a)||t.equals(a)||n.isAdjacent(t,a);){if(++i>=e.length)return P(t);a=e[i]}return A(a,b()),_+=n.getLength(t,a),a},k=this.size.y*this.size.x,L=Math.ceil(.6*k),M=0;M<L;M++){var I=l();if(0==I.length)break;for(var F=I[0],D=P(F);!w(D)&&Math.random()<t;)D=T(d(D))}for(var O=function(){for(var t=0,e=0;e<n.size.y;e++)for(var i=0;i<n.size.x;i++)0==n.board[e][i].getId()&&t++;return t}();O>0;){for(var z=h(),R=0,j=z[R];!x(j);)j=z[++R];P(j),O-=2}for(var E=0;E<this.size.y;E++)for(var V=0;V<this.size.x;V++)this.board[E][V].setId(a[E][V]);return this.startGame=!0,_},i.prototype.reflesh=function(){var t,i=this;this.startGame=!1;for(var n=0,a=new Array(this.size.y),o=0;o<a.length;o++){var s=new Array(this.size.x);a[o]=s;for(var r=0;r<s.length;r++){var h=this.board[o][r].isSpace()?-1:0;0==h&&n++,a[o][r]=h,this.board[o][r].setId(h)}}for(var l=function(){for(var t,n=[],a=0;a<i.size.x*i.size.y;a++){var o=a%i.size.x,s=Math.floor(a/i.size.x),r=new e.Point(o,s);v(r)||n.push(r)}for(var h=0;h<n.length;h++){var l=c.Int(n.length-1);t=[n[l],n[h]],n[h]=t[0],n[l]=t[1]}return n},d=new Array(30),p=0;p<d.length;p++)d[p]=p+1;for(var u=0;u<d.length;u++){var f=c.Int(d.length-1);t=[d[f],d[u]],d[u]=t[0],d[f]=t[1]}var m=function(t,i,n){return new e.Point(t.x+i,t.y+n)},v=function(t){return 0!=i.board[t.y][t.x].getId()},g=function(t){return function(t){return t.x<0||t.x>=i.size.x||t.y<0||t.y>=i.size.y}(t)||v(t)},y=function(t){return g(m(t,1,0))||g(m(t,-1,0))||g(m(t,0,1))||g(m(t,0,-1))},w=0,x=function(t,e){a[t.y][t.x]=e,i.board[t.y][t.x].setId(-1)},C=0,S=function(t){x(t,d[w]);for(var e,n=l(),a=0,o=n[a];!i.isConnect(t,o)||t.equals(o);)o=n[++a];return x(o,(e=w,++w>=d.length&&(w=0),d[e])),C+=i.getLength(t,o),o};for(this.size.y,this.size.x;n>0;){for(var b=l(),A=0,_=b[A];!y(_);)_=b[++A];S(_),n-=2}for(var P=0;P<this.size.y;P++)for(var T=0;T<this.size.x;T++)this.board[P][T].setId(a[P][T]);return this.startGame=!0,C},i.prototype.getTilePosition=function(t){var i=this.getTile(t);return new e.Point(i.x-i.pivot.x+i.width/2,i.y-i.pivot.y+i.height/2)},i.prototype.getTile=function(t){return this.board[t.y][t.x]},i.prototype.isSpace=function(t){return!(t.x>=0&&t.x<this.board[0].length&&t.y>=0&&t.y<this.board.length)||this.getTile(t).isSpace()},i.prototype.getSize=function(){return this.size},i.prototype.Select=function(t){(this.isSelect()&&this.getTile(this.selected).setSelect(!1),this.selected=t,this.isSelect())&&this.getTile(t).setSelect(!0)},i.prototype.Unselect=function(){this.isSelect()&&this.getTile(this.selected).setSelect(!1),this.Select(new e.Point(-1,-1))},i.prototype.isSelect=function(){return this.selected.x>=0&&this.selected.y>=0},i.prototype.isAdjacent=function(t,i){var n=function(t,i,n){return new e.Point(t.x+i,t.y+n)};return n(t,1,0).equals(i)||n(t,-1,0).equals(i)||n(t,0,1).equals(i)||n(t,0,-1).equals(i)},i.prototype.isZeroPoint=function(t){return 0==t.x&&0==t.y},i.prototype.existLineLight=function(){return!(this.isZeroPoint(this.lineLight[0])&&this.isZeroPoint(this.lineLight[1])&&this.isZeroPoint(this.lineLight[2])&&this.isZeroPoint(this.lineLight[3]))},i.prototype.resetLineLight=function(){if(this.startGame)for(var t=0;t<this.lineLight.length;t++)this.lineLight[t]=new e.Point(0,0)},i.prototype.setLineLight=function(t,e,i,n){this.startGame&&(this.lineLight[0]=t,this.lineLight[1]=e,this.lineLight[2]=i,this.lineLight[3]=n)},i.prototype.setHammerMode=function(t){t&&this.Unselect(),this.hammerMode=t},i.prototype.getVector=function(t,i){return new e.Point(i.x-t.x,i.y-t.y)},i.prototype.Sign=function(t){return new e.Point(Math.sign(t.x),Math.sign(t.y))},i.prototype.getLength=function(t,e){var i=this.getVector(t,e);return Math.abs(i.x)+Math.abs(i.y)},i.prototype.isLine=function(t,e){return t.x==e.x||t.y==e.y},i.prototype.canThrougthLine3_rtNum=function(t,e,i,n){return this.resetLineLight(),this.isLine(t,e)&&this.isLine(e,i)&&this.isLine(i,n)?this.canThrougthLine(t,e,!1,!e.equals(t))?this.canThrougthLine(e,i)?this.canThrougthLine(i,n,!i.equals(n),!1)?(this.setLineLight(t,e,i,n),1):-3:-2:-1:0},i.prototype.canThrougthLine3=function(t,e,i,n){return this.canThrougthLine3_rtNum(t,e,i,n)>=1},i.prototype.canThrougthLine=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var a=this.getVector(t,e);return this.canStraightLine(t,a,i,n)},i.prototype.canStraightLine=function(t,i,n,a){if(void 0===n&&(n=!1),void 0===a&&(a=!1),0!=i.x&&0!=i.y)return!1;if(0==i.x&&0==i.y)return!0;if(0==i.y){var o=Math.abs(i.x);a&&o++;var s=t.y,r=Math.sign(i.x),h=0;for(n||(h+=r);Math.abs(h)<o;h+=r)if(!this.isSpace(new e.Point(t.x+h,s)))return!1;return!0}var l=Math.abs(i.y);a&&l++;var c=t.x,d=Math.sign(i.y),p=0;for(n||(p+=d);Math.abs(p)<l;p+=d)if(!this.isSpace(new e.Point(c,t.y+p)))return!1;return!0},i.prototype.isShortestConnect=function(t,i){var n=this.getVector(t,i);if(t.y==i.y||t.x==i.x){var a=this.canThrougthLine(t,i);return a?this.setLineLight(t,t,i,i):this.resetLineLight(),a}for(var o=Math.abs(n.x),s=0;s<=o;s++){var r=new e.Point(t.x+s*(n.x>=0?1:-1),t.y),h=new e.Point(r.x,i.y);if(this.canThrougthLine3(t,r,h,i))return!0}for(var l=Math.abs(n.y),c=1;c<l;c++){var d=new e.Point(t.x,t.y+c*(n.y>=0?1:-1)),p=new e.Point(i.x,d.y);if(this.canThrougthLine3(t,d,p,i))return!0}return!1},i.prototype.isDetourConnect=function(t,i){for(var n=this.getVector(t,i),a=Math.abs(n.x),o=-1;o<=1;o+=2)for(var s=1;s<=this.size.x+1;s++){var r=n.x>=0?1:-1,h=1==o?(s+a)*r:-s*r,l=new e.Point(t.x+h,t.y),c=new e.Point(l.x,i.y),d=this.canThrougthLine3_rtNum(t,l,c,i);if(1==d)return!0;if(-1==d||-3==d)break}for(var p=Math.abs(n.y),u=-1;u<=1;u+=2)for(var f=1;f<=this.size.y+1;f++){var m=n.y>=0?1:-1,v=1==u?(f+p)*m:-f*m,g=new e.Point(t.x,t.y+v),y=new e.Point(i.x,g.y),w=this.canThrougthLine3_rtNum(t,g,y,i);if(1==w)return!0;if(-1==w||-3==w)break}return!1},i.prototype.isConnect=function(t,e){return this.resetLineLight(),!!this.isShortestConnect(t,e)||!!this.isDetourConnect(t,e)},i.prototype.setTilesVisible=function(t){for(var e=0;e<this.size.y;e++)for(var i=0;i<this.size.x;i++)this.board[e][i].setVisible(t)},i.prototype.findTile=function(t){for(var e=[],i=0;i<this.size.y;i++)for(var n=0;n<this.size.x;n++)this.board[i][n].getId()==t&&e.push(this.board[i][n]);return e},i.prototype.isGameOver=function(){if(this.startGame=!1,0==this.remain)return!1;for(var t=0;t<this.size.y;t++)for(var e=0;e<this.size.x;e++)if(!this.board[t][e].isSpace())for(var i=this.board[t][e],n=this.findTile(i.getId()),a=0;a<n.length;a++)if(i!=n[a]&&this.isConnect(i.getPos(),n[a].getPos()))return this.startGame=!0,!1;return this.startGame=!0,!0},i.prototype.isGameClear=function(){return 0==this.remain},i.prototype.ClearPair=function(t,e,i){void 0===i&&(i=!1);var n=this.getTile(t),a=this.getTile(e);n.Clear(this.particleContainer,i),a.Clear(this.particleContainer,i),this.remain-=2,this.isGameClear()?this.emit("gameclear"):this.isGameOver()&&this.emit("gameover")},i}(t.Container),A=function(t){function i(i,n){var r=this;t.call(this);var h=new e.Container,l=new e.Sprite(i.resources.spritesheets.ui["pop_pop.png"]),c=new e.Container;c.position.set(l.width/2,l.height/2+30);var d=new o(i,n,i.resources.spritesheets.text["j_gamewotsudukeru.png"]);d.y=-120;var p=new o(i,n,i.resources.spritesheets.text["j_asobikata.png"]),u=new o(i,n,i.resources.spritesheets.text["j_titlehemodoru.png"]);u.y=120;var f=new _(i,n);f.position=c.position,f.y-=50,f.visible=!1;var m=function(t){var e=new s(i,t);e.animateScale(0,1,.2,a.Decel),e.animateAlpha(0,1,.2,a.Linear),r.addChild(e)};p.on("buttontap",(function(){r.emit("showmanual")})),d.on("buttontap",(function(){r.emit("batuTap")})),u.on("buttontap",(function(){h.visible=!1,f.visible=!0,m(f)})),f.on("hai",(function(){f.hai.setEnable(!1),r.emit("topScene")})),f.on("iie",(function(){h.visible=!0,f.visible=!1,m(r)})),h.addChild(l),c.addChild(d),c.addChild(p),c.addChild(u),h.addChild(c),this.addChild(h),this.addChild(f),this.pivot.set(this.width/2,this.height/2)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),_=function(t){function i(i,n){var a=this;t.call(this);var s=new e.Sprite(i.resources.spritesheets.text["pop_title.png"]),r=new e.Container;r.position.set(s.width/2,s.height/2+40);this.hai=new o(i,n,i.resources.spritesheets.text["hai2.png"]),this.hai.y=-60,this.iie=new o(i,n,i.resources.spritesheets.text["iie.png"]),this.iie.y=60,this.hai.on("buttontap",(function(){a.emit("hai")})),this.iie.on("buttontap",(function(){a.emit("iie")})),this.addChild(s),r.addChild(this.hai),r.addChild(this.iie),this.addChild(r),this.pivot.set(this.width/2,this.height/2)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),P=function(t){function i(i,n,a,s,r){var h=this;void 0===s&&(s=0),void 0===r&&(r=!0),t.call(this),this.$=i;var l=new e.Sprite(a),c=new e.Container;c.position.set(l.width/2,l.height/2+s);this.hai=new o(i,n,i.resources.spritesheets.text["hai.png"]),this.hai.y=-75;var d=new e.Sprite(i.resources.spritesheets.text["koukoku_text.png"]);d.anchor.set(.5),this.iie=new o(i,n,i.resources.spritesheets.text["iie.png"]),this.iie.y=75,this.hai.on("buttontap",(function(){if(r){h.hai.setEnable(!1);var t=new v(i);t.on("complete",(function(){h.emit("complete"),h.hai.setEnable(!0)})),t.on("failed",(function(){h.hai.setEnable(!0)})),h.addChild(t)}else h.emit("hai")})),this.iie.on("buttontap",(function(){h.emit("iie")})),this.addChild(l),c.addChild(this.hai),i.vars.env.hasRewardAd&&c.addChild(d),c.addChild(this.iie),this.addChild(c),this.pivot.set(this.width/2,this.height/2),this.visible=!1}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.FadeIn=function(){this.visible=!0;var t=new s(this.$,this);t.animateScale(0,1,.2,a.Decel),t.animateAlpha(0,1,.2,a.Linear),this.addChild(t)},i.prototype.FadeOut=function(t){var e=this;void 0===t&&(t=function(){}),this.interactiveChildren=!1;var i=new s(this.$,this);i.animateScale(1,0,.2,a.Accel),i.animateAlpha(1,0,.2,a.Linear),this.addChild(i),i.on("endAnim_all",(function(){e.interactiveChildren=!0,e.visible=!1,t()}))},i}(t.Container),T=function(t){function i(i){var n=this;t.call(this),this.$=i;var o=new r(i,2955277,.4);o.interactive=!0;var h=new e.Container;setTimeout((function(){var t=new e.Sprite(i.resources.spritesheets.ui["ready.png"]);t.anchor.set(.5,1);var r=new s(i,t);r.animateAlpha(0,1,.4,a.Linear,1,!0),n.addChild(r);var l=new s(i,t);l.animateScaleXY({x:1,y:1},{x:1.05,y:.9},.1,a.Decel,2),n.addChild(l);var c=new s(i,t);c.animateScaleXY({x:1,y:1},{x:.95,y:1.025},.05,a.Decel,2),c.animateVector({x:0,y:-15},.1,a.Decel),n.addChild(c);var d=new s(i,t);d.animateVector({x:0,y:15},.1,a.Accel),n.addChild(d);var p=new s(i,t);p.animateScaleXY({x:1,y:1},{x:1.025,y:.975},.1,a.Decel,2),n.addChild(p);var u=new s(i,t);u.Wait(.9),n.addChild(u);var f=new s(i,t);f.animateAlpha(1,0,.2,a.Linear),n.addChild(f);var m=s.Flipbook([r,l,c,d,p,u,f]);h.addChild(t),m.on("endFlipbook",(function(){var t=new e.Sprite(i.resources.spritesheets.ui["go.png"]);t.anchor.set(.5),t.y+=-50;var r=new s(i,t);r.animateScale(1,2.2,.15,a.Over,1,!0),n.addChild(r);var l=new s(i,t);l.animateScale(2.2,2.1,.05,a.Decel,2),n.addChild(l);var c=new s(i,t);c.Wait(.3),n.addChild(c);var d=new s(i,t);d.animateScale(2.2,0,.2,a.Accel),d.animateAlpha(1,0,.1,a.Linear),n.addChild(d);var p=s.Flipbook([r,l,c,d]);h.addChild(t),p.on("endFlipbook",(function(){o.fadeOut(.2)}))}))}),500),h.position.set(i.vars.additional.width/2,i.vars.additional.height/2),h.scale.set(1.25),o.on("endFadeOut",(function(){o.interactive=!1,n.emit("finishAnimation"),n.destroy()})),this.addChild(o),this.addChild(h)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),k=function(t){function i(i,n){var r=this;t.call(this),this.$=i;var h=new e.Sprite(i.resources.spritesheets.ui["gameover.png"]);h.anchor.set(.5,1),h.position.set(i.vars.additional.width/2,i.vars.additional.height/2+60);var l=new s(i,h);l.animateAlpha(0,1,.3,a.Linear,1,!0),l.animateVectorFrom({x:0,y:-200},.3,a.Linear,1),this.addChild(l);var c=new s(i,h);c.animateScaleXY({x:1,y:1},{x:1.05,y:.95},.1,a.Decel,2),this.addChild(c);var d=new s(i,h);d.animateVector({x:0,y:-5},.1,a.Decel,2),this.addChild(d),s.Flipbook([l,c,d]).on("endFlipbook",(function(){var t=new o(i,n,i.resources.spritesheets.text["tugihe2.png"]);t.position.set(i.vars.additional.width/2,i.vars.additional.height/2+285);var e=new s(i,t);e.animateAlpha(0,1,.2,a.Linear,1,!0),r.addChild(e),t.on("buttontap",(function(){t.setEnable(!1),r.emit("tugihe")})),r.addChild(t)})),this.addChild(h)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),L=function(t){function i(i,n,o,r){void 0===o&&(o=1),void 0===r&&(r=.3),t.call(this),this.$=i;var h=new e.Container;h.scale.set(o);var l=new e.Sprite(i.resources.spritesheets.ui["particle_light.png"]);l.anchor.set(.5),l.scale.set(1.6);var d=new s(i,l);d.animateAlpha(0,1,.6*r,a.Linear),this.addChild(d);var p=new e.Sprite(i.resources.spritesheets.ui["star.png"]);p.anchor.set(.5),p.rotation=c.Float(2*Math.PI);var u=new s(i,this);u.animateVector({x:n.x,y:n.y},r,a.Decel2),u.animateScale(.5,1,r,a.Decel2),this.addChild(u),h.addChild(l),h.addChild(p),this.addChild(h)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),M=function(t){function i(i){var n=this;t.call(this),this.$=i;var o=new e.Sprite(i.resources.spritesheets.ui["eat.png"]);o.anchor.set(.5,1);var r=1.25;o.scale.set(r),o.y+=-250;var h=new e.Sprite(i.resources.spritesheets.cake["eat0sw0_.png"]);h.anchor.set(.5,1),h.y+=h.height/2;var l=new e.Container,c=function(){var t=.5,c=new w(h,w.getSpritesheetTextures(i.resources.spritesheets.cake,"eat0sw","_.png",0,10));c.play(t),n.addChild(c);c.on("finish",(function(){h.texture=i.resources.spritesheets.cake["eat0sw11_.png"],h.rotation=-.1;var o=new s(i,h);o.animateVector({x:0,y:40},.1*t,a.Linear),o.animateRotation(-.05/Math.PI,0,.1*t,a.Decel2),n.addChild(o);var r=new s(i,h);r.animateScaleXY({x:1,y:1},{x:1.05,y:.9},.1*t,a.Decel,2),n.addChild(r);var c=new s(i,h);c.animateScaleXY({x:1,y:1},{x:.95,y:1.1},.08*t,a.Decel2,2),c.animateVector({x:0,y:-5},.1*t,a.Decel,2),n.addChild(c),s.Flipbook([o,r,c]),o.on("endAnim_all",(function(){var t=[];t.push(new L(i,new e.Point(130,-140),.9)),t.push(new L(i,new e.Point(135,-40),.7)),t.push(new L(i,new e.Point(-140,-70),.9));for(var o=0;o<t.length;o++)t[o].position=h.position,l.addChild(t[o]);setTimeout((function(){var t=new s(i,n);t.animateAlpha(1,0,.25,a.Linear,1,!0),n.addChild(t),t.on("endAnim_all",(function(){n.emit("finish"),n.destroy()}))}),700)}))})),setTimeout((function(){var e=new s(i,o);e.animateVector({x:0,y:190},.2*t,a.Accel),n.addChild(e);var h=new s(i,o);h.animateScaleXY({x:r,y:r},{x:1.3125,y:1.125},.1*t,a.Decel,2),n.addChild(h);var l=new s(i,o);l.animateScaleXY({x:r,y:r},{x:1.1875,y:1.375},.15*t,a.Decel2,2),l.animateVector({x:0,y:-15},.1*t,a.Decel,2),n.addChild(l),s.Flipbook([e,h,l])}),9*t/11*1e3)};this.addChild(l),this.addChild(h),this.addChild(o);var d=new s(i,this);d.animateAlpha(0,1,.4,a.Linear,1,!0),this.addChild(d),d.on("endAnim_all",(function(){setTimeout(c,300)}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),I=function(t){function i(i){var n=this;t.call(this),this.$=i;var o=new e.Sprite(i.resources.spritesheets.ui["time_c.png"]),r=new e.Point(.55,.5);o.anchor=r,o.scale.set(1.1),o.x=o.width*(r.x-.5),o.y=o.height*(r.y-.5),o.y+=-400;var h=new e.Sprite(i.resources.spritesheets.ui["stop_c.png"]),l=new e.Point(.25,.4);h.anchor=l,h.scale.set(1.1),h.x=h.width*(l.x-.5),h.y=h.height*(l.y-.5),h.y+=o.y+o.height/2+h.height/2,h.y+=20;var c=new e.Sprite(i.resources.spritesheets.clock["tokei_1.png"]);c.anchor.set(.5),c.scale.set(.9),c.y=75;var d=new e.Container;this.addChild(d),this.addChild(c),this.addChild(o),this.addChild(h);var p=new s(i,this);p.animateAlpha(0,1,.2,a.Linear,1,!0),this.addChild(p),p.on("endAnim_all",(function(){var t=new w(c,w.getSpritesheetTextures(i.resources.spritesheets.clock,"tokei_",".png",1,10));t.play(.5),n.addChild(t),t.on("finish",(function(){var t=new s(i,o);t.animateRotation(0,-.018,.25,a.Linear),n.addChild(t);var r=new s(i,h);r.animateRotation(0,.018,.25,a.Linear),n.addChild(r);var l=[];l.push(new L(i,new e.Point(190,-165),1.2)),l.push(new L(i,new e.Point(200,135),.85)),l.push(new L(i,new e.Point(140,200),.6)),l.push(new L(i,new e.Point(-175,190),.75)),l.push(new L(i,new e.Point(-210,140),.4)),l.push(new L(i,new e.Point(-190,-150),1)),l.push(new L(i,new e.Point(-135,-190),.4));for(var p=0;p<l.length;p++)l[p].position=c.position,d.addChild(l[p]);setTimeout((function(){var t=new s(i,n);t.animateAlpha(1,0,.25,a.Linear,1,!0),n.addChild(t),t.on("endAnim_all",(function(){n.emit("finish"),n.destroy()}))}),800)}))}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),F=function(t){function i(i){var n=this;t.call(this),this.$=i;var o=new e.Point(i.vars.additional.width/2,i.vars.additional.height/2-25),r=new e.Sprite(i.resources.spritesheets.ui["gameclear.png"]);r.anchor.set(.5),r.position=o;var h=new s(i,r);h.animateAlpha(0,1,.3,a.Linear,1,!0),h.animateScale(0,1.25,.3,a.OverFew,1,!0),this.addChild(h);for(var l=function(t){var r=["akakami","aokami","shirokami"],h=new e.Sprite(i.resources.spritesheets.ui[r[c.Index(r)]+".png"]);h.anchor.set(.5),h.rotation=c.Float(2*Math.PI),Math.random()<.5&&(h.alpha=.5),h.position=o;var l=new e.Point(c.Float(i.vars.additional.width),c.Float(i.vars.additional.height)),d=new s(i,h);d.animatePosition({x:o.x,y:o.y},{x:l.x,y:l.y},.6,a.Decel2),n.addChild(d),setTimeout((function(){var t=new s(i,h);t.animateAlpha(h.alpha,0,.2,a.Linear),n.addChild(t)}),400),setTimeout((function(){n.emit("endAnim"),n.destroy()}),1200),n.addChild(h)},d=0;d<64;d++)l();this.addChild(r)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),D=function(){};D.getEdgePos=function(t,i){i%=4;var n=t.position.clone(),a=new e.Point(t.width,t.height),o=[new e.Point(0,0),new e.Point(1,0),new e.Point(1,1),new e.Point(0,1),new e.Point(0,0)],s=i<2?1:-1,r=n,h=a.x/(a.x+a.y)*2,l=i<2?i<h?0:1:i-2<h?2:3,c=(i%2-(l%2==0?0:h))/(l%2==0?h:2-h);return r.x+=a.x*o[l].x,r.y+=a.y*o[l].y,r.x+=a.x*c*s*(l%2==0?1:0),r.y+=a.y*c*s*(l%2==1?1:0),r},D.getEdgePosSquare=function(t,i){i%=4;var n=t.position.clone(),a=new e.Point(t.width,t.height),o=[new e.Point(0,0),new e.Point(1,0),new e.Point(1,1),new e.Point(0,1),new e.Point(0,0)],s=i<2?1:-1,r=n,h=Math.floor(i),l=i%1;return r.x+=a.x*o[h].x,r.y+=a.y*o[h].y,r.x+=a.x*l*s*(h%2==0?1:0),r.y+=a.y*l*s*(h%2==1?1:0),r};var O=function(t){function i(i,n,h,l){var d=this;t.call(this),this.$=i;var p=function(){var t=l.getAllFrame(),e=1e3;return Math.floor(t<36e3?99e3*Math.pow(1-t/36e3,3.5)+e:e)};h.score=p();var u=h.score>n.highScore;u&&(n.highScore=h.score);var f=new e.Container;f.position.set(i.vars.additional.width/2,i.vars.additional.height/2);var v=new e.Sprite(i.resources.spritesheets.ui["pop_result.png"]);v.position.set(i.vars.additional.width/2,i.vars.additional.height/2),v.y+=25;u&&setTimeout((function(){var t=new e.Sprite(i.resources.images.gokou);t.anchor.set(.5);var n=new s(i,t);n.animateRotation(0,1,11,a.Linear,0,!0),d.addChild(n);var o=new e.Sprite(i.resources.images.gokou);o.anchor.set(.5);var h=new s(i,o);h.animateRotation(0,-1,11,a.Linear,0,!0),d.addChild(h);var l=new e.Sprite(i.resources.images.gokou_maru);l.anchor.set(.5);var c=new s(i,l);c.animateAlpha(0,1,1.75,a.Decel,0,!0),d.addChild(c);var p=new r(i,16777215,1);p.graphics.blendMode=e.BLEND_MODES.ADD;var u=new s(i,p);u.animateAlpha(.7,0,1,a.Accel,1,!0),d.addChild(u),f.addChild(l),f.addChild(t),f.addChild(o),d.addChild(p)}),650),this.addChild(f),this.addChild(v),v.pivot.set(v.width/2,v.height/2);var w=new s(i,v);w.animateScale(0,1,.2,a.OverFew),w.animateAlpha(0,1,.15,a.Linear),this.addChild(w),w.on("endAnim_all",(function(){var t=function(t){var e=new s(i,t);e.animateAlpha(0,1,.1,a.Linear,1,!0),e.animateScale(0,1,.2,a.OverFew,1,!0),d.addChild(e)},r=new o(i,n,i.resources.spritesheets.text["tugihe.png"]);r.position=new e.Point(v.width/2,v.height/2),r.y+=250,t(r);var h=new e.Container;h.position=new e.Point(v.width/2,v.height/2),h.y+=-150,t(h);var f=new e.Sprite(i.resources.spritesheets.ui["score.png"]);f.anchor.set(.5),f.y+=-75;var w=g.getSpritesheetTextures(i.resources.spritesheets.number,"ye_",".png"),x=new g(i,w,p());x.setMargin(-3),x.scale.set(1.75),x.y+=120;var C=new e.Sprite(i.resources.spritesheets.ui["result_hikari.png"]);C.anchor.set(.5),C.y+=12.5;var S=new e.Container;S.position=new e.Point(v.width/2,v.height/2),S.y+=50,t(S);var b=new e.Sprite(i.resources.spritesheets.ui["bestscore.png"]);b.anchor.set(.5),b.y+=-75;var A=new e.Sprite(i.resources.spritesheets.ui["time_r.png"]);A.anchor.set(.5),A.y+=30;var _=g.getSpritesheetTextures(i.resources.spritesheets.number,"re_",".png"),P=new g(i,_,n.highScore);P.setMargin(5),P.scale.set(.75),P.y+=20;var T=m.getSpritesheetTextures(i.resources.spritesheets.number,"re_",".png"),k=new m(i,T);k.setTime(l.getTime()),k.setMargin(5),k.y+=95;var L=new e.Container,M=function(){var t=new e.Sprite(i.resources.spritesheets.ui["hikari.png"]);t.anchor.set(.5);var n=function(t){var e=D.getEdgePos(x,t);return e.x+=70,e.y+=55,e}(c.Float(4)),o=new e.Point(c.RangeFloat(-25,25),c.RangeFloat(-25,25));t.position=y.Plus(n,o);var r=c.RangeFloat(1,2),h=new s(i,t);h.animateScale(0,r,.2,a.Linear,1,!0),h.animateAlpha(0,1,.2,a.Accel,1,!0),d.addChild(h);var l=new s(i,t);l.animateScale(r,0,.2,a.Decel,1,!0),l.animateAlpha(1,0,.2,a.Decel,1,!0),d.addChild(l),s.Flipbook([h,l]),L.addChild(t),setTimeout(M,c.RangeInt(40,200))};u&&setTimeout(M,1650),r.on("buttontap",(function(){r.setEnable(!1),d.emit("tugihe")})),S.addChild(b),S.addChild(A),S.addChild(P),S.addChild(k),v.addChild(S),h.addChild(C),h.addChild(f),h.addChild(x),v.addChild(h),v.addChild(L),v.addChild(r)}))}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),z=function(t){function i(i,c,d){var p=this;t.call(this),n.PlayBGM(i,c,"bgm");var u=new e.Point(i.vars.additional.width/2,i.vars.additional.height/2),f=new T(i),v=new r(i,2955277),g=new e.Sprite(i.resources.spritesheets.text["eat_choose_text.png"]);g.anchor.set(.5),g.x=u.x,g.y=.91*i.vars.additional.height,g.alpha=0;var y=new o(i,c,i.resources.spritesheets.ui["batsu_button.png"]);y.x=i.vars.additional.width-y.width/2-25,y.y=y.height/2+25,y.scale.set(1.1),y.alpha=0,y.setInteractive(!1);var w=new s(i,g);w.animateAlpha(0,1,.3,a.Decel,0,!0),this.addChild(w),w.Stop();var x=new r(i,2955277);x.setInteractive(!0);var C=new l(i),_=new e.Sprite(i.resources.spritesheets.ui["time_ui.png"]);_.anchor.set(.5),_.x=u.x,_.y=_.height/2+25;var L=new m(i,m.getSpritesheetTextures(i.resources.spritesheets.number,"ti_",".png"));L.position.set(57.5,20);var D=new e.Point(90,35),z=new o(i,c,i.resources.spritesheets.ui["time_button.png"]);z.y=i.vars.additional.height-z.height/2-D.y,z.x=u.x-D.x;var R=new P(i,c,i.resources.spritesheets.text["pop_time.png"],175);R.position=u,R.y+=25;var j=new o(i,c,i.resources.spritesheets.ui["eat_button.png"]);j.y=i.vars.additional.height-j.height/2-D.y,j.x=u.x+D.x;var E=new P(i,c,i.resources.spritesheets.text["pop_eat.png"],175,!1);E.position=u,E.y+=25;var V=new P(i,c,i.resources.spritesheets.text["pop_continue.png"],75);V.position=u,V.y+=25;var $=new r(i,0,1);$.fadeOut(.2);var Y=new e.Container,G=new e.Container,U=new b(i,c,new e.Point(7,10),G);U.x=u.x-U.width/2,U.y=u.y-U.height/2-7.5;var N=new o(i,c,i.resources.spritesheets.ui["b_pause.png"]);N.x=i.vars.additional.width-N.width/2-25,N.y=N.height/2+25;var X=new A(i,c);X.position=u,X.visible=!1;var W=new h(i,c,!1);W.interactive=!0,W.visible=!1;var B=function(t){t?(x.fadeIn(.3,.9),x.setInteractive(!0),U.setTilesVisible(!1),Q||L.Stop()):(x.fadeOut(.3),x.on("endFadeOut",(function(){x.setInteractive(!1),U.setTilesVisible(!0),Q||L.Play()})))},q=function(){n.Stop(i,"bgm"),i.vars.api.callAsync("quitGame").then((function(){i.vars.api.viewAdAsync().then((function(t){p.emit("topScene")})).catch((function(t){p.emit("topScene")}))}))},Z=!1,H=!1;f.on("finishAnimation",(function(){Z=!0,L.Play(),x.setInteractive(!1)}));var J=function(){B(!0);var t=new F(i);p.addChild(t),t.on("endAnim",(function(){var t=new O(i,c,d,L);t.on("tugihe",(function(){var t;t=!1,n.Stop(i,"bgm"),p.emit("nextScene",t)})),p.addChild(t)}))};U.on("seikai",(function(t,e){var n=new S(i,U);n.DrawLine3(t[0],t[1],t[2],t[3],10),Y.addChild(n),setTimeout((function(){n.destroy()}),250)})),X.on("topScene",(function(){q()})),X.on("showmanual",(function(){W.visible=!0;var t=new s(i,W);t.animateAlpha(0,1,.3,a.Linear),p.addChild(t)})),W.on("nextScene",(function(){var t=new s(i,W);t.animateAlpha(1,0,.3,a.Linear),p.addChild(t),t.on("endAnim_all",(function(){W.visible=!1}))})),N.on("buttontap",(function(){X.visible=!0;var t=new s(i,X);t.animateScale(0,1,.2,a.Decel),t.animateAlpha(0,1,.2,a.Linear),p.addChild(t),B(!0)})),X.on("batuTap",(function(){X.interactiveChildren=!1;var t=new s(i,X);t.animateScale(1,0,.2,a.Accel),t.animateAlpha(1,0,.2,a.Linear),p.addChild(t),t.on("endAnim_all",(function(){X.interactiveChildren=!0,X.visible=!1})),B(!1)})),z.on("buttontap",(function(){R.FadeIn(),B(!0)})),R.on("complete",(function(){z.setEnable(!1),R.FadeOut((function(){U.setTilesVisible(!0);var t=new I(i);t.position=u,t.scale.set(.9),p.addChild(t),t.on("finish",(function(){B(!1),it()}))}))})),R.on("iie",(function(){R.FadeOut(),B(!1)})),j.on("buttontap",(function(){E.FadeIn(),B(!0)})),E.on("hai",(function(){E.FadeOut(),B(!1),v.fadeIn(.3,.9),v.interactive=!0;var t=new s(i,y);t.animateAlpha(0,1,.3,a.Linear,1,!0),p.addChild(t),y.setInteractive(!0),w.Play(),U.setHammerMode(!0),j.setEnable(!1)})),y.on("buttontap",(function(){v.fadeOut(.2),v.interactive=!1;var t=new s(i,y);t.animateAlpha(1,0,.2,a.Linear,1,!0),p.addChild(t),y.setInteractive(!1),w.setFrameAll(0),w.Stop(),g.alpha=0,U.setHammerMode(!1),j.setEnable(!0)})),E.on("iie",(function(){E.FadeOut(),B(!1)}));var K=!1;U.on("begin_eat",(function(){Q||L.Stop()})),U.on("use_eat",(function(){var t=new s(i,y);t.animateAlpha(1,0,.2,a.Linear,1,!0),p.addChild(t),y.setInteractive(!1),v.fadeOut(.3),w.clear();var e=new s(i,g);e.animateAlpha(g.alpha,0,.15,a.Linear,1,!0),p.addChild(e);var n=new r(i,2955277,0);p.addChild(n),n.fadeIn(.2,.9);var o=new M(i);o.position=u,o.scale.set(.9),p.addChild(o),o.on("finish",(function(){n.fadeOut(.1)})),K=!0})),U.on("used_eat",(function(){Q||L.Play(),K=!1,v.interactive=!1})),U.on("failed_eat",(function(){Q||L.Play()}));var Q=!1,tt=10;this.task.on("timeStop",(function(t){if(Q&&!X.visible&&!E.visible&&!K&&Z){var e=t.delta;tt-=e/60}tt<=0&&(tt=10,Q=!1,nt())}));var et=new s(i,L),it=function(){Q=!0,L.Stop(),et.animateAlpha(1,.3,.25,a.Accel,0),p.addChild(et)},nt=function(){L.Play(),et.clear(),L.alpha=1};U.on("gameover",(function(){L.Stop(),Z=!1,x.setInteractive(!0);var t=function(){B(!0),H?t():(V.FadeIn(),U.setTilesVisible(!0))};setTimeout(t,1e3)})),V.on("complete",(function(){Z=!0,H=!0,V.FadeOut(),B(!1),U.reflesh()})),V.on("iie",(function(){V.FadeOut((function(){var t;(t=new k(i,c)).on("tugihe",(function(){q()})),p.addChild(t)}))})),U.on("gameclear",(function(){Z=!1,L.Stop(),x.setInteractive(!0),setTimeout(J,900)})),this.addChild(C),_.addChild(L),this.addChild(_),i.vars.env.isAdPlatform&&(this.addChild(z),this.addChild(j)),this.addChild(N),this.addChild(v),this.addChild(g),this.addChild(y),this.addChild(Y),this.addChild(U),this.addChild(G),this.addChild(x),this.addChild(R),this.addChild(E),this.addChild(X),this.addChild(V),this.addChild(W),this.addChild($),this.addChild(f)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i}(t.Container),R=function(t){this.image={},this.sheet={},this.imagedefine={},this.sheetdefine={},this.$=t};R.prototype.resourceTakeout=function(t){var e={};for(var i in t)e[i]=t[i].data;return e},R.prototype.defineImages=function(t){this.imagedefine=t},R.prototype.defineSpritesheets=function(t){this.sheetdefine=t},R.prototype.loadAllResources=function(){var e=this,i=new t.TextureLoader,n=new t.SpritesheetLoader,a={},o={},s=this.$.vars.api.getLanguage(),r=[];for(var h in this.imagedefine)a[h]=this.imagedefine[h].replace(/\?/,s);for(var l in this.sheetdefine)o[l]=this.sheetdefine[l].replace(/\?/,s);var c={basepath:this.$.vars.env.basepath,version:this.$.vars.env.version+""};return r.push(i.loadAllAsync(a,c).then((function(t){e.image=e.resourceTakeout(t)}))),r.push(n.loadAllAsync(o,c).then((function(t){e.sheet=e.resourceTakeout(t)}))),Promise.all(r)};var j=function(t){function e(e){var i=this;t.call(this);var n=function(t){e.vars.api.changeLanguageAsync(t).then((function(){var t=new R(e);t.defineImages({asobikata:"assets/languages/?/asobikata.png",rogo:"assets/languages/?/rogo.png"}),t.defineSpritesheets({text:"assets/languages/?/text.json"}),t.loadAllResources().then((function(){for(var i in t.image)e.resources.images[i]=t.image[i];for(var n in t.sheet)e.resources.spritesheets[n]=t.sheet[n];s()}))}))};this.scale.set(.5),e.vars.additional.width=2*e.width,e.vars.additional.height=2*e.height,e.vars.additional.root=this;var a={isMute:!1,highScore:0},o={score:0};a.highScore=e.vars.data.highScore||0;var s=function(t){var s,r=new PIXI.Container,l=function(){var t=new f(e,a,o);t.on("nextScene",(function(){t.task.clear(),t.destroy(),c()})),r.addChild(t)},c=function(){e.vars.api.callAsync("playGame").then((function(){o.score=0;var t=new z(e,a,o);t.on("nextScene",(function(){var i=function(){t.task.clear(),t.destroy()};e.vars.api.setDataAsync("highScore",a.highScore,"more").then((function(){d(i)})).catch((function(t){d(i)}))})),t.on("topScene",(function(){t.task.clear(),t.destroy(),l()})),r.addChild(t)}))},d=function(t){void 0===t&&(t=function(){}),e.vars.api.sendScoreAsync(o.score).then((function(){e.vars.api.callAsync("finishPlay").then((function(){t(),l()}))})).catch((function(t){d()}))};i.on("changeLang",(function(t){r.destroy(),i.removeChildren(),n(t)})),(s=new h(e,a)).on("nextScene",(function(){s.task.clear(),s.destroy(),l()})),r.addChild(s),i.addChild(r)};e.vars.api.callAsync("startGame").then((function(){n(e.vars.api.getLanguage())}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(t.Container),E=t.Content.create();E.setConfig({width:360,height:640}),E.defineImages({haikei:"assets/images/haikei.png",gokou:"assets/images/gokou.png",gokou_maru:"assets/images/gokou_maru.png"}),E.defineSpritesheets({title_sweets:"assets/sprite_sheet/title_sweets.json",sweets:"assets/sprite_sheet/sweets.json",number:"assets/sprite_sheet/number.json",ui:"assets/sprite_sheet/ui.json",cake:"assets/sprite_sheet/cake.json",clock:"assets/sprite_sheet/clock.json",lang:"assets/languages/languages.json",langui:"assets/languages/languageui.json"}),E.defineSounds({bgm:"assets/sounds/se_bgm.mp3",button:"assets/sounds/se_button.mp3",sentaku:"assets/sounds/se_sentaku.mp3",seikai:"assets/sounds/se_seikai.mp3"}),E.defineJsons({}),E.defineLibraries({root:j}),i.defineAnimatesTo(E,{}),SCG.startAsync({Content:E,width:360,height:640})}(Pixim,PIXI,Pixim.animate);

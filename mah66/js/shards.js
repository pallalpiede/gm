var Helper,UI,Utils,Shards,Sponsor,__extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();function launch(){var e=Shards.Global.SPONSORS[Shards.sponsorName];if(void 0!==e){var t=(Shards.Global.sponsor=e).id;if(1===t){var i=new Shards.Game;e.sdk=new Sponsor.SponsorBuongiorno(i)}else if(10===t){i=new Shards.Game;e.sdk=new Sponsor.SponsorGTM(i,window.sbcPublisherId,window.sbcProductKey)}else if(2===t){i=new Shards.Game;e.sdk=new Sponsor.SponsorFamobi(i)}else if(8===t)try{var s=document.location.href.split("/")[2].split("."),a=s[s.length-2]+"."+s[s.length-1];-1<["pacogames.com","gamearter.com"].indexOf(a)?e.sdk=new Sponsor.SponsorGameArter(null,6868,1,function(){var t=new Shards.Game;e.sdk.game=t}):(alert("Please, load the game from PacoGames.com"),document.getElementsByTagName("body")[0].innerHTML="Unauthorized game start. Play the game on PacoGames")}catch(t){document.getElementsByTagName("body")[0].innerHTML="Unauthorized game start. Play the game on PacoGames",alert("Some kind of problem occured. Please, let us know about the problem at content@pacogames.com")}else if(7===t){if(Shards.Global.currentLanguage="jp",Shards.Global.SPONSOR_DEBUG){Shards.Global.WKB_DEBUG_WARNING=!1;var o={};window.wkbGetUserData=function(t){return(o=JSON.parse(localStorage.getItem("wkbUserData"))||{})[t]},window.wkbSetUserData=function(t,e){o[t]=e,localStorage.setItem("wkbUserData",JSON.stringify(o))},window.wkbRemoveUserData=function(t){delete o[t],localStorage.setItem("wkbUserData",JSON.stringify(o))},window.wkbGameStart("pc",function(){},function(){},function(){},function(){},function(){})}}else if(9===t){i=new Shards.Game;e.sdk=new Sponsor.SponsorGameDistribution(i,"bcc71660edef4def8d3d58e6a2cd2306")}else{i=new Shards.Game;e.sdk=new Sponsor.SponsorAdapter(i)}}}function wkbGameStart(t,e,i,s,a,o){Shards.Global.SPONSOR_DEBUG&&Shards.Global.WKB_DEBUG_WARNING;var n=new Shards.Game,r=new Sponsor.SponsorWKB(n),h=Shards.Global.SPONSORS[Shards.sponsorName];return(Shards.Global.sponsor=h).sdk=r,h.sdk.setCallbacks({callbackStart:e,callbackShowAd:i,callbackSendScore:s,callbackError:a,callbackStartLog:o}),e()}!function(t){var e;function i(t){return-2*t*t+3*t}(e=t.Easing||(t.Easing={})).wiggle=function(t,e,i){var s=t*Math.PI*2*e,a=t*Math.PI*2*i;return Math.sin(s)*Math.cos(a)},e.sinWithExpDecay=function(t,e,i){var s=t*Math.PI*2*e,a=-t*i;return Math.sin(s)*Math.exp(a)},e.parabolic=function(t){return t*(2*t-1)},e.pop5=i,e.pop5rev=function(t){return-(i(1-t)-1)},e.sin=function(t){return Math.sin(2*t*Math.PI)},e.cos=function(t){return Math.cos(2*t*Math.PI)},e.sinRotate=function(t){return Math.sin(2*t*Math.PI)},e.sinWithPeriod=function(t,e){return Math.sin(2*t*Math.PI*e)}}(Shards=Shards||{}),function(t){var e=(l.prototype.easing=function(t){for(var e=0,i=0;e<this._bounces&&t>i+this._bounceDuration[e];)i+=this._bounceDuration[e],++e;return e>=this._bounces?0:(t-=i,0==e&&this._halveFirstBounce?1+this._acceleration*(t*t)/2:t*(this._bouceVelocity[e]+this._acceleration*t/2))},l.EPSILON=.001,l.BOUNCES_MAX=10,l);function l(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=!0),this._bounceDuration=[],this._bounceHeight=[],this._bouceVelocity=[],!(t<=0&&e<0)){if(0<t&&e<0)e=Math.pow(l.EPSILON,1/t);else if(0<e&&t<=0){if(1<=e)return;t=Math.floor(Math.log(l.EPSILON)/Math.log(e)),t=Math.min(t,l.BOUNCES_MAX)}for(var s=l.EPSILON,a=0,o=1,n=0;n<t;n++){var r=2*Math.sqrt(2*o/s);i&&0==n&&(r/=2),this._bounceDuration[n]=r,this._bounceHeight[n]=o,a+=r,o*=e}for(n=0;n<t;n++){r=this._bounceDuration[n]/a;this._bounceDuration[n]=r}var h=i?this._bounceDuration[0]:this._bounceDuration[0]/2;this._acceleration=2/(h*h);for(n=0;n<t;n++)this._bouceVelocity[n]=0==n&&i?0:this._bounceDuration[n]/2*this._acceleration;this._acceleration=-this._acceleration,this._bounces=t,this._elasticity=e,this._halveFirstBounce=i}}t.GravityBounce=e}(Helper=Helper||{}),function(t){function n(t,e,i){return(e-t)*i+t}function o(t,e,i,s){return n(n(t,e,s),n(e,i,s),s)}function r(t,e,i,s,a){return n(o(t,e,i,a),o(e,i,s,a),a)}t.linear=n,t.quadratic=o,t.cubic=r,t.quintic=function(t,e,i,s,a,o){return n(r(t,e,i,s,o),r(e,i,s,a,o),o)},t.angleLinear=function(t,e,i,s){return 0===i?t:(0<i?t<e&&(e-=360):e<t&&(e+=360),this.linear(t,e,s))}}(Helper=Helper||{}),function(t){var e=(d.create=function(t,e,i,s,a,o,n,r,h,l){void 0===o&&(o=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===h&&(h=0),void 0===l&&(l=!1);var _,c=new Phaser.Image(t,0,0,s,a);return _="string"==typeof a?t.cache.getFrameByName(s,a):t.cache.getFrameByIndex(s,a),d.calculateNineImage(_,e,i,o,n,r,h,l),d._nineImage=new Phaser.BitmapData(t,"NineImage"+d._textureKey++,d._width,d._height),d.renderNineImage(c),d._nineImage},d.calculateNineImage=function(t,e,i,s,a,o,n,r){if(d._centralWidth=t.width-a-n,d._centralHeight=t.height-s-o,r)d._horizontalRepeats=e,d._verticalRepeats=i,d._width=a+n+d._centralWidth*e,d._height=s+o+d._centralHeight*i,d._lastWidth=0,d._lastHeight=0;else{var h=e-a-n;d._horizontalRepeats=Math.floor(h/d._centralWidth),d._lastWidth=h%d._centralWidth;var l=i-s-o;d._verticalRepeats=Math.floor(l/d._centralHeight),d._lastHeight=l%d._centralHeight,d._width=e,d._height=i}d._leftWidth=a,d._rightWidth=n,d._topHeight=s,d._bottomHeight=o},d.renderNineImage=function(t){var e=0,i=0;0<d._topHeight&&(d.renderNineImageRow(t,e,i,d._topHeight),e+=d._topHeight,i+=d._topHeight);for(var s=0;s<d._verticalRepeats;s++)d.renderNineImageRow(t,e,i,d._centralHeight),i+=d._centralHeight;0<d._lastHeight&&(d.renderNineImageRow(t,e,i,d._lastHeight),i+=d._lastHeight),e+=d._centralHeight,0<d._bottomHeight&&d.renderNineImageRow(t,e,i,d._bottomHeight)},d.renderNineImageRow=function(t,e,i,s){var a=0,o=0;0<d._leftWidth&&(d._nineImage.copy(t,a,e,d._leftWidth,s,o,i),o+=d._leftWidth,a+=d._leftWidth);for(var n=0;n<d._horizontalRepeats;n++)d._nineImage.copy(t,a,e,d._centralWidth,s,o,i),o+=d._centralWidth;0<d._lastWidth&&(d._nineImage.copy(t,a,e,d._lastWidth,s,o,i),o+=d._lastWidth),a+=d._centralWidth,0<d._rightWidth&&d._nineImage.copy(t,a,e,d._rightWidth,s,o,i)},d._textureKey=0,d);function d(){}t.NineImage=e}(Helper=Helper||{}),function(t){var M,e;(e=M=M||{})[e.UNDEFINED=-1]="UNDEFINED",e[e.SPACE=1]="SPACE",e[e.NEWLINE=2]="NEWLINE",e[e.CHARACTER=3]="CHARACTER";var i=(G.hasNext=function(){return G.textPosition<G.text.length},G.getChar=function(){return G.text.charAt(G.textPosition++)},G.peekChar=function(){return G.text.charAt(G.textPosition)},G.getPosition=function(){return G.textPosition},G.setPosition=function(t){G.textPosition=t},G.getCharAdvance=function(t,e){var i=G.fontData.chars[t];if(void 0===i)return 1;var s=i.xAdvance;return 0<e&&i.kerning[e]&&(s+=i.kerning[e]),s},G.getCharType=function(t){return" "===t?M.SPACE:/(?:\r\n|\r|\n)/.test(t)?M.NEWLINE:M.CHARACTER},G.wrapText=function(t,e,i,s,a,o){G.text=e,G.setPosition(0),G.fontData=t.cache.getBitmapFont(a).font,void 0===o&&(o=G.fontData.size);var n=o/G.fontData.size,r=G.fontData.lineHeight*n,h=i/n,l=[],_=[],c=[],d=0,u=0,p=0;l[d]=p,c[u++]=0;for(var g=s;G.hasNext();){for(var m=0,S=0,T=-1,E=M.UNDEFINED,b=M.UNDEFINED,f=h,y=-1;G.hasNext();){p=G.getPosition();var O=G.getChar();E=G.getCharType(O);var A=O.charCodeAt(0);if(E===M.SPACE)b!==M.SPACE&&(S=m),++m,f-=G.getCharAdvance(A,y);else if(E===M.CHARACTER){if(b!==M.CHARACTER&&(T=p),(f-=G.getCharAdvance(A,y))<0)break;++m}else if(E===M.NEWLINE){var I=!1;if(G.hasNext()&&(I=!0,S=m,p=T=G.getPosition(),f=-1,E=M.CHARACTER),I)break}b=E,y=A}(g-=r)<0&&(c[u++]=d),f<0&&E===M.CHARACTER?(_[d]=0!==S?S:m,g<0&&(g=s-r),0!==S?(l[++d]=T,G.setPosition(T)):(l[++d]=p,G.setPosition(p))):G.hasNext()||(E===M.CHARACTER?_[d]=m:E===M.SPACE&&(_[d]=S))}c[u]=d+1;for(var v=[],C=1;C<=u;C++){for(var N=c[C-1],L=c[C],P=[],B=N;B<L;B++)P.push(G.text.substr(l[B],_[B]));v.push(P.join("\n"))}return v},G);function G(){}t.TextWrapper=i}(Helper=Helper||{}),function(p){var g,t=(g=Phaser.Group,__extends(m,g),m.GLASS_WIDTH=440,m.GLASS_HEIGHT=500,m);function m(t,e,i){var s=g.call(this,t,e)||this;s._board=i;var a=p.Global.LOW?.4:1,o=m.GLASS_WIDTH*a,n=m.GLASS_HEIGHT*a,r=36*a,h=30*a,l=Helper.NineImage.create(t,o,n,"GUI","GLASS",80*a,60*a,80*a,60*a,!1);t.add.sprite(0,0,l,0,s).anchor.set(.5,.5);var _=Helper.TextWrapper.wrapText(t,Utils.TextUtils.getText("TXT_SCORE_LOST"),o-2*h,n,"Font",r),c=new Phaser.BitmapText(t,0,0-n/2+h,"Font",_[0],r);s.add(c),c.anchor.x=.5;var d=new UI.Button(s.game,"Cancel","GUI","BUTTON_CANCEL");d.position.set(-o/2+85*a,n/2-70*a),d.scaleOnOver.set(1.1,1.1),d.onClick.add(function(t){this._board.onExitWarningNo(t)},s),s.add(d);var u=new UI.Button(s.game,"Next","GUI","ICON_CONFIRM");return u.position.set(o/2-85*a,n/2-70*a),u.scaleOnOver.set(1.1,1.1),u.onClick.add(function(t){this._board.onExitWarningYes(t)},s),s.add(u),s}p.ExitWarning=t}(Shards=Shards||{}),function(d){var u,t=(u=Phaser.Group,__extends(p,u),p.GLASS_WIDTH=440,p.GLASS_HEIGHT=250,p);function p(t,e,i){var s=u.call(this,t,e)||this;s._board=i;var a=d.Global.LOW?.4:1,o=p.GLASS_WIDTH*a,n=p.GLASS_HEIGHT*a,r=36*a,h=30*a,l=Helper.NineImage.create(t,o,n,"GUI","GLASS",80*a,60*a,80*a,60*a,!1);t.add.sprite(0,0,l,0,s).anchor.set(.5,.5);var _=Helper.TextWrapper.wrapText(t,Utils.TextUtils.getText("TXT_TUTORIAL"),o-2*h,n,"Font",r),c=new Phaser.BitmapText(t,0,0,"Font",_[0],r);return s.add(c),c.anchor.set(.5),s}d.Tutorial=t}(Shards=Shards||{}),function(t){var e,i=(e=Phaser.State,__extends(s,e),s.prototype.preload=function(){this.load.image("Logo","assets/sponsor/Logo.png"),this.load.audio("LogoSound",["assets/sponsor/sound.ogg","assets/sponsor/sound.m4a","assets/sponsor/sound.mp3"])},s.prototype.create=function(){this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0),this.stage.backgroundColor=0,this._sound=this.add.audio("LogoSound");var t=this.add.group(this.world),e=this.game.width/s.LOGO_ANIM_WIDTH;t.scale.set(e,e),this._logo=this.add.sprite(0,0,"Logo",0,t),this._logo.anchor.copyFrom(s.LOGO_ANCHOR),this.setLogoFrame(this._animIdx)},s.prototype.setLogoFrame=function(t){t>=s.LOGO_ANIM.length&&(t=s.LOGO_ANIM.length-1);var e=s.LOGO_ANIM[t];this._logo.position.set(e.x,e.y),this._logo.scale.set(e.scaleX,e.scaleY),void 0!==e.sound&&this._sound.play()},s.prototype.update=function(){if(!this._animOver&&(this._time+=this.time.elapsedMS,s.LOGO_ANIM[this._animIdx].time<this._time))if(this.setLogoFrame(this._animIdx),this._animIdx===s.LOGO_ANIM.length-1)this._animOver=!0,this.game.state.start("Preloader",!0,!1);else for(;this._animIdx<s.LOGO_ANIM.length&&s.LOGO_ANIM[this._animIdx].time<this._time;)++this._animIdx},s.prototype.shutdown=function(){this._logo=null,this._sound=null,this.cache.removeSound("LogoSound")},s.LOGO_ANIM_WIDTH=1440,s.LOGO_ANIM_HEIGHT=900,s.LOGO_ANCHOR=new Phaser.Point(.510396975,.29820498),s.LOGO_ANIM=[{time:0,x:1,y:-1,scaleX:0,scaleY:0,sound:"LogoSound"},{time:791,x:1,y:-1,scaleX:.462769,scaleY:.462769},{time:1458,x:1,y:-1,scaleX:.77356,scaleY:.77356},{time:1999,x:1,y:-1,scaleX:1.440338,scaleY:1.440338},{time:2291,x:1,y:-1,scaleX:1.445007,scaleY:1.445007},{time:2374,x:1,y:-1,scaleX:1.658508,scaleY:1.658508},{time:2583,x:1,y:-1,scaleX:1.74144,scaleY:1.74144},{time:2791,x:1,y:-1,scaleX:2.028625,scaleY:2.028625},{time:3207,x:1,y:-1,scaleX:2.120972,scaleY:2.120972},{time:3291,x:1,y:-1,scaleX:2.436874,scaleY:2.436874},{time:3457,x:1,y:-1,scaleX:2.103882,scaleY:2.103882},{time:3582,x:1,y:-1,scaleX:2.135498,scaleY:2.135498},{time:3707,x:1,y:-1,scaleX:0,scaleY:0},{time:3749,x:1,y:-1,scaleX:2.135498,scaleY:2.135498},{time:3874,x:1,y:-1,scaleX:0,scaleY:0},{time:3957,x:1,y:-1,scaleX:8.09906,scaleY:8.09906},{time:3999,x:-175,y:159,scaleX:8.09906,scaleY:8.09906},{time:4040,x:241,y:-155,scaleX:8.09906,scaleY:8.09906},{time:4165,x:1,y:-1,scaleX:0,scaleY:0},{time:4207,x:1,y:-1,scaleX:2.412292,scaleY:2.412292},{time:5498,x:1,y:-1,scaleX:0,scaleY:0}],s);function s(){var t=e.call(this)||this;return t._animIdx=0,t._time=-500,t._animOver=!1,t}t.Logo2=i}(Shards=Shards||{}),function(t){var e,i=(e=Phaser.State,__extends(s,e),s.prototype.create=function(){this.stage.backgroundColor=16777215},s.prototype.update=function(){this._lock||t.Global.correctOrientation&&(this._lock=!0,this.time.events.add(200,function(){void 0===t.Global.sponsor.logo?this.game.state.start("Preloader",!0,!1):(this.game.state.add("Logo",t.Logo),this.game.state.start("Logo",!0,!1))},this))},s);function s(){var t=e.call(this)||this;return t._lock=!1,t}t.OrientationWait=i}(Shards=Shards||{}),function(t){var l,e=(l=Phaser.Group,__extends(i,l),Object.defineProperty(i.prototype,"anchor",{get:function(){return this._button.anchor},enumerable:!1,configurable:!0}),i.prototype.setHitArea=function(t){this._button.hitArea=t},i.prototype.setTint=function(t,e){void 0===e&&(e=0),this._downTint=t,this._overTint=e},i.prototype.overEvent=function(){this.setButton(!0,this._down),this.overAction()},i.prototype.outEvent=function(){this.setButton(!1,!1),this.outAction()},i.prototype.downEvent=function(){this.setButton(this._over,!0),this.downAction(),this.onDown.dispatch(this)},i.prototype.upEvent=function(t,e,i){this.setButton(this._over,!1),this.upAction(),i&&this.onClick.dispatch(this)},i.prototype.setButton=function(t,e){this._over||this._down||(this._saveScale.copyFrom(this._button.scale),this._savePosition.copyFrom(this._button.position)),this._down=e,this._over=t,e?(Phaser.Point.multiply(this._saveScale,this.scaleOnDown,this._button.scale),Phaser.Point.add(this._button.position,this.offsetOnDown,this._button.position),this._tinted&&(this._button.tint=this._downTint)):t?(Phaser.Point.multiply(this._saveScale,this.scaleOnOver,this._button.scale),Phaser.Point.add(this._button.position,this.offsetOnOver,this._button.position),this._tinted&&(this._button.tint=this._overTint)):(this._button.scale.copyFrom(this._saveScale),this._button.position.copyFrom(this._savePosition),this._tinted&&(this._button.tint=16777215))},i.prototype.overAction=function(){},i.prototype.outAction=function(){},i.prototype.downAction=function(){Utils.AudioUtils.playSound(Shards.Sfx.CLICK)},i.prototype.upAction=function(){},i);function i(t,e,i,s,a,o,n){var r=l.call(this,t)||this;r.onClick=new Phaser.Signal,r.onDown=new Phaser.Signal,r.scaleOnOver=new Phaser.Point(1,1),r.scaleOnDown=new Phaser.Point(1,1),r.offsetOnOver=new Phaser.Point(0,0),r.offsetOnDown=new Phaser.Point(0,0),r._tinted=!1,r._downTint=8421504,r._overTint=0,r._savePosition=new Phaser.Point,r._saveScale=new Phaser.Point,r._over=!1,r._down=!1;var h=new Phaser.Button(t,0,0,i);return r.add(h),r._button=h,void 0!==a&&a&&(r._tinted=!0),void 0===o&&(!r._tinted&&t.cache.getFrameByName(i,o)||(o=null)),void 0===n&&(!r._tinted&&t.cache.getFrameByName(i,n)||(n=null)),h.setFrames(n,s,o,s),h.anchor.setTo(.5,.5),h.name=e,h.onInputOver.add(r.overEvent,r),h.onInputOut.add(r.outEvent,r),h.onInputDown.add(r.downEvent,r),h.onInputUp.add(r.upEvent,r),r}t.Button=e}(UI=UI||{}),function(t){var d,e=(d=t.Button,__extends(i,d),Object.defineProperty(i.prototype,"checked",{get:function(){return this._checked},set:function(t){if(this._checked=t)this._checkSprite.frameName=this._frameChecked,this._checkSprite.visible=!0;else{var e=null!==this._frameUnchecked;e&&(this._checkSprite.frameName=this._frameUnchecked),this._checkSprite.visible=e}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changeOnDown",{get:function(){return this._changeOnDown},set:function(t){this._changeOnDown=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkSprite",{get:function(){return this._checkSprite},enumerable:!1,configurable:!0}),i.prototype.setCheckPosition=function(t,e){this._checkSprite.position.set(t,e)},i.prototype.downEvent=function(){this.setButton(this._over,!0),this._changeOnDown&&(this.checked=!this.checked),this.downAction(),this.onDown.dispatch(this,this._checked)},i.prototype.upEvent=function(t,e,i){this.setButton(this._over,!1),this.upAction(),i&&(this._changeOnDown||(this.checked=!this.checked),this.onClick.dispatch(this,this._checked))},i);function i(t,e,i,s,a,o,n,r){var h=d.call(this,t,e,i,s,o,n,r)||this;h._changeOnDown=!1,h._checkFramePosition=new Phaser.Point,h._checked=!1;var l=a+"On";h.game.cache.getFrameByName(i,l),h._frameChecked=l;var _=a+"Off";h.game.cache.getFrameByName(i,l)||(_=null),h._frameUnchecked=_;var c=new Phaser.Sprite(t,0,0,i);return c.anchor.set(.5,.5),h.addChild(c),h._checkSprite=c,h.checked=!1,h}t.CheckBox=e}(UI=UI||{}),function(t){var r,e=(r=t.Button,__extends(i,r),Object.defineProperty(i.prototype,"toggled",{get:function(){return this._toggled},set:function(t){(this._toggled=t)?(this._button.setFrames(null,this._frameToggled,this._frameToggled,this._frameToggled),this._changeOnDown&&(this._button.frameName=this._frameToggled)):(this._button.setFrames(null,this._frameUntoggled,this._frameUntoggled,this._frameUntoggled),this._changeOnDown&&(this._button.frameName=this._frameUntoggled))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changeOnDown",{get:function(){return this._changeOnDown},set:function(t){this._changeOnDown=t},enumerable:!1,configurable:!0}),i.prototype.downEvent=function(){this.setButton(this._over,!0),this._changeOnDown&&(this.toggled=!this.toggled),this.downAction(),this.onDown.dispatch(this,this._toggled)},i.prototype.upEvent=function(t,e,i){this.setButton(this._over,!1),this.upAction(),i&&(this._changeOnDown||(this.toggled=!this.toggled),this.onClick.dispatch(this,this._toggled))},i);function i(t,e,i,s,a,o){var n=r.call(this,t,e,i,s,o,a)||this;return n._toggled=!1,n._changeOnDown=!0,n._frameToggled=a,n._frameUntoggled=s,n.toggled=n._toggled,n}t.Toggle=e}(UI=UI||{}),function(t){var a,e;(e=a=t.eStringLenghtType||(t.eStringLenghtType={}))[e.NULL_TERMINATED=0]="NULL_TERMINATED",e[e.READ_LENGTH=1]="READ_LENGTH",e[e.FIXED_LENGTH=2]="FIXED_LENGTH";var i=(Object.defineProperty(s.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!1,configurable:!0}),s.prototype.setFile=function(t){void 0===t&&(t=0),this._compound?(this._position=3+4*t,this._lbound=this.readUint32()+3,this._ubound=this.readUint32()+3,this._position=this._lbound):(this._lbound=0,this._ubound=this._bin.byteLength,this._position=0)},s.prototype.hasNext=function(){return this._position<this._ubound},s.prototype.readUint8=function(){return this._bin.getUint8(this._position++)},s.prototype.readInt8=function(){return this._bin.getInt8(this._position++)},s.prototype.readUint16=function(t){void 0===t&&(t=this._littleEndian);var e=this._bin.getUint16(this._position,t);return this._position+=2,e},s.prototype.readInt16=function(t){void 0===t&&(t=this._littleEndian);var e=this._bin.getInt16(this._position,t);return this._position+=2,e},s.prototype.readUint32=function(t){void 0===t&&(t=this._littleEndian);var e=this._bin.getUint32(this._position,t);return this._position+=4,e},s.prototype.readInt32=function(t){void 0===t&&(t=this._littleEndian);var e=this._bin.getInt32(this._position,t);return this._position+=4,e},s.prototype.readFixed16_16=function(t){void 0===t&&(t=this._littleEndian);var e=this._bin.getInt32(this._position,t);return this._position+=4,e/65536},s.prototype.readFixed1_7=function(){return(255&this._bin.getInt8(this._position++))/128},s.prototype.readString=function(t,e){void 0===e&&(e=0);var i=[];for(t===a.READ_LENGTH&&(e=this._bin.getUint8(this._position++));0<e||t===a.NULL_TERMINATED;){var s=this._bin.getUint8(this._position++);if(t===a.NULL_TERMINATED&&0===s)break;i.push(s),--e}return String.fromCharCode.apply(null,i)},s);function s(t,e){void 0===e&&(e=!1),this._bin=new DataView(t),this._littleEndian=e,this._position=0,"NC2"===this.readString(a.FIXED_LENGTH,3)&&(this._compound=!0,this._filesCount=(this.readUint32()>>2)-1),this.setFile(0)}t.BinaryFileReader=i}(Shards=Shards||{}),function(s){var t=(e.prototype.loadMusic=function(){for(var t="assets/",e=0;e<s.Global.MAX_MUSIC;e++){var i="Music"+e;this._loader.audio(i,[t+i+".ogg",t+i+".m4a"])}this._loader.onFileComplete.add(this.onFileComplete,this),this._loader.start()},e.prototype.onFileComplete=function(t,e,i,s,a){var o=this._game.add.audio(e);Utils.AudioUtils.addMusic(e,o)},e.prototype.getMusic=function(){var t=this._musicToPlay;-1===t&&(t=this._game.rnd.integerInRange(0,s.Global.MAX_MUSIC-1),this._musicToPlay=t);do{var e="Music"+t;if(this._game.cache.getSound(e)&&this._game.cache.isSoundDecoded(e))return this._musicToPlay=(t+1)%s.Global.MAX_MUSIC,e;t=(t+1)%s.Global.MAX_MUSIC}while(t!==this._musicToPlay);return null},e);function e(t){this._game=t,this._loader=new Phaser.Loader(t),this._musicToPlay=-1}s.MusicManager=t}(Shards=Shards||{}),function(t){var e=(i.PTM=48,i.MUSIC_FILES_COUNT=4,i.EMPTY_HITS=40,i.EMPTY_HIT_DURATION=.25,i.NO_HIT_TIME=12.5,i.INITIAL_EFFECT_DURATION=.65,i.INITIAL_EFFECT_SCALE=10,i.IMPACT_DURATION=250,i.IMPACT_SCALE=1.0234375,i.BEST_ANIM_TIME=750,i.BEST_ANIM_TROPHY_SCALE=10,i.COLORED_BRICKS_MAX=20,i.SHADOW_OFFSET_X=19,i.SHADOW_OFFSET_Y=24,i.BRICK_SHINE=["BRICK_SHINE_0","BRICK_SHINE_1","BRICK_SHINE_2","BRICK_SHINE_3","BRICK_SHINE_4","BRICK_SHINE_5"],i.LAST_BRICK_TIME=29,i.LOST_TIME_BOMB=2,i.LOST_TIME_BALL=1,i.LOST_TIME_TOTAL=5,i.WON_TIME=3,i.TITLE_LEVEL=2.5,i.TITLE_GAMEOVER=5,i.BALLS_MAX=5,i.BALL_DIAMETER=33,i.PADDLE_HEIGHT_LEVEL=.147,i.PADDLE_SIZE_NORMAL=1,i.PADDLE_SIZE_SMALL=.5,i.PADDLE_SIZE_BIG=1.3,i.PADDLE_CHANGE_SPEED=1,i.CANNON_ON_ANIMATION=["GUN_0","GUN_1","GUN_2","GUN_3","GUN_4","GUN_5","GUN_6","GUN_7","GUN_8","GUN_9","GUN_10","GUN_11","GUN_12","GUN_13","GUN_14","GUN_15","GUN_16","GUN_17","GUN_18","GUN_19","GUN_20","GUN_21"],i.CANNON_OFF_ANIMATION=["GUN_21","GUN_20","GUN_19","GUN_18","GUN_17","GUN_16","GUN_15","GUN_14","GUN_13","GUN_12","GUN_11","GUN_10","GUN_9","GUN_8","GUN_7","GUN_6","GUN_5","GUN_4","GUN_3","GUN_2","GUN_1","GUN_0"],i.CANNON_DURATION=5,i.CANNON_OFFSET=40,i.PADDLE_OVERLAY_TIME=.5,i.BORDER_WIDTH=12,i.SHADOW_OFFSET=new Phaser.Point(0,0),i.PARTICLES_MAX=196,i.SPEED_NORMAL_SLOW_GAME=350,i.SPEED_INCREMENT=150,i.SPEED_FAST_RATE=1.5,i.SPEED_SLOW_RATE=.67,i.MISSILE_MAX=30,i.ENEMY_MAX=21,i.ENEMY_TIME_TO_SPAWN_MIN=5,i.ENEMY_TIME_TO_SPAWN_RANGE=15,i.ENEMY_RAGE_ADD=4,i.ENEMY_RAGE_LIMIT=10,i.ENEMY_RAGE_TIME=5,i.ENEMY_SPEED_NORMAL=1,i.ENEMY_SPEED_RAGE=5,i.ENEMY_TIME_TO_CHANGE_DIR_MIN=2,i.COMBOS_MAX=10,i.COMBO_TIMEOUT=1.5,i.BONUSES_MAX=16,i.PROBABILITY_BONUS=20,i.BONUS_FAST_DURATION=20,i.BONUS_SLOW_DURATION=20,i.BONUS_STICKY_DURATION=20,i.BONUS_POWER_DURATION=10,i.SCORE_DESTROYED=500,i.SCORE_ENEMY_DESTROYED=3e3,i.SCORE_NOT_DESTROYED=50,i.SCORE_COMBO=1e3,i);function i(){}t.Settings=e}(Shards=Shards||{}),function(t){var e=(i.prototype.createItem=function(){return 0===this._count?this._canGrow?this.newItem():null:this._pool[--this._count]},i.prototype.destroyItem=function(t){this._pool[this._count++]=t},Object.defineProperty(i.prototype,"newFunction",{set:function(t){this._newFunction=t},enumerable:!1,configurable:!0}),i.prototype.newItem=function(){return null!==this._newFunction?this._newFunction():new this._classType},Object.defineProperty(i.prototype,"canGrow",{set:function(t){this._canGrow=t},enumerable:!1,configurable:!0}),i);function i(t,e,i){void 0===i&&(i=null),this._newFunction=null,this._count=0,this._pool=[],this._canGrow=!0,this._maxPoolSize=0,this._classType=t,this._newFunction=i;for(var s=0;s<e;s++){var a=this.newItem();this._pool[this._count++]=a}}t.Pool=e}(Shards=Shards||{}),function(t){var e=(i.BALL_LOST=0,i.BALL_STICKY=1,i.BALL_STICKY_HIT=2,i.BOMB_EXPLOSION=3,i.BORDER_HIT_1=4,i.BORDER_HIT_2=5,i.BORDER_HIT_3=6,i.BRICK_DAMAGED_1=7,i.BRICK_DAMAGED_2=8,i.BRICK_DAMAGED_3=9,i.BRICK_DESTROYED_1=10,i.CANNON_EXPLOSION=11,i.CANNON_FIRE=12,i.CANNON_OFF=13,i.CANNON_ON=14,i.CLICK=15,i.FIRE=16,i.FREEZE=17,i.GAME_OVER=18,i.IMPACT=19,i.LIFE=20,i.PADDLE_ENLARGE=21,i.PADDLE_HIT_1=22,i.PADDLE_HIT_2=23,i.PADDLE_HIT_3=24,i.PADDLE_SHRINK=25,i.POWERBALL=26,i.SPLIT_BALL=27,i.SWOOSH=28,i.TICK=29,i.UNBREAKABLE_HIT_1=30,i.UNBREAKABLE_HIT_2=31,i.ENEMY_EXPLOSION=32,i.ENEMY_BORDER_HIT_1=33,i.ENEMY_BORDER_HIT_2=34,i.ENEMY_BORDER_HIT_3=35,i.ENEMY_BRICK_DAMAGED_1=36,i.ENEMY_BRICK_DAMAGED_2=37,i.ENEMY_BRICK_DAMAGED_3=38,i.ENEMY_UNBREAKABLE_HIT_1=39,i.ENEMY_UNBREAKABLE_HIT_2=40,i.SOUND_NAMES=["ball_lost","ball_sticky","ball_sticky_hit","bomb_explosion","border_hit_1","border_hit_2","border_hit_3","brick_damaged_1","brick_damaged_2","brick_damaged_3","brick_destroyed_1","cannon_explosion","cannon_fire","cannon_off","cannon_on","click","fire","freeze","game_over","impact","life","paddle_enlarge","paddle_hit_1","paddle_hit_2","paddle_hit_3","paddle_shrink","powerball","split_ball","swoosh","tick","unbreakable_hit_1","unbreakable_hit_2","enemy_explosion","enemy_border_hit_1","enemy_border_hit_2","enemy_border_hit_3","enemy_brick_damaged_1","enemy_brick_damaged_2","enemy_brick_damaged_3","enemy_unbreakable_hit_1","enemy_unbreakable_hit_2"],i);function i(){}t.Sfx=e}(Shards=Shards||{}),function(s){var t=(Object.defineProperty(i.prototype,"visual",{get:function(){return this._visual},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"on",{set:function(t){this._on=t,this._visual.exists=t,this._visual.visible=t},enumerable:!1,configurable:!0}),i.prototype.remove=function(){var t=this._visual.parent;null!==t&&(t instanceof Phaser.Group?t.remove(this._visual):t.removeChild(this._visual),t=null)},i.prototype.bringToTop=function(){var t=this._visual.parent;t instanceof Phaser.Group&&t.bringToTop(this._visual)},i.prototype.sendToBack=function(){var t=this._visual.parent;t instanceof Phaser.Group&&t.sendToBack(this._visual)},Object.defineProperty(i.prototype,"textureKey",{set:function(t){this._textureKey=t},enumerable:!1,configurable:!0}),i.prototype.setScaleChange=function(t,e){void 0===e&&(e=0),this._scaleChangeType=t,this._scaleChange=e},Object.defineProperty(i.prototype,"alpha",{set:function(t){this._alpha=t,this._visual.alpha=Phaser.Math.clamp(t,0,1)},enumerable:!1,configurable:!0}),i.prototype.setAlphaChange=function(t,e){void 0===e&&(e=0),this._alphaChangeType=t,this._alphaChange=e},i.prototype.setPhysics=function(t,e,i,s,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),this._velocity.setTo(t,e),this._angularVelocity=i,this._friction=s,this._angularDrag=a,this._gravity=o,this._simplePhysics=0===o&&0===s&&0===a},i.prototype.setFrame=function(t){},i.prototype.onEmit=function(t){t.add(this._visual)},i.prototype.onKill=function(t){},i.prototype.update=function(t,e){void 0===e&&(e=!0);var i=t;if(0<this.lifetime&&(this.lifetime-=i)<=0)return!1;if(0===this._velocity.x&&0===this._velocity.y||(this._visual.x+=this._velocity.x*i,this._visual.y+=this._velocity.y*i),0!==this._angularVelocity&&(this._visual.angle+=this._angularVelocity*i),this._simplePhysics||(this._velocity.x+=-this._friction*this._velocity.x*i,this._velocity.y+=(this._gravity-this._friction*this._velocity.y)*i,this._angularVelocity+=-this._angularDrag*this._angularVelocity*i),!e)return!0;if(this._scaleChangeType!=s.eParameterChangeType.NO_CHANGE)switch(this._scaleChangeType){case s.eParameterChangeType.IN_TIME:(this._visual.scale.x+=this._scaleChange*i)<0&&(this._visual.scale.x=0,this._scaleChange<0&&(this._scaleChangeType=s.eParameterChangeType.NO_CHANGE)),(this._visual.scale.y+=this._scaleChange*i)<0&&(this._visual.scale.y=0,this._scaleChange<0&&(this._scaleChangeType=s.eParameterChangeType.NO_CHANGE))}if(this._alphaChangeType!=s.eParameterChangeType.NO_CHANGE)switch(this._alphaChangeType){case s.eParameterChangeType.IN_TIME:this._alpha+=this._alphaChange*i,this._alpha<0?(this._visual.alpha=0,this._alphaChange<0&&(this._alphaChangeType=s.eParameterChangeType.NO_CHANGE)):1<this._alpha?(this._visual.alpha=1,0<this._alphaChange&&(this._alphaChangeType=s.eParameterChangeType.NO_CHANGE)):this._visual.alpha=this._alpha}return!0},i.MAX_VELOCITY=1e3,i);function i(t,e){this.maxVelocity=i.MAX_VELOCITY,this._velocity=new Phaser.Point(0,0),this._angularVelocity=0,this._friction=0,this._angularDrag=0,this._gravity=0,this._alpha=1,this._scaleChange=0,this._alphaChange=0,this._game=t}s.Particle=t}(Shards=Shards||{}),function(o){var n,t,r,e;(t=n=n||{})[t.NONE=0]="NONE",t[t.FLOW=1]="FLOW",t[t.EXPLODE=2]="EXPLODE",(e=r=o.eParameterChangeType||(o.eParameterChangeType={}))[e.NO_CHANGE=0]="NO_CHANGE",e[e.IN_TIME=1]="IN_TIME";var h,i=(h=Phaser.Group,__extends(l,h),l.prototype.clear=function(){this.gravity=0,this.setXSpeed(0,0),this.setYSpeed(0,0),this.setAngularSpeed(0)},l.prototype.update=function(){if(this._on&&this.game.time.time>=this._timer&&(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,this._mode===n.FLOW))if(-1!==this._flowTotal&&this._flowCounter>=this._flowTotal)this.on=!1;else for(var t=Math.max(1,this._flowQuantity),e=0;e<t&&!(this.emitParticle(this.forceEmit)&&(this._flowCounter++,-1!==this._flowTotal&&this._flowCounter>=this._flowTotal));e++);var i=this.game.time.delta/1e3;for(e=this._counterUsed-1;0<=e;e--){var s=this._particlesUsed[e];s.update(i)||(s.on=!1,s.remove(),s.onKill(this),this._particlesUsed[e]=this._particlesUsed[--this._counterUsed],this._particlesPool[this._counterPool++]=s)}},l.prototype.makeParticles=function(t,e,i,s){(void 0===i||i>this._maxParticles)&&(i=this._maxParticles),void 0!==e&&(this._frames=e);for(var a=0;a<i;a++){var o=new this.particleClass(this.game,s);o.textureKey=t,o.onCreate(this),o.on=!1,this._particlesPool[this._counterPool++]=o}},Object.defineProperty(l.prototype,"on",{set:function(t){this._on=t,this.exists=t,this.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"lifetime",{set:function(t){this.minLifetime=this.maxLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"countParticles",{get:function(){return this._counterUsed},enumerable:!1,configurable:!0}),l.prototype.explode=function(t,e,i){this._mode=n.EXPLODE,this.on=!0,this.emitParticles(t,e,i)},l.prototype.flow=function(t,e,i,s,a,o){this._mode=n.FLOW,this.on=!0,void 0!==e&&0!==e||(e=1),void 0===i&&(i=-1),void 0===s&&(s=!0),e>this._maxParticles&&(e=this._maxParticles),this.frequency=t,this._flowCounter=0,this._flowQuantity=e,this._flowTotal=i,s&&(this.emitParticles(e,a,o),this._flowCounter+=e,this._timer=this.game.time.time+t*this.game.time.slowMotion)},l.prototype.stopFlow=function(){this._mode=n.NONE},l.prototype.killAllParticles=function(t){for(void 0===t&&(t=!0);0<this._counterUsed;){var e=this._particlesUsed[--this._counterUsed];e.remove(),t||e.onKill(this),this._particlesPool[this._counterPool++]=e}},l.prototype.emitParticles=function(t,e,i){for(var s=0;s<t;s++){var a=this.emitParticle(this.forceEmit);if(null===a)break;null!=e&&e.call(i,a)}},l.prototype.emitParticle=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),0===this._counterPool){if(!t)return null;var i=this._particlesUsed[0];this._particlesUsed[0]=this._particlesUsed[--this._counterUsed],i.remove(),i.onKill(this),this._particlesPool[this._counterPool++]=i}var s=this._particlesPool[--this._counterPool];if((this._particlesUsed[this._counterUsed++]=s).on=!0,this.randomEmitPoint(this._emitPoint),s.visual.position.set(this._emitPoint.x,this._emitPoint.y),s.visual.angle=0,e)s.lifetime=-1,s.visual.scale.set(1,1),s.setScaleChange(r.NO_CHANGE),s.visual.angle=0,s.alpha=1,s.setAlphaChange(r.NO_CHANGE),s.setPhysics();else{if(s.lifetime=this.game.rnd.realInRange(this.minLifetime,this.maxLifetime),1!==this.minParticleScale||1!==this.maxParticleScale){var a=this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale);s.visual.scale.set(a,a)}else this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?s.visual.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):s.visual.scale.set(1,1);s.setScaleChange(this.scaleChangeType,this.scaleChange),s.visual.angle=this.minAngle===this.maxAngle?this.minAngle:this.game.rnd.realInRange(this.minAngle,this.maxAngle),s.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),s.setAlphaChange(this.alphaChangeType,this.alphaChange),s.setPhysics(this.game.rnd.realInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),this.game.rnd.realInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),this.game.rnd.realInRange(this.minAngularSpeed,this.maxAngularSpeed),this.particleFriction,this.angularDrag,this.gravity),null!==this._frames&&s.setFrame(this.randomFrame())}return s.onEmit(this),this.particleBringToTop?s.bringToTop():this.particleSendToBack&&s.sendToBack(),s},l.prototype.destroy=function(){o.ParticlesManager.instance.remove(this),h.prototype.destroy.call(this,!0,!1)},l.prototype.randomFrame=function(){var t=null;return null!==this._frames&&(t=Array.isArray(this._frames)?(this._frames[0],this.game.rnd.pick(this._frames)):this._frames),t},l.prototype.randomEmitPoint=function(t){return this.area instanceof Phaser.Point?t.setTo(0,0):this.area.random(t),t.x+=this.emitPoint.x,t.y+=this.emitPoint.y,null!==this.emitObject&&(t.x+=this.emitObject.x,t.y+=this.emitObject.y),t},l.prototype.setXSpeed=function(t,e){t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e},l.prototype.setYSpeed=function(t,e){t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e},l.prototype.setAngularSpeed=function(t,e){t=t||0,e=e||0,this.minAngularSpeed=t,this.maxAngularSpeed=e},l.prototype.setAlpha=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this.minParticleAlpha=t,this.maxParticleAlpha=e},l.prototype.setAlphaChange=function(t,e,i){switch(void 0===e&&(e=0),void 0===i&&(i=0),this.alphaChangeType=t){case r.NO_CHANGE:this.alphaChange=0;break;case r.IN_TIME:0===i&&(i=1),this.alphaChange=e/i}},l.prototype.setScale=function(t,e,i,s){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===s&&(s=1),this._minParticleScale.setTo(t,i),this._maxParticleScale.setTo(e,s)},l.prototype.setScaleChange=function(t,e,i){switch(void 0===e&&(e=0),void 0===i&&(i=0),this.scaleChangeType=t){case r.NO_CHANGE:this.scaleChange=0;break;case r.IN_TIME:0===i&&(i=1),this.scaleChange=e/i}},l.prototype.setAngle=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.minAngle=t,this.maxAngle=e},l.prototype.emitAt=function(t,e){this.emitPoint.setTo(t,e)},l.prototype.emitAtObject=function(t){t.center?this.emitPoint.setTo(t.center.x,t.center.y):this.emitPoint.setTo(t.x,t.y)},l.MAX_PARTICELES=16,l);function l(t,e,i,s){var a=h.call(this,t,null)||this;return a._maxParticles=l.MAX_PARTICELES,a.emitPoint=new Phaser.Point(0,0),a.area=new Phaser.Point(0,0),a.emitObject=null,a.gravity=100,a.particleClass=o.SpriteParticle,a.particleBringToTop=!1,a.particleSendToBack=!1,a.frequency=100,a.minLifetime=1,a.maxLifetime=2,a.minParticleScale=1,a.maxParticleScale=1,a.scaleChange=0,a.scaleChangeType=r.NO_CHANGE,a.minAngle=0,a.maxAngle=360,a.minParticleSpeed=new Phaser.Point(-100,-100),a.maxParticleSpeed=new Phaser.Point(100,100),a.particleFriction=0,a.minAngularSpeed=-360,a.maxAngularSpeed=360,a.angularDrag=0,a.minParticleAlpha=1,a.maxParticleAlpha=1,a.alphaChange=0,a.alphaChangeType=r.NO_CHANGE,a.forceEmit=!1,a._on=!1,a._mode=n.NONE,a._flowQuantity=0,a._flowTotal=0,a._flowCounter=0,a._particlesPool=[],a._counterPool=0,a._particlesUsed=[],a._counterUsed=0,a._timer=0,a._frames=null,a._emitPoint=new Phaser.Point(0,0),a._minParticleScale=new Phaser.Point(1,1),a._maxParticleScale=new Phaser.Point(1,1),a.position.setTo(e,i),a._maxParticles=s,a}o.ParticlesEmitter=i}(Shards=Shards||{}),function(t){var e=(Object.defineProperty(i,"instance",{get:function(){return null===i._instance&&(i._instance=new i),i._instance},enumerable:!1,configurable:!0}),i.prototype.add=function(t){this._emitters[this._emittersCount++]=t},i.prototype.remove=function(t){for(var e=this._emittersCount-1;0<=e&&this._emitters[e]!==t;e--);-1!==e&&(this._emitters[e]=this._emitters[--this._emittersCount])},i.prototype.update=function(){for(var t=0;t<this._emittersCount;t++){var e=this._emitters[t];e.exists&&e.update()}},i._instance=null,i);function i(){this._emitters=[],this._emittersCount=0}t.ParticlesManager=e}(Shards=Shards||{}),function(t){var e,i=(e=t.Particle,__extends(s,e),s.prototype.setFrame=function(t){var e=this._visual;"string"==typeof t?e.frameName=t:e.frame=t},s.prototype.onCreate=function(t){var e=new Phaser.Sprite(this._game,0,0,this._textureKey);e.anchor.setTo(.5,.5),this._visual=e},s);function s(){return null!==e&&e.apply(this,arguments)||this}t.SpriteParticle=i}(Shards=Shards||{}),function(t){var a,e=(a=t.SpriteParticle,__extends(i,a),i.prototype.onCreate=function(t){a.prototype.onCreate.call(this,t);for(var e=this._visual,i=0;i<this._anims.length;i++){var s=this._anims[i];e.animations.add(s.name,s.frames,s.frameRate,s.loop),!s.loop&&s.killOnComplete&&(s.killOnComplete=!0)}},i.prototype.setAnim=function(t){this._visual.animations.play(t)},i.prototype.setRandomAnim=function(){this._visual;var t=this._anims[this._game.rnd.integerInRange(0,this._anims.length-1)].name;this.setAnim(t)},i);function i(t,e){var i=a.call(this,t,e)||this;return void 0!==e&&null===e||(i._anims=e[0]),i}t.AnimatedParticle=e}(Shards=Shards||{}),function(t){var e=(i.SHARDS_PARTICLES=[{name:"shards1",frameRate:22,loop:!0,killOnComplete:!1,frames:["Shards_0","Shards_1","Shards_2","Shards_3","Shards_4","Shards_5","Shards_6","Shards_7","Shards_8","Shards_9","Shards_10","Shards_11","Shards_12","Shards_13","Shards_14","Shards_15","Shards_16","Shards_17","Shards_18","Shards_19"]},{name:"shards2",frameRate:22,loop:!0,killOnComplete:!1,frames:["Shards_20","Shards_21","Shards_22","Shards_23","Shards_24","Shards_25","Shards_26","Shards_27","Shards_28","Shards_29","Shards_30","Shards_31","Shards_32","Shards_33","Shards_34","Shards_35","Shards_36","Shards_37","Shards_38","Shards_39"]},{name:"shards3",frameRate:22,loop:!0,killOnComplete:!1,frames:["Shards_40","Shards_41","Shards_42","Shards_43","Shards_44","Shards_45","Shards_46","Shards_47","Shards_48","Shards_49","Shards_50","Shards_51","Shards_52","Shards_53","Shards_54","Shards_55","Shards_56","Shards_57","Shards_58","Shards_59"]}],i.EXPLOSIONS=[{name:"bigExplosion",frameRate:14,loop:!1,killOnComplete:!0,frames:["EXPLOSION_0","EXPLOSION_1","EXPLOSION_2","EXPLOSION_3","EXPLOSION_4","EXPLOSION_5","EXPLOSION_6","EXPLOSION_7","EXPLOSION_8"]},{name:"smallExplosion",frameRate:33,loop:!1,killOnComplete:!0,frames:["GUN_EXPLO_0","GUN_EXPLO_1","GUN_EXPLO_2","GUN_EXPLO_3","GUN_EXPLO_4","GUN_EXPLO_5","GUN_EXPLO_6","GUN_EXPLO_7","GUN_EXPLO_8","GUN_EXPLO_9","GUN_EXPLO_10","GUN_EXPLO_11","GUN_EXPLO_12","GUN_EXPLO_13"]},{name:"muzzle",frameRate:33,loop:!1,killOnComplete:!0,frames:["MUZZLE_0","MUZZLE_1","MUZZLE_2","MUZZLE_3","MUZZLE_4","MUZZLE_5"]}],i);function i(){}t.Animations=e}(Shards=Shards||{}),function(r){var n,t=(n=UI.Button,__extends(h,n),h.prototype.overAction=function(){this._text.scale.copyFrom(this._button.scale)},h.prototype.outAction=function(){this._text.scale.copyFrom(this._button.scale)},h.HIT_AREA_OFFSET=-60,h.HIT_AREA_HEIGHT=120,h.HIT_AREA_WIDTH=350,h.SCALE=1.1,h);function h(t,e,i,s,a){var o=n.call(this,t,e,i,s)||this;return o._text=a,o.scaleOnOver.set(h.SCALE,h.SCALE),r.Global.LOW?o.setHitArea(new Phaser.Rectangle(.4*h.HIT_AREA_OFFSET,.4*h.HIT_AREA_OFFSET,.4*h.HIT_AREA_WIDTH,.4*h.HIT_AREA_HEIGHT)):o.setHitArea(new Phaser.Rectangle(h.HIT_AREA_OFFSET,h.HIT_AREA_OFFSET,h.HIT_AREA_WIDTH,h.HIT_AREA_HEIGHT)),o}r.ButtonWithText=t;var l,e=(l=UI.Toggle,__extends(_,l),_.prototype.overAction=function(){this._text.scale.copyFrom(this._button.scale)},_.prototype.outAction=function(){this._text.scale.copyFrom(this._button.scale)},_.HIT_AREA_OFFSET=-60,_.HIT_AREA_HEIGHT=120,_.HIT_AREA_WIDTH=350,_.SCALE=1.1,_);function _(t,e,i,s,a,o){var n=l.call(this,t,e,i,s,a)||this;return n._text=o,n.scaleOnOver.set(_.SCALE,_.SCALE),r.Global.LOW?n.setHitArea(new Phaser.Rectangle(.4*_.HIT_AREA_OFFSET,.4*_.HIT_AREA_OFFSET,.4*_.HIT_AREA_WIDTH,.4*_.HIT_AREA_HEIGHT)):n.setHitArea(new Phaser.Rectangle(_.HIT_AREA_OFFSET,_.HIT_AREA_OFFSET,_.HIT_AREA_WIDTH,_.HIT_AREA_HEIGHT)),n}r.ToggleWithText=e}(Shards=Shards||{}),function(t){var a,e=(a=UI.Button,__extends(o,a),Object.defineProperty(o.prototype,"glow",{set:function(t){null!==t&&(this.add(t),this.bringToTop(t))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"buttonName",{get:function(){return this._button.name},enumerable:!1,configurable:!0}),o.prototype.setFlag=function(t){var e="Flag_"+t;this._button.setFrames(e,e,e,e)},o.SCALE=1.1,o);function o(t,e,i){var s=a.call(this,t,e,i,"Flag_"+e)||this;return s.scaleOnOver.set(o.SCALE,o.SCALE),s}t.FlagButton=e}(Shards=Shards||{}),function(s){var a,t=(a=Phaser.Group,__extends(o,a),o.prototype.init=function(t,e,i){var s="COMBO X"+i;this._backText.text=s,this._frontText.text=s,this._time=0;var a=this._frontText.textWidth;this._glow.position.set(t,e),this._glow.width=a<<1,this._glow.height=a>>1,this._glow.alpha=0,a*=.7215,t=Phaser.Math.clamp(t,-this.game.width/2+a,this.game.width/2-a),this._frontText.position.set(t,e),this._frontText.scale.set(.5,.5),this._frontText.alpha=0,this._backText.scale.set(1,1),this._backText.position.set(t+this.game.width/8,e),this._backAdjustment.set(t-this.game.width/8,e-this.game.height/80),this._backAdjustment.subtract(this._backText.position.x,this._backText.position.y),this._backAdjustment.divide(o.DURATION,o.DURATION)},o.prototype.tick=function(t){if((this._time+=t)>o.DURATION)return!1;var e=Math.sin(Phaser.Math.degToRad(180*this._time/o.DURATION));this._frontText.alpha=Math.min(1,1.3*e);var i=o.DURATION/2,s=this._time<i?.5+this._time/i*.5:1+(this._time-i)/i*.443;return this._frontText.scale.set(s,s),this._glow.position.copyFrom(this._frontText.position),this._glow.alpha=.5*this._frontText.alpha,this._backText.alpha=this._frontText.alpha/2,s=1+.314*this._time/o.DURATION,this._backText.scale.set(s,s),this._backText.position.add(this._backAdjustment.x*t,this._backAdjustment.y*t),!0},o.COMBO_TEXT_SIZE=44,o.DURATION=1,o);function o(t){var e=a.call(this,t,null)||this;e._backAdjustment=new Phaser.Point;var i=s.Global.LOW?.4:1;return e._backText=new Phaser.BitmapText(t,0,0,"FontBack","",o.COMBO_TEXT_SIZE*i),e._backText.anchor.set(.5,.5),e.add(e._backText),e._glow=new Phaser.Sprite(t,0,0,"Game","GLOW"),e._glow.anchor.set(.5,.5),e.add(e._glow),e._frontText=new Phaser.BitmapText(t,0,0,"FontFore","",o.COMBO_TEXT_SIZE*i),e._frontText.anchor.set(.5,.5),e.add(e._frontText),e}s.Combo=t}(Shards=Shards||{}),function(g){var t=(e.prototype.clear=function(){this._shardExplosion.killAllParticles(),this._shardsParticles.killAllParticles(),this._explosions.killAllParticles(),this._general.killAllParticles()},e.prototype.createShardsExplosion=function(){var t=new g.ParticlesEmitter(this._game,0,0,e.SHARDS_EXPLOSION_MAX);return t.clear(),t.setAlpha(1.28,1.28),t.makeParticles("Game","EXPLOSION_SHARDS"),t},e.prototype.shardsExplosion=function(t,e,i,s){this._shardExplosion.emitAt(t,e);var a=this._shardExplosion.emitParticle();null!==a&&(s?(a.visual.scale.set(.3*i,.3*i),a.setScaleChange(g.eParameterChangeType.IN_TIME,.8),a.setAlphaChange(g.eParameterChangeType.IN_TIME,-1.28),a.lifetime=1):(a.visual.scale.set(.2*i,.2*i),a.setScaleChange(g.eParameterChangeType.IN_TIME,1),a.setAlphaChange(g.eParameterChangeType.IN_TIME,-2.6),a.lifetime=.5))},e.prototype.createShardsParticles=function(){var t=new g.ParticlesEmitter(this._game,0,0,e.SHARDS_PARTICLES_MAX);return t.clear(),t.particleClass=g.AnimatedParticle,t.lifetime=2,t.setAlpha(2,2),t.setAlphaChange(g.eParameterChangeType.IN_TIME,-1.8,2),t.makeParticles("Game",null,e.SHARDS_PARTICLES_MAX,[g.Animations.SHARDS_PARTICLES]),t},e.prototype.shardsParticles=function(t,e,i,s,a,o){var n=this._game,r=a-s,h=s+n.rnd.integerInRange(0,r-1);g.Global.NO_ANIMS&&(h=Math.floor(h/2));for(var l=h;0<l;l--){var _=n.rnd.integerInRange(0,359),c=o*(8+n.rnd.integerInRange(0,23))*i,d=Math.cos(Phaser.Math.degToRad(_)),u=Math.sin(Phaser.Math.degToRad(_));this._shardsParticles.emitAt(t+o*d,e+o*u);var p=this._shardsParticles.emitParticle();null!==p&&(p.setPhysics(d*c,u*c),p.visual.scale.set(i,i),p.setRandomAnim())}},e.prototype.createExplosions=function(){var t=new g.ParticlesEmitter(this._game,0,0,e.EXPLOSIONS_MAX);return t.clear(),t.particleClass=g.AnimatedParticle,t.setAlpha(1,1),t.setScale(1,1),t.makeParticles("Game",null,e.EXPLOSIONS_MAX,[g.Animations.EXPLOSIONS]),t},e.prototype.muzzle=function(t,e){this._explosions.emitAt(t,e);var i=this._explosions.emitParticle();null!==i&&(i.lifetime=.25,i.visual.angle=0,i.setAnim("muzzle"))},e.prototype.smallExplosion=function(t,e){this._explosions.emitAt(t,e);var i=this._explosions.emitParticle();null!==i&&(i.lifetime=.45,i.setAlphaChange(g.eParameterChangeType.IN_TIME,-.35),i.setAnim("smallExplosion"))},e.prototype.bigExplosion=function(t,e){this._explosions.emitAt(t,e);var i=this._explosions.emitParticle();null!==i&&(i.lifetime=.7,i.visual.scale.set(2,2),i.alpha=2,i.setAlphaChange(g.eParameterChangeType.IN_TIME,-3),i.setAnim("bigExplosion"))},e.prototype.createGeneral=function(){var t=new g.ParticlesEmitter(this._game,0,0,e.GENERAL_MAX);return t.clear(),t.setAlpha(1,1),t.setScale(1,1),t.setAngle(0,0),t.makeParticles("Game"),t},e.prototype.bonus=function(t,e,i,s,a){this._general.emitAt(t,e);var o=this._general.emitParticle();null!==o&&(o.lifetime=1,o.setFrame(i),o.setPhysics(3*(t-s),3*(e-a),360*(s<t?1:-1)),o.setAlphaChange(g.eParameterChangeType.IN_TIME,-1),o.setScaleChange(g.eParameterChangeType.IN_TIME,4))},e.prototype.shockWave=function(t,e,i,s){this._general.emitAt(t,e);var a=this._general.emitParticle();null!==a&&(a.lifetime=.3,a.setFrame("SHOCKWAVE"),s?(a.visual.scale.set(i,i),a.setScaleChange(g.eParameterChangeType.IN_TIME,(1-i)/.3),a.alpha=0,a.setAlphaChange(g.eParameterChangeType.IN_TIME,3.4)):(a.setScaleChange(g.eParameterChangeType.IN_TIME,i),a.setAlphaChange(g.eParameterChangeType.IN_TIME,-3.4)))},e.prototype.newBall=function(t,e){this._general.emitAt(t,e);var i=this._general.emitParticle();null!==i&&(i.lifetime=1,i.setFrame("BALL_NORMAL"),i.setScaleChange(g.eParameterChangeType.IN_TIME,4),i.setAlphaChange(g.eParameterChangeType.IN_TIME,-1))},e.prototype.numParticle=function(t,e,i){this._general.emitAt(t,e);var s=this._general.emitParticle();null!==s&&(s.lifetime=1.5,s.setFrame("FONT_YELLOW_"+i),s.visual.scale.set(.1,.1),s.setScaleChange(g.eParameterChangeType.IN_TIME,4),s.alpha=2,s.setAlphaChange(g.eParameterChangeType.IN_TIME,-1.5))},e.SHARDS_EXPLOSION_MAX=8,e.SHARDS_PARTICLES_MAX=48,e.EXPLOSIONS_MAX=16,e.GENERAL_MAX=16,e);function e(t,e){this._game=t;var i=(this._board=e).topParticlesGroup;this._shardExplosion=this.createShardsExplosion(),i.add(this._shardExplosion),this._shardsParticles=this.createShardsParticles(),i.add(this._shardsParticles),this._explosions=this.createExplosions(),i.add(this._explosions),this._general=this.createGeneral(),i.add(this._general)}g.Emitters=t}(Shards=Shards||{}),function(t){var a,e=(a=Phaser.Sprite,__extends(s,a),Object.defineProperty(s.prototype,"fade",{set:function(t){this.alpha=t,this.visible=0<t},enumerable:!1,configurable:!0}),s.prototype.isRunning=function(){return this._fadeRunning},s.prototype.fadeIn=function(t,e){if(void 0===t&&(t=s.FADE_TIME_IN),void 0===e&&(e=0),!this._fadeRunning){this.alpha=1,this.exists=!0,this.bringToTop(),this._fadeRunning=!0;var i=this.game.add.tween(this);i.to({alpha:0},t,Phaser.Easing.Sinusoidal.In,!0,e),i.onComplete.addOnce(function(){this.exist=!1,this.visible=!1,this._fadeRunning=!1,this.onFadeFinished.dispatch(!0)},this)}},s.prototype.fadeOut=function(t,e){if(void 0===t&&(t=s.FADE_TIME_OUT),void 0===e&&(e=0),!this._fadeRunning){this.alpha=0,this.exists=!0,this.visible=!0,this.bringToTop(),this._fadeRunning=!0;var i=this.game.add.tween(this);i.to({alpha:1},t,Phaser.Easing.Sinusoidal.Out,!0,e),i.onComplete.addOnce(function(){this.exist=!1,this._fadeRunning=!1,this.onFadeFinished.dispatch(!1)},this)}},s.FADE_TIME_IN=250,s.FADE_TIME_OUT=250,s);function s(t,e,i){var s=a.call(this,t,0,0,e,i)||this;return s.onFadeFinished=new Phaser.Signal,s._fadeRunning=!1,s.width=t.width,s.height=t.height,s.anchor.setTo(.5,.5),s.exists=!1,s.visible=!1,s}t.Fader=e}(Shards=Shards||{}),function(c){var d,t=(d=Phaser.Group,__extends(u,d),Object.defineProperty(u.prototype,"ball",{get:function(){return this._ball},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"lives",{set:function(t){this._livesText.text=""+t;var e=c.Global.GAME_WIDTH,i=c.Global.LOW?.4:1,s=-e/2+u.X_OFFSET*i;7===c.Global.sponsor.id&&(s=-(this._livesText.textWidth+this._xText.textWidth+this._ball.width)/2),this._livesText.position.set(s,this._scoreY),s+=this._livesText.textWidth,this._xText.position.set(s,this._scoreY+7*i),s+=this._xText.textWidth,this._ball.position.set(s+.65*c.Settings.BALL_DIAMETER,this._scoreY)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"score",{set:function(t){this._score=t,this._scoreBase=this._currentScore,this._scoreTime=u.SCORE_TIME},enumerable:!1,configurable:!0}),u.prototype.changeImmediately=function(){this._scoreTime=0,this._scoreText.text=Utils.StringUtils.padNumber(this._score,this._padLength)},u.prototype.update=function(){if(0<this._scoreTime){this._scoreTime=Math.max(0,this._scoreTime-this.game.time.delta/1e3);var t=1-this._scoreTime/u.SCORE_TIME;this._currentScore=Math.floor(Phaser.Math.linear(this._scoreBase,this._score,t)),this._scoreText.text=Utils.StringUtils.padNumber(this._currentScore,this._padLength)}},u.prototype.makeTrophyVisible=function(){this._trophyGroup.visible=!0},u.prototype.onNewHiScore=function(){Utils.AudioUtils.playSound(c.Sfx.SWOOSH),this._glow.angle=-90,this._trophyGroup.scale.set(c.Settings.BEST_ANIM_TROPHY_SCALE,c.Settings.BEST_ANIM_TROPHY_SCALE),this._trophyGroup.alpha=0,this._trophyGroup.visible=!0,this._trophyTweenAlpha.start(),this._trophyTweenScale.start(),this._glowTweenRotate.start()},u.FONT_LIFE_SIZE=36,u.FONT_X_SIZE=22,u.Y_OFFSET=38,u.X_OFFSET=20,u.SCORE_TIME=1,u);function u(t,e,i){var s=d.call(this,t,e)||this;s._padLength=10,7===c.Global.sponsor.id&&(s._padLength=8);var a=c.Global.GAME_WIDTH,o=c.Global.LOW?.4:1;s._scoreY=-t.height/2+u.Y_OFFSET*o,s._board=i,s._livesText=new Phaser.BitmapText(t,0,0,"FontFore","",u.FONT_LIFE_SIZE*o),s._livesText.anchor.set(0,.5),s.add(s._livesText),s._xText=new Phaser.BitmapText(t,0,0,"FontFore","X",u.FONT_X_SIZE*o),s._xText.anchor.set(0,.5),s.add(s._xText),s._ball=new Phaser.Sprite(t,0,0,"Game","BALL_NORMAL"),s._ball.anchor.set(.5,.5),s.add(s._ball),s.lives=0;var n=t.cache.getFrameByName("Game","PAUSE");s._pauseButton=new UI.Button(t,"Pause","Game","PAUSE"),s._pauseButton.setHitArea(new Phaser.Circle(0,0,150*o)),s._pauseButton.offsetOnDown.set(0,3),s._pauseButton.scaleOnOver.set(1.1,1.1),s._pauseButton.onClick.add(i.onPause,i),s._pauseButton.position.set(a/2-u.X_OFFSET*o-n.width/2,s._scoreY),s.add(s._pauseButton),s._score=s._scoreBase=s._currentScore=0,s._scoreTime=0,s._scoreText=new Phaser.BitmapText(t,a/2-u.X_OFFSET*o-1.4*n.width,s._scoreY,"FontFore",10===s._padLength?"0000000000":"00000000",u.FONT_LIFE_SIZE*o),s._scoreText.anchor.set(1,.5),s.add(s._scoreText);var r=t.add.group(s),h=new c.AnchoredSprite(t,0,0,"Game","TROPHY_GLOW");h.scale.set(1.8,1.8),s._glow=h,r.add(h);var l=new c.AnchoredSprite(t,0,0,"Game","TROPHY");r.add(l),s._trophyTweenAlpha=t.add.tween(r).to({alpha:1},c.Settings.BEST_ANIM_TIME,Phaser.Easing.Linear.None,!1),s._trophyTweenScale=t.add.tween(r.scale).to({x:1,y:1},c.Settings.BEST_ANIM_TIME,Phaser.Easing.Linear.None,!1),s._glowTweenRotate=t.add.tween(h).to({angle:0},c.Settings.BEST_ANIM_TIME,Phaser.Easing.Linear.None,!1);var _=0;return 7===c.Global.sponsor.id&&(_=s._scoreText.x-s._scoreText.textWidth-.55*l.width),r.position.set(_,s._scoreY),r.visible=!1,s._trophyGroup=r,s}c.GUI=t}(Shards=Shards||{}),function(_){var c,t=(c=Phaser.Group,__extends(d,c),Object.defineProperty(d.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),d.prototype.addInputCallback=function(t,e){this._bg.events.onInputUp.add(t,e),this._bg.events.onInputOver.add(function(){this._bg.scale.x=1.02,this._bg.scale.y=1.05},this),this._bg.events.onInputOut.add(this.unscale,this)},d.prototype.unscale=function(){this._bg.scale.x=1,this._bg.scale.y=1},d.prototype.clearInput=function(){if(this._bg.inputEnabled)for(var t=0;t<2;t++){var e=this._bg.input._pointerData[t];e.id=t,e.x=0,e.y=0,e.isDown=!1,e.isUp=!1,e.isOver=!1,e.isOut=!1,e.timeOver=0,e.timeOut=0,e.timeDown=0,e.timeUp=0,e.downDuration=0,e.isDragged=!1}},d.ICON_OFFSET_X=9,d.ICON_OFFSET_Y=6,d.TEXT_SIZE=36,d.TEXT_OFFSET=135,d.LEVEL_NAME_OFFSET=19,d.BEST_TIME_OFFSET=56,d.STARS_OFFSET_X=523,d.STARS_OFFSET_Y=55,d.STARS_STEP=80,d);function d(t,e,i){var s=c.call(this,t)||this;s._level=e;var a,o=_.Global.levelStats[e],n=_.Global.LOW?.4:1;if(s._glassHeight=t.cache.getFrameByName("GUI","LEVEL_GLASS").height,s._glassWidth=t.cache.getFrameByName("GUI","LEVEL_GLASS").width,s._bg=t.add.sprite(0,s._glassHeight/2,"GUI","LEVEL_GLASS",s),s._bg.anchor.set(.5,.5),(o.unlocked||_.Global.unlockLevels)&&(s._bg.inputEnabled=!0),a=o.unlocked||_.Global.unlockLevels?t.cache.getFrameByName("GUI","LEVEL_ICONS").index+i:"LEVEL_LOCKED",t.add.sprite(-s._glassWidth/2+d.ICON_OFFSET_X*n,d.ICON_OFFSET_Y*n,"GUI",a,s),o.unlocked||_.Global.unlockLevels){t.add.bitmapText(-s._glassWidth/2+d.TEXT_OFFSET*n,d.LEVEL_NAME_OFFSET*n,"Font",Utils.TextUtils.getText("TXT_LEVEL_"+i),d.TEXT_SIZE*n,s);var r=d.TEXT_SIZE*n,h=d.BEST_TIME_OFFSET*n;7===_.Global.sponsor.id&&(r*=.8,h+=15*n),t.add.bitmapText(-s._glassWidth/2+d.TEXT_OFFSET*n,h,"Font",Utils.TextUtils.getText("TXT_BEST_TIME")+Utils.StringUtils.formatTime(o.time,1,2),r,s)}for(var l=0;l<3;l++){t.add.sprite(-s._glassWidth/2+d.STARS_OFFSET_X*n+l*d.STARS_STEP*n,d.STARS_OFFSET_Y*n,"GUI",(o.unlocked||_.Global.unlockLevels)&&l<o.stars?"LEVEL_STAR_ACHIEVED":"STAR_EMPTY",s).anchor.set(.5,.5)}return s}_.IconLevel=t}(Shards=Shards||{}),function(u){var p,t=(p=Phaser.Group,__extends(g,p),g.prototype.onFullscreenChange=function(t){u.Global.fullscreenOption&&(this._toggleFullscreen.toggled=t)},g.BUTTON_OFFSET=250,g.TOGGLE_OFFSET=80,g.SCALE=1.1,g);function g(t,e,i){var s=p.call(this,t,e)||this,a=u.Global.LOW?.4:1;s._board=i;var o=new UI.Button(t,"Cancel","GUI","BUTTON_CANCEL");o.position.set(-g.BUTTON_OFFSET*a,0),o.scaleOnOver.set(g.SCALE,g.SCALE),o.onClick.add(function(t){7===u.Global.sponsor.id?i.showExitWarning(t,!1):i.parent.onExit(t)},s),s.add(o),s._buttonExit=o;var n=new UI.Button(t,"Continue","GUI","BUTTON_CONTINUE");n.position.set(g.BUTTON_OFFSET*a,0),n.scaleOnOver.set(g.SCALE,g.SCALE),n.onClick.add(i.onUnpause,i),s.add(n),s._buttonContinue=n;var r=-60*a,h=120*a,l=new UI.Toggle(t,"Music","GUI","ICON_MUSIC_OFF","ICON_MUSIC_ON");l.changeOnDown=!1,l.position.set(-g.TOGGLE_OFFSET*a,0),l.scaleOnOver.set(g.SCALE,g.SCALE),l.setHitArea(new Phaser.Rectangle(r,r,h,h)),l.onClick.add(function(t){u.Global.musicOn=t.toggled,u.Global.musicOn?this._board.parent.playMusic():Utils.AudioUtils.stopMusic()},s),l.toggled=u.Global.musicOn,s.add(l),s._toggleMusic=l;var _=new UI.Toggle(t,"Sound","GUI","ICON_SOUND_OFF","ICON_SOUND_ON");if(_.changeOnDown=!1,_.position.set(g.TOGGLE_OFFSET*a,0),_.scaleOnOver.set(g.SCALE,g.SCALE),_.setHitArea(new PIXI.Rectangle(r,r,h,h)),_.onClick.add(function(t){u.Global.soundOn=t.toggled},s),_.toggled=u.Global.soundOn,s.add(_),s._toggleSound=_,u.Global.fullscreenOption){var c=new UI.Toggle(t,"FullScreen","GUI","FULLSCREEN_OFF","FULLSCREEN_ON");c.position.set(340*a,-t.height/2+60*a),c.scaleOnOver.set(1.1,1.1),c.onClick.add(function(t){Utils.FullscreenUtils.changeFullscreen()},s),c.toggled=Utils.FullscreenUtils.isFullscreen(),s.add(c),s._toggleFullscreen=c}if(5===u.Global.sponsor.id){var d=s.game.add.button(0,0,"Logo",function(){Utils.AudioUtils.playSound(u.Sfx.CLICK),window.open("http://www.addictinggames.com","_blank")},s);d.position.set(0,.4*-s.game.height),d.anchor.setTo(.5,.5),d.scale.setTo(.75*a,.75*a),s.add(d)}return s}u.InGameMenu=t}(Shards=Shards||{}),(Shards||(Shards={})).LevelStats=function(){this.unlocked=!1,this.time=0,this.stars=0},function(t){var e;(e=t.eObjectType||(t.eObjectType={}))[e.OBJECT_BRICK=1]="OBJECT_BRICK",e[e.OBJECT_BALL=2]="OBJECT_BALL",e[e.OBJECT_PADDLE=4]="OBJECT_PADDLE",e[e.OBJECT_ENEMY=8]="OBJECT_ENEMY",e[e.OBJECT_MISSILE=16]="OBJECT_MISSILE",e[e.OBJECT_BORDER=32]="OBJECT_BORDER",e[e.OBJECT_BOTTOM_BORDER=64]="OBJECT_BOTTOM_BORDER",e[e.OBJECT_BONUS=128]="OBJECT_BONUS"}(Shards=Shards||{}),function(t){var e=(i.prototype.clearStat=function(){this.combosValue=0,this.paddleHits=0,this.totalHitpoints=0,this.bricksToBreak=0,this.clearEmptyHits(),this.bricksWinCount=0,this.bricksUnbreakable=0},i.prototype.clearEmptyHits=function(){this.emptyHits=0,this.noHitTime=0,this.emptyHitCounter=0},i);function i(){}t.BoardStats=e}(Shards=Shards||{}),function(t){var n,e=(n=Phaser.Sprite,__extends(i,n),i.prototype.setAnchoredFrame=function(t){if("string"==typeof this.key){var e=null;void 0!==(e="string"==typeof t?(this.frameName=t,this.game.cache.getFrameByName(this.key,t)):(this.frame=t,this.game.cache.getFrameByIndex(this.key,t))).anchorX&&void 0!==e.anchorY&&this.anchor.setTo(e.anchorX,e.anchorY)}},i);function i(t,e,i,s,a){var o=n.call(this,t,e,i,s)||this;return void 0!==a&&o.setAnchoredFrame(a),o}t.AnchoredSprite=e}(Shards=Shards||{}),function(t){var s,e=(s=t.SpriteParticle,__extends(i,s),i.prototype.onEmit=function(t){this._parent.add(this._visual)},i);function i(t,e){var i=s.call(this,t,e)||this;return void 0!==e&&null===e||(i._parent=e[0]),i}t.OtherParentParticle=e}(Shards=Shards||{}),function(e){var t=(i.prototype.clear=function(){this._hiScore=e.Global.hiScore,this._score=0,this._newBest=!1},Object.defineProperty(i.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this._newBest=t>=e.Global.hiScore},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hiScore",{get:function(){return this._hiScore},enumerable:!1,configurable:!0}),i.prototype.addScore=function(t){this._score+=Math.floor(t),this.isNewHiScore()&&(this._hiScore=this._score,this._newBest||(this._newBest=!0,this.onNewHiScore.dispatch()))},i.prototype.isNewHiScore=function(){return this._score>this._hiScore},i);function i(){this.onNewHiScore=new Phaser.Signal,this._score=0,this._hiScore=0,this._newBest=!1,this.clear()}e.Score=t}(Shards=Shards||{}),function(n){var r,t=(r=Phaser.Group,__extends(h,r),Object.defineProperty(h.prototype,"toggle",{get:function(){return this._toogle},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"iconWidth",{get:function(){return h.TEXT_OFFSET*this._scale+this._text.textWidth},enumerable:!1,configurable:!0}),h.TEXT_OFFSET=65,h.TEXT_SIZE=36,h);function h(t,e,i,s,a){var o=r.call(this,t)||this;return o._scale=1,n.Global.LOW&&(o._scale=.4),o._text=new Phaser.BitmapText(t,h.TEXT_OFFSET*o._scale,0,"Font",Utils.TextUtils.getText(a),h.TEXT_SIZE*o._scale),o._text.anchor.set(0,.5),o.add(o._text),o._toogle=new UI.Toggle(t,"difficulty_"+e,"GUI",i,s),o._toogle.difficulty=e,o._toogle.scaleOnOver.set(1.1,1.1),o.add(o._toogle),n.Global.difficulty===e&&(o._toogle.toggled=!0),o}n.IconSpeed=t}(Shards=Shards||{}),function(e){var r,t=(r=e.AnchoredSprite,__extends(i,r),Object.defineProperty(i.prototype,"objType",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadow",{get:function(){return this._shadow},set:function(t){this._shadow=t},enumerable:!1,configurable:!0}),i.prototype.updateShadowPosition=function(){null!==this._shadow&&this._shadow.visible&&(this._shadow.position.set(this.position.x+e.Settings.SHADOW_OFFSET_X,this.position.y+e.Settings.SHADOW_OFFSET_Y),this._type===e.eObjectType.OBJECT_PADDLE?(this._shadow.scale.copyFrom(this.scale),this._shadow.angle=this.angle):this._type===e.eObjectType.OBJECT_ENEMY&&(this._shadow.angle=this.angle))},i.prototype.setActive=function(t){this.visible=t,this.exists=t,this.body.data.SetActive(t),null!==this._shadow&&(t?(this._type===e.eObjectType.OBJECT_ENEMY?this._board.bricksGroup.add(this._shadow):this._board.shadowsGroup.add(this._shadow),this.updateShadowPosition()):this._type===e.eObjectType.OBJECT_ENEMY?this._board.bricksGroup.remove(this._shadow):this._board.shadowsGroup.remove(this._shadow))},i.prototype.setPosition=function(t,e){var i=this.body;i.x=t,i.y=e},i.prototype.setVelocity=function(t,e){var i=this.body;i.velocity.x=t,i.velocity.y=e},i.prototype.getVelocity=function(t){var e=this.body;return t.x=e.velocity.x,t.y=e.velocity.y,t},i.prototype.setAngle=function(t){this.body.angle=0},i);function i(t,e,i,s,a,o){var n=r.call(this,t,i,s,a,o)||this;return n._shadow=null,n._board=e,n}e.SpriteWithShadow=t;var s,a=(__extends(o,s=t),o.prototype.postUpdate=function(){s.prototype.postUpdate.call(this),this.updateShadowPosition()},o);function o(){return null!==s&&s.apply(this,arguments)||this}e.SpriteWithUpdatableShadow=a}(Shards=Shards||{}),function(_){var c,t=(c=_.SpriteWithShadow,__extends(i,c),Object.defineProperty(i.prototype,"toBeDestroyed",{get:function(){return this._toBeDestroyed},set:function(t){this._toBeDestroyed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"unbreakable",{get:function(){return this._unbreakable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canShine",{get:function(){return!this._unbreakable&&this._hitPoints===this._hitPointsMax},enumerable:!1,configurable:!0}),i.prototype.set=function(t){this._brickType=t&i.MASK_TYPE,this._unbreakable=0<(t&i.MASK_UNBREAKABLE),this.hitPoints=(t&i.MASK_HP)>>8,this._toBeDestroyed=!1,this._colored=0<(t&i.MASK_COLORED),this._unbreakable||this._board.addTotalHitPoints(this._hitPoints),this._colored,this.setFrameImage()},Object.defineProperty(i.prototype,"hitPoints",{set:function(t){this._hitPointsMax=t,this._hitPoints=t},enumerable:!1,configurable:!0}),i.prototype.hit=function(t){if(!this._toBeDestroyed){var e=this._board;return this._unbreakable?(e.addEmptyHit(),Utils.AudioUtils.playSound(this.game.rnd.integerInRange(_.Sfx.UNBREAKABLE_HIT_1,_.Sfx.UNBREAKABLE_HIT_2)),!1):(e.clearEmptyHit(),this._hitPoints-=t,this._toBeDestroyed=this._hitPoints<=0,this._toBeDestroyed||(e.shardsExplosion(this.x,this.y,this.scale.x,!1),e.addScore(_.Settings.SCORE_NOT_DESTROYED),this.setFrameImage()),this._toBeDestroyed)}},i.prototype.setFrameImage=function(){var t=this._brickType,e=this.game.cache.getFrameByName("Game","BRICK_SHADOW").index;this._unbreakable?t+=i.UNBREAKABLE_BASE:(t=5*t+i.kBrickPhases[this._hitPointsMax-1][this._hitPointsMax-this._hitPoints]+i.NORMAL_BASE,e+=i.kBrickPhases[this._hitPointsMax-1][this._hitPointsMax-this._hitPoints]),this.frame=t,this._shadow.setAnchoredFrame(e),this.updateShadowPosition()},i.prototype.onCollisionBall=function(t,e,i,s,a,o){if(a){var n=e.sprite;n.setHit(o),this.hit(1)?n.addComboEvent(1):n.clearComboStates()}},i.MASK_COLORED=2048,i.MASK_UNBREAKABLE=4096,i.MASK_DARK=8192,i.MASK_HP=1792,i.MASK_ANGLE_BIT=32768,i.MASK_TYPE=255,i.kBrickPhases=[[0,0,0,0,0],[0,4,0,0,0],[0,3,4,0,0],[0,2,3,4,0],[0,1,2,3,4]],i);function i(t,e,i,s,a,o,n){var r=c.call(this,t,e,i,s,"Game","BRICK_NORMAL")||this;r.id=0,r._type=_.eObjectType.OBJECT_BRICK,r.shadow=new _.AnchoredSprite(t,0,0,"Game"),r.set(n),r.scale.set(a,a),t.physics.box2d.enable(r);var h=r.body,l=r.game.cache.getFrameByName("Game","BRICK_NORMAL");return h.setRectangle(l.width*a,l.height*a),h.angle=360-o,h.static=!0,h.data.SetUserData(r),h.setCollisionCategory(_.eObjectType.OBJECT_BRICK),h.setCollisionMask(_.eObjectType.OBJECT_BALL+_.eObjectType.OBJECT_ENEMY+_.eObjectType.OBJECT_MISSILE),h.setCategoryContactCallback(_.eObjectType.OBJECT_BALL,r.onCollisionBall,r),r._shadow.angle=360-o,r._shadow.scale.set(a,a),r.setActive(!0),r}_.Brick=t}(Shards=Shards||{}),function(r){var i,t;(t=i=r.eCannonState||(r.eCannonState={}))[t.NO_CANNON=0]="NO_CANNON",t[t.ON=1]="ON",t[t.ON_RUNNING=2]="ON_RUNNING",t[t.OFF=3]="OFF",t[t.ACTIVE=4]="ACTIVE";var h,e=(h=r.SpriteWithUpdatableShadow,__extends(o,h),Object.defineProperty(o.prototype,"cannonReady",{get:function(){return this._cannonOn&&this._cannonState===i.ACTIVE},enumerable:!1,configurable:!0}),o.prototype.setSize=function(t,e){if(void 0===e&&(e=!0),this.scale.set(t,1),e){for(var i=r.Global.LOW?.4:1,s=0;s<o.PADDLE_DATA.length;s+=2)this._scaledData[s]=o.PADDLE_DATA[s]*t*i,this._scaledData[s+1]=o.PADDLE_DATA[s+1]*i;var a=this.body;a.setPolygon(this._scaledData),a.mass=10,a.friction=.4,a.restitution=0,a.fixedRotation=!0,a.setCollisionCategory(r.eObjectType.OBJECT_PADDLE),a.setCollisionMask(r.eObjectType.OBJECT_BORDER+r.eObjectType.OBJECT_BALL+r.eObjectType.OBJECT_ENEMY+r.eObjectType.OBJECT_BONUS)}},o.prototype.updateScale=function(t){if(this._currentScale!==this._targetScale){var e=this._currentScale;this._currentScale<this._targetScale?this._currentScale=Math.min(this._currentScale+r.Settings.PADDLE_CHANGE_SPEED*t,this._targetScale):this._currentScale=Math.max(this._currentScale-r.Settings.PADDLE_CHANGE_SPEED*t,this._targetScale);var i=Math.floor(10*e)-Math.floor(10*this._currentScale)!=0||this._currentScale===this._targetScale;this.setSize(this._currentScale,i)}},o.prototype.tick=function(t){if(this.updateOverlay(t),this._cannonOn){var e=this._leftCannon.animations.currentAnim.isFinished;switch(this._cannonState){case i.ON_RUNNING:return void(e&&(this._cannonState=i.ACTIVE));case i.ACTIVE:return void((this._cannonTime-=t)<=0&&(this._cannonState=i.OFF,this._leftCannon.animations.play("cannon_off"),this._rightCannon.animations.play("cannon_off"),Utils.AudioUtils.playSound(r.Sfx.CANNON_OFF)));case i.OFF:return void(e&&this.cancelCannon())}}this.updateScale(t),this._currentScale===this._targetScale&&this._cannonOn&&this._cannonState===i.ON&&(this._cannonState=i.ON_RUNNING)},o.prototype.setNormalSize=function(){this.setScale(r.Settings.PADDLE_SIZE_NORMAL)},o.prototype.shrink=function(){this._targetScale!==r.Settings.PADDLE_SIZE_SMALL&&(this._targetScale===r.Settings.PADDLE_SIZE_NORMAL?this.setScale(r.Settings.PADDLE_SIZE_SMALL):this.setScale(r.Settings.PADDLE_SIZE_NORMAL))},o.prototype.enlarge=function(){this._targetScale!==r.Settings.PADDLE_SIZE_BIG&&(this._targetScale===r.Settings.PADDLE_SIZE_SMALL?this.setScale(r.Settings.PADDLE_SIZE_NORMAL):this.setScale(r.Settings.PADDLE_SIZE_BIG))},o.prototype.setCannon=function(t){t?(this.setNormalSize(),this._cannonOn||(this._cannonOn=!0,this._cannonState=i.ON,this._leftCannon.visible=!0,this._leftCannon.animations.play("cannon_on"),this._rightCannon.visible=!0,this._rightCannon.animations.play("cannon_on"),Utils.AudioUtils.playSound(r.Sfx.CANNON_ON)),this._cannonTime=r.Settings.CANNON_DURATION):this._cannonTime=0},o.prototype.cancelCannon=function(){this._cannonState=i.NO_CANNON,this._cannonOn=!1,this._leftCannon.visible=!1,this._rightCannon.visible=!1,this._cannonTime=0},Object.defineProperty(o.prototype,"cannonTime",{get:function(){return this._cannonTime},enumerable:!1,configurable:!0}),o.prototype.setScale=function(t){this._cannonOn&&(this._cannonTime=0,this._cannonState===i.ON&&(this._cannonOn=!1)),this._targetScale!==t&&(this._targetScale=t)},o.prototype.isCannonReady=function(){return this._cannonOn&&this._cannonState===i.ACTIVE},o.prototype.updateOverlay=function(t){var e=null;this._board.isFastTime()?e="PADDLE_FIRE":this._board.isSlowTime()?e="PADDLE_FROST":this._board.isStickTime()?e="PADDLE_STICKY":this._board.isPowerTime()&&(e="PADDLE_POWER");var i=null===e?0:this.game.cache.getFrameByName("Game",e).index;if(i!==this._overlayIn.frame){this._overlayTime=r.Settings.PADDLE_OVERLAY_TIME;var s=this._overlayIn.frame;this._overlayOut.setAnchoredFrame(s),this._overlayOut.visible=0!==s,this._overlayIn.setAnchoredFrame(i),this._overlayIn.visible=0!==i}if(0<this._overlayTime){this._overlayTime=Math.max(this._overlayTime-t,0);var a=this._overlayTime/r.Settings.PADDLE_OVERLAY_TIME;this._overlayOut.visible&&(this._overlayOut.alpha=a),this._overlayIn.visible&&(this._overlayIn.alpha=1-a),0===this._overlayTime&&(this._overlayOut.visible=!1)}},o.PADDLE_DATA=[0,0,-82,0,-79,-11,-68,-20,-42,-29,-23,-32,0,-32,23,-32,42,-29,68,-20,79,-11,82,0],o);function o(t,e,i,s){var a=h.call(this,t,e,i,s,"Game","PADDLE")||this;a._scaledData=[],a._overlayTime=0,a._cannonTime=0;var o=r.Global.LOW?.4:1;a._type=r.eObjectType.OBJECT_PADDLE,t.physics.box2d.enable(a),a._currentScale=r.Settings.PADDLE_SIZE_NORMAL,a._targetScale=a._currentScale,a.setSize(a._currentScale),a._overlayOut=new r.AnchoredSprite(t,0,0,"Game"),a._overlayOut.visible=!1,a.addChild(a._overlayOut),a._overlayIn=new r.AnchoredSprite(t,0,0,"Game"),a._overlayIn.visible=!1,a.addChild(a._overlayIn);var n=new r.AnchoredSprite(t,0,0,"Game");return n.anchor.set(.5,1),n.position.set(-r.Settings.CANNON_OFFSET,15*o),n.animations.add("cannon_on",r.Settings.CANNON_ON_ANIMATION,20),n.animations.add("cannon_off",r.Settings.CANNON_OFF_ANIMATION,20),n.visible=!1,a.addChild(n),a._leftCannon=n,(n=new r.AnchoredSprite(t,0,0,"Game")).anchor.set(.5,1),n.position.set(r.Settings.CANNON_OFFSET,15*o),n.animations.add("cannon_on",r.Settings.CANNON_ON_ANIMATION,20),n.animations.add("cannon_off",r.Settings.CANNON_OFF_ANIMATION,20),n.visible=!1,a.addChild(n),a._rightCannon=n,a.shadow=new r.AnchoredSprite(t,0,0,"Game","PADDLE_SHADOW"),a.setActive(!0),a}r.Paddle=e}(Shards=Shards||{}),function(p){var n,t=(n=p.SpriteWithUpdatableShadow,__extends(r,n),Object.defineProperty(r.prototype,"sticked",{get:function(){return this._sticked},enumerable:!1,configurable:!0}),r.prototype.setStickPosition=function(t,e){this._stickPosition.set(t,e)},Object.defineProperty(r.prototype,"dead",{get:function(){return this._dead},set:function(t){this._dead=t},enumerable:!1,configurable:!0}),r.prototype.clear=function(){null!==this._weldJoint&&(this.game.physics.box2d.world.DestroyJoint(this._weldJoint),this._weldJoint=null),this.dead=!1,this._doStick=!1,this._sticked=!1,this._hitOccured=!1;var t=this.body;this._lastPosition.set(t.x,t.y),p.Global.NO_ANIMS||(this._bottomEmitter.killAllParticles(),this._topEmitter.killAllParticles())},r.prototype.setSticked=function(t){if(this._lastVelocity.set(0,0),this._lastVelocityCounter=0,!t||!this._sticked){var e=this.body;if(t){e.setCollisionMask(p.eObjectType.OBJECT_BORDER+p.eObjectType.OBJECT_PADDLE+p.eObjectType.OBJECT_BALL+p.eObjectType.OBJECT_BRICK),e.setZeroVelocity(),e.setZeroRotation(),e.angle=0,e.x=this._stickPosition.x,e.y=this._stickPosition.y,null!==this._weldJoint&&(this.game.physics.box2d.world.DestroyJoint(this._weldJoint),this._weldJoint=null);var i=this._board.paddle;this._weldJoint=this.game.physics.box2d.weldJoint(i,this,e.x-i.body.x,e.y-i.body.y,0,0)}else e.setCollisionMask(p.eObjectType.OBJECT_BORDER+p.eObjectType.OBJECT_PADDLE+p.eObjectType.OBJECT_BALL+p.eObjectType.OBJECT_BRICK+p.eObjectType.OBJECT_ENEMY+p.eObjectType.OBJECT_BOTTOM_BORDER),null!==this._weldJoint&&(this.game.physics.box2d.world.DestroyJoint(this._weldJoint),this._weldJoint=null);(this._sticked=t)||this._lastPosition.set(this.x,this.y)}},r.prototype.tick=function(t){var e=this._board;this.game,this.processComboQueue(t),this._doStick&&(this.setSticked(!0),this._doStick=!1);var i=e.speed;e.isSlowTime()?i*=p.Settings.SPEED_SLOW_RATE:e.isFastTime()&&(i*=p.Settings.SPEED_FAST_RATE);var s=i*i,a=this.getVelocity(this._pt).getMagnitudeSq();if(!this._sticked&&2<Math.abs(a-s)&&(0===this._pt.x&&0===this._pt.y&&this._pt.set(1,1),this._pt.setMagnitude(i),this.setVelocity(this._pt.x,this._pt.y)),p.Global.NO_ANIMS||this.tickParticles(t),this._hitOccured&&!this._sticked){var o=!1,n=this.getVelocity(this._pt),r=Math.abs(n.x),h=Math.abs(n.y),l=Math.abs(this._lastVelocity.x),_=Math.abs(this._lastVelocity.y),c=Math.abs(r-l),d=Math.abs(h-_);if(c<.05&&d<.05?10<++this._lastVelocityCounter&&((this._lastVelocityCounter=0)===this.game.rnd.integerInRange(0,1)?n.x*=2:n.y*=2,o=!0,this._lastVelocity.set(0,0)):(this._lastVelocity.copyFrom(n),this._lastVelocityCounter=0),n.normalize(),Math.abs(n.x)<.1)l=n.x,0===(u=Phaser.Math.sign(l))&&(u=0==this.game.rnd.integerInRange(0,1)?-1:1),n.x=Math.sin(Phaser.Math.degToRad(15))*u,o=!0;else if(Math.abs(n.y)<.1){var u;_=n.y,0===(u=Phaser.Math.sign(_))&&(u=0==this.game.rnd.integerInRange(0,1)?-1:1),n.y=Math.sin(Phaser.Math.degToRad(15))*u,o=!0}o&&this.setVelocity(n.x,n.y)}this._hitOccured=!1},r.prototype.tickParticles=function(t){this._bottomEmitter.update(),this._topEmitter.update(),this.trailParticle(t),this._hitOccured&&this.hitParticle()},r.prototype.trailParticle=function(t){var e=this._board.activeBonus,i=p.Settings.BALL_DIAMETER/4;if(!this._sticked){var s=this._pt;if(s.set(this.x,this.y),s.subtract(this._lastPosition.x,this._lastPosition.y),s.getMagnitudeSq()<i*i)return;var a=Math.floor(s.getMagnitude()/i);s.setMagnitude(i);for(var o=0;o<a;o++)if(this._lastPosition.add(s.x,s.y),e!==p.eBonusType.POWER&&(this._bottomEmitter.emitAt(this._lastPosition.x,this._lastPosition.y),this._bottomEmitter.emitParticle()),e!==p.eBonusType.NONE&&(this._nextParticleTime-=t)<=0){this._topEmitter.emitAt(this._lastPosition.x,this._lastPosition.y);var n=this._topEmitter.emitParticle();if(null!==n)switch(e){case p.eBonusType.FAST:this._nextParticleTime=.04*this._board.speedCoef,n.setFrame("BALL_PTC_FAST"),n.lifetime=.4*this._board.speedCoef;var r=p.Settings.BALL_DIAMETER>>3;n.visual.position.x+=this.game.rnd.integerInRange(-r,r),n.visual.position.y+=this.game.rnd.integerInRange(-r,r),n.setScaleChange(p.eParameterChangeType.IN_TIME,-.9),n.alpha=.5+this.game.rnd.realInRange(0,.5),n.setAlphaChange(p.eParameterChangeType.IN_TIME,-2);break;case p.eBonusType.SLOW:this._nextParticleTime=.18*this._board.speedCoef,n.setFrame("BALL_PTC_SLOW"),n.lifetime=+this._board.speedCoef,r=p.Settings.BALL_DIAMETER>>2,n.visual.position.x+=this.game.rnd.integerInRange(-r,r),n.visual.position.y+=this.game.rnd.integerInRange(-r,r),n.setScaleChange(p.eParameterChangeType.IN_TIME,-1);break;case p.eBonusType.POWER:this._nextParticleTime=.08*this._board.speedCoef,n.setFrame("BALL_PTC_POWER"),n.lifetime=.4*this._board.speedCoef,n.setScaleChange(p.eParameterChangeType.IN_TIME,-.9),n.setAlphaChange(p.eParameterChangeType.IN_TIME,-2);break;case p.eBonusType.STICKY:this._nextParticleTime=.04*this._board.speedCoef,n.setFrame("BALL_PTC_STICKY"),n.lifetime=.4*this._board.speedCoef,r=p.Settings.BALL_DIAMETER>>2,n.visual.position.x+=this.game.rnd.integerInRange(-r,r),n.visual.position.y+=this.game.rnd.integerInRange(-r,r),n.setScaleChange(p.eParameterChangeType.IN_TIME,-2),n.setAlphaChange(p.eParameterChangeType.IN_TIME,-2)}}}},r.prototype.hitParticle=function(){switch(this._topEmitter.emitAt(this._hitPoint.x,this._hitPoint.y),this._board.activeBonus){case p.eBonusType.SLOW:for(var t=0;t<this.game.rnd.integerInRange(3,6);t++)if(null!==(s=this._topEmitter.emitParticle())){s.setFrame("HIT_PARTICLE_ICE");var e=s.visual.rotation;s.setPhysics(120*Math.cos(e),120*Math.sin(e),0,.5),s.lifetime=2,s.setScaleChange(p.eParameterChangeType.NO_CHANGE),s.setAlphaChange(p.eParameterChangeType.IN_TIME,-.5)}break;case p.eBonusType.FAST:for(t=0;t<this.game.rnd.integerInRange(4,7);t++)null!==(s=this._topEmitter.emitParticle())&&(s.setFrame("HIT_PARTICLE_FIRE"),e=s.visual.rotation,s.setPhysics(240*Math.cos(e),240*Math.sin(e),0,.7),s.lifetime=1,s.setScaleChange(p.eParameterChangeType.NO_CHANGE),s.setAlphaChange(p.eParameterChangeType.IN_TIME,-.5));break;case p.eBonusType.STICKY:for(this._topEmitter.emitAt(this._hitPoint.x+this.game.rnd.integerInRange(p.Settings.BALL_DIAMETER,p.Settings.BALL_DIAMETER)/2,this._hitPoint.y+this.game.rnd.integerInRange(p.Settings.BALL_DIAMETER,p.Settings.BALL_DIAMETER)/2),t=0;t<3;t++)if(null!==(s=this._topEmitter.emitParticle())){s.setFrame("BALL_PTC_STICKY"),s.lifetime=2.5;var i=.5+this.game.rnd.realInRange(.5,1);s.visual.scale.set(i,i),s.setScaleChange(p.eParameterChangeType.IN_TIME,-.2),s.setAlphaChange(p.eParameterChangeType.IN_TIME,-.5)}break;case p.eBonusType.POWER:var s;null!==(s=this._topEmitter.emitParticle())&&(s.setFrame("BALL_PTC_POWER"),s.lifetime=1,s.setScaleChange(p.eParameterChangeType.IN_TIME,1),s.setAlphaChange(p.eParameterChangeType.IN_TIME,-1))}},r.prototype.onCollisionBorder=function(t,e,i,s,a,o){a&&(this.setHit(o),this._board.addEmptyHit(),this.addComboEvent(2),Utils.AudioUtils.playSound(this.game.rnd.integerInRange(p.Sfx.BORDER_HIT_1,p.Sfx.BORDER_HIT_3)))},r.prototype.onCollisionBottomBorder=function(t,e,i,s,a,o){a&&(this.setHit(o),this.dead=!0)},r.prototype.onCollisionPaddle=function(t,e,i,s,a,o){a&&(this.setHit(o),this._board.addPaddleHit(),this.clearComboStates(),!this._sticked&&this._board.isStickTime()?(0<t.velocity.y&&t.y+p.Settings.BALL_DIAMETER/2<e.y&&(this._doStick=!0,this._stickPosition.set(t.x,t.y)),Utils.AudioUtils.playSound(p.Sfx.BALL_STICKY_HIT)):Utils.AudioUtils.playSound(this.game.rnd.integerInRange(p.Sfx.PADDLE_HIT_1,p.Sfx.PADDLE_HIT_3)))},r.prototype.onCollisionBall=function(t,e,i,s,a,o){a&&(this.setHit(o),Utils.AudioUtils.playSound(this.game.rnd.integerInRange(p.Sfx.PADDLE_HIT_1,p.Sfx.PADDLE_HIT_3)))},r.prototype.onPresolveBrick=function(t,e,i,s,a,o){if(this._board.isPowerTime()){var n=e.sprite;(n.objType!==p.eObjectType.OBJECT_BRICK||e.sprite.unbreakable)&&n.objType!==p.eObjectType.OBJECT_ENEMY||a.SetEnabled(!1)}},r.prototype.setHit=function(t){this._hitOccured=!0,this._board.calcContactPoint(t,this._hitPoint)},r.prototype.clearComboStates=function(){this._comboState=0,this._expectedEvent=0,this._comboQueueCtr=0,this._comboCtr=0},r.prototype.addComboEvent=function(t){this._comboQueueCtr>=r.MAX_COMBO_EVENTS||(1==t&&this._board.isPowerTime()&&(t=3),this._comboQueue[this._comboQueueCtr++]=t)},r.prototype.setComboState=function(t,e,i){void 0===i&&(i=4),this._comboState!==t&&0!==t&&(this._comboTimeout=p.Settings.COMBO_TIMEOUT),this._comboState=t,this._comboCtr=e,4!==i&&(this._expectedEvent=i)},r.prototype.increaseComboCounter=function(){if(++this._comboCtr,this._comboTimeout=p.Settings.COMBO_TIMEOUT,3<=this._comboCtr&&(2===this._comboState||3===this._comboState)||4<=this._comboCtr&&4===this._comboState){var t=this._board.getFreeCombo();null!==t&&t.init(this.x,this.y,this._comboCtr),this._board.adjustComboValue(this._comboCtr-2)}},r.prototype.processComboQueue=function(t){0<this._comboTimeout&&(this._comboTimeout-=t)<0&&this.setComboState(0,0);for(var e=0;e<this._comboQueueCtr;e++){var i=this._comboQueue[e];switch(this._comboState){case 0:3===i?this.setComboState(4,1,3):1===i?this.setComboState(1,1):this.setComboState(0,0);break;case 1:3===i?this.setComboState(4,1,3):1===i?(this.setComboState(2,this._comboCtr,1),this.increaseComboCounter()):this.setComboState(3,this._comboCtr,1);break;case 2:1===i?this.increaseComboCounter():2===i?this.setComboState(0,0):3===i&&this.setComboState(4,1,3);break;case 3:i===this._expectedEvent?1===this._expectedEvent?(this.increaseComboCounter(),this._expectedEvent=2):this._expectedEvent=1:2===i?this.setComboState(0,0):1===i?this.setComboState(2,2,1):3===i&&this.setComboState(4,1,3);break;case 4:2===i?this.setComboState(0,0):1===i?this.setComboState(1,1):this.increaseComboCounter()}}this._comboQueueCtr=0},r.BOTTOM_PARTICLES_MAX=32,r.TOP_PARTICLES_MAX=32,r.MAX_COMBO_EVENTS=12,r);function r(t,e){var i=n.call(this,t,e,500,0,"Game","BALL_NORMAL")||this;i._stickPosition=new Phaser.Point,i._lastVelocity=new Phaser.Point,i._lastPosition=new Phaser.Point,i._weldJoint=null,i._hitPoint=new Phaser.Point,i._comboQueue=[],i._pt=new Phaser.Point,i._type=p.eObjectType.OBJECT_BALL,t.physics.box2d.enable(i);var s=i.body;if(s.setCircle(p.Settings.BALL_DIAMETER/2),s.mass=.47,s.friction=0,s.restitution=1,s.bullet=!0,s.setCollisionCategory(p.eObjectType.OBJECT_BALL),s.setCollisionMask(p.eObjectType.OBJECT_BORDER+p.eObjectType.OBJECT_PADDLE+p.eObjectType.OBJECT_BALL+p.eObjectType.OBJECT_BRICK+p.eObjectType.OBJECT_ENEMY+p.eObjectType.OBJECT_BOTTOM_BORDER),s.setCategoryContactCallback(p.eObjectType.OBJECT_BORDER,i.onCollisionBorder,i),s.setCategoryContactCallback(p.eObjectType.OBJECT_BOTTOM_BORDER,i.onCollisionBottomBorder,i),s.setCategoryContactCallback(p.eObjectType.OBJECT_PADDLE,i.onCollisionPaddle,i),s.setCategoryContactCallback(p.eObjectType.OBJECT_BALL,i.onCollisionBall,i),s.setCategoryPresolveCallback(p.eObjectType.OBJECT_BRICK,i.onPresolveBrick,i),s.setCategoryPresolveCallback(p.eObjectType.OBJECT_ENEMY,i.onPresolveBrick,i),i.setActive(!1),!p.Global.NO_ANIMS){var a=.5*i._board.speedCoef,o=new p.ParticlesEmitter(t,0,0,r.BOTTOM_PARTICLES_MAX);o.clear(),o.particleClass=p.OtherParentParticle,o.lifetime=a,o.setScaleChange(p.eParameterChangeType.IN_TIME,-.9,1),o.setAlpha(.5,.5),o.setAlphaChange(p.eParameterChangeType.IN_TIME,-1,1),o.makeParticles("Game","BALL_PTC_NORMAL",r.BOTTOM_PARTICLES_MAX,[i._board.ballLowParticlesGroup]),i.addChild(o),i._bottomEmitter=o,(o=new p.ParticlesEmitter(t,0,0,r.BOTTOM_PARTICLES_MAX)).clear(),o.particleClass=p.OtherParentParticle,o.lifetime=a,o.setAngle(0,360),o.makeParticles("Game",null,r.BOTTOM_PARTICLES_MAX,[i._board.ballTopParticlesGroup]),i.addChild(o),i._topEmitter=o}return i._nextParticleTime=0,i.shadow=new p.AnchoredSprite(t,0,0,"Game","BALL_SHADOW"),i.clearComboStates(),i}p.Ball=t}(Shards=Shards||{}),function(o){var i,t;(t=i=o.eBonusType||(o.eBonusType={}))[t.NONE=0]="NONE",t[t.LIFE=1]="LIFE",t[t.BOMB=2]="BOMB",t[t.CANNON=3]="CANNON",t[t.ENLARGE=4]="ENLARGE",t[t.FAST=5]="FAST",t[t.POWER=6]="POWER",t[t.SHRINK=7]="SHRINK",t[t.SLOW=8]="SLOW",t[t.STICKY=9]="STICKY",t[t.TRIPLE=10]="TRIPLE";var n,e=(n=o.SpriteWithUpdatableShadow,__extends(r,n),Object.defineProperty(r.prototype,"toBeDestroyed",{get:function(){return this._toBeDestroyed},set:function(t){this._toBeDestroyed=t,this.shadow=null},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"activate",{get:function(){return this._activate},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bonusType",{get:function(){return this._bonusType},set:function(t){this._bonusType=t,this._toBeDestroyed=!1,this._activate=!1;var e=r.FRAMES[this._bonusType];t===i.BOMB?(this._typeSprite.visible=!1,this.animations.play("bomb")):(this._typeSprite.visible=!0,this._typeSprite.frameName=e,this.animations.play("bonus")),this._shadow.setAnchoredFrame(this.game.cache.getFrameByName("Game",e).index+13)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"typeFrame",{get:function(){return this._typeSprite.frameName},enumerable:!1,configurable:!0}),r.prototype.onCollision=function(t,e,i,s,a,o){a&&(null===e.sprite?this._toBeDestroyed=!0:this._activate=!0)},r.FRAMES=["","BONUS_1UP","BONUS_BOMB_0","BONUS_CANNON","BONUS_ENLARGE","BONUS_FAST","BONUS_POWER","BONUS_SHRINK","BONUS_SLOW","BONUS_STICKY","BONUS_TRIPLE"],r.ANIM_BONUS=["BONUS_0","BONUS_1","BONUS_2","BONUS_3","BONUS_4","BONUS_5","BONUS_6","BONUS_7"],r.ANIM_BOMB=["BONUS_BOMB_0","BONUS_BOMB_1","BONUS_BOMB_2","BONUS_BOMB_3","BONUS_BOMB_2","BONUS_BOMB_1","BONUS_BOMB_0"],r);function r(t,e){var i=n.call(this,t,e,500,0,"Game")||this,s=o.Global.LOW?.4:1;i._type=o.eObjectType.OBJECT_BONUS,i._typeSprite=new Phaser.Sprite(t,0,0,"Game"),i._typeSprite.anchor.set(.5,.5),i._typeSprite.visible=!1,i.addChild(i._typeSprite),i.animations.add("bonus",r.ANIM_BONUS,8,!0),i.animations.add("bomb",r.ANIM_BOMB,12,!0),t.physics.box2d.enable(i,!1);var a=i.body;return a.setCircle(25*s),a.mass=1,a.friction=0,a.restitution=1,a.sensor=!0,a.setCollisionCategory(o.eObjectType.OBJECT_BONUS),a.setCollisionMask(o.eObjectType.OBJECT_BORDER+o.eObjectType.OBJECT_BOTTOM_BORDER+o.eObjectType.OBJECT_PADDLE),a.setCategoryContactCallback(o.eObjectType.OBJECT_BOTTOM_BORDER,i.onCollision,i),a.setCategoryContactCallback(o.eObjectType.OBJECT_PADDLE,i.onCollision,i),i.setActive(!1),i.shadow=new o.AnchoredSprite(t,0,0,"Game","BONUS_SHADOW"),i}o.Bonus=e}(Shards=Shards||{}),function(u){var t,p,e;(t=u.eHiveType||(u.eHiveType={}))[t.BLOCKER=0]="BLOCKER",t[t.PASSER=1]="PASSER",t[t.MIXED=2]="MIXED",(e=p=u.eEnemyType||(u.eEnemyType={}))[e.HIVE=0]="HIVE",e[e.PASSER=1]="PASSER",e[e.BLOCKER=2]="BLOCKER";var a,i=(a=u.SpriteWithUpdatableShadow,__extends(s,a),s.claerHives=function(){s._hivesCount=0,s._hivesScale=0,s._enemiesCount=0},Object.defineProperty(s.prototype,"toBeDestroyed",{get:function(){return this._toBeDestroyed},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"enemyScale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"hiveType",{get:function(){return this._hiveType},enumerable:!1,configurable:!0}),s.prototype.init=function(t,e,i,s,a){var o=this.game.cache.getFrameByName("Game","ENEMY_HIVE").index+s,n=this.game.cache.getFrameByIndex("Game",o).width*i;this.frame=o,this.scale.set(i,i),this._shadow.scale.set(i,i),s===p.HIVE&&(n*=.8);var r=this.body;if(r.setCircle(n/2),r.mass=n/u.Settings.PTM/2*(n/u.Settings.PTM/2)*Math.PI*5,r.friction=0,r.restitution=1,r.static=s===p.HIVE,this.setPosition(t,e),this.setVelocity(0,0),r.setCollisionCategory(u.eObjectType.OBJECT_ENEMY),r.setCollisionMask(u.eObjectType.OBJECT_BORDER+u.eObjectType.OBJECT_BALL+u.eObjectType.OBJECT_BOTTOM_BORDER+u.eObjectType.OBJECT_PADDLE+u.eObjectType.OBJECT_BRICK+u.eObjectType.OBJECT_MISSILE),s===p.HIVE?this._shadow.visible=!1:s===p.PASSER?this._shadow.setAnchoredFrame("ENEMY_SHADOW_PASSER"):this._shadow.setAnchoredFrame("ENEMY_SHADOW_BLOCKER"),this.set(s,i,a),s!==p.HIVE){this._shadow.visible=!0;var h=u.Settings.ENEMY_SPEED_NORMAL*r.mass,l=this.game.rnd.integerInRange(0,359),_=Math.cos(Phaser.Math.degToRad(l)),c=Math.sin(Phaser.Math.degToRad(l));r.data.ApplyLinearImpulse(new box2d.b2Vec2(-_*h,-c*h),new box2d.b2Vec2(-r.x/u.Settings.PTM,-r.y/u.Settings.PTM)),r.data.SetAngularVelocity((0===this.game.rnd.integerInRange(0,1)?-1:1)*u.Settings.ENEMY_SPEED_NORMAL)}this.setActive(!0)},s.prototype.tick=function(t){if(this._lives<=0)return this._enemyType===p.HIVE?(--s._hivesCount,(s._hivesScale-=this._scale)<0&&(s._hivesScale=0)):--s._enemiesCount,this._board.shardsExplosion(this.x,this.y,1,!0),Utils.AudioUtils.playSound(u.Sfx.ENEMY_EXPLOSION),Utils.AudioUtils.playSound(u.Sfx.ENEMY_EXPLOSION),this._enemyType,this._board.shardsParticles(this.x,this.y,1.5*this._scale,8,12,this.width*this._scale/8),this._board.shockWave(this.x,this.y,8*this._scale),!(this._toBeDestroyed=!0);var e=!1;return this._enemyType===p.HIVE?e=s._enemiesCount<2*s._hivesScale+.5&&s._enemiesCount+s._hivesCount<u.Settings.ENEMY_MAX&&this.updateHive(t):this.updateMoving(t),e},s.prototype.set=function(t,e,i){switch(this._enemyType=t,this._hiveType=i,this._scale=e,this._toBeDestroyed=!1,this._collision=!1,this._rage=0,this._rageTime=0,t){case p.HIVE:this._lives=5.5*this._scale,this._timeToSpawn=this.game.rnd.realInRange(u.Settings.ENEMY_TIME_TO_SPAWN_MIN,u.Settings.ENEMY_TIME_TO_SPAWN_MIN+u.Settings.ENEMY_TIME_TO_SPAWN_RANGE)*this._scale,++s._hivesCount,s._hivesScale+=1/this._scale;break;case p.PASSER:this._lives=3.5*this._scale,++s._enemiesCount;break;case p.BLOCKER:this._lives=2.5*this._scale,++s._enemiesCount}this._lives<1&&(this._lives=1),t!==p.HIVE&&(this._timeToChangeDir=this.game.rnd.realInRange(u.Settings.ENEMY_TIME_TO_CHANGE_DIR_MIN,4*u.Settings.ENEMY_TIME_TO_CHANGE_DIR_MIN))},s.prototype.updateHive=function(t){return(this._timeToSpawn-=t)<=0&&(this._timeToSpawn=this.game.rnd.realInRange(u.Settings.ENEMY_TIME_TO_SPAWN_MIN,u.Settings.ENEMY_TIME_TO_SPAWN_MIN+u.Settings.ENEMY_TIME_TO_SPAWN_RANGE)*this._scale,!0)},s.prototype.updateMoving=function(t){var e=0<this._rageTime;this._collision&&(this._collision=!1,this._rageTime<=0&&(this._rage+=u.Settings.ENEMY_RAGE_ADD)),0<this._rage&&(this._rage-=1.5*t),e&&(this._rageTime-=t,this._rageTime<=0&&this.setVelocity(this.game.rnd.realInRange(-1,1),this.game.rnd.realInRange(-1,1))),this._rage>u.Settings.ENEMY_RAGE_LIMIT&&(this._rageTime=u.Settings.ENEMY_RAGE_TIME,this._rage=0);var i=u.Settings.ENEMY_SPEED_NORMAL;e&&(i=u.Settings.ENEMY_SPEED_RAGE);var s=this.getVelocity(this._pt);s.divide(-u.Settings.PTM,-u.Settings.PTM);var a=this.body;if(s.getMagnitudeSq()<i*i){var o=this.game.cache.getFrameByIndex("Game",this.frame).width;o=o/2/u.Settings.PTM;var n=Math.abs(i-s.getMagnitude())+.01;n*=a.data.GetMass(),s.multiply(n,n);var r=this._b2Vec2;r.SetXY(s.x,s.y);var h=this._b2Vec1;h.SetXY(this.game.rnd.realInRange(-o,o),this.game.rnd.realInRange(-o,o)),a.data.ApplyLinearImpulse(r,a.data.GetWorldPoint(h,h));var l=Phaser.Math.sign(a.angularVelocity);0===l&&(l=0===this.game.rnd.integerInRange(0,1)?-1:1),a.angularVelocity=i*l}if(this._enemyType!==p.HIVE&&(this._timeToChangeDir-=t)<0){this._timeToChangeDir=this.game.rnd.realInRange(u.Settings.ENEMY_TIME_TO_CHANGE_DIR_MIN,4*u.Settings.ENEMY_TIME_TO_CHANGE_DIR_MIN);var _=this.getVelocity(this._pt);switch(this.game.rnd.integerInRange(0,3)){case 0:_.x=-_.x;break;case 1:_.y=-_.y;break;case 2:var c=_.x;_.x=_.y,_.y=c;break;case 3:var d=this._b2Vec1;d.SetXY(_.x,_.y),d.SelfRotateDegrees(this.game.rnd.integerInRange(0,359)),_.x=d.x,_.y=d.y}this.setVelocity(_.x,_.y)}},s.prototype.onCollisionBorder=function(t,e,i,s,a,o){a&&(Utils.AudioUtils.playSound(this.game.rnd.integerInRange(u.Sfx.ENEMY_BORDER_HIT_1,u.Sfx.ENEMY_BORDER_HIT_3)),this._collision=!0)},s.prototype.onCollisionBrick=function(t,e,i,s,a,o){a&&(e.sprite.unbreakable?(Utils.AudioUtils.playSound(this.game.rnd.integerInRange(u.Sfx.ENEMY_UNBREAKABLE_HIT_1,u.Sfx.ENEMY_UNBREAKABLE_HIT_2)),this._collision=!0):this._enemyType===p.BLOCKER?(this._collision=!0,Utils.AudioUtils.playSound(this.game.rnd.integerInRange(u.Sfx.ENEMY_BRICK_DAMAGED_1,u.Sfx.ENEMY_BRICK_DAMAGED_3))):this._enemyType===p.PASSER&&(this._hitPoint=this._board.calcContactPoint(o,this._hitPoint)))},s.prototype.onCollisionPaddle=function(t,e,i,s,a,o){a&&0<(this._lives-=10)&&Utils.AudioUtils.playSound(this.game.rnd.integerInRange(u.Sfx.ENEMY_UNBREAKABLE_HIT_1,u.Sfx.ENEMY_UNBREAKABLE_HIT_2))},s.prototype.onCollisionBallMissile=function(t,e,i,s,a,o){a&&(this._board.shardsExplosion(this.x,this.y,this._scale,!1),0<--this._lives&&Utils.AudioUtils.playSound(this.game.rnd.integerInRange(u.Sfx.ENEMY_UNBREAKABLE_HIT_1,u.Sfx.ENEMY_UNBREAKABLE_HIT_2)))},s.prototype.onPresolveBrick=function(t,e,i,s,a,o){this._enemyType!==p.PASSER||e.sprite.unbreakable||a.SetEnabled(!1)},s);function s(t,e){var i=a.call(this,t,e,500,0,"Game","PADDLE")||this;i._hitPoint=new Phaser.Point,i._pt=new Phaser.Point,i._b2Vec1=new box2d.b2Vec2,i._b2Vec2=new box2d.b2Vec2,i._type=u.eObjectType.OBJECT_ENEMY,t.physics.box2d.enable(i);var s=i.body;return i.shadow=new u.AnchoredSprite(t,0,0,"Game"),s.setCategoryContactCallback(u.eObjectType.OBJECT_BORDER,i.onCollisionBorder,i),s.setCategoryContactCallback(u.eObjectType.OBJECT_BALL,i.onCollisionBallMissile,i),s.setCategoryContactCallback(u.eObjectType.OBJECT_PADDLE,i.onCollisionPaddle,i),s.setCategoryContactCallback(u.eObjectType.OBJECT_BRICK,i.onCollisionBrick,i),s.setCategoryContactCallback(u.eObjectType.OBJECT_MISSILE,i.onCollisionBallMissile,i),s.setCategoryPresolveCallback(u.eObjectType.OBJECT_BRICK,i.onPresolveBrick,i),i.setActive(!1),i}u.Enemy=i}(Shards=Shards||{}),function(r){var a,t=(a=r.SpriteWithUpdatableShadow,__extends(e,a),Object.defineProperty(e.prototype,"toBeDestroyed",{get:function(){return this._toBeDestroyed},set:function(t){this._toBeDestroyed=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitPoint",{get:function(){return this._hitPoint},enumerable:!1,configurable:!0}),e.prototype.onCollision=function(t,e,i,s,a,o){if(a&&(this._hitPoint.set(this.position.x,this.position.y-35),this._toBeDestroyed=!0,null!==e.sprite)){var n=e.sprite;n.objType===r.eObjectType.OBJECT_BRICK&&n.hit(1)}},e);function e(t,e){var i=a.call(this,t,e,500,0,"Game","LASER")||this;i._hitPoint=new Phaser.Point,i._type=r.eObjectType.OBJECT_MISSILE,t.physics.box2d.enable(i);var s=i.body;return s.setRectangle(10,70),s.mass=.2,s.friction=0,s.restitution=0,s.fixedRotation=!0,s.setCollisionCategory(r.eObjectType.OBJECT_MISSILE),s.setCollisionMask(r.eObjectType.OBJECT_BORDER+r.eObjectType.OBJECT_BRICK+r.eObjectType.OBJECT_ENEMY),s.setCategoryContactCallback(r.eObjectType.OBJECT_BORDER,i.onCollision,i),s.setCategoryContactCallback(r.eObjectType.OBJECT_BRICK,i.onCollision,i),s.setCategoryContactCallback(r.eObjectType.OBJECT_ENEMY,i.onCollision,i),i.shadow=new r.AnchoredSprite(t,0,0,"Game","LASER_SHADOW"),i.setActive(!1),i}r.Missile=t}(Shards=Shards||{}),function(d){var t=(Object.defineProperty(a.prototype,"exitWarningFromStats",{get:function(){return this._exitWarningFromStats},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"paused",{get:function(){return this._paused},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"inGameMenu",{get:function(){return this._menuLayer},enumerable:!1,configurable:!0}),a.prototype.createLayers=function(){var t=this._game,e=new Phaser.Group(t,t.world);this._gameLayer=e,this._menuLayer=new d.InGameMenu(t,t.world,this),this._menuLayer.exists=!1,this._menuLayer.visible=!1,7===d.Global.sponsor.id&&(this._exitWarning=new d.ExitWarning(t,t.world,this),this._exitWarning.exists=!1,this._exitWarning.visible=!1),this._bonusText=new d.BonusText(t,e),this._shadowsGroup=new Phaser.Group(t,e),this._bricksGroup=new Phaser.Group(t,e),this._enemyGroup=new Phaser.Group(t,e),this._ballLowParticlesGroup=new Phaser.Group(t,e),this._ballsGroup=new Phaser.Group(t,e),this._ballTopParticlesGroup=new Phaser.Group(t,e),this._bonusGroup=new Phaser.Group(t,e),this._missilesGroup=new Phaser.Group(t,e),this._topParticlesGroup=new Phaser.Group(t,e),this._combosGroup=new Phaser.Group(t,e),this._statsGroup=new d.Stats(t,e,this._parent),this._ballArrow=new d.AnchoredSprite(t,0,0,"Game","START_ARROW"),this._ballArrow.visible=!1,this._ballShock=new d.AnchoredSprite(t,0,0,"Game","SHOCKWAVE"),this._ballShock.visible=!1,this._gui=new d.GUI(t,e,this),(d.Global.showTutorial&&!d.Global.tutorialShown||d.Global.showTutorialEverytime)&&(d.Global.tutorialShown=!0,d.Global.showTutorialEverytime||Utils.StorageUtils.save(),this._tutorial=new d.Tutorial(t,e,this),this._tutorial.y=170,e.setChildIndex(this._tutorial,e.getChildIndex(this._topParticlesGroup)),e.updateZ(),this._tutorial.visible=!1,null!==this._tutorial)&&(this._tutorial.visible=!0,this._tutorial.alpha=0,this._tutorial.angle=45,this._tutorial.scale.set(3),t.add.tween(this._tutorial.scale).to({x:1,y:1},a.TUTORIAL_TIME,Phaser.Easing.Linear.None,!0),t.add.tween(this._tutorial).to({alpha:1,angle:0},a.TUTORIAL_TIME,Phaser.Easing.Linear.None,!0))},a.prototype.destroy=function(){},Object.defineProperty(a.prototype,"paddle",{get:function(){return this._paddle},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"shadowsGroup",{get:function(){return this._shadowsGroup},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bricksGroup",{get:function(){return this._bricksGroup},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ballLowParticlesGroup",{get:function(){return this._ballLowParticlesGroup},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ballTopParticlesGroup",{get:function(){return this._ballTopParticlesGroup},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"topParticlesGroup",{get:function(){return this._topParticlesGroup},enumerable:!1,configurable:!0}),a.prototype.clearEntities=function(t){for(var e=this._ballsCount-1;0<=e;e--)this.removeBall(this._balls[e]);for(this._ballsCount=0,e=this._bonusesCount-1;0<=e;e--)this.removeBonus(e);for(this._bonusesCount=0,e=this._missilesCount-1;0<=e;e--)this.removeMissile(e);for(this._missilesCount=0,e=this._combosCount-1;0<=e;e--)this.removeCombo(e);this._combosCount=0,null!==this._paddleJoint&&(this._game.physics.box2d.world.DestroyJoint(this._paddleJoint),this._paddleJoint=null)},a.prototype.loadLevel=function(t){this._level=t,this._state=0,this._lostState=0,this._lostTime=0,this._boardStats.clearStat();var e=this._game.cache.getFrameByName("Game","BRICK_NORMAL");d.Settings.SHADOW_OFFSET.set(e.width>>2,e.height>>1);var i=this._parent.levelsFile;i.setFile(t),this._bgIndex=i.readUint8()+1,this.setBG(this._bgIndex),this.loadBricks(i),this._brickShine=new d.AnchoredSprite(this._game,0,0,"Game","BRICK_SHINE_0"),this._brickShine.animations.add("shine",d.Settings.BRICK_SHINE,20).onComplete.add(function(){this._brickShine.visible=!1},this),this._brickShine.visible=!1,this.loadShardiens(i),this.createBorders(),this.paintBorders(),this.initPaddle(),this._title.init("LEVEL "+(t+1),d.Settings.TITLE_LEVEL),this._shineTime=this._game.rnd.realInRange(0,5),this._lastBrick=null,this._lastBrickTime=!1,this._lastBrickCounter=d.Settings.LAST_BRICK_TIME,this._gameTime=0,this._initialEffectTime=d.Settings.INITIAL_EFFECT_DURATION;var s=new Helper.GravityBounce(2,.3,!1);this._bounceTween=this._game.add.tween(this._game.world.scale).to({x:d.Settings.IMPACT_SCALE,y:d.Settings.IMPACT_SCALE},d.Settings.IMPACT_DURATION,function(t){return s.easing(t)},!1),Utils.AudioUtils.playSound(d.Sfx.FIRE)},a.prototype.loadBricks=function(t){d.Brick.NORMAL_BASE=this._game.cache.getFrameByName("Game","BRICK_NORMAL").index,d.Brick.UNBREAKABLE_BASE=this._game.cache.getFrameByName("Game","BRICK_UNBREAKABLE").index;var e=t.readUint8();d.Settings.COLORED_BRICKS_MAX;for(var i=0;i<e;i++)t.readUint32(!0);var s=t.readUint16(!0),a=d.Global.GAME_WIDTH;for(i=0;i<s;i++){var o=t.readInt16(!0)*a/800-a/2,n=t.readInt16(!0)*this._game.height/1280-this._game.height/2,r=t.readUint8()/100,h=t.readUint8(),l=t.readUint16(!0);l&d.Brick.MASK_ANGLE_BIT&&(h+=256);var _=new d.Brick(this._game,this,o,n,r,h,l);_.id=i,this._bricks[this._bricksCount++]=_,this._bricksGroup.add(_),l&d.Brick.MASK_UNBREAKABLE?++this._boardStats.bricksUnbreakable:++this._boardStats.bricksWinCount,this._boardStats.bricksToBreak=this._boardStats.bricksWinCount,this._bricksGroup.customSort(function(t,e){return e.id-t.id})}},a.prototype.removeBrick=function(t){this._bricksGroup.remove(t),t.setActive(!1)},a.prototype.loadShardiens=function(t){var e=d.Global.shardiensOn;if(t.hasNext())for(var i=t.readUint8(),s=d.Global.GAME_WIDTH,a=0;a<i;a++){var o=t.readUint8(),n=t.readInt16(!0)*s/800-s/2,r=t.readInt16(!0)*this._game.height/1280-this._game.height/2,h=t.readUint8()/100;e&&this.spawnEnemy(n,r,!0,o,h)}},a.prototype.createBorders=function(){var t=this._game,e=d.Global.GAME_WIDTH,i=d.Settings.BORDER_WIDTH,s=[],a=new Phaser.Physics.Box2D.Body(t,null,-e/2-50+i,0);a.setRectangle(100,t.height+200),s.push(a);var o=new Phaser.Physics.Box2D.Body(t,null,e/2+50-i,0);o.setRectangle(100,t.height+200),s.push(o);var n=new Phaser.Physics.Box2D.Body(t,null,0,-t.height/2-50+i);n.setRectangle(e+100,100),s.push(n);var r=new Phaser.Physics.Box2D.Body(t,null,0,t.height/2+100);r.setRectangle(e+100,100),s.push(r),this._bottomBorderBody=r;for(var h=0;h<s.length;h++){var l=s[h];l.static=!0,l.restitution=1,l.friction=0,l.setCollisionCategory(h<s.length-1?d.eObjectType.OBJECT_BORDER:d.eObjectType.OBJECT_BOTTOM_BORDER),l.setCollisionMask(d.eObjectType.OBJECT_PADDLE+d.eObjectType.OBJECT_BALL+d.eObjectType.OBJECT_ENEMY+d.eObjectType.OBJECT_MISSILE+d.eObjectType.OBJECT_BONUS)}},a.prototype.paintBorders=function(){for(var t=this._game,e=d.Global.GAME_WIDTH,i=new Phaser.Group(t,null),s=[],a=0;a<3;a++)s[a]=t.rnd.integer();for(var o=t.cache.getFrameByName("Game","BORDER_TOP_LEFT"),n=t.cache.getFrameByName("Game","BORDER_HORIZONTAL"),r=t.cache.getFrameByName("Game","BORDER_VERTICAL_LEFT"),h=-t.height/2,l=o.width-e/2,_=s[0];l<e/2-o.width;)i.add(new d.AnchoredSprite(t,l,h,"Game",0!=(7&_)?"BORDER_HORIZONTAL":"BORDER_HORIZONTAL2")),_>>=1,l+=n.width;h=-t.height/2+o.height;var c=s[1];for(s[2];h<t.height/2;)i.add(new d.AnchoredSprite(t,-e/2,h,"Game",0!=(7&c)?"BORDER_VERTICAL_LEFT":"BORDER_VERTICAL_LEFT2")),i.add(new d.AnchoredSprite(t,e/2,h,"Game",0!=(7&c)?"BORDER_VERTICAL_RIGHT":"BORDER_VERTICAL_RIGHT2")),c>>=1,h+=r.height;h=-t.height/2,i.add(new d.AnchoredSprite(t,-e/2,h,"Game","BORDER_TOP_LEFT")),i.add(new d.AnchoredSprite(t,e/2,h,"Game","BORDER_TOP_RIGHT")),this._prerendered.renderXY(i,this._prerendered.width/2,this._prerendered.height/2)},a.prototype.initPaddle=function(){var t=this._paddleY;this.resetPaddle(0,t,1);var e=this._game.cache.getFrameByName("Game","PADDLE").height/2+d.Settings.BALL_DIAMETER/2,i=this.createBall(0,t-e);null!==i&&(i.setStickPosition(0,t-e),i.setSticked(!0)),this._emitters.newBall(this._gui.ball.x,this._gui.ball.y),this._gui.lives=this._lives,this._paddleLastVelocityX=0,this._initialBallLaunch=!0,this._ballArrow.angle=-90,this._ballArrow.visible=0!==this._state,i.addChild(this._ballArrow)},a.prototype.createBall=function(t,e){var i=this._ballsPool.createItem();return null===i?null:(i.setPosition(t,e),i.setActive(!0),i.clear(),this._balls[this._ballsCount++]=i,this._ballsGroup.add(i),this.setBallsFrame(),i)},a.prototype.removeBall=function(t){this._ballsGroup.remove(t),t.setActive(!1),t.clear(),this._ballsPool.destroyItem(t);for(var e=0;e<this._ballsCount;e++)this._balls[e]===t&&(this._balls[e]=this._balls[--this._ballsCount],this._balls[this._ballsCount]=null)},a.prototype.resetPaddle=function(t,e,i){var s=this._game,a=this.paddle;a.setPosition(t,e),a.setAngle(0),a.setSize(i),a.cancelCannon(),null===this._paddleJoint&&(this._paddleJoint=s.physics.box2d.prismaticJoint(this._bottomBorderBody,a,1,0,0,-(this._bottomBorderBody.y-this._paddleY),0,0,0,0,!1,-1200,1200,!0));for(var o=0;o<this._ballsCount;o++)this._balls[o].setSticked(!1)},a.prototype.tick=function(t){switch(this._state){case 0:this._state=1;break;case 1:0<this._initialEffectTime?this.updateInitialEffect(t):(this._ballArrow.visible=!0,this._state=2);break;case 2:this._paused||this.tickPlay(t);break;case 4:this.tickStats(t)}},a.prototype.updateStartArrow=function(){var t=this._game.time.time;t=Math.floor(t/4),120<(t%=240)&&(t=120-(t-120)),this._ballArrow.angle=t-60-90},a.prototype.tickPlay=function(t){this._gameTime+=t;var e=0!=this._lostState;if(this.updateBonusText(),this._ballArrow.visible&&this.updateStartArrow(),this.destroyBrokenBricks(),this._boardStats.bricksWinCount<=0&&!e)this._winTime=1,this._state=4,this.clearBonuses(),this.updateBonusText();else if(1===this._boardStats.bricksWinCount&&!this._lastBrickTime){this._lastBrickTime=!0,this._lastBrickCounter=d.Settings.LAST_BRICK_TIME,this._lastBrick=this._bricks[0];for(var i=0;i<this._bricksCount;i++)if(!this._bricks[i].unbreakable){this._lastBrick=this._bricks[i];break}}if(this._lastBrickTime&&this.updateCountDown(t),this.shineBrick(t),e){if((this._lostTime-=t)<=0)return this.clearEntities(this._lives<0),this._lives<0?(d.Global.hiScore=this._score.hiScore,Utils.StorageUtils.save(),this._state=3,void this._parent.onGameOver()):(this._lostState=0,this.initPaddle(),void this._boardStats.clearEmptyHits());1!==this._lostState&&2===this._lostState&&(this._lostExplosionCounter-=t)<=0&&(this._lostExplosionCounter=this._game.rnd.realInRange(.2,.6),this.setExplosion(this._paddle.x+this._game.rnd.integerInRange(-30,30),this._paddle.y+this._game.rnd.integerInRange(-30,30)))}this.updateAll(t),0===this._ballsCount&&!e&&0<this._boardStats.bricksWinCount&&(this._lostState=1,this.looseLife(),this._lives<0?(this._lostTime=d.Settings.LOST_TIME_TOTAL,this._parent.stopMusic(),Utils.AudioUtils.playSound(d.Sfx.GAME_OVER)):(this._lostTime=d.Settings.LOST_TIME_BALL,Utils.AudioUtils.playSound(d.Sfx.BALL_LOST)));var s=!1;for(i=0;i<this._ballsCount;i++)if(this._balls[i].sticked){s=!0;break}if(s||(this._boardStats.noHitTime+=t),(this._boardStats.emptyHits>d.Settings.EMPTY_HITS||this._boardStats.noHitTime>d.Settings.NO_HIT_TIME)&&(this._boardStats.emptyHits=0,this._boardStats.noHitTime=0,!s&&this._ballsCount<d.Settings.BALLS_MAX)){this._boardStats.emptyHitCounter=d.Settings.EMPTY_HIT_DURATION;var a=this._game.cache.getFrameByName("Game","PADDLE").height/2+d.Settings.BALL_DIAMETER/2;this._ballShock.visible=!0,this._ballShock.scale.set(10/this._paddle.scale.x,10),this._ballShock.position.y=-a,this._paddle.addChild(this._ballShock),Utils.AudioUtils.playSound(d.Sfx.SWOOSH),Utils.AudioUtils.playSound(d.Sfx.SWOOSH)}if(0<this._boardStats.emptyHitCounter){this._boardStats.emptyHitCounter-=t;var o=10*this._boardStats.emptyHitCounter/d.Settings.EMPTY_HIT_DURATION;if(this._ballShock.scale.set(o/this._paddle.scale.x,o),this._boardStats.emptyHitCounter<=0){this._boardStats.emptyHitCounter=0,this._ballShock.visible=!1,this._paddle.removeChild(this._ballShock),a=this._game.cache.getFrameByName("Game","PADDLE").height/2+d.Settings.BALL_DIAMETER/2;var n=this.createBall(this._paddle.x,this._paddle.y-a);null!==n&&(n.setStickPosition(this._paddle.x,this._paddle.y-a),n.setSticked(!0))}}},a.prototype.tickStats=function(t){var e=this._game.physics.box2d;if(this._winTime<d.Settings.WON_TIME){var i=60+240*(this._winTime-1);if(e.frameRate=1/i,this.updateAll(t/(i/60)),this._winTime+=t,this._winTime>=d.Settings.WON_TIME){e.pause();var s=this.calcStars(),a=Math.floor(this._gameTime);d.Global.hiScore=this._score.hiScore;var o=d.Global.levelStats[this._level];o.stars=Math.max(s,o.stars),o.time=0===o.time?a:Math.min(a,o.time),this._level+1<d.Global.LEVELS&&(d.Global.levelStats[this._level+1].unlocked=!0),Utils.StorageUtils.save(),this._statsGroup.show(s,a)}}},a.prototype.updateAll=function(t){this.updateBalls(t),this.updateBonuses(t),this.updateMissiles(t),this.updateEnemies(t),this.updateCombos(t),this.paddle.tick(t)},a.prototype.destroyBrokenBricks=function(){for(var t=this._bricksCount-1;0<=t;t--){var e=this._bricks[t];if(e.toBeDestroyed){this.removeBrick(e),this._bricks[t]=this._bricks[--this._bricksCount],this._bricks[this._bricksCount]=null,this.addScore(d.Settings.SCORE_DESTROYED),this._game.rnd.integerInRange(0,99)<d.Settings.PROBABILITY_BONUS&&this.spawnBonus(e.x,e.y);var i=e.scale.x;this.shardsExplosion(e.x,e.y,i,!0),this.shardsParticles(e.x,e.y,i,5,7,10),--this._boardStats.bricksWinCount}}},a.prototype.shineBrick=function(t){if(0!==this._bricksCount&&(this._shineTime-=t)<=0){if(this._shineTime=this._game.rnd.realInRange(0,5),this._brickShine.animations.currentAnim.isPlaying)return;var e=this._game.rnd.integerInRange(0,this._bricksCount-1),i=this._bricks[e];if(!i.canShine)return;var s=this._brickShine;i.addChild(s),s.position.set(0,3),s.play("shine"),s.visible=!0}},a.prototype.shardsExplosion=function(t,e,i,s){this._emitters.shardsExplosion(t,e,i,s),s?Utils.AudioUtils.playSound(d.Sfx.BRICK_DESTROYED_1):Utils.AudioUtils.playSound(this._game.rnd.integerInRange(d.Sfx.BRICK_DAMAGED_1,d.Sfx.BRICK_DAMAGED_3))},a.prototype.shardsParticles=function(t,e,i,s,a,o){this._emitters.shardsParticles(t,e,i,s,a,o)},a.prototype.spawnBonus=function(t,e){var i=this._game.rnd.integerInRange(d.eBonusType.LIFE,d.eBonusType.TRIPLE);if(i===d.eBonusType.LIFE){if(this._lifeBonusAlreadySpawned)return;this._lifeBonusAlreadySpawned=!0}if(!(i===d.eBonusType.TRIPLE&&this._ballsCount>=d.Settings.BALLS_MAX)){var s=this._bonusesPool.createItem();null!==s&&(s.setPosition(t,e),s.setActive(!0),s.bonusType=i,this._bonusGroup.add(s),(this._bonuses[this._bonusesCount++]=s).setVelocity(0,320*(d.Global.LOW?.4:1)))}},a.prototype.spawnMissile=function(t){for(var e=d.Global.LOW?.4:1,i=-1;i<2;i+=2){var s=this._missilesPool.createItem();if(null===s)return;s.toBeDestroyed=!1,s.setActive(!0),this._missilesGroup.add(s),(this._missiles[this._missilesCount++]=s).setPosition(t.x+d.Settings.CANNON_OFFSET*i,t.y-70),s.setVelocity(0,-640*e),this._emitters.muzzle(t.x-1+40*i*e,t.y-80*e),Utils.AudioUtils.playSound(d.Sfx.CANNON_FIRE)}},a.prototype.updatePaddlePosition=function(t){if(0!==this._lostState||this._paused)this._paddle.setVelocity(0,0);else{var e=this._game;if(t.y<-e.height/2*.8)this._paddle.setVelocity(0,0);else{var i=this._paddle.width/2,s=d.Global.GAME_WIDTH,a=s/2-d.Settings.BORDER_WIDTH-i-2;t.x=Phaser.Math.clamp(t.x,-a,a);var o=t.x-this._paddle.x,n=this._paddle.body;if(5<Math.abs(o)){var r=Math.min(Math.abs(o),200)/200,h=Helper.quintic(0,1,1,1,1,r)*s*3.5;h*=Phaser.Math.sign(o),n.x<-a&&h<0?h=0:n.x>a&&0<h&&(h=0),n.velocity.x=h}else n.velocity.x=0;this._paddleLastVelocityX=n.velocity.x}}},a.prototype.fireMissile=function(t){2===this._state&&this._paddle.cannonReady&&this.spawnMissile(this._paddle.position)},a.prototype.calcContactPoint=function(t,e){if(t.GetWorldManifold(this._worldManifold),0<this._worldManifold.points.length){var i=this._worldManifold.points[0];e.set(-i.x*d.Settings.PTM,-i.y*d.Settings.PTM)}return e},Object.defineProperty(a.prototype,"activeBonus",{get:function(){return this._activeBallBonus},enumerable:!1,configurable:!0}),a.prototype.isStickTime=function(){return this._activeBallBonus==d.eBonusType.STICKY&&0<this._activeBallBonusTime},a.prototype.isFastTime=function(){return this._activeBallBonus==d.eBonusType.FAST&&0<this._activeBallBonusTime},a.prototype.isSlowTime=function(){return this._activeBallBonus==d.eBonusType.SLOW&&0<this._activeBallBonusTime},a.prototype.isPowerTime=function(){return this._activeBallBonus==d.eBonusType.POWER&&0<this._activeBallBonusTime},a.prototype.clearBonuses=function(){this._activeBallBonus=d.eBonusType.NONE,this._activeBallBonusTime=0,this.paddle.cancelCannon()},a.prototype.updateCombos=function(t){for(var e=this._combosCount-1;0<=e;e--)this._combos[e].tick(t)||this.removeCombo(e)},a.prototype.removeCombo=function(t){var e=this._combos[t];this._combosGroup.remove(e),this._combos[t]=this._combos[--this._combosCount],this._combos[this._combosCount]=null,this._combosPool.destroyItem(e)},a.prototype.updateBalls=function(t){for(var e=this._ballsCount-1;0<=e;e--){var i=this._balls[e];i.dead?(this.shockWave(i.x,i.y,16),this.removeBall(i),Utils.AudioUtils.playSound(d.Sfx.BALL_LOST)):i.tick(t)}},a.prototype.updateBonuses=function(t){this._activeBallBonus!==d.eBonusType.NONE&&(this._activeBallBonusTime-=t)<=0&&(this._activeBallBonus===d.eBonusType.STICKY&&this.unstickBalls(),this.clearBonuses(),this.setBallsFrame());for(var e=this._bonusesCount-1;0<=e;e--){var i=this._bonuses[e];i.activate&&this.activateBonus(i),(i.activate||i.toBeDestroyed)&&this.removeBonus(e)}},a.prototype.updateBonusText=function(){var t=this._activeBallBonus;if(t===d.eBonusType.NONE&&this._paddle.cannonTime<=0)this._bonusText.visible&&(this._bonusText.visible=!1);else{var e=d.eBonusType.NONE,i=0;0<this._paddle.cannonTime?(e=d.eBonusType.CANNON,i=this._paddle.cannonTime/d.Settings.CANNON_DURATION):t===d.eBonusType.SLOW?(e=t,i=this._activeBallBonusTime/d.Settings.BONUS_SLOW_DURATION):t===d.eBonusType.STICKY?(e=t,i=this._activeBallBonusTime/d.Settings.BONUS_STICKY_DURATION):t===d.eBonusType.POWER?(e=t,i=this._activeBallBonusTime/d.Settings.BONUS_POWER_DURATION):t===d.eBonusType.FAST&&(e=t,i=this._activeBallBonusTime/d.Settings.BONUS_FAST_DURATION),e!==d.eBonusType.NONE&&(this._bonusText.visible=!0,this._bonusText.tick(e,i))}},a.prototype.removeBonus=function(t){var e=this._bonuses[t];e.setActive(!1),this._bonusGroup.remove(e),this._bonuses[t]=this._bonuses[--this._bonusesCount],this._bonuses[this._bonusesCount]=null,this._bonusesPool.destroyItem(e)},a.prototype.updateMissiles=function(t){for(var e=this._missilesCount-1;0<=e;e--){var i=this._missiles[e];if(i.toBeDestroyed){this.removeMissile(e);var s=i.hitPoint;this._emitters.smallExplosion(s.x,s.y),Utils.AudioUtils.playSound(d.Sfx.CANNON_EXPLOSION)}}},a.prototype.removeMissile=function(t){var e=this._missiles[t];e.setActive(!1),this._missilesGroup.remove(e),this._missiles[t]=this._missiles[--this._missilesCount],this._missiles[this._missilesCount]=null,this._missilesPool.destroyItem(e)},a.prototype.activateBonus=function(t){if(0===this._lostState&&2===this._state){switch(t.bonusType){case d.eBonusType.LIFE:this._lives<10&&(++this._lives,this._emitters.newBall(this._gui.ball.x,this._gui.ball.y),this._gui.lives=this._lives,Utils.AudioUtils.playSound(d.Sfx.LIFE));break;case d.eBonusType.BOMB:this.setExplosion(t.x,t.y);var e=this._paddle.body;return e.fixedRotation=!1,this.unstickBalls(),this._game.physics.box2d.world.DestroyJoint(this._paddleJoint),this._paddleJoint=null,(i=this._pt).set(this._paddle.x,this._paddle.y+10),i.subtract(t.x,t.y),i.setMagnitude(50),e.data.ApplyLinearImpulse(new box2d.b2Vec2(-i.x,-i.y),new box2d.b2Vec2(-t.x/d.Settings.PTM,-t.y/d.Settings.PTM)),25e4<(i=this._paddle.getVelocity(i)).getMagnitudeSq()&&(i.setMagnitude(500),this._paddle.setVelocity(i.x,i.y)),this._lostState=2,this._lostExplosionCounter=0,this.looseLife(),void(this._lives<0?(this._lostTime=d.Settings.LOST_TIME_TOTAL,this._parent.stopMusic(),Utils.AudioUtils.playSound(d.Sfx.GAME_OVER)):this._lostTime=d.Settings.LOST_TIME_BOMB);case d.eBonusType.TRIPLE:if(0<this._ballsCount&&this._ballsCount<d.Settings.BALLS_MAX){var i,s=-d.Global.GAME_WIDTH/2+d.Settings.BORDER_WIDTH+d.Settings.BALL_DIAMETER/2,a=-s,o=-this._game.height/2+d.Settings.BORDER_WIDTH+d.Settings.BALL_DIAMETER/2,n=this._balls[0];(i=n.getVelocity(this._pt)).setMagnitude(d.Settings.BALL_DIAMETER);for(var r=0;r<2;r++){i.rotate(0,0,120,!0);var h=n.x+i.x,l=n.y+i.y;h<s?h=s:a<h&&(h=a),l<o&&(l=o);var _=this.createBall(h,l);null!==_&&_.setVelocity(i.x,i.y)}Utils.AudioUtils.playSound(d.Sfx.SPLIT_BALL)}break;case d.eBonusType.FAST:this._activeBallBonus=t.bonusType,this._activeBallBonusTime=d.Settings.BONUS_FAST_DURATION,this.unstickBalls(),Utils.AudioUtils.playSound(d.Sfx.FIRE);break;case d.eBonusType.POWER:this._activeBallBonus=t.bonusType,this._activeBallBonusTime=d.Settings.BONUS_POWER_DURATION,this.unstickBalls(),Utils.AudioUtils.playSound(d.Sfx.POWERBALL);break;case d.eBonusType.SLOW:this._activeBallBonus=t.bonusType,this._activeBallBonusTime=d.Settings.BONUS_SLOW_DURATION,this.unstickBalls(),Utils.AudioUtils.playSound(d.Sfx.FREEZE);break;case d.eBonusType.STICKY:this._paddle.isCannonReady()&&this._paddle.setCannon(!1),this._activeBallBonus=t.bonusType,this._activeBallBonusTime=d.Settings.BONUS_STICKY_DURATION,Utils.AudioUtils.playSound(d.Sfx.BALL_STICKY);break;case d.eBonusType.CANNON:this._activeBallBonus==d.eBonusType.STICKY&&(this._activeBallBonus=d.eBonusType.NONE),this._paddle.setCannon(!0),this.unstickBalls();break;case d.eBonusType.SHRINK:this._paddle.shrink(),Utils.AudioUtils.playSound(d.Sfx.PADDLE_SHRINK);break;case d.eBonusType.ENLARGE:this._paddle.enlarge(),Utils.AudioUtils.playSound(d.Sfx.PADDLE_ENLARGE)}this._emitters.bonus(t.x,t.y,t.typeFrame,this._paddle.x,this._paddle.y),this.setBallsFrame()}},a.prototype.setBallsFrame=function(){var t="BALL_NORMAL",e=this._activeBallBonus;e===d.eBonusType.SLOW?t="BALL_SLOW":e===d.eBonusType.FAST?t="BALL_FAST":e===d.eBonusType.STICKY?t="BALL_STICKY":e===d.eBonusType.POWER&&(t="BALL_POWER");for(var i=0;i<this._ballsCount;i++)this._balls[i].frameName=t},a.prototype.setExplosion=function(t,e){this._emitters.bigExplosion(t,e),this.shockWave(t,e,12),Utils.AudioUtils.playSound(d.Sfx.BOMB_EXPLOSION)},a.prototype.getFreeCombo=function(){var t=this._combosPool.createItem();return null!==t&&(this._combos[this._combosCount++]=t,this._combosGroup.add(t)),t},a.prototype.looseLife=function(){--this._lives<0&&this._title.init("GAME OVER",d.Settings.TITLE_GAMEOVER),this.clearBonuses(),this.updateBonusText()},a.prototype.setLives=function(t){this._lives=t,this._gui.lives=t},a.prototype.shockWave=function(t,e,i,s){void 0===s&&(s=!1),this._emitters.shockWave(t,e,i,s)},a.prototype.unstickBalls=function(){if(2===this._state&&!this._paused){for(var t=this._pt,e=0;e<this._ballsCount;e++){var i=this._balls[e];if(0<i.children.length&&(i.removeChild(this._ballArrow),this._ballArrow.visible=!1),i.sticked)if(i.setSticked(!1),this._initialBallLaunch){var s=Phaser.Math.degToRad(this._ballArrow.angle);i.setVelocity(Math.cos(s)*this._speed,Math.sin(s)*this._speed),null!==this._tutorial&&(this._game.add.tween(this._tutorial.scale).to({x:3,y:3},a.TUTORIAL_TIME,Phaser.Easing.Linear.None,!0),this._game.add.tween(this._tutorial).to({alpha:0,angle:45},a.TUTORIAL_TIME,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this._game.world.remove(this._tutorial),this._tutorial=null},this))}else t.copyFrom(i.position),t.subtract(this._paddle.x,this._paddle.y),t.x+=Phaser.Math.clamp(this._paddleLastVelocityX,-d.Settings.PTM,d.Settings.PTM),t.normalize(),i.setVelocity(t.x,t.y)}this._initialBallLaunch=!1}},a.prototype.updateCountDown=function(t){if(!(this._boardStats.bricksWinCount<=0)){var e=Math.floor(this._lastBrickCounter/3);this._lastBrickCounter-=t,this._lastBrickCounter<=0?this._lastBrick.toBeDestroyed=!0:0<e-Math.floor(this._lastBrickCounter/3)&&(this._emitters.numParticle(this._lastBrick.x,this._lastBrick.y,e),Utils.AudioUtils.playSound(d.Sfx.TICK))}},a.prototype.adjustComboValue=function(t){this._boardStats.combosValue+=t,this.addScore(t*d.Settings.SCORE_COMBO)},a.prototype.addPaddleHit=function(){++this._boardStats.paddleHits,this._boardStats.emptyHits=0},a.prototype.addEmptyHit=function(){++this._boardStats.emptyHits},a.prototype.clearEmptyHit=function(){this._boardStats.emptyHits=0,this._boardStats.noHitTime=0},a.prototype.addTotalHitPoints=function(t){this._boardStats.totalHitpoints+=t},a.prototype.calcStars=function(){var t=0;0<this._lastBrickCounter&&++t;var e=this._boardStats.totalHitpoints/(2*this._boardStats.paddleHits)+4*this._boardStats.combosValue/this._boardStats.bricksToBreak;return 2<e&&(e=2),t=Math.round(t+e)},a.prototype.setBG=function(t){var e=new Phaser.Image(this._game,0,0,"Bg");e.anchor.set(.5,.5),e.width=e.width*(d.Global.LOW?.4:1),e.height=this._game.height,this._prerendered.renderXY(e,this._prerendered.width/2,this._prerendered.height/2);for(var i=this._game.cache.getFrameByName("GUI","Board"),s=new Phaser.Group(this._game,null),a=d.Global.GAME_WIDTH,o=this._prerendered.width/2,n=o-a/2,r=0;r<this._game.height;){var h=new Phaser.Sprite(this._game,o-a/2,r,"GUI","Board");h.anchor.x=1;var l=new Phaser.Sprite(this._game,o+a/2,r,"GUI","Board");l.anchor.x=1,l.scale.x=-1,s.add(h),s.add(l),n>i.width&&(h.width=n,l.width=n),r+=i.height}this._prerendered.renderXY(s,0,0)},Object.defineProperty(a.prototype,"lives",{get:function(){return this._lives},enumerable:!1,configurable:!0}),a.prototype.clearScore=function(){this._score.clear()},Object.defineProperty(a.prototype,"score",{get:function(){return this._score.score},set:function(t){this._score.score=t,this._gui.score=t,this._gui.changeImmediately(),t>=d.Global.hiScore&&this._gui.makeTrophyVisible()},enumerable:!1,configurable:!0}),a.prototype.addScore=function(t){this._score.addScore(t),this._gui.score=this._score.score},a.prototype.setSpeed=function(){var t=d.Global.difficulty;this._speed=d.Settings.SPEED_NORMAL_SLOW_GAME+t*d.Settings.SPEED_INCREMENT,this._speedCoef=d.Settings.SPEED_NORMAL_SLOW_GAME/this._speed},Object.defineProperty(a.prototype,"speed",{get:function(){return this._speed},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"speedCoef",{get:function(){return this._speedCoef},enumerable:!1,configurable:!0}),a.prototype.updateEnemies=function(t){for(var e=this._enemiesCount-1;0<=e;e--){var i=this._enemies[e];i.toBeDestroyed?(this.addScore(d.Settings.SCORE_ENEMY_DESTROYED*i.enemyScale),i.setActive(!1),this._enemyGroup.remove(i),this._enemies[e]=this._enemies[--this._enemiesCount],this._enemies[this._enemiesCount]=null,this._enemiesPool.destroyItem(i)):i.tick(t)&&this.spawnEnemy(i.x,i.y,!1,i.hiveType,i.enemyScale)}},a.prototype.spawnEnemy=function(t,e,i,s,a){var o=this._enemiesPool.createItem();if(null!==o){var n;if(i)n=d.eEnemyType.HIVE;else switch(a=this._game.rnd.realInRange(-.3,0)+a,s){case 0:n=d.eEnemyType.BLOCKER;break;case 1:n=d.eEnemyType.PASSER;break;default:n=this._game.rnd.integerInRange(d.eEnemyType.BLOCKER,d.eEnemyType.PASSER)}o.init(t,e,a,n,s),n!==d.eEnemyType.HIVE&&(this.shockWave(t,e,4,!0),Utils.AudioUtils.playSound(d.Sfx.SWOOSH)),this._enemies[this._enemiesCount++]=o,this._enemyGroup.add(o)}},a.prototype.updateInitialEffect=function(t){if((this._initialEffectTime-=t)<=0){for(var e=this._initialEffectTime=0;e<4;e++)Utils.AudioUtils.playSound(d.Sfx.BOMB_EXPLOSION);this._bounceTween.start()}var i=1-this._initialEffectTime/d.Settings.INITIAL_EFFECT_DURATION,s=Phaser.Math.linear(d.Settings.INITIAL_EFFECT_SCALE,1,i),a=s*s;this._bricksGroup.scale.set(s,s),this._bricksGroup.alpha=1/s,this._shadowsGroup.scale.set(a,a),this._shadowsGroup.alpha=1/a},a.prototype.onPause=function(t){this._paused||2!==this._state||(this._state=5,this._game.physics.box2d.pause(),this._gameLayer.exists=!1,this._gameLayer.visible=!1,this._menuLayer.exists=!0,this._menuLayer.visible=!0,this._paused=!0,null!==this._tutorial&&(this._gameLayer.remove(this._tutorial),this._tutorial=null))},a.prototype.onUnpause=function(t){!this._paused&&5===this._state||(Utils.StorageUtils.save(),this._state=2,this._game.physics.box2d.resume(),this._gameLayer.exists=!0,this._gameLayer.visible=!0,this._menuLayer.exists=!1,this._menuLayer.visible=!1,this._paused=!1)},a.prototype.showExitWarning=function(t,e){(this._exitWarningFromStats=e)?(this._statsGroup.exists=!1,this._statsGroup.visible=!1):(this._menuLayer.exists=!1,this._menuLayer.visible=!1),this._exitWarning.exists=!0,this._exitWarning.visible=!0},a.prototype.onExitWarningNo=function(t){this._exitWarningFromStats?(this._statsGroup.exists=!0,this._statsGroup.visible=!0):(this._menuLayer.exists=!0,this._menuLayer.visible=!0),this._exitWarning.exists=!1,this._exitWarning.visible=!1},a.prototype.onExitWarningYes=function(t){this._parent.onExit(t)},a.TUTORIAL_DELAY=2500,a.TUTORIAL_TIME=300,a);function a(t,e){this._boardStats=new d.BoardStats,this._exitWarning=null,this._exitWarningFromStats=!1,this._tutorial=null,this._paddleJoint=null,this._pt=new Phaser.Point,this._worldManifold=new box2d.b2WorldManifold,this._game=t,this._parent=e,this._paused=!1,this.setSpeed(),this._prerendered=new Phaser.RenderTexture(t,t.width,t.height);var i=new Phaser.Image(t,0,0,this._prerendered,0);i.anchor.setTo(.5,.5),t.world.add(i),this.createLayers();var s=this;this._ballsPool=new d.Pool(d.Ball,d.Settings.BALLS_MAX,function(){return new d.Ball(t,s)}),this._ballsPool.canGrow=!1,this._balls=[],this._ballsCount=0,this._missilesPool=new d.Pool(d.Missile,d.Settings.MISSILE_MAX,function(){return new d.Missile(t,s)}),this._missilesPool.canGrow=!1,this._missiles=[],this._missilesCount=0,this._combosPool=new d.Pool(d.Combo,d.Settings.COMBOS_MAX,function(){return new d.Combo(t)}),this._combosPool.canGrow=!1,this._combos=[],this._combosCount=0,this._enemiesPool=new d.Pool(d.Enemy,d.Settings.ENEMY_MAX,function(){return new d.Enemy(t,s)}),this._enemies=[],this._enemiesCount=0,d.Enemy.claerHives(),this._bonusesPool=new d.Pool(d.Bonus,d.Settings.BONUSES_MAX,function(){return new d.Bonus(t,s)}),this._bonusesPool.canGrow=!1,this._bonuses=[],this._bonusesCount=0,this._activeBallBonus=d.eBonusType.NONE,this._activeBallBonusTime=0,this._lifeBonusAlreadySpawned=!1,this._paddleY=Math.floor(t.height/2-t.height*d.Settings.PADDLE_HEIGHT_LEVEL);var a=new d.Paddle(t,this,0,this._paddleY),o=this._gameLayer.getIndex(this._topParticlesGroup);this._gameLayer.addAt(a,o),this._paddle=a,this._bricks=[],this._bricksCount=0,this._score=new d.Score,this._score.onNewHiScore.add(this._gui.onNewHiScore,this._gui),this._emitters=new d.Emitters(t,this),this._title=new d.Title(t,this._combosGroup)}d.Board=t}(Shards=Shards||{}),function(a){var o,t=(o=a.AnchoredSprite,__extends(n,o),n.prototype.move=function(t){this.position.x=t,this.alpha=0,this._star.scale.set(5,5),this._star.angle=90,this._star.alpha=0,this._star.visible=!1,this._moveTween.start()},n.prototype.star=function(){this._star.visible=!0,this._starTweenScale.start(),this._starTween.start(),Utils.AudioUtils.playSound(a.Sfx.SWOOSH)},n.MOVE_TIME=1e3,n.STAR_TIME=500,n);function n(t,e,i){var s=o.call(this,t,e,i,"GUI","STAR_GREY")||this;return s.onStarComplete=new Phaser.Signal,s._star=new a.AnchoredSprite(t,0,0,"GUI","STAR_GOLD"),s.addChild(s._star),s._moveTween=t.add.tween(s).to({x:s.position.x,alpha:1},n.MOVE_TIME,Phaser.Easing.Sinusoidal.In,!1),s._starTween=t.add.tween(s._star).to({angle:0,alpha:1},n.STAR_TIME,Phaser.Easing.Linear.None,!1),s._starTween.onComplete.add(function(){Utils.AudioUtils.playSound(a.Sfx.IMPACT),this.onStarComplete.dispatch()},s),s._starTweenScale=t.add.tween(s._star.scale).to({x:1,y:1},n.STAR_TIME,Phaser.Easing.Linear.None,!1),s}a.StarSlot=t}(Shards=Shards||{}),function(_){var c,t=(c=Phaser.Group,__extends(d,c),d.prototype.update=function(){switch(this._state){case 1:var t=Math.floor(10*this._currentTime);this._currentTime+=this.game.time.delta/1e3,this._currentTime=Math.min(this._currentTime,d.TIME_DURATION),0<Math.floor(10*this._currentTime)-t&&Utils.AudioUtils.playSound(_.Sfx.TICK);var e=Math.floor(this._time*this._currentTime/d.TIME_DURATION);e!==this._prevTime&&(this._prevTime=e,this._timeText.text=Utils.StringUtils.padNumber(Math.floor(e/60),2)+":"+Utils.StringUtils.padNumber(e%60,2)),this._currentTime>=d.TIME_DURATION&&(this._state=2,this.showStar())}},d.prototype.show=function(t,e){this._nextPressed=!1,this._time=e,this._prevTime=0,this._currentTime=0,this._stars=t,this._currentStar=0,this._state=0,this.exists=!0,this.visible=!0,this._buttonCancel.visible=!1,this._buttonNext.visible=!1,this._clock.visible=!1,this._timeText.visible=!1,this._glass.scale.set(0,0),this._glass.angle=65;for(var i=0;i<3;i++)this._starSlots[i].move(.6*-d.GLASS_WIDTH);this._glassTweenAngle.start(),this._glassTween.start(),_.Global.sponsor.sdk.levelUp()},d.prototype.showTime=function(){this._clock.visible=!0,this._timeText.visible=!0,this._state=1},d.prototype.showStar=function(){this._currentStar<this._stars?this._starSlots[this._currentStar++].star():(this._state=3,this.showButtons())},d.prototype.showButtons=function(){this._buttonCancel.visible=!0,this._buttonNext.visible=!0,this._playState.onWin()},d.GLASS_WIDTH=400,d.GLASS_HEIGHT=384,d.BUTTON_X=130,d.BUTTON_Y=105,d.CLOCK_X=-120,d.CLOCK_Y=-160,d.TIME_X=-16,d.TIME_Y=-105,d.STAR_X=95,d.SCALE=1.1,d.GLASS_DURATION=1e3,d.TIME_DURATION=1,d);function d(t,e,i){var s=c.call(this,t,e)||this;s._starSlots=[],s._state=0,s._nextPressed=!1,s._playState=i;var a=_.Global.LOW?.4:1,o=Helper.NineImage.create(t,d.GLASS_WIDTH*a,d.GLASS_HEIGHT*a,"GUI","GLASS",80*a,60*a,80*a,60*a,!1);s._glass=new Phaser.Sprite(t,0,0,o),s._glass.anchor.set(.5,.5),s.add(s._glass),s._glassTween=t.add.tween(s._glass.scale).to({x:1,y:1},d.GLASS_DURATION,Phaser.Easing.Sinusoidal.In,!1),s._glassTween.onComplete.add(s.showTime,s),s._glassTweenAngle=t.add.tween(s._glass).to({angle:0},d.GLASS_DURATION,Phaser.Easing.Linear.None,!1);var n=new UI.Button(t,"Cancel","GUI","BUTTON_CANCEL");n.position.set(-d.BUTTON_X*a,d.BUTTON_Y*a),n.scaleOnOver.set(d.SCALE,d.SCALE),n.onClick.add(function(t){7===_.Global.sponsor.id?i.board.showExitWarning(t,!0):i.onExit(t)},s),s.add(n),s._buttonCancel=n;var r=new UI.Button(t,"next","GUI","BUTTON_CONTINUE");r.position.set(d.BUTTON_X*a,d.BUTTON_Y*a),r.scaleOnOver.set(d.SCALE,d.SCALE),r.onClick.add(function(t){this._nextPressed||(this._nextPressed=!0,i.onNext(t))},s),s.add(r),s._buttonNext=r,s._clock=new _.AnchoredSprite(t,d.CLOCK_X*a,d.CLOCK_Y*a,"GUI","CLOCK"),s.add(s._clock),s._timeText=new Phaser.BitmapText(t,d.TIME_X*a,d.TIME_Y*a,"FontFore","00:00",44*a),s._timeText.anchor.set(0,.5),s.add(s._timeText);for(var h=0;h<3;h++){var l=new _.StarSlot(t,(h-1)*d.STAR_X*a,0);l.onStarComplete.add(s.showStar,s),s._starSlots[h]=l,s.add(l)}return s.exists=!1,s.visible=!1,s}_.Stats=t}(Shards=Shards||{}),function(a){var o,t=(o=Phaser.Group,__extends(n,o),n.prototype.init=function(t,e){this._backText.text=t,this._foreText.text=t,this._timeMax=e,this._time=e,this._backText.alpha=0,this._foreText.alpha=0,this.exists=this.visible=!0},n.prototype.preUpdate=function(){if((this._time-=this.game.time.delta/1e3)<=0)return this.exists=this.visible=!1,!1;var t=this._time/this._timeMax,e=2*(t-.5),i=a.Global.LOW?.4:1;this._foreText.x=n.FRONT_OFFSET*e*i,this._backText.x=n.BACK_OFFSET*e*i;var s=Math.sin(Math.PI*(1-t));return this._foreText.alpha=Math.min(1.3*s,1),this._backText.alpha=s/2,!0},n.BACK_TEXT_SIZE=88,n.FRONT_TEXT_SIZE=66,n.BACK_OFFSET=200,n.FRONT_OFFSET=100,n);function n(t,e){var i=o.call(this,t,e)||this,s=a.Global.LOW?.4:1;return i._backText=new Phaser.BitmapText(t,0,0,"FontBack","",n.BACK_TEXT_SIZE*s),i._backText.anchor.set(.5,.5),i.add(i._backText),i._foreText=new Phaser.BitmapText(t,0,0,"FontFore","",n.FRONT_TEXT_SIZE*s),i._foreText.anchor.set(.5,.5),i.add(i._foreText),i.exists=!1,i}a.Title=t}(Shards=Shards||{}),function(t){var i,e=(i=Phaser.Sprite,__extends(s,i),s.prototype.setChar=function(t){var e=t-65,i=this.game.cache.getFrameByName("Game","FONT_GREY_A").index;this.frame=i+e;var s=this.game.cache.getFrameByName("Game","FONT_YELLOW_A").index,a=this.game.cache.getFrameByIndex("Game",s+e);return this._origFrame=a,this._topChar.frame=s+e,this._cropRect.width=a.width,this.setPercent(1),this.width+3},s.prototype.setPercent=function(t){var e=this._origFrame.height,i=e*t;this._topChar.y=e-i,this._cropRect.y=e-i,this._cropRect.height=i,this._topChar.updateCrop()},s);function s(t){var e=i.call(this,t,0,0,"Game")||this;return e.alpha=.6,e._cropRect=new Phaser.Rectangle(0,0,0,0),e._topChar=new Phaser.Sprite(t,0,0,"Game"),e._topChar.alpha=.9,e._topChar.crop(e._cropRect,!1),e.addChild(e._topChar),e}t.BonusChar=e}(Shards=Shards||{}),function(a){var o,t=(o=Phaser.Group,__extends(e,o),e.prototype.hideChars=function(){for(var t=0;t<12;t++)this._chars[t].visible=!1},e.prototype.getTextForBonus=function(t){switch(t){case a.eBonusType.CANNON:return e.LASER_CANNON;case a.eBonusType.SLOW:return e.SLOW_BALL;case a.eBonusType.FAST:return e.FAST_BALL;case a.eBonusType.STICKY:return e.STICKY_BALL;case a.eBonusType.POWER:return e.POWERBALL}return null},e.prototype.setText=function(t){var e=this.getTextForBonus(t);if(null!==e.length){this.hideChars();for(var i=0,s=0,a=0;a<e.length;a++){var o=e.charCodeAt(a);if(32!==o){var n=this._chars[s++];n.position.x=i,i+=n.setChar(o),n.visible=!0}else i+=18}this._length=s,this.x=-i/2}},e.prototype.tick=function(t,e){t!==this._currentBonus&&(this.setText(t),this._currentBonus=t);for(var i=0;i<this._length;i++)this._chars[i].setPercent(e)},e.SLOW_BALL="SLOW BALL",e.FAST_BALL="FAST BALL",e.POWERBALL="POWERBALL",e.STICKY_BALL="STICKY BALL",e.LASER_CANNON="LASER CANNON",e);function e(t,e){var i=o.call(this,t,e)||this;i._chars=[];for(var s=0;s<12;s++)i._chars[s]=new a.BonusChar(t),i.add(i._chars[s]);return i.hideChars(),i._currentBonus=a.eBonusType.NONE,i.visible=!1,i.y=t.height/2*.33,i}a.BonusText=t}(Shards=Shards||{}),function(t){var e=(a.setSounds=function(t,e){void 0===e&&(e=null),a._sfx=t,a._sfxIds=e},a.addSound=function(t,e){a._sfxs[t]=e},a.playSound=function(t){var e;e="number"==typeof t?a._sfxIds[t]:t,Shards.Global.soundOn&&(null!==a._sfx?a._sfx.play(e):void 0!==a._sfxs[e]&&a._sfxs[e].play())},Object.defineProperty(a,"currentMusic",{get:function(){return a._currentMusic},enumerable:!1,configurable:!0}),Object.defineProperty(a,"isMusicPlaying",{get:function(){return null!==this._currentMusic&&0!==this._currentMusic.length&&a._music[a._currentMusic].isPlaying},enumerable:!1,configurable:!0}),a.addMusic=function(t,e){a._music[t]=e},a.playMusic=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),(a._currentMusic!==t||i)&&(null!==a._currentMusic&&0<a._currentMusic.length&&a.stopMusic(),t in a._music&&Shards.Global.musicOn)){a._currentMusic=t;var s=a._music[t];s.loop=e,s.play(),e||s.onStop.addOnce(function(){a.onFinished.dispatch(t)},this)}},a.stopMusic=function(){if(null!==a._currentMusic&&0<a._currentMusic.length){var t=a._music[a._currentMusic];t.isPlaying&&t.stop(),a._currentMusic=""}},a.pauseMusic=function(){if(null!==a._currentMusic&&0<a._currentMusic.length){var t=a._music[a._currentMusic];t.isPlaying&&t.pause()}},a.resumeMusic=function(){if(null!==a._currentMusic&&0<a._currentMusic.length){var t=a._music[a._currentMusic];t.paused&&t.resume()}},a._sfx=null,a._sfxs={},a._music={},a._currentMusic="",a.onFinished=new Phaser.Signal,a);function a(){}t.AudioUtils=e}(Utils=Utils||{}),function(t){var e=(i.supported=function(){return Shards.Global.game.scale.compatibility.supportsFullScreen},i.isFullscreen=function(){return Shards.Global.game.scale.isFullScreen},i.changeFullscreen=function(){var t=Shards.Global.game;t.scale.isFullScreen?t.scale.stopFullScreen():t.scale.startFullScreen(!1,!1)},i);function i(){}t.FullscreenUtils=e}(Utils=Utils||{}),function(t){var e=(i.ChangeAnimationPhaserJSONData=function(t){Phaser.AnimationParser.myCallback=t,Phaser.AnimationParser.JSONData=function(t,e){if(e.frames){for(var i=new Phaser.FrameData,s=e.frames,a=0;a<s.length;a++){var o=i.addFrame(new Phaser.Frame(a,s[a].frame.x,s[a].frame.y,s[a].frame.w,s[a].frame.h,s[a].filename));s[a].trimmed&&o.setTrim(s[a].trimmed,s[a].sourceSize.w,s[a].sourceSize.h,s[a].spriteSourceSize.x,s[a].spriteSourceSize.y,s[a].spriteSourceSize.w,s[a].spriteSourceSize.h),Phaser.AnimationParser.myCallback(o,s[a])}return i}}},i.AdjustTweenFunctions=function(){Phaser.TweenManager.prototype.removeFromUpdateQueue=function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens.splice(e,1):-1!==(e=this._add.indexOf(t))&&this._add.splice(e,1)},Phaser.Tween.prototype.stopAndRemoveFromUpdateQueue=function(t){var e=this.stop(t);return this.manager.removeFromUpdateQueue(this),this.pendingDelete=!1,e}},i.AddBitmapFontAddMethod=function(){Phaser.Cache.prototype.addBitmapFontFromImage=function(t,e,i,s,a,o,n){var r=this.getImage(i,!0),h={url:e,data:r.data,font:null,base:r.base};void 0===o&&(o=0),void 0===n&&(n=0),h.font="json"===a?Phaser.LoaderParser.jsonBitmapFont(s,h.base,o,n):Phaser.LoaderParser.xmlBitmapFont(s,h.base,o,n),this._cache.bitmapFont[t]=h,this._resolveURL(e,h)}},i);function i(){}t.PhaserUtils=e}(Utils=Utils||{}),function(t){var m,e,S=function(){};t.ScreenMetrics=S,(e=m=t.eOrientation||(t.eOrientation={}))[e.PORTRAIT=0]="PORTRAIT",e[e.LANDSCAPE=1]="LANDSCAPE";var i=(s.calculateScreenMetrics=function(t,e,i,s,a,o){var n,r;if(void 0===i&&(i=m.LANDSCAPE),n=window.innerWidth,r=window.innerHeight,0===n||0===r)return this.screenMetrics;if((n<r&&i===m.LANDSCAPE||r<n&&i===m.PORTRAIT)&&!s){var h=n;n=r,r=h}void 0!==a&&void 0!==o||(o=i===m.LANDSCAPE?(a=Math.round(1024*t/960),Math.round(720*e/600)):(a=Math.round(720*t/600),Math.round(1024*e/960)));var l=n/r,_=0,c=0,d=0,u=0;c=t/e<l?(u=e,d=2*Math.ceil(u*l/2),_=((d=Math.min(d,a))-t)/2,0):(d=t,u=2*Math.ceil(d/l/2),_=0,((u=Math.min(u,o))-e)/2);var p=(n+.01)/d,g=(r+.01)/u;return s&&i===m.LANDSCAPE&&(p=g),this.screenMetrics=new S,this.screenMetrics.windowWidth=n,this.screenMetrics.windowHeight=r,this.screenMetrics.defaultGameWidth=t,this.screenMetrics.defaultGameHeight=e,this.screenMetrics.maxGameWidth=a,this.screenMetrics.maxGameHeight=o,this.screenMetrics.gameWidth=d,this.screenMetrics.gameHeight=u,this.screenMetrics.scaleX=p,this.screenMetrics.scaleY=g,this.screenMetrics.offsetX=_,this.screenMetrics.offsetY=c,this.screenMetrics},s);function s(){}t.ScreenUtils=i}(Utils=Utils||{}),function(t){var a=function(){this.levelStats=[]},e=(o.save=function(){var t=new a;t.musicOn=Shards.Global.musicOn,t.soundOn=Shards.Global.soundOn,t.currentLanguage=Shards.Global.currentLanguage,t.shardiensOn=Shards.Global.shardiensOn,t.lastLoadedLevel=Shards.Global.lastLoadedLevel,t.difficulty=Shards.Global.difficulty,t.hiScore=Shards.Global.hiScore,t.levelStats=Shards.Global.levelStats,t.tutorialShown=Shards.Global.tutorialShown;var e=Shards.Global.sponsor;if(1===e.id)e.sdk.saveUserData(t);else if(7===e.id)return void window.wkbSetUserData("data",JSON.stringify(t));var i=o.getLocalStorage();if(null!==i){var s=JSON.stringify(t);i.setItem("shards_save",s)}},o.load=function(){var t=null,e=Shards.Global.sponsor;if(1===e.id)t=e.sdk.loadUserData();else if(7===e.id){var i=window.wkbGetUserData("data");return!!i&&(t=JSON.parse(i),o.processLoadedData(t))}if(null==t){var s=o.getLocalStorage();if(null===s)return!1;t=JSON.parse(s.getItem("shards_save"))}return o.processLoadedData(t)},o.processLoadedData=function(t){return null!=t&&(Shards.Global.musicOn=t.musicOn,Shards.Global.soundOn=t.soundOn,Shards.Global.currentLanguage=t.currentLanguage,Shards.Global.shardiensOn=t.shardiensOn,Shards.Global.lastLoadedLevel=t.lastLoadedLevel,Shards.Global.difficulty=t.difficulty,Shards.Global.hiScore=t.hiScore,Shards.Global.levelStats=t.levelStats,Shards.Global.tutorialShown=t.tutorialShown,!0)},o.getLocalStorage=function(){try{if(2===Shards.Global.sponsor.id){var t=window.famobi?window.famobi:{};if(t.localStorage)return t.localStorage}if("localStorage"in window&&null!==window.localStorage)return localStorage}catch(t){return null}return null},o);function o(){}t.StorageUtils=e}(Utils=Utils||{}),function(t){var e=(l.padNumber=function(t,e,i){void 0===i&&(i="0");var s=t+"";return e<=s.length?s:new Array(e-s.length+1).join(i)+s},l.addSpacingToNumber=function(t,e){return void 0===e&&(e=" "),(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,e)},l.formatTime=function(t,e,i,s){void 0===i&&(i=-1),void 0===s&&(s=":");var a=!1,o="";if(3600<(t=Math.floor(t))||0===e){var n=Math.floor(t/3600);o+=(-1!==i?l.padNumber(n,i):n)+s,t%=3600,a=!0}if(!0===a||60<t||1===e){var r=Math.floor(t/60);o+=(-1!==i?l.padNumber(r,i):r)+s,t%=60,a=!0}var h=t;return o+=-1!==i?l.padNumber(h,i):h},l);function l(){}t.StringUtils=e}(Utils=Utils||{}),function(t){var e=(i.isAndroidStockBrowser=function(){var t=navigator.userAgent,e=/Android/.test(t),i=/Chrome/.test(t);return e&&!i},i);function i(){}t.SystemUtils=e}(Utils=Utils||{}),function(t){var e=(o.setTexts=function(t){o._texts=t},o.getLanguage=function(){var t=null;return navigator&&navigator.userAgent&&(t=navigator.userAgent.match(/android.*\W(\w\w)-(\w\w)\W/i))&&(t=t[1]),t=!t&&navigator?(navigator.language?t=navigator.language:navigator.languages&&0<navigator.languages.length?t=navigator.languages[0]:navigator.browserLanguage?t=navigator.browserLanguage:navigator.systemLanguage?t=navigator.systemLanguage:navigator.userLanguage&&(t=navigator.userLanguage),t.substr(0,2).toLowerCase()):"en"},o.getText=function(t,e){if(2===Shards.Global.sponsor.id&&"function"==typeof window.famobi.__){var i=window.famobi.__(t);return void 0===i?"undefined":i}if(null===o._texts)return"Texts not set";void 0===e&&(e=Shards.Global.currentLanguage);var s=o._texts[e];if(void 0===s)return"Invalid language "+e;var a=s[t];return void 0===a?"!MISSING TEXT!":a},o.game=null,o._texts=null,o);function o(){}t.TextUtils=e}(Utils=Utils||{}),function(n){var t,e=(t=Phaser.State,__extends(i,t),i.prototype.init=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!1;var t=this.screenDims();if(this.game.device.desktop){this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setMinMax(.25*this.game.width,.25*this.game.height,2.5*this.game.width,2.5*this.game.height),this.scale.setUserScale(t.scaleX,t.scaleY),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setResizeCallback(this.gameResized,this);var e=document.getElementById("body");if(e){var i=e.style;i.backgroundImage="url('assets/pattern.png')",i.backgroundRepeat="repeat",this.game.canvas.style.boxShadow="0 0 40px black"}}else this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setUserScale(t.scaleX,t.scaleY),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.forceOrientation(!1,!0),this.scale.setResizeCallback(this.gameResized,this),this.scale.onOrientationChange.add(this.orientationChange,this);this.orientationChange(this.scale,"",!0),Utils.FullscreenUtils.supported&&(this.scale.onFullScreenChange.add(this.onFullscreenChange,this),this.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL);var s=this;if(2===n.Global.sponsor.id&&"function"==typeof window.famobi.onOrientationChange&&(window.famobi.onOrientationChange(function(){s.orientationChange_Famobi()}),this.orientationChange_Famobi()),this.game.device.android){var a=navigator.userAgent,o=parseFloat(a.slice(a.indexOf("Android")+8));(o<=4.3||Phaser.Device.isAndroidStockBrowser)&&(n.Global.NO_ANIMS=!0,n.Global.MAX_MUSIC=1)}},i.prototype.preload=function(){7===n.Global.sponsor.id&&(n.Global.assetsPath=n.Global.assetsPath.substr(0,3)+"_jap/");var t="assets/"+n.Global.assetsPath;this.load.atlas("Splash",t+"Splash.png",t+"Splash.json"),this.load.xml("SplashFontData",t+"SplashFont.xml")},i.prototype.create=function(){this.cache.addBitmapFontFromImage("SplashFont",null,"Splash",this.cache.getXML("SplashFontData"),"xml"),n.Global.correctOrientation?void 0===n.Global.sponsor.logo?this.game.state.start("Preloader",!0,!1):3===n.Global.sponsor.id?(this.game.state.add("Logo",n.Logo),this.game.state.start("Logo",!0,!1)):5===n.Global.sponsor.id&&(this.game.state.add("Logo2",n.Logo2),this.game.state.start("Logo2",!0,!1)):(this.game.state.add("OrientationWait",n.OrientationWait),this.game.state.start("OrientationWait"))},i.prototype.screenDims=function(){return this.game.device.desktop?Utils.ScreenUtils.calculateScreenMetrics(n.Global.GAME_WIDTH,n.Global.GAME_HEIGHT,Utils.eOrientation.LANDSCAPE,this.game.device.desktop,n.Global.MAX_GAME_WIDTH_DESKTOP,n.Global.MAX_GAME_HEIGHT_DESKTOP):Utils.ScreenUtils.calculateScreenMetrics(n.Global.GAME_WIDTH,n.Global.GAME_HEIGHT,Utils.eOrientation.PORTRAIT,this.game.device.desktop,n.Global.MAX_GAME_WIDTH_MOBILE,n.Global.MAX_GAME_HEIGHT_MOBILE)},i.prototype.gameResized=function(t,e){if(!t.incorrectOrientation||7===n.Global.sponsor.id){var i=Utils.ScreenUtils.screenMetrics,s=i.scaleX,a=i.scaleY;if((i=this.screenDims()).gameWidth!==this.game.width||i.gameHeight!==this.game.height||.001<Math.abs(i.scaleX-s)||.001<Math.abs(i.scaleY-a)){this.scale.setGameSize(i.gameWidth,i.gameHeight),this.scale.setUserScale(i.scaleX,i.scaleY);var o=this.game.state.getCurrentState();this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width/2,this.game.height/2),this.camera.focusOnXY(0,0),"function"==typeof o.onResize&&o.onResize(this.game.width,this.game.height)}}},i.prototype.orientationChange_Famobi=function(){var t=window.famobi.getOrientation();n.Global.correctOrientation=this.game.device.desktop&&"landscape"===t||!this.game.device.desktop&&"portrait"===t,n.Global.correctOrientation?this.leaveIncorrectOrientation():this.enterIncorrectOrientation()},i.prototype.orientationChange=function(t,e,i){2===n.Global.sponsor.id&&"function"==typeof window.famobi.onOrientationChange||(7!==n.Global.sponsor.id?(n.Global.correctOrientation=this.game.device.desktop?t.isLandscape:t.isPortrait,n.Global.correctOrientation?this.leaveIncorrectOrientation():this.enterIncorrectOrientation()):n.Global.correctOrientation=!0)},i.prototype.enterIncorrectOrientation=function(){n.Global.correctOrientation=!1,document.getElementById("orientation").style.display="block";var t=this.game.state.getCurrentState();t===this.game.state.states.Play&&t.pause()},i.prototype.leaveIncorrectOrientation=function(){n.Global.correctOrientation=!0,document.getElementById("orientation").style.display="none"},i.prototype.onFullscreenChange=function(t){t.isFullScreen;var e=this.game.state.getCurrentState();"function"==typeof e.onFullscreenChange&&e.onFullscreenChange(t.isFullScreen)},i);function i(){return t.call(this)||this}n.Boot=e}(Shards=Shards||{}),function(E){var e,t=(e=Phaser.State,__extends(b,e),Object.defineProperty(b.prototype,"congrats",{set:function(t){this._showCongrats=!0},enumerable:!1,configurable:!0}),b.prototype.onResize=function(t,e){this._bg.width=t,this._bg.height=e},b.prototype.onFullscreenChange=function(t){E.Global.fullscreenOption&&(this._tglFullScreen.toggled=t)},b.prototype.create=function(){this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0),E.Global.LOW&&(this.time.desiredFps=60);var t=this.add.image(0,0,"Title",0,this.world);t.anchor.set(.5,.5),t.width=this.game.width,t.height=this.game.height,this._bg=t,this._rimX=E.Global.GAME_WIDTH/40,this._rimY=E.Global.GAME_HEIGHT/40,this._buttonsSpace=b.BUTTON_DIM/3,this._greyBG=this.add.sprite(0,-this.game.height/2,"GUI","GRADIENT",this.world),this._greyBG.width=(.5-b.MENU_GRAY_START_RATIO)*this.game.width,this._greyBG.height=this.game.height;var e=80*(E.Global.LOW?.4:1),i=60*(E.Global.LOW?.4:1),s=Helper.NineImage.create(this.game,this.game.width-2*this._rimX,this.game.height-3*this._rimY-this._glassOffsetY,"GUI","GLASS",e,i,e,i,!1);if(this._glass=new Phaser.Sprite(this.game,0,this._glassOffsetY,s),this.world.add(this._glass),this._layerMain=new Phaser.Group(this.game,this.world),this._layerOptions=new Phaser.Group(this.game,this.world),this._layerHelp=new Phaser.Group(this.game,this.world),this._layerCredits=new Phaser.Group(this.game,this.world),this._layerCongrats=new Phaser.Group(this.game,this.world),this._layerLangs=new Phaser.Group(this.game,this.world),this._sprLogo=new E.AnchoredSprite(this.game,0,0,"GUI","LOGO"),this._layerMain.add(this._sprLogo),7===E.Global.sponsor.id){var a=this.add.sprite(0,100*(E.Global.LOW?.4:1),"GUI","ja_title");a.anchor.set(.5),a.scale.set(1.8),this._sprLogo.addChild(a),this._japTitleTween=this.add.tween(a.scale).to({y:-1.8},750,function(t){return E.Easing.sinWithPeriod(t,.5)},!1,750)}if(this._txtPlay=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_BUTTON_PLAY"),b.TEXT_SIZE,this._layerMain),this._txtPlay.anchor.set(0,.5),this._btnPlay=new E.ButtonWithText(this.game,"Play","GUI","ICON_PLAY",this._txtPlay),this._btnPlay.onClick.add(function(){7===E.Global.sponsor.id?this._fader.fadeOut():this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,5,!0)},this),this._layerMain.add(this._btnPlay),this._txtHelp=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_BUTTON_HELP"),b.TEXT_SIZE,this._layerMain),this._txtHelp.anchor.set(0,.5),this._btnHelp=new E.ButtonWithText(this.game,"Help","GUI","ICON_HELP",this._txtHelp),this._btnHelp.onClick.add(function(){this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,4)},this),this._layerMain.add(this._btnHelp),this._txtOptions=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_BUTTON_SETTINGS"),b.TEXT_SIZE,this._layerMain),this._txtOptions.anchor.set(0,.5),this._btnOptions=new E.ButtonWithText(this.game,"Options","GUI","ICON_SETTINGS",this._txtOptions),this._btnOptions.onClick.add(function(){this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,2)},this),this._layerMain.add(this._btnOptions),this._txtCredits=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_BUTTON_ABOUT"),b.TEXT_SIZE,this._layerMain),this._txtCredits.anchor.set(0,.5),this._btnCredits=new E.ButtonWithText(this.game,"Credits","GUI","ICON_ABOUT",this._txtCredits),this._btnCredits.onClick.add(function(){this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,3)},this),this._layerMain.add(this._btnCredits),E.Global.showLanguages&&(this._btnCurrentLang=new E.FlagButton(this.game,E.Global.currentLanguage,"GUI"),this._btnCurrentLang.onClick.add(function(){this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,7)},this),this._layerMain.add(this._btnCurrentLang)),this._txtHiScore=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_HISCORE")+Utils.StringUtils.padNumber(E.Global.hiScore,7!==E.Global.sponsor.id?10:8),b.TEXT_SIZE,this._layerMain),this._txtHiScore.anchor.set(.5,.5),void 0!==E.Global.sponsor.soundcontrolls&&(this._tglMMusic=new UI.Toggle(this.game,"Music","GUI","ICON_MUSIC_OFF","ICON_MUSIC_ON"),this._tglMMusic.scale.set(.6,.6),this._tglMMusic.scaleOnOver.set(1.1,1.1),this._tglMMusic.toggled=E.Global.musicOn,this._tglMMusic.onClick.add(function(t){E.Global.musicOn=t.toggled,E.Global.musicOn?Utils.AudioUtils.playMusic("MainMusic",!0):Utils.AudioUtils.stopMusic(),Utils.StorageUtils.save()},this),this._layerMain.add(this._tglMMusic),this._tglMSound=new UI.Toggle(this.game,"Sound","GUI","ICON_SOUND_OFF","ICON_SOUND_ON"),this._tglMSound.scale.set(.6,.6),this._tglMSound.scaleOnOver.set(1.1,1.1),this._tglMSound.toggled=E.Global.soundOn,this._tglMSound.onClick.add(function(t){E.Global.soundOn=t.toggled,Utils.StorageUtils.save()},this),this._layerMain.add(this._tglMSound)),E.Global.fullscreenOption&&(this._tglFullScreen=new UI.Toggle(this.game,"FullScreen","GUI","FULLSCREEN_OFF","FULLSCREEN_ON"),this._tglFullScreen.scaleOnOver.set(1.1,1.1),this._tglFullScreen.onClick.add(function(t){Utils.FullscreenUtils.changeFullscreen()},this),this._tglFullScreen.toggled=Utils.FullscreenUtils.isFullscreen(),this._layerMain.add(this._tglFullScreen)),2===E.Global.sponsor.id||5===E.Global.sponsor.id){var o=void 0;2===E.Global.sponsor.id?o=this.game.add.button(0,0,"MoreGames",function(){Utils.AudioUtils.playSound(E.Sfx.CLICK),E.Global.sponsor.sdk.moreGamesLink()},this):5===E.Global.sponsor.id&&(o=this.game.add.button(0,0,"Logo",function(){Utils.AudioUtils.playSound(E.Sfx.CLICK),window.open("http://www.addictinggames.com","_blank")},this)),o.anchor.setTo(0,1);var n=E.Global.LOW?.4:1;o.scale.setTo(.35*n,.35*n),this._layerMain.add(o),this._moreGames=o}else if(6===E.Global.sponsor.id){o=new Phaser.Group(this.game,this._layerMain);var r=new UI.Button(this.game,"MoreGames","GUI","GLASS");r.scaleOnOver.set(1.05,1.05),r.onClick.add(function(){Utils.AudioUtils.playSound(E.Sfx.CLICK),window.open("https://www.classicgame.com","_blank")},this),r.anchor.setTo(.5,.5),o.add(r);var h=this.add.bitmapText(0,-2,"Font",Utils.TextUtils.getText("TXT_MORE_GAMES"),b.TEXT_SIZE,o);h.anchor.set(.5,.5);var l=E.Global.LOW?.4:1;r.width=h.textWidth+40*l,r.height=h.textHeight+24*l,o.x=this.game.width/2-.3*b.FLAG_X-r.width/2,this._moreGames=o}this._txtMusic=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_TOGGLE_MUSIC"),b.TEXT_SIZE,this._layerOptions),this._txtMusic.anchor.set(0,.5),this._tglMusic=new E.ToggleWithText(this.game,"Music","GUI","ICON_MUSIC_OFF","ICON_MUSIC_ON",this._txtMusic),this._tglMusic.toggled=E.Global.musicOn,this._tglMusic.onClick.add(function(t){E.Global.musicOn=t.toggled,E.Global.musicOn?Utils.AudioUtils.playMusic("MainMusic",!0):Utils.AudioUtils.stopMusic()},this),this._layerOptions.add(this._tglMusic),this._txtSound=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_TOGGLE_SOUND"),b.TEXT_SIZE,this._layerOptions),this._txtSound.anchor.set(0,.5),this._tglSound=new E.ToggleWithText(this.game,"Sound","GUI","ICON_SOUND_OFF","ICON_SOUND_ON",this._txtSound),this._tglSound.toggled=E.Global.soundOn,this._tglSound.onClick.add(function(t){E.Global.soundOn=t.toggled},this),this._layerOptions.add(this._tglSound),this._txtShardiens=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_TOGGLE_SHARDIENS"),b.TEXT_SIZE,this._layerOptions),this._txtShardiens.anchor.set(0,.5),this._tglShardiens=new E.ToggleWithText(this.game,"Shardiens","GUI","SHARDIENS_OFF","SHARDIENS_ON",this._txtShardiens),this._tglShardiens.toggled=E.Global.shardiensOn,this._tglShardiens.onClick.add(function(t){E.Global.shardiensOn=t.toggled},this),this._layerOptions.add(this._tglShardiens),this._txtOptionBack=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_BUTTON_BACK"),b.TEXT_SIZE,this._layerOptions),this._txtOptionBack.anchor.set(0,.5),this._btnOptionBack=new E.ButtonWithText(this.game,"OptionBack","GUI","ICON_CANCEL",this._txtOptionBack),this._btnOptionBack.onClick.add(function(){Utils.StorageUtils.save(),this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,1)},this),this._layerOptions.add(this._btnOptionBack);var _=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_CREDITS"),this.game.width-4*this._rimX,this.game.height,"Font",b.TEXT_SIZE);this._txtAbout=new Phaser.BitmapText(this.game,0,0,"Font",_[0],b.TEXT_SIZE),this._layerCredits.add(this._txtAbout),this._logos=new Phaser.Group(this.game,this._layerCredits);var c=E.Global.LOW?.4:1;this.add.sprite(20*c,40*c,"GUI","BOX2D",this._logos),this.add.sprite(-20*c,0*c,"GUI","PHASER",this._logos).anchor.set(1,0);for(var d=this.game.width-4*this._rimX-60*(E.Global.LOW?.4:1),u=0;u<10;u++){this._sprHelp[u]=new E.AnchoredSprite(this.game,0,0,"GUI","BONUS_"+u),this._layerHelp.add(this._sprHelp[u]),this._sprHelp[u].anchor.y=.5;var p=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_HELP_"+u),d,1e3,"Font",b.TEXT_SIZE);this._txtBonus[u]=this.add.bitmapText(0,0,"Font",p[0],b.TEXT_SIZE,this._layerHelp),this._txtBonus[u].anchor.y=.5}var g=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_CONGRATS"),this.game.width-4*this._rimX,this.game.height,"Font",b.TEXT_SIZE);if(this._txtCongrats=new Phaser.BitmapText(this.game,0,0,"Font",g[0],b.TEXT_SIZE,"center"),this._layerCongrats.add(this._txtCongrats),this._txtCongrats.anchor.set(.5,0),7!==E.Global.sponsor.id){this._sprGlow=this.add.sprite(0,0,"GUI","Glow",this._layerLangs),this._sprGlow.anchor.set(.5,.5),this._sprGlow.position.set(2,10),this._sprGlow.scale.set(4,4),this.add.tween(this._sprGlow).to({angle:360},12e3,Phaser.Easing.Linear.None,!0,0,-1);var m=E.Global.supportedLanguages;for(u=0;u<m.length;u++){var S=new E.FlagButton(this.game,m[u],"GUI");this._layerLangs.add(S),S.onClick.add(this.onChangeLanguage,this),m[u]===E.Global.currentLanguage&&(S.glow=this._sprGlow),this._btnLangs[u]=S,2!==E.Global.sponsor.id&&(this._txtLangs[u]=this.add.bitmapText(0,0,"Font",Utils.TextUtils.getText("TXT_LANGS",m[u]),b.TEXT_SIZE,this._layerLangs),this._txtLangs[u].anchor.y=.5)}}this._btnBack=new UI.Button(this.game,"Back","GUI","ICON_CANCEL"),this._btnBack.scaleOnOver.set(1.1,1.1),this._btnBack.onClick.add(function(){this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!0,b.HEADLINE_ROW,1)},this),this.world.add(this._btnBack),this._fader=new E.Fader(this.game,"GUI","WHITE"),this._fader.onFadeFinished.add(this.faderFinished,this),this.world.add(this._fader);var T=new E.ParticlesEmitter(this.game,0,0,b.PARTICLES_MAX);T.clear(),T.particleClass=E.AnimatedParticle,T.lifetime=2,T.setAlpha(2,2),T.setAlphaChange(E.eParameterChangeType.IN_TIME,-1.8,2),T.makeParticles("GUI",null,b.PARTICLES_MAX,[E.Animations.SHARDS_PARTICLES]),this._emitter=T,this.world.add(this._emitter),this._time=0,this._parabolicTimerTime=0,this._animationReversed=!0,this._time=0,this._parabolicAddBrightness=0,this._showEffect=!0,this._showCongrats?(this._showCongrats=!1,this._state=6,this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.CREDITS_ROW,-1)):(this._state=1,this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.HEADLINE_ROW,-1,!0)),this._fader.fadeIn(),Utils.AudioUtils.stopMusic(),Utils.AudioUtils.playMusic("MainMusic",!0)},b.prototype.onChangeLanguage=function(t){t.glow=this._sprGlow,E.Global.currentLanguage=t.buttonName,this._btnCurrentLang.setFlag(t.buttonName),this._txtPlay.text=Utils.TextUtils.getText("TXT_BUTTON_PLAY"),this._txtHelp.text=Utils.TextUtils.getText("TXT_BUTTON_HELP"),this._txtOptions.text=Utils.TextUtils.getText("TXT_BUTTON_SETTINGS"),this._txtCredits.text=Utils.TextUtils.getText("TXT_BUTTON_ABOUT"),this._txtHiScore.text=Utils.TextUtils.getText("TXT_HISCORE")+Utils.StringUtils.padNumber(E.Global.hiScore,7!==E.Global.sponsor.id?10:8),this._txtMusic.text=Utils.TextUtils.getText("TXT_TOGGLE_MUSIC"),this._txtSound.text=Utils.TextUtils.getText("TXT_TOGGLE_SOUND"),this._txtShardiens.text=Utils.TextUtils.getText("TXT_TOGGLE_SHARDIENS"),this._txtOptionBack.text=Utils.TextUtils.getText("TXT_BUTTON_BACK");var e=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_CREDITS"),this.game.width-4*this._rimX,this.game.height,"Font",b.TEXT_SIZE);this._txtAbout.text=e[0];for(var i=0;i<this._txtBonus.length;i++){var s=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_HELP_"+i),this.game.width-4*this._rimX-60*(E.Global.LOW?.4:1),1e3,"Font",b.TEXT_SIZE);this._txtBonus[i].text=s[0]}var a=Helper.TextWrapper.wrapText(this.game,Utils.TextUtils.getText("TXT_CONGRATS"),this.game.width-4*this._rimX,this.game.height,"Font",b.TEXT_SIZE);this._txtCongrats.text=a[0],Utils.StorageUtils.save()},b.prototype.faderFinished=function(t){t||(9!==E.Global.sponsor.id&&8!==E.Global.sponsor.id||E.Global.sponsor.sdk.showAd(null,null,!1),this.game.state.start("Levels",!0,!1))},b.prototype.update=function(){this.updateAnimation(this.game.time.delta/1e3),this.updateScreen()},b.prototype.updateScreen=function(){var t,e,i,s=this.game.width,a=this.game.height,o=s/2,n=a/2,r=E.Global.LOW?.4:1;switch(this._state){case 1:e=a*b.MENU_TOP_RATIO-n,t=s*b.MENU_ICON_LEFT_RATIO;var h=s*b.MENU_TEXT_START_RATIO;this._greyBG.position.x=b.MENU_GRAY_START_RATIO*s+this.getAnimX(e-b.BUTTON_DIM,this._greyBG.width),this.paintGameTitle(),i=o+t+b.BUTTON_DIM;var l=e+(b.BUTTON_DIM+this._buttonsSpace);this._btnPlay.position.set(t-this.getAnimX(e,i),l),this._txtPlay.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+this._buttonsSpace)+(b.BUTTON_DIM+this._buttonsSpace),this._btnHelp.position.set(t-this.getAnimX(e,i),l),this._txtHelp.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+this._buttonsSpace)+(b.BUTTON_DIM+this._buttonsSpace),this._btnOptions.position.set(t-this.getAnimX(e,i),l),this._txtOptions.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+this._buttonsSpace)+(b.BUTTON_DIM+this._buttonsSpace),this._btnCredits.position.set(t-this.getAnimX(e,i),l),this._txtCredits.position.set(h+this.getAnimX(e,o-h),l),E.Global.showLanguages&&(e=-this.game.height/2+b.FLAG_X,t=-this.game.width/2+b.FLAG_Y,this._btnCurrentLang.position.set(t,e-this.getAnimX(.75*a,n))),void 0!==E.Global.sponsor.soundcontrolls&&(e=-this.game.height/2+1.2*b.FLAG_X,t=this.game.width/2-1.2*b.FLAG_Y,this._tglMSound.position.set(t,e-this.getAnimX(.75*a,n)),t-=2*b.FLAG_Y,this._tglMMusic.position.set(t,e-this.getAnimX(.75*a,n))),E.Global.fullscreenOption&&(e=-this.game.height/2+1.2*b.FLAG_X,t=this.game.width/2-1.2*b.FLAG_Y,this._tglFullScreen.position.set(t,e-this.getAnimX(.75*a,n))),2===E.Global.sponsor.id||5===E.Global.sponsor.id?(e=this.game.height/2-.3*b.FLAG_Y,t=-this.game.width/2+.3*b.FLAG_X,this._moreGames.position.set(t,e+this.getAnimX(e,n))):6===E.Global.sponsor.id&&(e=this.game.height/2-.6*b.FLAG_Y,this._moreGames.position.y=e+this.getAnimX(e,n)),t=0,e=.89*a-n+this.getAnimX(a*b.MENU_TOP_RATIO,n);var _=this.time.time;t+=Math.sin(Phaser.Math.degToRad(_/32)%360)*(s/5),e-=Math.sin(Phaser.Math.degToRad(_/16)%360)*(a/80),this._txtHiScore.position.set(t,e);break;case 2:e=.2*a-n,t=s*b.MENU_ICON_LEFT_RATIO,h=s*b.MENU_TEXT_START_RATIO,this._greyBG.position.x=b.MENU_GRAY_START_RATIO*s+this.getAnimX(e-b.BUTTON_DIM,this._greyBG.width),i=o+t+b.BUTTON_DIM,l=e+(b.BUTTON_DIM+1.5*this._buttonsSpace),this._tglMusic.position.set(t-this.getAnimX(e,i),l),this._txtMusic.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+1.5*this._buttonsSpace)+(b.BUTTON_DIM+1.5*this._buttonsSpace),this._tglSound.position.set(t-this.getAnimX(e,i),l),this._txtSound.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+1.5*this._buttonsSpace)+(b.BUTTON_DIM+1.5*this._buttonsSpace),this._tglShardiens.position.set(t-this.getAnimX(e,i),l),this._txtShardiens.position.set(h+this.getAnimX(e,o-h),l),l=(e+=b.BUTTON_DIM+1.5*this._buttonsSpace)+(b.BUTTON_DIM+1.5*this._buttonsSpace),this._btnOptionBack.position.set(t-this.getAnimX(e,i),l),this._txtOptionBack.position.set(h+this.getAnimX(e,o-h),l);break;case 3:this.paintGlass(),e=4*this._rimY-n+this._glassOffsetY,this._txtAbout.position.set(2*this._rimX-o+this.getAnimX(b.CREDITS_ROW,s),e),e+=this._txtAbout.height+this._rimY,this._logos.position.set(0,e+this.getAnimX(e,a));break;case 6:this.paintGlass(),e=4*this._rimY-n+this._glassOffsetY,this._txtCongrats.position.set(0,e+this.getAnimX(b.CREDITS_ROW,a));break;case 4:this.paintGlass();var c=80*r;t=2*this._rimX-o,e=4*this._rimY-n+this._glassOffsetY;for(var d=t+60*r+this._rimX,u=0;u<10;u++)this._sprHelp[u].position.set(t-this.getAnimX(e,s),e),this._txtBonus[u].position.set(d+this.getAnimX(e,s),e),e+=Math.max(c,this._txtBonus[u].textHeight+this._rimX/2);break;case 7:this.paintGlass();var p=140*r,g=E.Global.supportedLanguages,m=-(g.length-1)*p/2;for(u=0;u<g.length;u++)2!==E.Global.sponsor.id?(this._btnLangs[u].position.set(-80*r-this.getAnimX(m-100*r,s),m),this._txtLangs[u].position.set(50*r+this.getAnimX(m-100*r,s),m)):this._btnLangs[u].position.set(0-this.getAnimX(m-100*r,s),m),m+=p}},b.prototype.paintGlass=function(){var t=2*this._rimY-this.game.height/2+this._glassOffsetY;this._glass.position.set(this._rimX-this.game.width/2,t+this.getAnimX(t,this.game.height)),this.animationRunning();var e=60*(E.Global.LOW?.4:1);this._btnBack.position.set(this.game.width/2-2*this._rimX-e,t-this.getAnimX(.25*-this.game.height,2*this._rimY+e+this._glassOffsetY))},b.prototype.parabolicTimerTick=function(t){this._parabolicTimerTime=Math.min(this._parabolicTimerTime+t,b.SHARDS_DURATION);var e=this._parabolicTimerTime/b.SHARDS_DURATION;return-4*e*e+4*e},b.prototype.paintGameTitle=function(){var t=0,e=1,i=.2*this.game.height-this.game.height/2;if(this._showEffect){if(1<=this._time)if(this._parabolicTimerTime<b.SHARDS_DURATION){if(this._parabolicAddBrightness=this.parabolicTimerTick(this.game.time.delta/1e3),this._parabolicTimerTime>b.SHARDS_DURATION/2&&(t=1-this._parabolicAddBrightness,e+=1.5*this._parabolicAddBrightness),this._parabolicTimerTime>=b.SHARDS_DURATION){Utils.AudioUtils.playSound(E.Sfx.BRICK_DESTROYED_1),Utils.AudioUtils.playSound(E.Sfx.BRICK_DESTROYED_1),this._showEffect=!1;for(var s=0;s<b.PARTICLES_MAX;s++){var a=this.game.rnd.integerInRange(-this._sprLogo.width/2,this._sprLogo.width/2),o=this.game.rnd.integerInRange(-this._sprLogo.height/2,this._sprLogo.height/2),n=b.PARTICLES_MAX-3<=s;this._emitter.emitAt(0+a,i+o);var r=this._emitter.emitParticle();if(null!==r)if(n)o=0,a=(s-(b.PARTICLES_MAX-2))*(this._sprLogo.width/4),r.visual.position.set(0+a,i+o),r.lifetime=1.05,r.setFrame("SHARDS_EXPLOSION"),r.alpha=1.28,r.setAlphaChange(E.eParameterChangeType.IN_TIME,-1.28/1.05),r.visual.scale.set(1,1),r.setScaleChange(E.eParameterChangeType.IN_TIME,1);else{r.lifetime=1.5,r.setPhysics(3*a,3*o),r.setRandomAnim();var h=1+this.game.rnd.realInRange(0,2);r.visual.scale.set(h,h),r.setScaleChange(E.eParameterChangeType.IN_TIME,2),r.alpha=2,r.setAlphaChange(E.eParameterChangeType.IN_TIME,-2/1.5)}}7===E.Global.sponsor.id&&this._japTitleTween.start()}}else t=1}else if(this.animationRunning()){var l=b.ANIMATION_TIME/2;this._time>l&&(t=(this._time-l)/l)}else t=1;this._sprLogo.position.set(0,i),this._sprLogo.alpha=Phaser.Math.clamp(t,0,1),this._sprLogo.scale.set(e,e),this._fader.isRunning()||(this._fader.fade=this._parabolicAddBrightness)},b.prototype.getAnimX=function(t,e,i){void 0===i&&(i=!0);var s=(t+=this.game.height/2)/this.game.height;return s*=this._originalAnimationTime-this._animationSinCycle,s=this._time<s?0:this._time>=s+this._animationSinCycle?1:(this._time-s)/this._animationSinCycle,i?e-Math.sin(Phaser.Math.degToRad(90*s))*e:s*(-3*s+4)},b.prototype.animationRunning=function(){return!this._animationReversed&&this._time<this._totalAnimationTime||this._animationReversed&&0<this._time},b.prototype.setAnimation=function(t,e,i,s,a,o){if(void 0===o&&(o=!1),!this.animationRunning()){this._layerMain.visible=1===this._state,this._layerOptions.visible=2===this._state,this._layerCredits.visible=3===this._state,this._layerHelp.visible=4===this._state,this._layerCongrats.visible=6===this._state,this._layerLangs.visible=7===this._state,this._greyBG.visible=1===this._state||2===this._state,this._glass.visible=1!==this._state&&2!==this._state,this._btnBack.visible=this._glass.visible;var n=t-e,r=(s=this.game.height-s)/this.game.height;this._totalAnimationTime=n*r+e,this._originalAnimationTime=t,this._animationSinCycle=e,this._animationReversed=i,this._stateAfterAnim=a,this._doBrightening=o,void 0!==E.Global.sponsor.soundcontrolls&&(this._tglMMusic.toggled=E.Global.musicOn,this._tglMSound.toggled=E.Global.soundOn),this._tglMusic.toggled=E.Global.musicOn,this._tglSound.toggled=E.Global.soundOn}},b.prototype.updateAnimation=function(t){var e=!1;if(!this._animationReversed&&this._time<this._totalAnimationTime?(this._time+=t,this._time>=this._totalAnimationTime&&(this._time=this._totalAnimationTime,e=!0)):this._animationReversed&&0<this._time&&(this._time-=t,this._time<=0&&(e=!(this._time=0))),e&&-1!=this._stateAfterAnim)switch(this._state=this._stateAfterAnim,this._state){case 5:this._fader.fadeOut();break;case 2:this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.HEADLINE_ROW_SETTINGS,-1);break;case 4:this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.HELP_ROW,-1);break;case 3:this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.CREDITS_ROW,-1);break;case 1:this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.HEADLINE_ROW,-1);break;case 7:this.setAnimation(b.ANIMATION_TIME,b.ANIMATION_SIN_CYCLE,!1,b.LANG_ROW,-1)}},b.TEXT_SIZE=36,b.PARTICLES_MAX=30,b.SHARDS_DURATION=.2,b.ANIMATION_TIME=1.4,b.ANIMATION_SIN_CYCLE=.5,b.MENU_TOP_RATIO=.3,b.MENU_ICON_LEFT_RATIO=-.18,b.MENU_GRAY_START_RATIO=-.05,b.MENU_TEXT_START_RATIO=-.03,b.HEADLINE_ROW=-320,b.HEADLINE_ROW_SETTINGS=1280*.33-640,b.CREDITS_ROW=128,b.HELP_ROW=-320,b.LANG_ROW=128,b.FLAG_X=50,b.FLAG_Y=60,b.BUTTON_DIM=114,b);function b(){var t=e.call(this)||this;return t._glassOffsetY=0,t._sprHelp=[],t._txtBonus=[],t._btnLangs=[],t._txtLangs=[],t._showCongrats=!1,E.Global.LOW&&(b.TEXT_SIZE*=.4,b.PARTICLES_MAX=20,b.HEADLINE_ROW*=.4,b.HEADLINE_ROW_SETTINGS*=.4,b.CREDITS_ROW*=.4,b.HELP_ROW*=.4,b.LANG_ROW*=.4,b.FLAG_X*=.4,b.FLAG_Y*=.4,b.BUTTON_DIM*=.4),7===E.Global.sponsor.id&&(t._glassOffsetY=100*(E.Global.LOW?.4:1)),t}E.Menu=t}(Shards=Shards||{}),function(i){var e,t=(e=Phaser.State,__extends(s,e),s.prototype.paused=function(){this._board.onPause(null)},s.prototype.onFullscreenChange=function(t){i.Global.fullscreenOption&&this._board.inGameMenu.onFullscreenChange(t)},Object.defineProperty(s.prototype,"level",{set:function(t){this._level=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"newGame",{set:function(t){this._newGame=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"levelsFile",{get:function(){return this._levelsFile},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"board",{get:function(){return this._board},enumerable:!1,configurable:!0}),s.prototype.pause=function(){this._board.onPause(null)},s.prototype.create=function(){var t=this.cache.getBinary("LevelData");this._levelsFile=new i.BinaryFileReader(t),this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0),this.stage.backgroundColor=3158064,box2d.b2_velocityThreshold=0,this.game.physics.startSystem(Phaser.Physics.BOX2D);var e=this.game.physics.box2d;e.setPTMRatio(i.Settings.PTM),e.debugDraw.joints=!0,i.Global.LOW?(e.frameRate=1/30,e.velocityIterations=2,e.positionIterations=1,this.time.desiredFps=30):(e.frameRate=1/60,e.velocityIterations=2,e.positionIterations=1),this.game.forceSingleUpdate=!0,e.resume(),this.game.input.onDown.add(this.dragStart,this),this.game.input.addMoveCallback(this.mouseMove,this),this.game.input.onUp.add(this.dragEnd,this),this._board=new i.Board(this.game,this),this._newGame?(this._board.setLives(2),this._board.clearScore(),this._newGame=!1):(this._board.setLives(this._lives),this._board.score=this._score),this._board.loadLevel(this._level),i.Global.lastLoadedLevel=this._level,this._fader=new i.Fader(this.game,"GUI","BLACK"),this._fader.onFadeFinished.add(this.faderFinished,this),this.world.add(this._fader),this._fader.fadeIn(500),this._playNextMusic=!0,this.playMusic(),this._mouseDown=!1,7!==i.Global.sponsor.id&&10!==i.Global.sponsor.id||i.Global.sponsor.sdk.startGameSession({level:this._level})},s.prototype.dragStart=function(t){this._board.paused||(this._mousePosition.copyFrom(t.position),this._mousePosition.subtract(this.game.width/2,this.game.height/2),this._mousePosition.y>-this.game.height/2*.8&&(this.game.device.desktop&&this._board.unstickBalls(),this._board.fireMissile(this._mousePosition)),this._mouseDown=!0)},s.prototype.mouseMove=function(t,e,i,s){this._board.paused||(this._mousePosition.copyFrom(t.position),this._mousePosition.subtract(this.game.width/2,this.game.height/2))},s.prototype.dragEnd=function(t){!this.game.device.desktop&&this._mouseDown&&t.y-this.game.height/2>-this.game.height/2*.8&&this._board.unstickBalls(),this._mouseDown=!1},s.prototype.update=function(){this._board.updatePaddlePosition(this._mousePosition);var t=this.game.time.delta/1e3;this._board.tick(t)},s.prototype.shutdown=function(){},s.prototype.onExit=function(t){Utils.StorageUtils.save(),this._playNextMusic=!1,this._afterFade=s.FADE_TO_LEVELS,this._fader.frameName="WHITE",this._fader.fadeOut(),7===i.Global.sponsor.id&&(this._board.exitWarningFromStats||i.Global.sponsor.sdk.showAd(null,null,!1))},s.prototype.onNext=function(t){this._newGame=!1,this._lives=this._board.lives,this._score=this._board.score,++this._level,this._afterFade=s.FADE_TO_NEXT,this._fader.frameName="BLACK",this._fader.fadeOut()},s.prototype.onWin=function(){7!==i.Global.sponsor.id&&10!==i.Global.sponsor.id||i.Global.sponsor.sdk.endGameSession({score:this._board.score})},s.prototype.onGameOver=function(){this._afterFade=s.FADE_TO_MAIN,this._fader.frameName="WHITE",this._fader.fadeOut(),7!==i.Global.sponsor.id&&10!==i.Global.sponsor.id||i.Global.sponsor.sdk.endGameSession({score:this._board.score})},s.prototype.faderFinished=function(t){t||(7!==i.Global.sponsor.id&&i.Global.sponsor.sdk.showAd(null,null,!1),this._afterFade===s.FADE_TO_MAIN?(7!==i.Global.sponsor.id&&10!==i.Global.sponsor.id&&(i.Global.sponsor.sdk.endGameSession({score:this._board.score,level:this._level}),i.Global.sponsor.sdk.submitScore(0,this._board.score),i.Global.sponsor.sdk.gameOver()),this.game.state.start("Menu",!0,!1)):this._afterFade===s.FADE_TO_LEVELS?(7!==i.Global.sponsor.id&&10!==i.Global.sponsor.id&&(i.Global.sponsor.sdk.endGameSession({score:this._board.score,level:this._level}),i.Global.sponsor.sdk.submitScore(0,this._board.score),i.Global.sponsor.sdk.gameOver()),this.game.state.start("Levels",!0,!1)):this._afterFade===s.FADE_TO_NEXT&&(this._level<i.Global.LEVELS?this.game.state.start("BgLoader",!0,!1,this._level):(this.game.state.states.Menu.congrats=!0,this.game.state.start("Menu",!0,!1))))},s.prototype.playMusic=function(){if("MainMusic"===Utils.AudioUtils.currentMusic&&Utils.AudioUtils.stopMusic(),"Play"===this.game.state.current&&i.Global.musicOn&&!Utils.AudioUtils.isMusicPlaying&&this._playNextMusic){var t=this.game.musicLoader.getMusic();null!==t?Utils.AudioUtils.playMusic(t,!1,!0):this.game.time.events.add(3e3,function(){this.playMusic()},this)}},s.prototype.stopMusic=function(){this._playNextMusic=!1,Utils.AudioUtils.stopMusic()},s.prototype.onMusicFinished=function(t){"Play"===this.game.state.current&&this.playMusic()},s.FADE_TO_MAIN=0,s.FADE_TO_LEVELS=1,s.FADE_TO_NEXT=2,s);function s(){var t=e.call(this)||this;return t._level=0,t._newGame=!0,t._lives=2,t._score=0,t._mousePosition=new Phaser.Point,Utils.AudioUtils.onFinished.add(t.onMusicFinished,t),t}i.Play=t}(Shards=Shards||{}),function(_){var e,t=(e=Phaser.State,__extends(c,e),c.prototype.preload=function(){this.stage.backgroundColor=16777215,this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0);var t=this.game.height/2*.7;this._loadingBar=this.add.sprite(-c.LOADING_BAR_WIDTH/2,t,"Splash","Splash_Bar"),this._loadingBar.anchor.set(0,1),this._loadingBar.width=0,this._loadingText=this.add.bitmapText(0,t+c.TEXT_SIZE,"SplashFont","0%",c.TEXT_SIZE),this._loadingText.anchor.set(.5,.5);var e="assets/";if(this.game.device.ie||Phaser.Device.isAndroidStockBrowser())for(var i=0;i<_.Sfx.SOUND_NAMES.length;i++)this.load.audio(_.Sfx.SOUND_NAMES[i],"assets/Sfx/"+_.Sfx.SOUND_NAMES[i]+".m4a");else this.load.audio("SFX",["assets/sfx.ogg","assets/sfx.m4a"]);this.load.audio("MainMusic",["assets/Main.ogg","assets/Main.m4a"]),this.load.image("Title","assets/Backgrounds/Title.jpg");var s=e+_.Global.assetsPath;this.load.atlas("GUI",s+"GUI_Shards.png",s+"GUI_Shards.json"),this.load.atlas("Game",s+"Shards_game.png",s+"Shards_game.json"),this.load.atlas("Hourglass",s+"Hourglass.png",s+"Hourglass.json"),this.load.xml("FontData",s+"Font.xml"),this.load.xml("FontForeData",s+"Font_fore.xml"),this.load.xml("FontBackData",s+"Font_back.xml"),7===_.Global.sponsor.id?(this.load.binary("LevelData",e+"levels_jap.bin",this.onBinaryLoaded,this),_.Global.LEVELS=80-_.Global.excludedLevels.length):this.load.binary("LevelData",e+"levels.bin",this.onBinaryLoaded,this),this.load.json("Text",e+"text.json"),this.load.json("Config",e+"config.json"),2===_.Global.sponsor.id&&this.load.image("MoreGames",_.Global.sponsor.sdk.getMoreGamesButton())},c.prototype.onBinaryLoaded=function(t,e){return e},c.prototype.loadUpdate=function(){this.setLoadingText(this.load.progress)},c.prototype.create=function(){this.setLoadingText(100),this._loadingBar.width=c.LOADING_BAR_WIDTH;var t=new _.MusicManager(this.game);(this.game.musicLoader=t).loadMusic(),this.cache.addBitmapFontFromImage("Font",null,"GUI",this.cache.getXML("FontData"),"xml"),this.cache.addBitmapFontFromImage("FontFore",null,"Game",this.cache.getXML("FontForeData"),"xml"),this.cache.addBitmapFontFromImage("FontBack",null,"Game",this.cache.getXML("FontBackData"),"xml"),_.Global.LOW;var e=this.cache.getImage("Title"),i=this.cache.getFrameData("Title"),s=new Phaser.Frame(1,0,0,e.width,260,"Top"),a=new Phaser.Frame(1,0,e.height-36,e.width,36,"Bottom");if(i.addFrame(s),i.addFrame(a),this.readConfig(),this.loadSavedData(),7!==_.Global.sponsor.id&&(!this._dataLoadedFromSave||_.Global.checkLanguageEveryTime)){var o=Utils.TextUtils.getLanguage();0<=_.Global.supportedLanguages.indexOf(o)?_.Global.currentLanguage=o:_.Global.currentLanguage="en"}Utils.TextUtils.setTexts(this.game.cache.getJSON("Text")),Utils.AudioUtils.addMusic("MainMusic",this.add.audio("MainMusic"));var n=0;if(this.game.device.ie||Phaser.Device.isAndroidStockBrowser()){n=.02,Utils.AudioUtils.setSounds(null,_.Sfx.SOUND_NAMES);for(var r=0;r<_.Sfx.SOUND_NAMES.length;r++){var h=this.add.audio(_.Sfx.SOUND_NAMES[r]);h.allowMultiple=!0,Utils.AudioUtils.addSound(_.Sfx.SOUND_NAMES[r],h)}}else{this.game.device.iOS&&(n=.1);var l=this.add.audio("SFX");Utils.AudioUtils.setSounds(l,_.Sfx.SOUND_NAMES),l.allowMultiple=!0,l.addMarker("ball_lost",0,1.229),l.addMarker("ball_sticky",2.5-n,.261+n),l.addMarker("ball_sticky_hit",4-n,.184+n),l.addMarker("bomb_explosion",5.5-n,.468+n),l.addMarker("border_hit_1",7-n,.302+n),l.addMarker("border_hit_2",8.5-n,.091+n),l.addMarker("border_hit_3",10-n,.25+n),l.addMarker("brick_damaged_1",11.5-n,.749+n),l.addMarker("brick_damaged_2",13-n,.091+n),l.addMarker("brick_damaged_3",14.5-n,.087+n),l.addMarker("brick_destroyed_1",16-n,.447+n),l.addMarker("cannon_explosion",17.5-n,.3+n),l.addMarker("cannon_fire",19-n,.12+n),l.addMarker("cannon_off",20.5-n,1.093+n),l.addMarker("cannon_on",23-n,1.1+n),l.addMarker("click",25.5-n,.397+n),l.addMarker("fire",27-n,.677+n),l.addMarker("freeze",28.5-n,1.296+n),l.addMarker("game_over",31-n,8.001+n),l.addMarker("impact",40.5-n,.246+n),l.addMarker("life",42-n,1.449+n),l.addMarker("paddle_enlarge",44.5-n,.295+n),l.addMarker("paddle_hit_1",46-n,.12+n),l.addMarker("paddle_hit_2",47.5-n,.107+n),l.addMarker("paddle_hit_3",49-n,.104+n),l.addMarker("paddle_shrink",50.5-n,.295+n),l.addMarker("powerball",52-n,1.009+n),l.addMarker("split_ball",54.5-n,.225+n),l.addMarker("swoosh",56-n,.517+n),l.addMarker("tick",57.5-n,.008+n),l.addMarker("unbreakable_hit_1",59-n,.116+n),l.addMarker("unbreakable_hit_2",60.5-n,.104+n),l.addMarker("enemy_explosion",62-n,.597+n),l.addMarker("enemy_border_hit_1",63.5-n,.302+n),l.addMarker("enemy_border_hit_2",65-n,.091+n),l.addMarker("enemy_border_hit_3",66.5-n,.25+n),l.addMarker("enemy_brick_damaged_1",68-n,.304+n),l.addMarker("enemy_brick_damaged_2",69.5-n,.091+n),l.addMarker("enemy_brick_damaged_3",71-n,.067+n),l.addMarker("enemy_unbreakable_hit_1",72.5-n,.062+n),l.addMarker("enemy_unbreakable_hit_2",74-n,.033+n)}this.time.events.add(500,function(){this._loadingBar.visible=!1,this._loadingText.visible=!1},this),this.time.events.add(1500,function(){if(!this._ready){var t=this.add.sprite(0,this._loadingBar.y,"Hourglass",0);t.anchor.set(.5,.5),t.animations.add("hourglass",Phaser.Animation.generateFrameNames("Loading",1,8),16,!0),t.animations.play("hourglass"),this._hourglass=t}},this),(this.game.device.iOS||_.Global.showSoundDialog)&&this.game.state.add("SoundDialog",_.SoundDialog)},c.prototype.loadSavedData=function(){this._dataLoadedFromSave=Utils.StorageUtils.load();for(var t=_.Global.levelStats,e=t.length;e<_.Global.LEVELS;e++)t[e]=new _.LevelStats;t[0].unlocked=!0},c.prototype.readConfig=function(){var t=this.game.cache.getJSON("Config");for(var e in t)_.Global[e]=t[e]},c.prototype.createLogo=function(){null!==this._hourglass&&(this._hourglass.visible=!1);var t=this.add.sprite(0,0,"Splash","Splash_Logo");t.anchor.set(.5,.5),t.scale.set(3,0),t.alpha=0,this.add.tween(t).to({alpha:1},500,Phaser.Easing.Exponential.In,!0);var e=this.add.tween(t.scale).to({x:1,y:1},500,Phaser.Easing.Exponential.In,!0);7!==_.Global.sponsor.id&&Utils.AudioUtils.playSound(_.Sfx.SWOOSH),e.onComplete.add(function(){this.time.events.add(1500,function(){7!==_.Global.sponsor.id&&Utils.AudioUtils.playSound(_.Sfx.CLICK),this.add.tween(t).to({alpha:0},1e3,Phaser.Easing.Sinusoidal.In,!0),this.add.tween(t).to({y:this.game.height/2*.7},1e3,_.Easing.parabolic,!0).onComplete.add(this.nextState,this)},this)},this)},c.prototype.nextState=function(){this.game.device.iOS||_.Global.showSoundDialog?this.game.state.start("SoundDialog"):this.game.state.start("Menu")},c.prototype.update=function(){(this.game.device.ie||Phaser.Device.isAndroidStockBrowser()||this.cache.isSoundDecoded("SFX"))&&this.cache.isSoundDecoded("MainMusic")&&!1===this._ready&&(this._ready=!0,void 0===_.Global.sponsor.nobranding?this.createLogo():this.nextState())},c.prototype.setLoadingText=function(t){this._loadingText.setText(t+"%"),this._loadingText.updateText(),this._loadingBar.width=t/100*c.LOADING_BAR_WIDTH},c.LOADING_BAR_WIDTH=400,c.TEXT_SIZE=32,c);function c(){var t=e.call(this)||this;return t._hourglass=null,t._dataLoadedFromSave=!1,t._ready=!1,_.Global.LOW&&(c.LOADING_BAR_WIDTH*=.4,c.TEXT_SIZE*=.4),t}_.Preloader=t}(Shards=Shards||{}),function(s){var t,e=(t=Phaser.State,__extends(i,t),i.prototype.init=function(t){this._level=t,this.stage.backgroundColor=0,this.time.events.add(3e3,function(){var t=this.add.sprite(0,0,"Hourglass");t.anchor.set(.5,.5),t.scale.set(5,5),t.smoothed=!1,t.animations.add("hourglass",Phaser.Animation.generateFrameNames("frame_",0,14,"",2),7,!0),t.animations.play("hourglass")},this)},i.prototype.preload=function(){var t=this.cache.getBinary("LevelData"),e=new s.BinaryFileReader(t);e.setFile(this._level);var i=e.readUint8()+1;this.load.image("Bg","assets/Backgrounds/Background_"+Utils.StringUtils.padNumber(i,2)+".jpg")},i.prototype.create=function(){this.game.state.start("Play",!0,!1)},i);function i(){return t.call(this)||this}s.BgLoader=e}(Shards=Shards||{}),function(u){var s,t=(s=Phaser.State,__extends(p,s),p.prototype.create=function(){this._levelIsStarting=!1;var t=this.add.image(0,0,"Title",0,this.world);t.anchor.set(.5,.5),t.width=this.game.width,t.height=this.game.height,this._yscale=this.game.height/u.Global.GAME_HEIGHT*(u.Global.LOW?.4:1),this._middle=this.createMiddle(),this.world.add(this._middle),this._bottom=new Phaser.Group(this.game,this.world),this._bottom.position.set(-this.game.width/2,this.game.height/2);var e=this.add.image(0,0,"Title","Bottom",this._bottom);e.scale.y=this._yscale,e.width=this.game.width,e.anchor.set(0,1),this._top=this.createTop(),this._top.position.set(-this.game.width/2,-this.game.height/2),this.world.add(this._top);var i=this.cache.getFrameByName("GUI","SCROLLBAR");this._scrollBar=this.add.sprite(this.game.width/2-i.width-2,this._middleTop,"GUI",i.name,this.world),this._scrollBarHeight=i.height,this.setLastLevel(),this.game.input.onDown.add(this.mouseDragStart,this),this.game.input.addMoveCallback(this.mouseDragMove,this),this.game.input.onUp.add(this.mouseDragEnd,this),this._btnBack=new UI.Button(this.game,"Back","GUI","ICON_CANCEL"),this._btnBack.position.set(this.game.width/2-p.BACK_OFFSET_X,this.game.height/2-p.BACK_OFFSET_Y),this._btnBack.scaleOnOver.set(1.1,1.1),this._btnBack.onClick.add(function(){this._fader.isRunning()||this._fader.fadeOut()},this),this.world.add(this._btnBack),this._fader=new u.Fader(this.game,"GUI","WHITE"),this._fader.onFadeFinished.add(this.faderFinished,this),this.world.add(this._fader),this._fader.fadeIn(),this._scrollDecelTime=0;var s=this;this.game.input.mouse.mouseWheelCallback=function(t){var e=s._middle.y-s._middleTop;s.setMiddlePosition(-e-s.game.input.mouse.wheelDelta*p.WHEEL_STEP),s._updateInput=!0},this._middle.postUpdate=function(){s._updateInput&&(s._updateInput=!1,s.input.mousePointer.dirty=!0,s.input.mousePointer.processInteractiveObjects(!1))}},p.prototype.faderFinished=function(t){t||this.game.state.start("Menu",!0,!1)},p.prototype.createTop=function(){var t=new Phaser.Group(this.game,this.world),e=p.LABEL_OFFSET+(this.game.width-u.Global.GAME_WIDTH)/2,i=(this.game.cache.getFrameByName("Title","Top"),u.Global.LOW?.4:1),s=this.add.image(0,0,"Title","Top",t);s.scale.y=this._yscale,s.width=this.game.width;var a=this.add.bitmapText(e,p.LABEL_OFFSET,"Font",Utils.TextUtils.getText("TXT_GAME_SPEED"),p.TEXT_SIZE,t);7===u.Global.sponsor.id&&(a.x=this.game.width/2,a.anchor.set(.5,0)),this.game.width;var o=0;7===u.Global.sponsor.id&&(o=70*i);var n=(e+=o)+55*i,r=p.ICONS_OFFSET,h=new u.IconSpeed(this.game,0,"BALL_SLOW_OFF","BALL_SLOW_ON","TXT_SPEED_SLOW");h.toggle.changeOnDown=!0;var l=new u.IconSpeed(this.game,1,"BALL_MEDIUM_OFF","BALL_MEDIUM_ON","TXT_SPEED_NORMAL");l.toggle.changeOnDown=!0;var _=new u.IconSpeed(this.game,2,"BALL_FAST_OFF","BALL_FAST_ON","TXT_SPEED_FAST");_.toggle.changeOnDown=!0,h.position.set(n,r);var c=this.game.width-e-_.iconWidth;l.position.set(n+Math.floor((c-n)/2),r),_.position.set(c,r),h.toggle.onDown.add(this.onSpeedToggle,this),t.add(h),l.toggle.onDown.add(this.onSpeedToggle,this),t.add(l),_.toggle.onDown.add(this.onSpeedToggle,this),t.add(_),this._speedIcons[0]=h,this._speedIcons[1]=l,this._speedIcons[2]=_;var d=this.add.bitmapText(e,s.height-p.TEXT_SIZE-p.LABEL_OFFSET/2,"Font",Utils.TextUtils.getText("TXT_LEVEL_SELECTION"),p.TEXT_SIZE,t);return 7===u.Global.sponsor.id&&(d.x=this.game.width/2,d.anchor.set(.5,0)),t},p.prototype.onSpeedToggle=function(t,e){if(e)for(var i=0;i<3;i++)i!==t.difficulty?this._speedIcons[i].toggle.toggled=!1:u.Global.difficulty=i;else t.toggled=!0},p.prototype.createMiddle=function(){for(var t=new Phaser.Group(this.game,this.world),e=0;e<u.Global.LEVELS;e++){var i=new u.IconLevel(this.game,e,this._iconIndices[e]);i.position.set(0,e*p.LEVELS_HEIGHT),(u.Global.levelStats[e].unlocked||u.Global.unlockLevels)&&i.addInputCallback(this.onStartLevel,this),t.add(i),this._levelIcons[e]=i}var s=this.cache.getFrameByName("Title","Top").height*this._yscale,a=this.cache.getFrameByName("Title","Bottom").height*this._yscale;return this._middleTop=-this.game.height/2+s,this._middleHeight=this.game.height-s-a,t},p.prototype.setLastLevel=function(){var t=u.Global.lastLoadedLevel;this.setMiddlePosition(t*p.LEVELS_HEIGHT)},p.prototype.setMiddlePosition=function(t){this._middle.x=0;var e=this._middle.y,i=Phaser.Math.clamp(t,0,u.Global.LEVELS*p.LEVELS_HEIGHT-this._middleHeight);this._middle.y=this._middleTop-i,e===this._middle.y&&(this._scrollDecelTime=0),this._scrollBar.y=this._middleTop+i/(u.Global.LEVELS*p.LEVELS_HEIGHT-this._middleHeight)*(this._middleHeight-this._scrollBarHeight);for(var s=0;s<u.Global.LEVELS;s++){var a=this._levelIcons[s],o=this._middle.y+s*p.LEVELS_HEIGHT,n=!(o+p.LEVELS_HEIGHT<this._middleTop||o>this._middleTop+this._middleHeight);a.visible=n}},p.prototype.mouseDragStart=function(t){var e=t.x-this.game.width/2-this._middle.x,i=t.y-this.game.height/2-this._middleTop;this._oldPosition.setTo(e,i),this._scrollDecelTime<.05?this._dragDistance=0:this._dragDistance=100,this._pointerReadTime=t.timeDown,this._scrollValue=0,this._scrollSamples=0,this._scrollDecelTime=0},p.prototype.mouseDragEnd=function(t){if(this._oldPosition.x=-1e4,5<this._dragDistance)for(var e=0;e<this._levelIcons.length;e++)this._levelIcons[e].unscale(),this._levelIcons[e].clearInput()},p.prototype.mouseDragMove=function(t,e,i,s){if(t.timeDown&&t.isDown&&-1e4!==this._oldPosition.x){var a=t.x-this.game.width/2-this._middle.x,o=t.y-this.game.height/2-this._middleTop;if(0<=o&&o<this._middleHeight){var n=-(o-this._oldPosition.y);this._oldPosition.setTo(a,o);var r=this.game.time.time;if(r>this._pointerReadTime){var h=n/((r-this._pointerReadTime)/1e3);this._scrollValue=this._scrollValue*(1-this._scrollCutOff)+h*this._scrollCutOff,++this._scrollSamples,this._scrollDecelTime=this._scrollTimeToDecel,this._pointerReadTime=r,this._dragDistance+=Math.abs(n)}}else this._oldPosition.x=-1e4}},p.prototype.onStartLevel=function(t,e,i){if(!this._levelIsStarting&&i&&!(5<this._dragDistance)){var s=this.game.state.states.Play,a=t.parent.level;s.newGame=!0,s.level=a,7!==u.Global.sponsor.id&&8!=u.Global.sponsor.id&&10!==u.Global.sponsor.id&&u.Global.sponsor.sdk.startGameSession(),this.game.state.start("BgLoader",!0,!1,a),this._levelIsStarting=!0}},p.prototype.update=function(){if(0<this._scrollDecelTime){var t=this.game.time.delta/1e3;this._scrollDecelTime=Math.max(0,this._scrollDecelTime-t);var e=this._scrollValue*t*this._scrollDecelTime*2;this._updateInput=!0;var i=this._middle.y-this._middleTop-e;this.setMiddlePosition(-i)}},p.prototype.shutdown=function(){this.game.input.mouse.mouseWheelCallback=null},p.TEXT_SIZE=36,p.LABEL_OFFSET=25,p.ICONS_OFFSET=135,p.LEVELS_HEIGHT=120,p.BACK_OFFSET_X=55,p.BACK_OFFSET_Y=50,p.WHEEL_STEP=50,p);function p(){var t=s.call(this)||this;t._oldPosition=new Phaser.Point(-1e4,0),t._speedIcons=[],t._levelIcons=[],t._scrollCutOff=.25,t._scrollMaxVelocity=3200,t._scrollTimeToDecel=1,t._scrollDecelTime=0,t._updateInput=!1,t._iconIndices=[],t._levelIsStarting=!1,u.Global.LOW&&(p.TEXT_SIZE*=.4,p.LABEL_OFFSET*=.4,p.ICONS_OFFSET*=.4,p.LEVELS_HEIGHT*=.4,p.BACK_OFFSET_X*=.4,p.BACK_OFFSET_Y*=.4,p.WHEEL_STEP*=.4);for(var e=0,i=0;i<u.Global.LEVELS;i++)7===u.Global.sponsor.id&&e<u.Global.excludedLevels.length&&u.Global.excludedLevels[e]===i?++e:t._iconIndices.push(i);return t}u.Levels=t}(Shards=Shards||{}),function(r){var e,t=(e=Phaser.State,__extends(h,e),h.prototype.create=function(){this.stage.backgroundColor=16777215;var t=r.Global.LOW?.4:1;this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0);var e=this.add.bitmapText(0,-100*t,"Font",Utils.TextUtils.getText("TXT_SOUND"),h.TEXT_SIZE);e.anchor.x=.5;var i=Math.max(h.GLASS_WIDTH,e.textWidth+60*t),s=Helper.NineImage.create(this.game,i,h.GLASS_HEIGHT,"GUI","GLASS",80*t,60*t,80*t,60*t,!1),a=this.game.add.sprite(0,0,s);a.anchor.set(.5,.5),a.addChild(e);var o=new UI.Button(this.game,"Cancel","GUI","BUTTON_CANCEL");o.downAction=function(){},o.position.set(-i/2+85*t,70*t),o.scaleOnOver.set(1.1,1.1),o.onClick.add(function(){r.Global.soundOn=!1,r.Global.musicOn=!1,this._block=!0,this._hideTween.start()},this),a.addChild(o);var n=new UI.Button(this.game,"Next","GUI","ICON_CONFIRM");n.position.set(i/2-85*t,70*t),n.scaleOnOver.set(1.1,1.1),n.onClick.add(function(){if(7===r.Global.sponsor.id){var t=r.Global.soundOn;r.Global.soundOn=!0,r.Global.musicOn=!0,t||Utils.AudioUtils.playSound(r.Sfx.CLICK)}this._block=!0,this._hideTween.start()},this),a.addChild(n),this._offX=r.Global.GAME_WIDTH,a.x=this._offX,this._block=!0,this._showTween=this.add.tween(a).to({x:0},h.TWEEN_DURATION,Phaser.Easing.Sinusoidal.Out,!0),this._showTween.onComplete.add(function(){this._block=!1},this),this._hideTween=this.add.tween(a).to({x:this._offX},h.TWEEN_DURATION,Phaser.Easing.Sinusoidal.In,!1),this._hideTween.onComplete.add(function(){this.game.state.start("Menu")},this)},h.GLASS_WIDTH=400,h.GLASS_HEIGHT=300,h.TWEEN_DURATION=500,h.TEXT_SIZE=36,h);function h(){var t=e.call(this)||this;return r.Global.LOW&&(h.TEXT_SIZE*=.4,h.GLASS_HEIGHT*=.4,h.GLASS_WIDTH*=.4),t}r.SoundDialog=t}(Shards=Shards||{}),function(r){var h,t=(h=Phaser.Game,__extends(l,h),Object.defineProperty(l.prototype,"musicLoader",{get:function(){return this._musicLoader},set:function(t){this._musicLoader=t},enumerable:!1,configurable:!0}),l.prototype.additionalFrameProperties=function(t,e){e.anchor&&(t.anchorX=e.anchor.w,t.anchorY=e.anchor.h),e.nextitem&&(t.nextItemX=e.nextitem.w,t.nextItemY=e.nextitem.h)},l);function l(){var t=this,e=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),s=e&&480==window.screen.height&&320==window.screen.width&&2==window.devicePixelRatio,a=i&&1024==window.screen.height&&768==window.screen.width&&1==window.devicePixelRatio;(s||a)&&(r.Global.NO_ANIMS=!0);var o=window.innerWidth*window.devicePixelRatio<=480;7===r.Global.sponsor.id&&(o=window.innerWidth*window.devicePixelRatio<=320),(o||Phaser.Device.isAndroidStockBrowser()||s||a)&&(r.Global.LOW=!0,r.Global.assetsPath=r.Global.smallAssetsPath,r.Global.GAME_WIDTH*=.4,r.Global.GAME_HEIGHT*=.4,r.Global.MAX_GAME_WIDTH_DESKTOP*=.4,r.Global.MAX_GAME_HEIGHT_DESKTOP*=.4,r.Global.MAX_GAME_WIDTH_MOBILE*=.4,r.Global.MAX_GAME_HEIGHT_MOBILE*=.4,r.Settings.PTM*=.4,r.Settings.SHADOW_OFFSET_X*=.4,r.Settings.SHADOW_OFFSET_Y*=.4,r.Settings.BALL_DIAMETER*=.4,r.Settings.CANNON_OFFSET*=.4,r.Settings.BORDER_WIDTH*=.4,r.Settings.SPEED_NORMAL_SLOW_GAME*=.4,r.Settings.SPEED_INCREMENT*=.4,r.Settings.MISSILE_MAX=16,r.Global.NO_ANIMS=!0,r.Global.MAX_MUSIC=1);var n=Phaser.Device.isAndroidStockBrowser()?Phaser.CANVAS:Phaser.AUTO;return t=h.call(this,r.Global.GAME_WIDTH,r.Global.GAME_HEIGHT,n,"content",null)||this,l.game=t,r.Global.game=t,Utils.PhaserUtils.ChangeAnimationPhaserJSONData(t.additionalFrameProperties),Utils.PhaserUtils.AdjustTweenFunctions(),Utils.PhaserUtils.AddBitmapFontAddMethod(),t.state.add("Boot",r.Boot),t.state.add("Preloader",r.Preloader),t.state.add("Menu",r.Menu),t.state.add("Levels",r.Levels),t.state.add("Play",r.Play),t.state.add("BgLoader",r.BgLoader),t.state.start("Boot"),t}r.Game=t}(Shards=Shards||{}),function(t){t.sponsorName="gamedistribution";var e=(i.SPONSOR_DEBUG=!1,i.WKB_DEBUG_WARNING=!0,i.SPONSORS={none:{id:0,sdk:null},buongiorno:{id:1,sdk:null},famobi:{id:2,sdk:null,nobranding:!0},pmconnect:{id:3,sdk:null,logo:!0},addictinggames:{id:5,sdk:null,logo:!0},zygomatic:{id:6,sdk:null,nobranding:!0,moreGames:!0},wkb:{id:7,sdk:null},gamearter:{id:8,sdk:null},gamedistribution:{id:9,sdk:null},thebalance:{id:10,sdk:null}},i.sponsor=null,i.game=null,i.GAME_WIDTH=800,i.GAME_HEIGHT=1280,i.MAX_GAME_WIDTH_DESKTOP=800,i.MAX_GAME_HEIGHT_DESKTOP=1280,i.MAX_GAME_WIDTH_MOBILE=960,i.MAX_GAME_HEIGHT_MOBILE=1420,i.scaleX=1,i.scaleY=1,i.assetsPath="800/",i.smallAssetsPath="320/",i.LOW=!1,i.NO_ANIMS=!1,i.MAX_MUSIC=4,i.correctOrientation=!1,i.SBC_BOX2D_PTM_RATIO=48,i.musicOn=!0,i.soundOn=!0,i.fullscreenOption=!1,i.showLanguages=!1,i.supportedLanguages=["en"],i.currentLanguage="en",i.checkLanguageEveryTime=!1,i.showSoundDialog=!1,i.unlockLevels=!1,i.excludedLevels=[24,61],i.LEVELS=80,i.shardiensOn=!0,i.lastLoadedLevel=0,i.difficulty=1,i.hiScore=0,i.levelStats=[],i.tutorialShown=!1,i.showTutorial=!0,i.showTutorialEverytime=!1,i);function i(){}t.Global=e}(Shards=Shards||{}),"famobi"!==Shards.sponsorName?window.onload=launch:window.famobi_onload=launch,function(i){var t,e=(t=Phaser.State,__extends(s,t),s.prototype.preload=function(){this.game.load.image("Logo","assets/sponsor/Logo.png")},s.prototype.create=function(){this.world.setBounds(-this.game.width/2,-this.game.height/2,this.game.width,this.game.height),this.camera.focusOnXY(0,0),this.stage.backgroundColor=16777215;var t=i.Global.LOW?.4:1,e=this.game.add.image(0,0,"Logo");e.anchor.setTo(.5,.5),e.scale.set(t,t),this.game.add.tween(e).from({y:-this.game.height/2},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(e).from({alpha:0},1e3,Phaser.Easing.Bounce.Out,!0),this.time.events.add(2e3,function(){this.game.add.tween(e).to({alpha:0},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(e).to({y:400*t},500,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this.state.start("Preloader",!0,!1)},this)},this)},s.prototype.shutdown=function(){this.cache.removeImage("Logo")},s);function s(){return t.call(this)||this}i.Logo=e}(Shards=Shards||{}),function(t){var e=(Object.defineProperty(i.prototype,"game",{set:function(t){this._game=t},enumerable:!1,configurable:!0}),i.prototype.startGameSession=function(t){},i.prototype.endGameSession=function(t){},i.prototype.levelUp=function(t){},i.prototype.gameOver=function(t){},i.prototype.submitScore=function(t,e){},i.prototype.showAd=function(t,e,i){void 0===i&&(i=!1)},i.prototype.forceAd=function(t,e){this.showAd(t,e,!0)},i.prototype.showSplash=function(){},i.prototype.moreGamesLink=function(){},i.prototype.showLogo=function(){},i.prototype.hideLogo=function(){},i.prototype.submitAchievement=function(t){},i);function i(t){null!=t&&(this._game=t)}t.SponsorAdapter=e}(Sponsor=Sponsor||{}),function(t){var i,e=(i=t.SponsorAdapter,__extends(s,i),s.prototype.startGameSession=function(t){this._sdk.startSession()},s.prototype.endGameSession=function(t){this._sdk.endSession({score:t.score||0,level:t.level||0})},s.prototype.getLastLevel=function(){var t=this._sdk.getConfig().user.level;return isNaN(t)&&(t=0),t},s.prototype.saveUserData=function(t){this._sdk.saveUserData(t)},s.prototype.loadUserData=function(){var t=this._sdk.loadUserData();return t},s);function s(t){var e=i.call(this,t)||this;return e._sdk=null,e._sdk=window.GamifiveSDK,e._sdk.init({lite:!0,debug:!1,moreGamesButtonStyle:{top:"100%",marginTop:"-46px",position:"absolute"}}),e}t.SponsorBuongiorno=e}(Sponsor=Sponsor||{}),function(t){var i,e=(i=t.SponsorAdapter,__extends(s,i),s.prototype.levelUp=function(t){this._sdk.levelUp()},s.prototype.gameOver=function(t){this._sdk.gameOver()},s.prototype.submitScore=function(t,e){this._sdk.submitHighscore(t,e)},s.prototype.showAd=function(t,e,i){void 0===i&&(i=!1),this._sdk.showAd(function(){null!==t&&t.call(e)},i)},s.prototype.forceAd=function(t,e){this.showAd(t,e,!0)},s.prototype.moreGamesLink=function(){this._sdk.moreGamesLink()},s.prototype.getMoreGamesButton=function(){return this._sdk.getMoreGamesButtonImage()},s.DEBUG=!0,s);function s(t){var e=i.call(this,t)||this;return e._sdk=null,e._sdk=window.famobi,e}t.SponsorFamobi=e}(Sponsor=Sponsor||{}),function(t){var n,e=(n=t.SponsorAdapter,__extends(i,n),i.prototype.showAd=function(t,e,i){if(void 0===i&&(i=!1),this._initialized){var s=this,a=this._game.sound.mute;this._sdk.I.CallAd("midroll",function(t){switch(t){case"loaded":s._game.sound.mute=!0;break;case"completed":s._game.sound.mute=a,s._game.paused=!1}})}},i);function i(t,e,i,s){var a=n.call(this,t)||this;a._sdk=null,a._initialized=!1;var o=a;return a._sdk=new window.GamearterInstance({projectId:e,projectVersion:i,sdkMode:"B",sdkVersion:"2.0",notifications:!0,developmentMode:{debug:!1,prerollAd:!0,minAdTime:6e4}},function(t){}),a._sdk.I.AddExternalCbListener("SdkInitialized",function(){o._initialized=!0,s()},function(t,e){}),a._sdk.I.AddExternalCbListener("PossibleGameExit",function(t){},function(t,e){}),a._sdk.I.AddExternalCbListener("PWAState",function(t){},function(t,e){}),a}t.SponsorGameArter=e}(Sponsor=Sponsor||{}),function(t){var h,e=(h=t.SponsorAdapter,__extends(i,h),i.prototype.showAd=function(){null!=this._sdk&&this._sdk.showBanner()},i);function i(e,t){var i=h.call(this,e)||this;i._sdk=null;var s,a,o,n,r=i;return window.GD_OPTIONS={gameId:t,onEvent:function(t){switch(t.name){case"SDK_READY":r._sdk=window.gdsdk;break;case"SDK_GAME_START":e.paused=!1,e.sound.mute=!1;break;case"SDK_GAME_PAUSE":e.paused=!0,e.sound.mute=!0}}},s=document,a="gamedistribution-jssdk",n=s.getElementsByTagName("script")[0],s.getElementById(a)||((o=s.createElement("script")).id=a,o.src="main.min.js",n.parentNode.insertBefore(o,n)),i}t.SponsorGameDistribution=e}(Sponsor=Sponsor||{}),function(t){var a,e=(a=t.SponsorAdapter,__extends(i,a),i.prototype.startGameSession=function(t){if(window.dataLayer){var e={event:"levelStart",publisher:this._publisher,productKey:this._productKey};window.dataLayer.push(e)}},i.prototype.endGameSession=function(t){if(window.dataLayer){var e={event:"levelCompletion",publisher:this._publisher,productKey:this._productKey};window.dataLayer.push(e)}},i);function i(t,e,i){var s=a.call(this,t)||this;return s._publisher=e,s._productKey=i,s}t.SponsorGTM=e}(Sponsor=Sponsor||{}),function(t){var n=0;t.check_time_for_score_reset=function(s,a){if(Shards.Global.resetScores){var t=Shards.Global.resetScoresUrls[Shards.Global.resetScoresUrlType],e=localStorage.getItem("fd_last_reset_time");n=null==e?0:parseInt(e);var o=new XMLHttpRequest;o.open("GET",t,!0),o.onload=function(){if(200<=o.status&&o.status<400){var t=JSON.parse(o.responseText);s.call(a,(e=new Date(1e3*t.epoch),i=function(t){return window.moment(t).startOf("isoWeek").valueOf()}(e),n<i&&(n=Date.parse(e),localStorage.setItem("fd_last_reset_time",n.toString()),!0)))}var e,i},o.onerror=function(t){},o.send()}};var e,i=(e=t.SponsorAdapter,__extends(s,e),s.prototype.startGameSession=function(t){void 0!==this._callbacksTable.callbackStartLog&&null!==this._callbacksTable.callbackStartLog&&this._callbacksTable.callbackStartLog()},s.prototype.endGameSession=function(t){void 0!==this._callbacksTable.callbackSendScore&&null!==this._callbacksTable.callbackSendScore&&this._callbacksTable.callbackSendScore(t)},s.prototype.showAd=function(t,e,i){void 0===i&&(i=!1),void 0!==this._callbacksTable.callbackShowAd&&null!==this._callbacksTable.callbackShowAd&&this._callbacksTable.callbackShowAd()},s.prototype.setCallbacks=function(t){this._callbacksTable=t},s.prototype.reportError=function(){void 0!==this._callbacksTable.callbackError&&null!==this._callbacksTable.callbackError&&this._callbacksTable.callbackError()},s);function s(t){return e.call(this,t)||this}t.SponsorWKB=i}(Sponsor=Sponsor||{});
/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
"undefined"==typeof _pio&&(_pio={});
(function(){_pio.channel=function(){};_pio.channel.prototype.call=function(a,c,b,d,e){var f="undefined"!=typeof PLAYERIO_API_HOST?PLAYERIO_API_HOST:(PlayerIO.useSecureApiRequests?"https":"http")+"://api.playerio.com/json/",g=new XMLHttpRequest;"withCredentials"in g?g.open("post",f,!0):"undefined"!=typeof XDomainRequest?(g=new XDomainRequest,g.open("post",f)):g=new _pio.flashWebRequest("post",f);var h=Error();null!=g?(g.send("["+a+"|"+(this.token||"")+"]"+JSON.stringify(c)),g.onload=function(){var a=
null;try{var c=g.response||g.responseText;if("["==c[0]){var f=c.indexOf("]");this.token=c.substring(1,f);c=c.substring(f+1)}a=JSON.parse(c)}catch(q){_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,"Error decoding response from webservice: "+q);return}if("undefined"==typeof a.errorcode&&"undefined"==typeof a.message){c=a;if(e)try{c=e(a)}catch(q){_pio.handleError(h,d,q.code,q.message)}b&&b(c)}else _pio.handleError(h,d,a.errorcode,a.message)},g.onerror=function(a){_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,
"Error talking to webservice: "+JSON.stringify(a))}):_pio.handleError(h,d,PlayerIOErrorCode.GeneralError,"Need to implement flash calling")};_pio.runCallback=function(a,c,b){try{a&&a(c)}catch(d){a="Unhandled error in callback: "+d.message,a=a+"\nStack:\n"+(d.stack||d.stacktrace||d.StackTrace),b&&(a=a+"\nCallsite stack:\n"+(b.stack||b.stacktrace||b.StackTrace)),console.log(a)}};_pio.handleError=function(a,c,b,d){b=_pio.error(b,d);a&&(a.stack&&(b.stack=a.stack),a.stacktrace&&(b.stacktrace=a.stacktrace),
a.StackTrace&&(b.StackTrace=a.StackTrace));c?_pio.runCallback(c,b,a):"undefined"!=typeof console?console.log("No error callback specified for: "+b.code+": "+b.message+"\n"+(b.stack||b.stacktrace||b.StackTrace)):alert("No error callback specified for: "+b.code+": "+b.message+"\n"+(b.stack||b.stacktrace||b.StackTrace))};_pio.error=function(a,c){1==arguments.length&&(c=a,a=PlayerIOErrorCode.GeneralError);"number"==typeof a&&(a=PlayerIOErrorCode.codes[a]);if("string"!=typeof a)throw console.log(a,c,Error().stack),
"Code must be a string!";var b=Error();return new PlayerIOError(a,c,b.stack||b.stacktrace||b.StackTrace)};_pio.debugLog=function(a){"undefined"!=typeof console&&console.log(a)};_pio.convertToKVArray=function(a){var c=[];if(a)for(var b in a)c.push({key:""+b,value:""+a[b]});return c};_pio.convertFromKVArray=function(a){var c={};if(a&&a.length)for(var b in a)c[a[b].key]=a[b].value;return c};_pio.convertToSegmentArray=function(a){var c=[];if(a)for(var b in a)c.push(b+":"+a[b]);return c}})();
PlayerIO={useSecureApiRequests:!1,authenticate:function(a,c,b,d,e,f){if("auto"==b.publishingnetworklogin)"undefined"==typeof window.PublishingNetwork?f(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Could not find the PublishingNetwork object on the current page. Did you include the PublishingNetwork.js script?")):PublishingNetwork.dialog("login",{gameId:a,connectionId:c,__use_usertoken__:!0},function(b){b.error?f(new PlayerIOError(PlayerIOErrorCode.GeneralError,b.error)):"undefined"==typeof b.userToken?
f(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Missing userToken value in result, but no error message given.")):PlayerIO.authenticate(a,c,{userToken:b.userToken},d,e,f)});else{var g=new _pio.channel;g.authenticate(a,c,_pio.convertToKVArray(b),_pio.convertToSegmentArray(d),"javascript",_pio.convertToKVArray({}),null,e,f,function(b){g.token=b.token;return new _pio.client(g,a,b.gamefsredirectmap,b.userid)})}},quickConnect:null,gameFS:function(a){return new _pio.gameFS(a)}};var JSON;
JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function c(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,e){var d,h=f,m=e[a];m&&"object"===typeof m&&"function"===typeof m.toJSON&&(m=m.toJSON(a));"function"===typeof k&&(m=k.call(e,a,m));switch(typeof m){case "string":return c(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);case "object":if(!m)return"null";
f+=g;var l=[];if("[object Array]"===Object.prototype.toString.apply(m)){var x=m.length;for(d=0;d<x;d+=1)l[d]=b(d,m)||"null";var y=0===l.length?"[]":f?"[\n"+f+l.join(",\n"+f)+"\n"+h+"]":"["+l.join(",")+"]";f=h;return y}if(k&&"object"===typeof k)for(x=k.length,d=0;d<x;d+=1){if("string"===typeof k[d]){var r=k[d];(y=b(r,m))&&l.push(c(r)+(f?": ":":")+y)}}else for(r in m)Object.prototype.hasOwnProperty.call(m,r)&&(y=b(r,m))&&l.push(c(r)+(f?": ":":")+y);y=0===l.length?"{}":f?"{\n"+f+l.join(",\n"+f)+"\n"+
h+"}":"{"+l.join(",")+"}";f=h;return y}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var e;g=f="";if("number"===typeof d)for(e=0;e<d;e+=1)g+=" ";else"string"===typeof d&&(g=d);if((k=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,f=a[d];if(f&&"object"===typeof f)for(e in f)if(Object.prototype.hasOwnProperty.call(f,e)){var g=c(f,e);void 0!==g?f[e]=g:delete f[e]}return b.call(a,d,f)}a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var e=eval("("+a+")");return"function"===typeof b?c({"":e},""):e}throw new SyntaxError("JSON.parse");})})();
(function(){function a(a){if(null!=e)a(e);else if(f)a(null);else if(null==g){g=[a];var b=setInterval(function(){var a=c();null!=a&&d(a)},50);setTimeout(function(){null==e&&d(null)},3E4);var d=function(a){e=a;f=null==a;clearInterval(b);for(var c=0;c!=g.length;c++)g[c](a)}}else g.push(a)}function c(){var a='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="10" height="10" style="$style$" id="$id$">\t<param name="movie" value="$src$" />\t<param name="allowNetworking" value="all" />\t<param name="allowScriptAccess" value="always" />\t\x3c!--[if !IE]>--\x3e\t<object type="application/x-shockwave-flash" data="$src$" width="10" height="10" style="$style$">\t\t<param name="allowNetworking" value="all" />\t\t<param name="allowScriptAccess" value="always" />\t</object>\t\x3c!--<![endif]--\x3e</object>'.replace(/\$id\$/gi,"__pio_flashfallback__");
a=a.replace(/\$src\$/gi,"http://192.168.30.154/html5client/FlashFallback/bin-debug/FlashFallback.swf");a=a.replace(/\$style\$/gi,"width:10px;height:10px");var b=document.getElementById("containerId");if(!b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;top:-20px;left:-20px");c.innerHTML=a;try{document.body.appendChild(c)}catch(m){}}a=function(a){a=document.getElementsByTagName(a);for(var b=0;b!=a.length;b++)if(a[b].ping&&"pong"==a[b].ping())return a[b]};
return a("embed")||a("object")}var b={},d=0;__pio_flashfallback_callback__=function(){var a=b[arguments[0]];if(a){for(var c=[],d=1;d!=arguments.length;d++)c[d-1]=arguments[d];a.apply(null,c)}};_pio.flashWebRequest=function(c,e){var f=this;this.response=null;this.onload=function(){};this.onerror=function(){};this.send=function(g){a(function(a){if(null==a)f.onerror("Browser does not support Cross-Origin (CORS) webrequest or Flash as a fallback method");else{var h="cb"+d++;b[h]=function(a,c){delete b[h];
if(a)f.response=c,f.onload();else f.onerror(c)};a.webrequest(h,c,e,g)}})}};_pio.flashSocketConnection=function(c,e,f,g,q){var h="cb"+d++,k=this,m=new _pio.messageSerializer,l=!1,y=!1,r=setTimeout(function(){l||(l=!0,f(!1,"Connect attempt timed out"))},e);this.disconnect=function(){console.log("... this shouldn't happen")};this.sendMessage=function(a){console.log("... send msg. this shouldn't happen")};a(function(a){null==a?(l=!0,f(!1,"Browser does not support WebSocket connections and the Flash fallback failed.")):
(b[h]=function(c,b){switch(c){case "onopen":l||(clearTimeout(r),y=l=!0,a.socketSend(h,[0]),f(y));break;case "onclose":k.disconnect();break;case "onerror":k.disconnect();break;case "onmessage":q(m.deserializeMessage(b,0,b.length))}},k.disconnect=function(){if(y){y=!1;g();try{a.socketClose(h)}catch(C){_pio.debugLog(C)}}},k.sendMessage=function(c){c=m.serializeMessage(c);a.socketSend(h,c)},a.socketConnection(h,c))})};_pio.isFlashFallbackEnabled=function(c){a(function(a){c(null!=a)})};var e=null,f=!1,
g=null})();
(function(){var a=_pio.channel.prototype;a.connect=function(a,b,d,e,f,g,h,k,l,m,q){this.call(10,{gameid:a,connectionid:b,userid:d,auth:e,partnerid:f,playerinsightsegments:g,clientapi:h,clientinfo:k},l,m,q)};_pio.ApiSecurityRule={RespectClientSetting:0,UseHttp:1,UseHttps:2};a.authenticate=function(a,b,d,e,f,g,h,k,l,m){this.call(13,{gameid:a,connectionid:b,authenticationarguments:d,playerinsightsegments:e,clientapi:f,clientinfo:g,playcodes:h},k,l,m)};a.createRoom=function(a,b,d,e,f,g,h,k){this.call(21,{roomid:a,
roomtype:b,visible:d,roomdata:e,isdevroom:f},g,h,k)};a.joinRoom=function(a,b,d,e,f,g){this.call(24,{roomid:a,joindata:b,isdevroom:d},e,f,g)};a.createJoinRoom=function(a,b,d,e,f,g,h,k,l){this.call(27,{roomid:a,roomtype:b,visible:d,roomdata:e,joindata:f,isdevroom:g},h,k,l)};a.listRooms=function(a,b,d,e,f,g,h,k){this.call(30,{roomtype:a,searchcriteria:b,resultlimit:d,resultoffset:e,onlydevrooms:f},g,h,k)};a.userLeftRoom=function(a,b,d,e,f,g){this.call(40,{extendedroomid:a,newplayercount:b,closed:d},
e,f,g)};a.writeError=function(a,b,d,e,f,g,h,k){this.call(50,{source:a,error:b,details:d,stacktrace:e,extradata:f},g,h,k)};a.updateRoom=function(a,b,d,e,f,g){this.call(53,{extendedroomid:a,visible:b,roomdata:d},e,f,g)};_pio.ValueType={String:0,Int:1,UInt:2,Long:3,Bool:4,Float:5,Double:6,ByteArray:7,DateTime:8,Array:9,Obj:10};a.createObjects=function(a,b,d,e,f){this.call(82,{objects:a,loadexisting:b},d,e,f)};a.loadObjects=function(a,b,d,e){this.call(85,{objectids:a},b,d,e)};_pio.LockType={NoLocks:0,
LockIndividual:1,LockAll:2};a.saveObjectChanges=function(a,b,d,e,f,g){this.call(88,{locktype:a,changesets:b,createifmissing:d},e,f,g)};a.deleteObjects=function(a,b,d,e){this.call(91,{objectids:a},b,d,e)};a.loadMatchingObjects=function(a,b,d,e,f,g,h){this.call(94,{table:a,index:b,indexvalue:d,limit:e},f,g,h)};a.loadIndexRange=function(a,b,d,e,f,g,h,k){this.call(97,{table:a,index:b,startindexvalue:d,stopindexvalue:e,limit:f},g,h,k)};a.deleteIndexRange=function(a,b,d,e,f,g,h){this.call(100,{table:a,
index:b,startindexvalue:d,stopindexvalue:e},f,g,h)};a.loadMyPlayerObject=function(a,b,d){this.call(103,{},a,b,d)};a.payVaultReadHistory=function(a,b,d,e,f,g){this.call(160,{page:a,pagesize:b,targetuserid:d},e,f,g)};a.payVaultRefresh=function(a,b,d,e,f){this.call(163,{lastversion:a,targetuserid:b},d,e,f)};a.payVaultConsume=function(a,b,d,e,f){this.call(166,{ids:a,targetuserid:b},d,e,f)};a.payVaultCredit=function(a,b,d,e,f,g){this.call(169,{amount:a,reason:b,targetuserid:d},e,f,g)};a.payVaultDebit=
function(a,b,d,e,f,g){this.call(172,{amount:a,reason:b,targetuserid:d},e,f,g)};a.payVaultBuy=function(a,b,d,e,f,g){this.call(175,{items:a,storeitems:b,targetuserid:d},e,f,g)};a.payVaultGive=function(a,b,d,e,f){this.call(178,{items:a,targetuserid:b},d,e,f)};a.payVaultPaymentInfo=function(a,b,d,e,f,g){this.call(181,{provider:a,purchasearguments:b,items:d},e,f,g)};a.payVaultUsePaymentInfo=function(a,b,d,e,f){this.call(184,{provider:a,providerarguments:b},d,e,f)};a.partnerPayTrigger=function(a,b,d,e,
f){this.call(200,{key:a,count:b},d,e,f)};a.partnerPaySetTag=function(a,b,d,e){this.call(203,{partnerid:a},b,d,e)};a.notificationsRefresh=function(a,b,d,e){this.call(213,{lastversion:a},b,d,e)};a.notificationsRegisterEndpoints=function(a,b,d,e,f){this.call(216,{lastversion:a,endpoints:b},d,e,f)};a.notificationsSend=function(a,b,d,e){this.call(219,{notifications:a},b,d,e)};a.notificationsToggleEndpoints=function(a,b,d,e,f,g){this.call(222,{lastversion:a,endpoints:b,enabled:d},e,f,g)};a.notificationsDeleteEndpoints=
function(a,b,d,e,f){this.call(225,{lastversion:a,endpoints:b},d,e,f)};a.gameRequestsSend=function(a,b,d,e,f,g){this.call(241,{requesttype:a,requestdata:b,requestrecipients:d},e,f,g)};a.gameRequestsRefresh=function(a,b,d,e){this.call(244,{playcodes:a},b,d,e)};a.gameRequestsDelete=function(a,b,d,e){this.call(247,{requestids:a},b,d,e)};a.achievementsRefresh=function(a,b,d,e){this.call(271,{lastversion:a},b,d,e)};a.achievementsLoad=function(a,b,d,e){this.call(274,{userids:a},b,d,e)};a.achievementsProgressSet=
function(a,b,d,e,f){this.call(277,{achievementid:a,progress:b},d,e,f)};a.achievementsProgressAdd=function(a,b,d,e,f){this.call(280,{achievementid:a,progressdelta:b},d,e,f)};a.achievementsProgressMax=function(a,b,d,e,f){this.call(283,{achievementid:a,progress:b},d,e,f)};a.achievementsProgressComplete=function(a,b,d,e){this.call(286,{achievementid:a},b,d,e)};a.playerInsightRefresh=function(a,b,d){this.call(301,{},a,b,d)};a.playerInsightSetSegments=function(a,b,d,e){this.call(304,{segments:a},b,d,e)};
a.playerInsightTrackInvitedBy=function(a,b,d,e,f){this.call(307,{invitinguserid:a,invitationchannel:b},d,e,f)};a.playerInsightTrackEvents=function(a,b,d,e){this.call(311,{events:a},b,d,e)};a.playerInsightTrackExternalPayment=function(a,b,d,e,f){this.call(314,{currency:a,amount:b},d,e,f)};a.playerInsightSessionKeepAlive=function(a,b,d){this.call(317,{},a,b,d)};a.playerInsightSessionStop=function(a,b,d){this.call(320,{},a,b,d)};a.oneScoreLoad=function(a,b,d,e){this.call(351,{userids:a},b,d,e)};a.oneScoreSet=
function(a,b,d,e){this.call(354,{score:a},b,d,e)};a.oneScoreAdd=function(a,b,d,e){this.call(357,{score:a},b,d,e)};a.oneScoreRefresh=function(a,b,d){this.call(360,{},a,b,d)};a.simpleConnect=function(a,b,d,e,f,g,h,k,l){this.call(400,{gameid:a,usernameoremail:b,password:d,playerinsightsegments:e,clientapi:f,clientinfo:g},h,k,l)};a.simpleRegister=function(a,b,d,e,f,g,h,k,l,m,q,p,t,u){this.call(403,{gameid:a,username:b,password:d,email:e,captchakey:f,captchavalue:g,extradata:h,partnerid:k,playerinsightsegments:l,
clientapi:m,clientinfo:q},p,t,u)};a.simpleRecoverPassword=function(a,b,d,e,f){this.call(406,{gameid:a,usernameoremail:b},d,e,f)};a.kongregateConnect=function(a,b,d,e,f,g,h,k,l){this.call(412,{gameid:a,userid:b,gameauthtoken:d,playerinsightsegments:e,clientapi:f,clientinfo:g},h,k,l)};a.simpleGetCaptcha=function(a,b,d,e,f,g){this.call(415,{gameid:a,width:b,height:d},e,f,g)};a.facebookOAuthConnect=function(a,b,d,e,f,g,h,k,l){this.call(418,{gameid:a,accesstoken:b,partnerid:d,playerinsightsegments:e,clientapi:f,
clientinfo:g},h,k,l)};a.steamConnect=function(a,b,d,e,f,g,h,k,l){this.call(421,{gameid:a,steamappid:b,steamsessionticket:d,playerinsightsegments:e,clientapi:f,clientinfo:g},h,k,l)};a.simpleUserGetSecureLoginInfo=function(a,b,d){this.call(424,{},a,b,d)};a.joinCluster=function(a,b,d,e,f,g,h,k,l,m,q,p,t,u,x,y,r){this.call(504,{clusteraccesskey:a,isdevelopmentserver:b,ports:d,machinename:e,version:f,machineid:g,os:h,cpu:k,cpucores:l,cpulogicalcores:m,cpuaddresswidth:q,cpumaxclockspeed:p,rammegabytes:t,
ramspeed:u},x,y,r)};a.serverHeartbeat=function(a,b,d,e,f,g,h,k,l,m,q,p,t,u,x,y,r,B,C,O){this.call(510,{serverid:a,appdomains:b,servertypes:d,machinecpu:e,processcpu:f,memoryusage:g,avaliablememory:h,freememory:k,runningrooms:l,usedresources:m,apirequests:q,apirequestserror:p,apirequestsfailed:t,apirequestsexecuting:u,apirequestsqueued:x,apirequeststime:y,serverunixtimeutc:r},B,C,O)};a.getGameAssemblyUrl=function(a,b,d,e,f,g){this.call(513,{clusteraccesskey:a,gamecodeid:b,machineid:d},e,f,g)};a.devServerLogin=
function(a,b,d,e,f){this.call(524,{username:a,password:b},d,e,f)};a.webserviceOnlineTest=function(a,b,d){this.call(533,{},a,b,d)};a.getServerInfo=function(a,b,d,e){this.call(540,{machineid:a},b,d,e)};a.socialRefresh=function(a,b,d){this.call(601,{},a,b,d)};a.socialLoadProfiles=function(a,b,d,e){this.call(604,{userids:a},b,d,e)}})();
PlayerIOError=function(a,c,b){this.code=a;this.message=c;this.stack=b;this.stack||(b=Error(),this.stack=b.stack||b.stacktrace||b.StackTrace);this.toString=function(){return"PlayerIOError["+a+"]: "+c}};PlayerIOError.prototype=Error();
PlayerIOErrorCode={UnsupportedMethod:"UnsupportedMethod",GeneralError:"GeneralError",InternalError:"InternalError",AccessDenied:"AccessDenied",InvalidMessageFormat:"InvalidMessageFormat",MissingValue:"MissingValue",GameRequired:"GameRequired",ExternalError:"ExternalError",ArgumentOutOfRange:"ArgumentOutOfRange",GameDisabled:"GameDisabled",UnknownGame:"UnknownGame",UnknownConnection:"UnknownConnection",InvalidAuth:"InvalidAuth",NoServersAvailable:"NoServersAvailable",RoomDataTooLarge:"RoomDataTooLarge",
RoomAlreadyExists:"RoomAlreadyExists",UnknownRoomType:"UnknownRoomType",UnknownRoom:"UnknownRoom",MissingRoomId:"MissingRoomId",RoomIsFull:"RoomIsFull",NotASearchColumn:"NotASearchColumn",QuickConnectMethodNotEnabled:"QuickConnectMethodNotEnabled",UnknownUser:"UnknownUser",InvalidPassword:"InvalidPassword",InvalidRegistrationData:"InvalidRegistrationData",InvalidBigDBKey:"InvalidBigDBKey",BigDBObjectTooLarge:"BigDBObjectTooLarge",BigDBObjectDoesNotExist:"BigDBObjectDoesNotExist",UnknownTable:"UnknownTable",
UnknownIndex:"UnknownIndex",InvalidIndexValue:"InvalidIndexValue",NotObjectCreator:"NotObjectCreator",KeyAlreadyUsed:"KeyAlreadyUsed",StaleVersion:"StaleVersion",CircularReference:"CircularReference",HeartbeatFailed:"HeartbeatFailed",InvalidGameCode:"InvalidGameCode",VaultNotLoaded:"VaultNotLoaded",UnknownPayVaultProvider:"UnknownPayVaultProvider",DirectPurchaseNotSupportedByProvider:"DirectPurchaseNotSupportedByProvider",BuyingCoinsNotSupportedByProvider:"BuyingCoinsNotSupportedByProvider",NotEnoughCoins:"NotEnoughCoins",
ItemNotInVault:"ItemNotInVault",InvalidPurchaseArguments:"InvalidPurchaseArguments",InvalidPayVaultProviderSetup:"InvalidPayVaultProviderSetup",UnknownPartnerPayAction:"UnknownPartnerPayAction",InvalidType:"InvalidType",IndexOutOfBounds:"IndexOutOfBounds",InvalidIdentifier:"InvalidIdentifier",InvalidArgument:"InvalidArgument",LoggedOut:"LoggedOut",InvalidSegment:"InvalidSegment",GameRequestsNotLoaded:"GameRequestsNotLoaded",AchievementsNotLoaded:"AchievementsNotLoaded",UnknownAchievement:"UnknownAchievement",
NotificationsNotLoaded:"NotificationsNotLoaded",InvalidNotificationsEndpoint:"InvalidNotificationsEndpoint",NetworkIssue:"NetworkIssue",OneScoreNotLoaded:"OneScoreNotLoaded",PublishingNetworkNotAvailable:"PublishingNetworkNotAvailable",PublishingNetworkNotLoaded:"PublishingNetworkNotLoaded",DialogClosed:"DialogClosed",AdTrackCheckCookie:"AdTrackCheckCookie",codes:{0:"UnsupportedMethod",1:"GeneralError",2:"InternalError",3:"AccessDenied",4:"InvalidMessageFormat",5:"MissingValue",6:"GameRequired",7:"ExternalError",
8:"ArgumentOutOfRange",9:"GameDisabled",10:"UnknownGame",11:"UnknownConnection",12:"InvalidAuth",13:"NoServersAvailable",14:"RoomDataTooLarge",15:"RoomAlreadyExists",16:"UnknownRoomType",17:"UnknownRoom",18:"MissingRoomId",19:"RoomIsFull",20:"NotASearchColumn",21:"QuickConnectMethodNotEnabled",22:"UnknownUser",23:"InvalidPassword",24:"InvalidRegistrationData",25:"InvalidBigDBKey",26:"BigDBObjectTooLarge",27:"BigDBObjectDoesNotExist",28:"UnknownTable",29:"UnknownIndex",30:"InvalidIndexValue",31:"NotObjectCreator",
32:"KeyAlreadyUsed",33:"StaleVersion",34:"CircularReference",40:"HeartbeatFailed",41:"InvalidGameCode",50:"VaultNotLoaded",51:"UnknownPayVaultProvider",52:"DirectPurchaseNotSupportedByProvider",54:"BuyingCoinsNotSupportedByProvider",55:"NotEnoughCoins",56:"ItemNotInVault",57:"InvalidPurchaseArguments",58:"InvalidPayVaultProviderSetup",70:"UnknownPartnerPayAction",80:"InvalidType",81:"IndexOutOfBounds",82:"InvalidIdentifier",83:"InvalidArgument",84:"LoggedOut",90:"InvalidSegment",100:"GameRequestsNotLoaded",
110:"AchievementsNotLoaded",111:"UnknownAchievement",120:"NotificationsNotLoaded",121:"InvalidNotificationsEndpoint",130:"NetworkIssue",131:"OneScoreNotLoaded",200:"PublishingNetworkNotAvailable",201:"PublishingNetworkNotLoaded",301:"DialogClosed",302:"AdTrackCheckCookie"}};
(function(){_pio.client=function(a,c,b,d){this.connectUserId=d;this.gameId=c;this.gameFS=new _pio.gameFS(c,b);this.errorLog=new _pio.errorLog(a);this.payVault=new _pio.payVault(a);this.bigDB=new _pio.bigDB(a);this.multiplayer=new _pio.multiplayer(a);this.gameRequests=new _pio.gameRequests(a);this.achievements=new _pio.achievements(a);this.playerInsight=new _pio.playerInsight(a);this.oneScore=new _pio.oneScore(a);this.notifications=new _pio.notifications(a);this.publishingNetwork=new _pio.publishingNetwork(a,
this.connectUserId)}})();
(function(){var a={};_pio.gameFS=function(c,b){if("string"==typeof b&&0<b.length){var d=(b||"").split("|");if(1<=d.length)for(var e=a[c.toLowerCase()]={},f=0;f!=d.length;f++){var g=d[f];"alltoredirect"==g||"cdnmap"==g?e.baseUrl=d[f+1]:"alltoredirectsecure"==g||"cdnmapsecure"==g?e.secureBaseUrl=d[f+1]:e["."+g]=d[f+1]}}this.getUrl=function(b,d){if("/"==!b[0])throw _pio.error("The path given to getUrl must start with a slash, like: '/myfile.swf' or '/folder/file.jpg'");var e=a[c];return e?(d?e.secureBaseUrl:
e.baseUrl)+(e["."+b]||b):(d?"https":"http")+"://r.playerio.com/r/"+c+b}}})();
(function(){_pio.gameRequests=function(a){function c(a){if(null==a||0==a.length)return[];for(var b=[],d=0;d!=a.length;d++){var e=a[d];b.push(new _pio.gameRequest(e.id,e.type,e.senderuserid,e.created,e.data))}return b}var b=[];this.waitingRequests="[ERROR: You tried to access gameRequests.waitingRequests before loading waiting requests. You have to call the refresh method first.]";var d=this;this.send=function(b,d,c,h,k){a.gameRequestsSend(b,_pio.convertToKVArray(d),c,h,k,function(a){})};this.refresh=
function(e,f){a.gameRequestsRefresh(b,e,f,function(a){d._playCodes=a.newplaycodes;d.waitingRequests=c(a.requests)})};this["delete"]=function(b,f,g){if("object"==typeof b||b.length){for(var e=[],k=0;k!=b.length;k++){var l=b[k].id;if(l)e.push(l);else{b=_pio.error("No GameRequest id found on item#"+k+". You have to use requests from the gameRequests.waitingRequests array. For instance: client.gameRequests.delete(client.gameRequests.waitingRequests, ...)");_pio.handleError(b,g,b.code,b.message);return}}a.gameRequestsDelete(e,
f,g,function(a){d.waitingRequests=c(a.requests)})}else b=_pio.error("The first argument to delete should be an array: client.gameRequests.delete([requests], ...)"),_pio.handleError(b,g,b.code,b.message)}};_pio.gameRequest=function(a,c,b,d,e){this.id=a;this.type=c;this.senderUserId=b;this.created=new Date(d);this.data=_pio.convertFromKVArray(e)}})();(function(){_pio.errorLog=function(a){this.writeError=function(c,b,d,e){a.writeError("Javascript",c,b,d,_pio.convertToKVArray(e))}}})();
(function(){_pio.quickConnect=function(){this.simpleGetCaptcha=function(a,c,b,d,e){(new _pio.channel).simpleGetCaptcha(a,c,b,d,e,function(a){return new _pio.simpleGetCaptchaOutput(a.captchakey,a.captchaimageurl)})};this.simpleRecoverPassword=function(a,c,b,d){(new _pio.channel).simpleRecoverPassword(a,c,b,d,function(a){})}};_pio.simpleGetCaptchaOutput=function(a,c){this.captchaKey=a;this.captchaImageUrl=c};PlayerIO.quickConnect=new _pio.quickConnect})();
(function(){_pio.payVault=function(a){function c(a){if(null!=a&&(b=a.version,d.coins=a.coins||0,d.items=[],a.items&&a.items.length))for(var e=0;e!=a.items.length;e++){var c=a.items[e],h=d.items[e]=new _pio.vaultItem(c.id,c.itemkey,(new Date).setTime(c.purchasedate));_pio.bigDBDeserialize(c.properties,h,!0)}}var b=null;this.coins="[ERROR: you tried to access payVault.coins before the vault was loaded. You have to refresh the vault before the .coins property is set to the right value]";this.items="[ERROR: you tried to access payVault.items before the vault was loaded. You have to refresh the vault before the .items property is set to the right value]";
this.has=function(a){if(null==b)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var d=0;d!=this.items.length;d++)if(this.items[d].itemKey==a)return!0;return!1};this.first=function(a){if(null==b)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var d=0;d!=this.items.length;d++)if(this.items[d].itemKey==a)return this.items[d];
return null};this.count=function(a){if(null==b)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var d=0,e=0;e!=this.items.length;e++)this.items[e].itemKey==a&&d++;return d};this.refresh=function(d,f){a.payVaultRefresh(b,null,d,f,function(a){c(a.vaultcontents)})};this.readHistory=function(b,d,c,h){a.payVaultReadHistory(b,d,null,c,h,function(a){for(var b=[],d=0;d!=a.entries.length;d++){var e=a.entries[d];
b.push(new _pio.payVaultHistoryEntry(e.type,e.amount,e.timestamp,e.itemkeys||[],e.reason,e.providertransactionid,e.providerprice))}return b})};this.credit=function(b,d,g,h){a.payVaultCredit(b,d,null,g,h,function(a){c(a.vaultcontents)})};this.debit=function(b,d,g,h){a.payVaultDebit(b,d,null,g,h,function(a){c(a.vaultcontents)})};this.consume=function(b,d,g){if("object"==typeof b||b.length){for(var e=[],f=0;f!=b.length;f++){var l=b[f].id;if(l)e.push(l);else{b=_pio.error("No PayVault item id found on item#"+
f+". You have to use items from the payVault.items array. For instance: client.payVault.consume([client.payVault.first('sportscar')], ...)");_pio.handleError(b,g,b.code,b.message);return}}a.payVaultConsume(e,null,d,g,function(a){c(a.vaultcontents)})}else b=_pio.error("The first argument to consume should be an array: client.payVault.consume([item], ...)"),_pio.handleError(b,g,b.code,b.message)};this.buy=function(b,d,g,h){a.payVaultBuy(_pio.convertBuyItems(b),d,null,g,h,function(a){c(a.vaultcontents)})};
this.give=function(b,d,g){a.payVaultGive(_pio.convertBuyItems(b),null,d,g,function(a){c(a.vaultcontents)})};this.getBuyCoinsInfo=function(b,d,c,h){a.payVaultPaymentInfo(b,_pio.convertToKVArray(d),null,c,h,function(a){return _pio.convertFromKVArray(a.providerarguments)})};this.getBuyDirectInfo=function(b,d,c,h,k){a.payVaultPaymentInfo(b,_pio.convertToKVArray(d),_pio.convertBuyItems(c),h,k,function(a){return _pio.convertFromKVArray(a.providerarguments)})};var d=this};_pio.convertBuyItems=function(a){if(null==
a)return[];for(var c=[],b=0;b!=a.length;b++){var d=a[b].itemkey;if(!d)throw _pio.error("You have to specify an itemkey for the payvault item. Example:  {itemkey:'car'}");c.push({itemkey:d,payload:_pio.compareForChanges({itemkey:d},a[b],!0,!0)})}return c};_pio.vaultItem=function(a,c,b){this.id=a;this.itemKey=c;this.purchaseDate=b};_pio.payVaultHistoryEntry=function(a,c,b,d,e,f,g){this.type=a;this.amount=c;this.timestamp=(new Date).setTime(b);this.itemKeys=d;this.reason=e;this.providerTransactionId=
f;this.providerPrice=g}})();
(function(){_pio.bigDB=function(a){function c(){for(var a=0;a<e.length;a++){var b=e[a],d=!0,c;for(c in b.objects)if(b.objects[c]._internal_("get-is-saving")){d=!1;break}if(d){for(c in b.objects)for(d=a+1;d<e.length;d++){futureSave=e[d];for(var l=0;l<futureSave.objects.length;l++)futureSave.objects[l]==b.objects[c]&&futureSave.fullOverwrite==b.fullOverwrite&&futureSave.useOptimisticLock==b.useOptimisticLock&&(b.changesets[c]=futureSave.changesets[l],b.futureSaves.push(futureSave))}e.splice(a,1);a--;
b.execute()}}}function b(a,b){null==a?a=[]:a instanceof Array||(a=[a]);null!=b&&(a=a.concat([b]));for(var d=[],c=0;c!=a.length;c++){var e=a[c];switch(typeof e){case "boolean":d.push({valuetype:_pio.ValueType.Bool,bool:e});break;case "string":d.push({valuetype:_pio.ValueType.String,string:e});break;case "number":0!=e%1?d.push({valuetype:_pio.ValueType.Double,"double":e}):-2147483648<e&&2147483647>e?d.push({valuetype:_pio.ValueType.Int,"int":e}):0<e&&4294967295>e?d.push({valuetype:_pio.ValueType.UInt,
uint:e}):d.push({valuetype:_pio.ValueType.Long,"long":e});break;case "object":if(e.getTime&&e.getMilliseconds)d.push({valuetype:_pio.ValueType.DateTime,datetime:e.getTime()});else throw Error("Don't know how to serialize type '"+typeof e+"' for BigDB");break;default:throw Error("Don't know how to serialize type '"+typeof e+"' for BigDB");}}return d}var d=this,e=[];this.createObject=function(b,c,e,k,l){var f=_pio.compareForChanges({},e||{},!0,!0);a.createObjects([{key:c,table:b,properties:f}],!1,k,
l,function(a){if(1==a.objects.length)return new _pio.databaseobject(d,b,a.objects[0].key,a.objects[0].version,!1,f);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.loadMyPlayerObject=function(b,c){a.loadMyPlayerObject(b,c,function(a){return new _pio.databaseobject(d,"PlayerObjects",a.playerobject.key,a.playerobject.version,!0,a.playerobject.properties)})};this.load=function(b,c,e,k){a.loadObjects([{table:b,keys:[c]}],e,k,function(a){if(1==a.objects.length)return null==
a.objects[0]?null:new _pio.databaseobject(d,b,a.objects[0].key,a.objects[0].version,!1,a.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error loading object");})};this.loadKeys=function(b,c,e,k){a.loadObjects([{table:b,keys:c}],e,k,function(a){for(var c=[],e=0;e!=a.objects.length;e++){var f=a.objects[e];c[e]=null==f?null:new _pio.databaseobject(d,b,f.key,f.version,!1,f.properties)}return c})};this.loadOrCreate=function(b,c,e,k){a.createObjects([{key:c,table:b,properties:[]}],
!0,e,k,function(a){if(1==a.objects.length)return new _pio.databaseobject(d,b,a.objects[0].key,a.objects[0].version,!1,a.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.deleteKeys=function(b,d,c,e){a.deleteObjects([{table:b,keys:d}],c,e,function(a){return null})};this.loadKeysOrCreate=function(b,c,e,k){for(var f=[],g=0;g!=c.length;g++)f.push({key:c[g],table:b,properties:[]});a.createObjects(f,!0,e,k,function(a){for(var c=[],e=0;e!=a.objects.length;e++){var f=
a.objects[e];c[e]=new _pio.databaseobject(d,b,f.key,f.version,!1,f.properties)}return c})};this.loadSingle=function(c,e,h,k,l){a.loadMatchingObjects(c,e,b(h),1,k,l,function(a){return 0==a.objects.length?null:new _pio.databaseobject(d,c,a.objects[0].key,a.objects[0].version,!1,a.objects[0].properties)})};this.loadRange=function(c,e,h,k,l,m,q,p){a.loadIndexRange(c,e,b(h,k),b(h,l),m,q,p,function(a){for(var b=[],e=0;e!=a.objects.length;e++){var f=a.objects[e];b[e]=null==f?null:new _pio.databaseobject(d,
c,f.key,f.version,!1,f.properties)}return b})};this.deleteRange=function(d,e,c,k,l,m,q){a.deleteIndexRange(d,e,b(c,k),b(c,l),m,q,function(){})};this.saveChanges=function(b,d,h,k,l,m){var f=1==m;m=[];for(var g in h){var t=h[g];if(!(t.existsInDatabase&&t.key&&t.table&&t._internal_&&t.save)){b=_pio.error("You can only save database objects that exist in the database");_pio.handleError(b,l,b.code,b.message);return}var u=_pio.compareForChanges(d?{}:t._internal_("get-dbCurrent"),t,!0,!0);(d||0<u.length)&&
m.push({key:t._internal_("get-key"),table:t._internal_("get-table"),fulloverwrite:d,onlyifversion:b?t._internal_("get-version"):null,changes:u})}e.push({objects:h,changesets:m,fullOverwrite:d,useOptimisticLock:b,futureSaves:[],setIsSavingOnAll:function(a){for(var b=0;b!=this.objects.length;b++)this.objects[b]._internal_("set-is-saving",a)},done:function(){this.setIsSavingOnAll(!1);c()},execute:function(){var b=this;b.setIsSavingOnAll(!0);0<b.changesets.length?a.saveObjectChanges(_pio.LockType.LockAll,
b.changesets,f,k,function(a){b.done();_pio.handleError(a,l,a.code,a.message)},function(a){for(var d=0;d!=b.objects.length;d++){var e=b.objects[d];e._internal_("set-version",a.versions[d]);e._internal_("change-dbCurrent",b.changesets[d].changes);for(var c=0;c!=b.futureSaves.length;c++)for(var f=b.futureSaves[c],g=0;g<f.objects.length;g++)f.objects[g]==e&&(f.changesets.splice(g,1),f.objects.splice(g,1),g--)}b.done()}):(b.done(),setTimeout(k,1))}});c()}};_pio.databaseobject=function(a,c,b,d,e,f){var g=
{},h=!1;_pio.bigDBDeserialize(f,g,!0);this.table=c;this.key=b;this.existsInDatabase=!0;this.save=function(b,d,c,f){a.saveChanges(b,d,[this],c,f,e)};this._internal_=function(a,e){switch(a){case "get-table":return c;case "get-key":return b;case "set-is-saving":h=e;case "get-is-saving":return h;case "get-version":return d;case "set-version":d=e;case "get-dbCurrent":return g;case "change-dbCurrent":_pio.bigDBDeserialize(e,g,!0)}};_pio.bigDBDeserialize(f,this,!0)};_pio.compareForChanges=function(a,c,b,
d){var e=[],f;for(f in c){var g=c[f],h=a?a[f]:null;switch(f){case "table":if(d)continue;case "key":if(d)continue;case "save":if(d)continue;case "existsInDatabase":if(d)continue;case "_internal_":if(d)continue;case "_circular_reference_finder_":continue}if(null!=g){var k=b?{name:f}:{index:parseInt(f)};switch(typeof g){case "boolean":g!=h&&(k.value={valuetype:_pio.ValueType.Bool,bool:g},e.push(k));break;case "number":g!=h&&(isFinite(g)&&Math.floor(g)===g?k.value=-2147483648<=g&&2147483647>=g?{valuetype:_pio.ValueType.Int,
"int":g}:0<g&&4294967295>=g?{valuetype:_pio.ValueType.UInt,uint:g}:-0x7ffffffffffffc00<=g&&0x7ffffffffffffc00>=g?{valuetype:_pio.ValueType.Long,"long":g}:0<g&&1.844674407370955E19>=g?{valuetype:_pio.ValueType.ULong,ulong:g}:{valuetype:_pio.ValueType.Double,"double":g}:k.value={valuetype:_pio.ValueType.Double,"double":g},e.push(k));break;case "string":g!=h&&(k.value={valuetype:_pio.ValueType.String,string:g},e.push(k));break;case "object":if(g.getTime&&g.getMilliseconds)g+""!=h+""&&(k.value={valuetype:_pio.ValueType.DateTime,
datetime:g.getTime()},e.push(k));else{if(g._circular_reference_finder_)throw new PlayerIOError(PlayerIOErrorCode.CircularReference,"The object you're trying to save contains a circular reference for "+(b?"a property named":"the array entry")+"): "+f);g._circular_reference_finder_=!0;var l=g instanceof Array;if(l&&g.bytearray){l=Array(g.length);for(h=0;h!=l.length;h++){var m=g[h];if(0<=m&&255>=m)l[h]=m;else throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"The bytearray property '"+f+"' was supposed to only contain byte (0-255) values, but contained the value: "+
m);}k.value={valuetype:_pio.ValueType.ByteArray,bytearray:l}}else h=_pio.compareForChanges(h,g,!l,!1),k.value=l?{valuetype:_pio.ValueType.Array,arrayproperties:h}:{valuetype:_pio.ValueType.Obj,objectproperties:h};e.push(k);delete g._circular_reference_finder_}break;case "undefined":break;case "function":break;default:throw Error("Don't know how to serialize type '"+typeof g+"' for BigDB");}}}for(f in a)null!=c[f]&&"undefined"!=typeof c[f]||e.push(b?{name:f}:{index:parseInt(f)});return e};_pio.bigDBDeserialize=
function(a,c,b){for(var d in a){var e=a[d],f=b?e.name:e.index||0;if(e=e.value)switch(e.valuetype||0){case _pio.ValueType.String:c[f]=e.string||"";break;case _pio.ValueType.Int:c[f]=e["int"]||0;break;case _pio.ValueType.UInt:c[f]=e.uint||0;break;case _pio.ValueType.Long:c[f]=e["long"]||0;break;case _pio.ValueType.Bool:c[f]=e.bool||0;break;case _pio.ValueType.Float:c[f]=e["float"]||0;break;case _pio.ValueType.Double:c[f]=e["double"]||0;break;case _pio.ValueType.ByteArray:c[f]=e.bytearray;c[f].bytearray=
!0;break;case _pio.ValueType.DateTime:c[f]=new Date(e.datetime||0);break;case _pio.ValueType.Array:var g=c[f]instanceof Array?c[f]:[];_pio.bigDBDeserialize(e.arrayproperties,g,!1);c[f]=g;break;case _pio.ValueType.Obj:g="object"==typeof c[f]?c[f]:{},_pio.bigDBDeserialize(e.objectproperties,g,!0),c[f]=g}else delete c[f]}}})();
(function(){_pio.multiplayer=function(a){var b=this;this.developmentServer=null;this.useSecureConnections=!1;this.createRoom=function(d,c,g,h,k,l){a.createRoom(d,c,g,_pio.convertToKVArray(h),null!=b.developmentServer,k,l,function(a){return a.roomid})};this.joinRoom=function(d,c,g,h){clearTimeout(setTimeout(function(){g(new _pio.connection)},1E4));var e=Error();a.joinRoom(d,_pio.convertToKVArray(c),null!=b.developmentServer,function(){},h,function(a){return new _pio.connection(e,b.developmentServer,
b.useSecureConnections,a.endpoints,a.joinkey,c||{},g,h)})};this.createJoinRoom=function(d,c,g,h,k,l,m){clearTimeout(setTimeout(function(){l(new _pio.connection)},1E4));var e=Error();a.createJoinRoom(d,c,g,_pio.convertToKVArray(h),_pio.convertToKVArray(k),null!=b.developmentServer,function(){},m,function(a){return new _pio.connection(e,b.developmentServer,b.useSecureConnections,a.endpoints,a.joinkey,k||{},l,m)})};this.listRooms=function(d,c,g,h,k,l){a.listRooms(d,_pio.convertToKVArray(c),g,h,null!=
b.developmentServer,k,l,function(a){var b=[];if(a.rooms&&0<a.rooms.length)for(var d=0;d!=a.rooms.length;d++){var c=a.rooms[d];b.push(new _pio.roomInfo(c.id,c.roomtype,c.onlineusers,_pio.convertFromKVArray(c.roomdata)))}return b})}};_pio.websocketConnection=function(a,d,c,f,g,h,k){var b=this,e=!1,q=new _pio.messageSerializer,p=!1,t=null;d=(d?"wss://":"ws://")+c+"/";try{t="undefined"!=typeof MozWebSocket?new MozWebSocket(d):new WebSocket(d)}catch(x){g(!1,""+x);return}var u=setTimeout(function(){e||
(e=!0,g(!1,"Connect attempt timed out"))},f);t.onopen=function(){e||(clearTimeout(u),p=e=!0,g(p))};t.onclose=function(a){b.disconnect()};t.onerror=function(a){b.disconnect()};t.onmessage=function(b){if(p)if(a){var d=new FileReader;d.onloadend=function(){for(var a=new Uint8Array(d.result),b=Array(a.length),c=0;c!=a.length;c++)b[c]=a[c];k(q.deserializeMessage(b,0,b.length))};d.readAsArrayBuffer(b.data)}else b=_pio.base64decode(b.data),k(q.deserializeMessage(b,0,b.length))};this.disconnect=function(){if(p){p=
!1;h();try{t.close()}catch(x){_pio.debugLog(x)}}};this.sendMessage=function(b){b=q.serializeMessage(b);if(a){for(var d=new Uint8Array(b.length),c=0;c<b.length;c++)d[c]=b[c];t.send(d.buffer)}else b=_pio.base64encode(b),t.send(b)}};_pio.connection=function(a,d,c,f,g,h,k,l){function b(b){function m(){if(0<B.length){var d=B[0];B.splice(0,1);var f=b(c,d,4E3,function(a,b){if(a){y=f;e.connected=!0;var c=e.createMessage("join");c.addString(g);if(null!=h)for(var k in h)c.addString(k),c.addString(""+h[k]);
e.sendMessage(c)}else _pio.debugLog("Unable to connect to endpoint: "+d+'. reason: "'+b+(0<B.length?'". Trying next endpoint.':'". No more endpoints to try.')),m()},function(a){e.connected&&(e.connected=!1,setTimeout(function(){for(var a=0;a!=t.length;a++)_pio.runCallback(t[a].callback,e,t[a].stackSource)},100))},function(b){p?"playerio.joinresult"==b.type?(p=!1,b.getBoolean(0)?_pio.runCallback(k,e,null):_pio.handleError(a,l,b.getInt(1),b.getString(2))):_pio.handleError(a,l,PlayerIOErrorCode.GeneralError,
"The expected inital messagetype is: playerio.joinresult, received: "+joinResult.getType()):(q(b.type,b),q("*",b))})}else _pio.handleError(a,l,PlayerIOErrorCode.GeneralError,"Could not establish a socket connection to any of the given endpoints for the room")}function q(a,b){var d=u[a];if(d)for(var c=0;c<d.length;c++)_pio.runCallback(d[c].callback,b,d[c].stackSource)}var B=[];if(d)B.push(d);else for(var r=0;r!=f.length;r++)B.push(f[r].address+":"+f[r].port);m()}var e=this,p=!0,t=[],u={},x=[],y=null,
r=/(WebKit|Firefox|Trident)\/([0-9]+)/gi.exec(navigator.userAgent),B=r&&3<=r.length?r[1]:null;r=r&&3<=r.length?parseInt(r[2]):null;window.FileReader&&"WebKit"==B&&535<=r||"Firefox"==B&&11<=r||"Trident"==B&&6<=r?b(function(a,b,d,c,e,f){return new _pio.websocketConnection(!0,a,b,d,c,e,f)}):_pio.isFlashFallbackEnabled(function(a){a?b(function(a,b,d,c,e,f){return new _pio.flashSocketConnection(b,d,c,e,f)}):b(function(a,b,d,c,e,f){return new _pio.websocketConnection(!1,a,b,d,c,e,f)})});this.connected=
!1;this.addDisconnectCallback=function(a){t.push({callback:a,stackSourc:Error()})};this.addMessageCallback=function(a,b){null==a&&(a="*");var d=u[a];d||(u[a]=d=[]);d.push({callback:b,stackSource:Error()})};this.removeDisconnectCallback=function(a){for(var b=0;b<t.length;b++)t[b].callback==a&&(t.splice(b,1),b--)};this.removeMessageCallback=function(a){for(var b in u)for(var d=u[b],c=0;c<d.length;c++)d[c].callback==a&&(d.splice(c,1),c--)};this.createMessage=function(a){for(var b=new _pio.message(a),
d=1;d<arguments.length;d++)b.add(arguments[d]);return b};this.send=function(a){var b=this.createMessage.apply(this,arguments);this.sendMessage(b)};this.sendMessage=function(a){e.connected?y.sendMessage(a):x.push(a)};this.disconnect=function(){e.connected&&y.disconnect()}};_pio.message=function(a){function b(a,b,d,c){if(a)l.push(b),k.push(d),h.length=l.length;else throw _pio.error("The given value ("+b+") is not "+c);}function c(a,b){if(a>l.length)throw _pio.error("this message ("+h.type+") only has "+
l.length+" entries");if(k[a]==b)return l[a];throw _pio.error("Value at index:"+a+" is a "+f(k[a])+" and not a "+f(b)+" as requested. The value is: "+l[a]);}function f(a){return{0:"Integer",1:"Unsigned Integer",2:"Long",3:"Unsigned Long",4:"Double",5:"Float",6:"String",7:"ByteArray",8:"Boolean"}[a]}function g(a){var b="object"==typeof a&&"undefined"!=typeof a.length;if(b)for(var d=0;d!=a.length;d++)if(255<a[d]||0>a[d]){b=!1;break}return b}var h=this,k=[],l=[];this.type=a;this.length=0;this.add=function(){for(var a=
0;a<arguments.length;a++){var b=arguments[a];switch(typeof b){case "string":h.addString(b);break;case "boolean":h.addBoolean(b);break;case "number":if(isFinite(b)&&Math.floor(b)===b)if(-2147483648<=b&&2147483647>=b){h.addInt(b);break}else if(0<b&&4294967295>=b){h.addUInt(b);break}else if(-0x7ffffffffffffc00<=b&&0x7ffffffffffffc00>=b){h.addLong(b);break}else if(0<b&&1.844674407370955E19>=b){h.addULong(b);break}h.addDouble(b);break;case "object":if(g(b)){this.addByteArray(b);break}default:throw _pio.error("The type of the value ("+
b+") cannot be inferred");}}};this.addInt=function(a){b(-2147483648<=a&&2147483647>=a,Math.trunc(a),0,"an integer (32bit)")};this.addUInt=function(a){b(0<=a&&4294967295>=a,Math.trunc(a),1,"an unsigned integer (32bit)")};this.addLong=function(a){b(-0x7ffffffffffffc00<=a&&0x7ffffffffffffc00>=a,Math.trunc(a),2,"a long (64bit)")};this.addULong=function(a){b(0<=a&&1.844674407370955E19>=a,a,3,"an unsigned long (64bit)")};this.addBoolean=function(a){b(!0,a?!0:!1,8,"a boolean value")};this.addFloat=function(a){b(!0,
Number(a),5,"a floating point value (32bit)")};this.addDouble=function(a){b(!0,Number(a),4,"a double floating point value (64bit)")};this.addByteArray=function(a){b(g(a),a,7,"a bytearray")};this.addString=function(a){b(!0,a+"",6,"a string")};this.getInt=function(a){return c(a,0)};this.getUInt=function(a){return c(a,1)};this.getLong=function(a){return c(a,2)};this.getULong=function(a){return c(a,3)};this.getBoolean=function(a){return c(a,8)};this.getDouble=function(a){return c(a,4)};this.getFloat=
function(a){return c(a,5)};this.getByteArray=function(a){return c(a,7)};this.getString=function(a){return c(a,6)};this.toString=function(){for(var a="msg.Type = "+this.type,b=0;b!=this.length;b++)a+=", msg["+b+"] = "+l[b]+" ("+f(k[b])+")";return a};this._internal_=function(a,b){switch(a){case "get-objects":return l;case "get-types":return k}}};_pio.roomInfo=function(a,d,c,f){this.id=a;this.roomType=d;this.onlineUsers=c;this.roomData=f};_pio.byteWriter=function(){this.bytes=[];this.writeByte=function(a){if(0<=
a&&255>=a)this.bytes.push(a);else throw Error("This is not a byte value: "+a);};this.writeBytes=function(a){for(var b=0;b!=a.length;b++)this.writeByte(a[b])};this.writeTagWithLength=function(a,d,c){63<a||0>a?this.writeBottomPatternAndBytes(c,_pio.binaryserializer.bytesFromInt(a)):this.writeByte(d|a)};this.writeBottomPatternAndBytes=function(a,d){var b=0;0!=d[0]?b=3:0!=d[1]?b=2:0!=d[2]&&(b=1);this.writeByte(a|b);for(b=d.length-b-1;b!=d.length;b++)this.writeByte(d[b])};this.writeLongPattern=function(a,
d,c){for(var b=0,e=0;7!=e;e++)if(0!=c[e]){b=7-e;break}3<b?this.writeByte(d|b-4):this.writeByte(a|b);for(e=c.length-b-1;e!=c.length;e++)this.writeByte(c[e])}};_pio.messageSerializer=function(){this.serializeMessage=function(a){var b=new _pio.byteWriter;b.writeTagWithLength(a.length,128,4);var c=_pio.binaryserializer.bytesFromString(a.type);b.writeTagWithLength(c.length,192,12);b.writeBytes(c);for(var f=0;f!=a.length;f++)switch(c=a._internal_("get-objects")[f],a._internal_("get-types")[f]){case 6:c=
_pio.binaryserializer.bytesFromString(c);b.writeTagWithLength(c.length,192,12);b.writeBytes(c);break;case 0:b.writeTagWithLength(c,128,4);break;case 1:b.writeBottomPatternAndBytes(8,_pio.binaryserializer.bytesFromUInt(c));break;case 2:b.writeLongPattern(48,52,_pio.binaryserializer.bytesFromLong(c));break;case 3:b.writeLongPattern(56,60,_pio.binaryserializer.bytesFromULong(c));break;case 7:b.writeTagWithLength(c.length,64,16);b.writeBytes(c);break;case 4:b.writeByte(3);b.writeBytes(_pio.binaryserializer.bytesFromDouble(c));
break;case 5:b.writeByte(2);c=_pio.binaryserializer.bytesFromFloat(c);b.writeBytes(c);break;case 8:b.writeByte(c?1:0)}return b.bytes};this.deserializeMessage=function(a,c,e){var b=c;c+=e;e=null;for(var d=0;b<c;){var h=0,k=0,l=a[b];b++;var m=l&192;0==m&&(m=l&60,0==m&&(m=l));switch(m){case 12:case 16:h=(l&3)+1;if(b+h>c)throw Error("Unexpected: Unfinished message");l=h;h=_pio.binaryserializer.intFromBytes(a,b,h);b+=l;break;case 192:h=l&63;break;case 128:k=l&63;break;case 64:h=l&63;break;case 4:case 8:case 48:case 56:h=
(l&3)+1;break;case 52:case 60:h=(l&3)+5;break;case 3:h=8;break;case 2:h=4}if(b+h>c)throw Error("Unexpected: Unfinished message");switch(m){case 12:case 192:null==e?(e=new _pio.message(_pio.binaryserializer.stringFromBytes(a,b,h)),d++):e.addString(_pio.binaryserializer.stringFromBytes(a,b,h));break;case 4:k=_pio.binaryserializer.intFromBytes(a,b,h);case 128:0==d?d=k:e.addInt(k);break;case 16:case 64:e.addByteArray(a.slice(b,b+h));break;case 8:e.addUInt(_pio.binaryserializer.uintFromBytes(a,b,h));break;
case 48:case 52:e.addLong(_pio.binaryserializer.longFromBytes(a,b,h));break;case 56:case 60:e.addULong(_pio.binaryserializer.ulongFromBytes(a,b,h));break;case 3:e.addDouble(_pio.binaryserializer.doubleFromBytes(a,b,h));break;case 2:e.addFloat(_pio.binaryserializer.floatFromBytes(a,b,h));break;case 1:e.addBoolean(!0);break;case 0:e.addBoolean(!1)}b+=h;if(null!=e&&0==--d)return e}throw Error("Unexpected: Misaligned message");}};_pio.binaryserializer={pow2:function(a){return 0<=a&&31>a?1<<a:this.pow2[a]||
(this.pow2[a]=Math.pow(2,a))},_intEncode:function(a,c){if(4==c)var b=[a>>>24&255,a>>>16&255,a>>>8&255,a&255];else{if(0<=a){b=Math.floor(a/this.pow2(32));var d=a-b*this.pow2(32)}else b=Math.floor(a/this.pow2(32)),d=a-b*this.pow2(32),b+=this.pow2(32);b=[b>>>24&255,b>>>16&255,b>>>8&255,b&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255]}return b},_floatEncode:function(a,c,e){var b=0>a?1:0,d,h=~(-1<<e-1),k=1-h;0>a&&(a=-a);0===a?a=d=0:isNaN(a)?(d=2*h+1,a=1):Infinity===a?(d=2*h+1,a=0):(d=Math.floor(Math.log(a)/
Math.LN2),d>=k&&d<=h?(a=Math.floor((a*this.pow2(-d)-1)*this.pow2(c)),d+=h):(a=Math.floor(a/this.pow2(k-c)),d=0));for(h=[];8<=c;)h.push(a%256),a=Math.floor(a/256),c-=8;d=d<<c|a;for(e+=c;8<=e;)h.push(d&255),d>>>=8,e-=8;h.push(b<<e|d);h.reverse();return h},bytesFromString:function(a){for(var b=[],c=0;c<a.length;c++)if(127>=a.charCodeAt(c))b.push(a.charCodeAt(c));else for(var f=encodeURIComponent(a.charAt(c)).substr(1).split("%"),g=0;g<f.length;g++)b.push(parseInt(f[g],16));return b},bytesFromInt:function(a){return this._intEncode(a,
4)},bytesFromUInt:function(a){return this._intEncode(a,4)},bytesFromLong:function(a){return this._intEncode(a,8)},bytesFromULong:function(a){return this._intEncode(a,8)},bytesFromFloat:function(a){return this._floatEncode(a,23,8)},bytesFromDouble:function(a){return this._floatEncode(a,52,11)},_intDecode:function(a,c,e,f,g){var b=c+e-1;c=g&&e==f&&a[c]&128;f=0;g=1;for(var d=0;d<e;d++){var l=a[b-d];c&&(l=(l^255)+g,g=l>>8,l&=255);f+=l*this.pow2(8*d)}return c?-f:f},_float32Decode:function(a,c){var b=a.slice(c,
c+4).reverse(),d=1-2*(b[3]>>7),g=(b[3]<<1&255|b[2]>>7)-127;b=(b[2]&127)<<16|b[1]<<8|b[0];return 128===g?0!==b?NaN:Infinity*d:-127===g?d*b*this.pow2(-149):d*(1+b*this.pow2(-23))*this.pow2(g)},_float64Decode:function(a,c){var b=a.slice(c,c+8).reverse(),d=1-2*(b[7]>>7),g=((b[7]<<1&255)<<3|b[6]>>4)-1023;b=(b[6]&15)*this.pow2(48)+b[5]*this.pow2(40)+b[4]*this.pow2(32)+b[3]*this.pow2(24)+b[2]*this.pow2(16)+b[1]*this.pow2(8)+b[0];return 1024===g?0!==b?NaN:Infinity*d:-1023===g?d*b*this.pow2(-1074):d*(1+b*
this.pow2(-52))*this.pow2(g)},stringFromBytes:function(a,c,e){for(var b="",d=c;d<c+e;d++)b+=127>=a[d]?37===a[d]?"%25":String.fromCharCode(a[d]):"%"+a[d].toString(16).toUpperCase();return decodeURIComponent(b)},intFromBytes:function(a,c,e){return this._intDecode(a,c,e,4,!0)},uintFromBytes:function(a,c,e){return this._intDecode(a,c,e,4,!1)},longFromBytes:function(a,c,e){return this._intDecode(a,c,e,8,!0)},ulongFromBytes:function(a,c,e){return this._intDecode(a,c,e,8,!1)},floatFromBytes:function(a,c,
e){return 4==e?this._float32Decode(a,c):NaN},doubleFromBytes:function(a,c,e){return 8==e?this._float64Decode(a,c):NaN}};for(var a=[],c=0;65!=c;c++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(c)]=c;_pio.base64encode=function(a){for(var b=[],c=0;c<a.length;c++){var f=a[c],g=++c<=a.length?a[c]:NaN,h=++c<=a.length?a[c]:NaN,k=f>>2;f=(f&3)<<4|g>>4;var l=(g&15)<<2|h>>6,m=h&63;isNaN(g)?l=m=64:isNaN(h)&&(m=64);b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k));
b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m))}return b.join("")};_pio.base64decode=function(b){for(var c=[],e=0;e<b.length;e++){var f=a[b.charCodeAt(e)],g=++e<b.length?a[b.charCodeAt(e)]:64,h=++e<b.length?a[b.charCodeAt(e)]:64,k=++e<b.length?a[b.charCodeAt(e)]:64,l=(g&15)<<4|h>>2,m=(h&3)<<
6|k;c.push(f<<2|g>>4);64!=h&&(c.push(l),64!=k&&c.push(m))}return c}})();
(function(){_pio.achievements=function(a){function c(a,b){var c=new _pio.achievement(a.identifier,a.title,a.description,a.imageurl,a.progress,a.progressgoal,a.lastupdated);if("string"!==typeof d.myAchievements)for(var e=0;e<d.myAchievements.length;e++)d.myAchievements[e].id==c.id&&(d.myAchievements[e]=c,d.currentVersion=null);if(b)for(e=0;e<d.onCompleteHandlers.length;e++)(0,d.onCompleteHandlers[e])(c);return c}var b=null;this.myAchievements="[ERROR: You tried to access achievements.myAchievements before loading them. You have to call the refresh method first.]";
this.onCompleteHandlers=[];var d=this;this.addOnComplete=function(a){if("function"===typeof a&&1==a.length)d.onCompleteHandlers.push(a);else throw new PlayerIOError(PlayerIOErrorCode.InvalidArgument,"Expects argument to be a function that takes an achievement as an argument.");};this.get=function(a){if("string"===typeof d.myAchievements)return null;for(var b=0;b<d.myAchievements.length;b++)if(d.myAchievements[b].id==a)return d.myAchievements[b];return null};this.refresh=function(c,f){a.achievementsRefresh(b,
c,f,function(a){if(b!=a.version)if(b=a.version,null==a.achievements||0==a.achievements.length)d.myAchievements=[];else{for(var c=[],e=0;e<a.achievements.length;e++){var f=a.achievements[e];c.push(new _pio.achievement(f.identifier,f.title,f.description,f.imageurl,f.progress,f.progressgoal,f.lastupdated))}d.myAchievements=c}})};this.load=function(b,c,d){"object"==typeof b||requests.length?a.achievementsLoad(b,c,d,function(a){if(null==a||0==a.length)return{};for(var b={},c=0;c<a.userachievements.length;c++){for(var d=
a.userachievements[c],e=[],f=0;f<d.achievements.length;f++){var g=d.achievements[f];e.push(new _pio.achievement(g.identifier,g.title,g.description,g.imageurl,g.progress,g.progressgoal,g.lastupdated))}b[d.userid]=e}return b}):(b=_pio.error("The first argument to load should be an array: client.achievements.load(['user1', 'user2', ...], ...)"),_pio.handleError(b,d,b.code,b.message))};this.progressSet=function(b,d,g,h){a.achievementsProgressSet(b,d,g,h,function(a){return c(a.achievement,a.completednow)})};
this.progressAdd=function(b,d,g,h){a.achievementsProgressAdd(b,d,g,h,function(a){return c(a.achievement,a.completednow)})};this.progressMax=function(b,d,g,h){a.achievementsProgressMax(b,d,g,h,function(a){return c(a.achievement,a.completednow)})};this.progressComplete=function(b,d,g){a.achievementsProgressComplete(b,d,g,function(a){return c(a.achievement,a.completednow)})}};_pio.achievement=function(a,c,b,d,e,f,g){this.id=a;this.title=c;this.description=b;this.imageUrl=d;this.progress="undefined"===
typeof e?0:e;this.progressGoal=f;this.lastUpdated=new Date(1E3*g);this.progressRatio=this.progress/this.progressGoal;this.completed=this.progress==this.progressGoal}})();
(function(){_pio.playerInsight=function(a){function c(a){b.playersOnline=-1==a.playersonline?"[ERROR: The current connection does not have the rights required to read the playersonline variable.]":a.playersonline;b.segments=_pio.convertFromKVArray(a.segments)}this.playersOnline="[ERROR: You tried to access playerInsight.playersOnline before loading it. You have to call the refresh method first.]";this.segments={};var b=this;this.refresh=function(b,e){a.playerInsightRefresh(b,e,function(a){c(a.state)})};
this.setSegments=function(b,e,f){a.playerInsightSetSegments(_pio.convertToSegmentArray(b),e,f,function(a){c(a.state)})};this.trackInvitedBy=function(b,c,f,g){a.playerInsightTrackInvitedBy(b,c,f,g,function(a){})};this.trackEvent=function(b,c,f,g){a.playerInsightTrackEvents([{eventtype:b,value:c}],f,g,function(a){})};this.trackExternalPayment=function(b,c,f,g){a.playerInsightTrackExternalPayment(b,c,f,g,function(a){})};this.sessionKeepAlive=function(b,c){a.playerInsightSessionKeepAlive(b,c,function(a){})}}})();
(function(){_pio.oneScore=function(a){this.percentile="[ERROR: You tried to access oneScore.percentile before loading the OneScore. You have to call the refresh method first.]";this.score="[ERROR: You tried to access oneScore.score before loading the OneScore. You have to call the refresh method first.]";this.topRank="[ERROR: You tried to access oneScore.topRank before loading the OneScore. You have to call the refresh method first.]";var c=this;this.refresh=function(b,d){a.oneScoreRefresh(b,d,function(a){a=
new _pio.oneScoreValue(a.onescore.percentile,a.onescore.score,a.onescore.toprank);c.percentile=a.percentile;c.score=a.score;c.topRank=a.toprank})};this.set=function(b,d,e){a.oneScoreSet(b,d,e,function(a){a=new _pio.oneScoreValue(a.onescore.percentile,a.onescore.score,a.onescore.toprank);c.percentile=a.percentile;c.score=a.score;c.topRank=a.toprank;return a})};this.add=function(b,d,e){a.oneScoreAdd(b,d,e,function(a){a=new _pio.oneScoreValue(a.onescore.percentile,a.onescore.score,a.onescore.toprank);
c.percentile=a.percentile;c.score=a.score;c.topRank=a.toprank;return a})};this.load=function(b,c,e){if("object"==typeof b||requests.length)a.oneScoreLoad(b,c,e,function(a){if(null==a||null==a.onescores||0==a.onescores.length)return[];for(var c=[],d=0,e=0;e<b.length;e++){var f=a.onescores[d];f&&b[e]==f.userid?(c.push(new _pio.oneScoreValue(f.percentile,f.score,f.toprank)),d++):c.push(null)}return c});else c=_pio.error("The first argument to load should be an array: client.oneScore.load(['user1', 'user2', ...], ...)"),
_pio.handleError(c,e,c.code,c.message)}};_pio.oneScoreValue=function(a,c,b){this.percentile="undefined"===typeof a?0:a;this.score="undefined"===typeof c?0:c;this.topRank="undefined"===typeof b?0:b}})();
(function(){_pio.notifications=function(a){function c(a){if(a.version!=e){var b=[];if(a.endpoints)for(var c=0;c!=a.endpoints.length;c++){var f=a.endpoints[c];b[c]=new _pio.notificationEndpoint(f.type,f.identifier,_pio.convertFromKVArray(f.configuration),f.enabled?!0:!1)}e=a.version;d.myEndpoints=b}}function b(a){var b=[];if(a&&0<a.length)for(var c=0;c!=a.length;c++){var d=a[c];d.type&&d.identifier&&b.push({type:d.type,identifier:d.identifier})}return b}this.myEndpoints="[ERROR: You tried to access notifications.myEndpoints before calling refresh.]";
var d=this,e="";this.refresh=function(b,d){a.notificationsRefresh(e,b,d,c)};this.registerEndpoint=function(b,g,h,k,l,m){var f;a:{if(""!=e)for(f=0;f!=d.myEndpoints.length;f++){var p=d.myEndpoints[f];if(p.type==b&&p.identifier==g){f=p;break a}}f=null}(p=null==f||f.enabled!=k)||(p=JSON.stringify(f.configuration)!=JSON.stringify(h));p?a.notificationsRegisterEndpoints(e,[{type:b,identifier:g,configuration:_pio.convertToKVArray(h),enabled:k}],l,m,c):l&&l()};this.toggleEndpoints=function(d,g,h,k){d=b(d);
0<d.length?a.notificationsToggleEndpoints(e,d,g?!0:!1,h,k,c):h&&h()};this.deleteEndpoints=function(d,g,h){d=b(d);0<d.length?a.notificationsDeleteEndpoints(e,d,g,h,c):g&&g()};this.send=function(b,c,d){for(var e=[],f=0;f!=b.length;f++){var g=b[f],h={recipient:g.recipientUserId,endpointtype:g.endpointType,data:{}};0!=(h.recipient+"").length&&0!=(h.endpointtype+"").length||console.log("error");for(var p in g)"recipientUserId"!=p&&"endpointType"!=p&&(h.data[p]=g[p]);e[f]=h}0<e.length?a.notificationsSend(e,
c,d,null):c&&c()}};_pio.notificationEndpoint=function(a,c,b,d){this.type=a;this.identifier=c;this.configuration=b;this.enabled=d}})();
(function(){_pio.publishingNetwork=function(a,c){var b=this;this.profiles=new _pio.publishingNetworkProfiles(a);this.payments=new _pio.publishingNetworkPayments(a);this.relations=new _pio.publishingNetworkRelations(a,c,this);this.userToken="[ERROR: you tried to access publishingNetwork.userToken before calling publishingNetwork.refresh(callback)]";this.refresh=function(c,e){a.socialRefresh(c,e,function(a){b.userToken=a.myprofile.usertoken;b.profiles.myProfile=new _pio.publishingNetworkProfile(a.myprofile);
"undefined"==typeof _pio.friendLookup&&(_pio.friendLookup={},_pio.blockedLookup={});var c=_pio.friendLookup[b.profiles.myProfile.userId],d=_pio.blockedLookup[b.profiles.myProfile.userId];c||d||(c=_pio.friendLookup[b.profiles.myProfile.userId]={},d=_pio.blockedLookup[b.profiles.myProfile.userId]={});b.relations.friends=[];for(var e=0;e!=a.friends.length;e++){var f=new _pio.publishingNetworkProfile(a.friends[e]);b.relations.friends.push(f);c[f.userId]=!0}for(e=0;e!=a.blocked.length;e++)d[a.blocked[e]]=
!0})}};_pio.showDialog=function(a,c,b,d){if("undefined"==typeof window.PublishingNetwork)throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotAvailable,"PublishingNetwork.js was not found on the current page. You have to include the 'piocdn.com/publishingnetwork.js' on the containing page to show dialogs. See http://playerio.com/documentation/ for more information.");b.__apitoken__=c.token;window.PublishingNetwork.dialog(a,b,d)}})();
(function(){_pio.publishingNetworkPayments=function(a){this.showBuyCoinsDialog=function(c,b,d,e){b||(b={});b.coinamount=c;a.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(b),null,function(b){_pio.showDialog("buy",a,b,function(a){a.error?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,a.error)):d(a)})},e,function(a){return _pio.convertFromKVArray(a.providerarguments)})};this.showBuyItemsDialog=function(c,b,d,e){a.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(b||{}),
_pio.convertBuyItems(c),function(b){_pio.showDialog("buy",a,b,function(a){a.error?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,a.error)):d(a)})},e,function(a){return _pio.convertFromKVArray(a.providerarguments)})}}})();
(function(){_pio.publishingNetworkProfiles=function(a){this.myProfile="[ERROR: you tried to access publishingNetworkProfiles.myProfile before calling publishingNetwork.refresh(callback)]";this.showProfile=function(c,b){_pio.showDialog("profile",a,{userId:c},b)};this.loadProfiles=function(c,b,d){a.socialLoadProfiles(c,b,d,function(a){for(var b=[],d=0;d!=c.length;d++){var e=c[d];b[d]=null;for(var k=0;k!=a.profiles.length;k++){var l=a.profiles[k];if(l&&l.userid==e){b[d]=new _pio.publishingNetworkProfile(a.profiles[k]);
break}}}return b})}};_pio.publishingNetworkProfile=function(a){this.userId=a.userid;this.displayName=a.displayname;this.avatarUrl=a.avatarurl;this.lastOnline=new Date(a.lastonline);this.countryCode=a.countrycode}})();
(function(){_pio.publishingNetworkRelations=function(a,c,b){this.friends="[ERROR: you tried to access publishingNetworkRelations.friends before calling publishingNetwork.refresh(callback)]";this.isFriend=function(a){if("undefined"!=typeof _pio.friendLookup&&"undefined"!=typeof _pio.friendLookup[c])return _pio.friendLookup[c][a]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");
};this.isBlocked=function(a){if("undefined"!=typeof _pio.blockedLookup&&"undefined"!=typeof _pio.blockedLookup[c])return _pio.blockedLookup[c][a]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");};this.showRequestFriendshipDialog=function(b,c){_pio.showDialog("requestfriendship",a,{userId:b},c)};this.showRequestBlockUserDialog=function(c,e){_pio.showDialog("requestblockuser",
a,{userId:c},function(){b.refresh(function(){e&&e()},function(){e&&e()})})};this.showFriendsManager=function(c){_pio.showDialog("friendsmanager",a,{},function(a){a.updated?b.refresh(function(){c&&c()},function(){c&&c()}):c&&c()})};this.showBlockedUsersManager=function(c){_pio.showDialog("blockedusersmanager",a,{},function(a){a.updated?b.refresh(function(){c&&c()},function(){c&&c()}):c&&c()})}}})();
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},c="undefined"!==typeof module&&module.exports,b="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,d=function(){for(var b,c=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],d=0,e=c.length,f={};d<e;d++)if((b=c[d])&&b[1]in a){for(d=0;d<b.length;d++)f[c[0][d]]=
b[d];return f}return!1}(),e={change:d.fullscreenchange,error:d.fullscreenerror},f={request:function(c){var e=d.requestFullscreen;c=c||a.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))c[e]();else c[e](b&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){a[d.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(b,c){var d=e[b];d&&a.addEventListener(d,c,!1)},off:function(b,
c){var d=e[b];d&&a.removeEventListener(d,c,!1)},raw:d};d?(Object.defineProperties(f,{isFullscreen:{get:function(){return!!a[d.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[d.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!a[d.fullscreenEnabled]}}}),c?module.exports=f:window.screenfull=f):c?module.exports=!1:window.screenfull=!1})();
(function(){function a(a){a=String(a);return a.charAt(0).toUpperCase()+a.slice(1)}function c(a,b){var c=-1,e=a?a.length:0;if("number"==typeof e&&-1<e&&e<=t)for(;++c<e;)b(a[c],c,a);else d(a,b)}function b(b){b=String(b).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(b)?b:a(b)}function d(a,b){for(var c in a)x.call(a,c)&&b(a[c],c,a)}function e(b){return null==b?a(b):y.call(b).slice(8,-1)}function f(a,b){var c=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&
("object"==c?!!a[b]:!0)}function g(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function h(a,b){var d=null;c(a,function(c,e){d=b(d,c,e,a)});return d}function k(a){function c(c){return h(c,function(c,d){var e=d.pattern||g(d);!c&&(c=RegExp("\\b"+e+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+e+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+e+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((c=String(d.label&&!RegExp(e,"i").test(d.label)?d.label:c).split("/"))[1]&&!/[\d.]+/.test(c[0])&&(c[0]+=
" "+c[1]),d=d.label||d,c=b(c[0].replace(RegExp(e,"i"),d).replace(RegExp("; *(?:"+d+"[_-])?","i")," ").replace(RegExp("("+d+")[-_.]?(\\w)","i"),"$1 $2")));return c})}function l(b){return h(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}var q=m,p=a&&"object"==typeof a&&"String"!=e(a);p&&(q=a,a=null);var t=q.navigator||{},r=t.userAgent||"";a||(a=r);var x=p?!!t.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(y.toString()),
B=p?"Object":"ScriptBridgingProxyObject",L=p?"Object":"Environment",G=p&&q.java?"JavaPackage":e(q.java),P=p?"Object":"RuntimeObject";L=(G=/\bJava/.test(G)&&q.java)&&e(q.environment)==L;var R=G?"a":"\u03b1",S=G?"b":"\u03b2",M=q.document||{},E=q.operamini||q.opera,I=u.test(I=p&&E?E["[[Class]]"]:e(E))?I:E=null,n,J=a;p=[];var K=null,F=a==r;r=F&&E&&"function"==typeof E.version&&E.version();var z=function(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||g(c))+"\\b","i").exec(a)&&(c.label||
c)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),v=function(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||g(c))+"\\b","i").exec(a)&&(c.label||c)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),A=c([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(b){return h(b,function(b,c,d){return b||(c[A]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(A)]||RegExp("\\b"+g(d)+"(?:\\b|\\w*\\d)","i").exec(a))&&d})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),w=function(c){return h(c,function(c,d){var e=d.pattern||g(d);if(!c&&(c=RegExp("\\b"+e+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))){var f=c,h=d.label||d,k={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};e&&h&&/^Win/i.test(f)&&!/^Windows Phone /i.test(f)&&(k=k[/[\d.]+$/.exec(f)])&&(f="Windows "+k);f=String(f);e&&h&&(f=f.replace(RegExp(e,"i"),h));c=f=b(f.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return c})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);z&&(z=[z]);D&&!A&&(A=c([D]));if(n=/\bGoogle TV\b/.exec(A))A=n[0];/\bSimulator\b/i.test(a)&&(A=(A?A+" ":"")+"Simulator");"Opera Mini"==v&&/\bOPiOS\b/.test(a)&&p.push("running in Turbo/Uncompressed mode");"IE"==v&&/\blike iPhone OS\b/.test(a)?(n=k(a.replace(/like iPhone OS/,"")),D=n.manufacturer,A=n.product):/^iP/.test(A)?(v||(v="Safari"),w="iOS"+((n=/ OS ([\d_]+)/i.exec(a))?" "+n[1].replace(/_/g,"."):"")):"Konqueror"!=v||/buntu/i.test(w)?D&&"Google"!=D&&(/Chrome/.test(v)&&
!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(A))||/\bAndroid\b/.test(w)&&/^Chrome/.test(v)&&/\bVersion\//i.test(a)?(v="Android Browser",w=/\bAndroid\b/.test(w)?w:"Android"):"Silk"==v?(/\bMobi/i.test(a)||(w="Android",p.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&p.unshift("accelerated")):"PaleMoon"==v&&(n=/\bFirefox\/([\d.]+)\b/.exec(a))?p.push("identifying as Firefox "+n[1]):"Firefox"==v&&(n=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(w||(w="Firefox OS"),A||(A=n[1])):!v||(n=!/\bMinefield\b/i.test(a)&&
/\b(?:Firefox|Safari)\b/.exec(v))?(v&&!A&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(n+"/")+8))&&(v=null),(n=A||D||w)&&(A||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(w))&&(v=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(w)?w:n)+" Browser")):"Electron"==v&&(n=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&p.push("Chromium "+n):w="Kubuntu";r||(r=l(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",g(v),"(?:Firefox|Minefield|NetFront)"]));
if(n="iCab"==z&&3<parseFloat(r)&&"WebKit"||/\bOpera\b/.test(v)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(a)&&("Mac OS"==w?"Tasman":"Trident")||"WebKit"==z&&/\bPlayStation\b(?! Vita\b)/i.test(v)&&"NetFront")z=[n];"IE"==v&&(n=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(v+=" Mobile",w="Windows Phone "+(/\+$/.test(n)?n:n+".x"),p.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(v="IE Mobile",w="Windows Phone 8.x",
p.unshift("desktop mode"),r||(r=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=v&&"Trident"==z&&(n=/\brv:([\d.]+)/.exec(a))&&(v&&p.push("identifying as "+v+(r?" "+r:"")),v="IE",r=n[1]);if(F){if(f(q,"global"))if(G&&(n=G.lang.System,J=n.getProperty("os.arch"),w=w||n.getProperty("os.name")+" "+n.getProperty("os.version")),L){try{r=q.require("ringo/engine").version.join("."),v="RingoJS"}catch(Q){(n=q.system)&&n.global.system==q.system&&(v="Narwhal",w||(w=n[0].os||null))}v||(v="Rhino")}else"object"==typeof q.process&&
!q.process.browser&&(n=q.process)&&("object"==typeof n.versions&&("string"==typeof n.versions.electron?(p.push("Node "+n.versions.node),v="Electron",r=n.versions.electron):"string"==typeof n.versions.nw&&(p.push("Chromium "+r,"Node "+n.versions.node),v="NW.js",r=n.versions.nw)),v||(v="Node.js",J=n.arch,w=n.platform,r=(r=/[\d.]+/.exec(n.version))?r[0]:null));else e(n=q.runtime)==B?(v="Adobe AIR",w=n.flash.system.Capabilities.os):e(n=q.phantom)==P?(v="PhantomJS",r=(n=n.version||null)&&n.major+"."+n.minor+
"."+n.patch):"number"==typeof M.documentMode&&(n=/\bTrident\/(\d+)/i.exec(a))?(r=[r,M.documentMode],(n=+n[1]+4)!=r[1]&&(p.push("IE "+r[1]+" mode"),z&&(z[1]=""),r[1]=n),r="IE"==v?String(r[1].toFixed(1)):r[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(v)&&(p.push("masking as "+v+" "+r),v="IE",r="11.0",z=["Trident"],w="Windows");w=w&&b(w)}r&&(n=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(r)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(F&&t.appMinorVersion))||/\bMinefield\b/i.test(a)&&
"a")&&(K=/b/i.test(n)?"beta":"alpha",r=r.replace(RegExp(n+"\\+?$"),"")+("beta"==K?S:R)+(/\d+\+?/.exec(n)||""));if("Fennec"==v||"Firefox"==v&&/\b(?:Android|Firefox OS)\b/.test(w))v="Firefox Mobile";else if("Maxthon"==v&&r)r=r.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(A))"Xbox 360"==A&&(w=null),"Xbox 360"==A&&/\bIEMobile\b/.test(a)&&p.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(v)&&(!v||A||/Browser|Mobi/.test(v))||"Windows CE"!=w&&!/Mobi/i.test(a))if("IE"==v&&F)try{null===q.external&&
p.unshift("platform preview")}catch(Q){p.unshift("embedded")}else(/\bBlackBerry\b/.test(A)||/\bBB10\b/.test(a))&&(n=(RegExp(A.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||r)?(n=[n,/BB10/.test(a)],w=(n[1]?(A=null,D="BlackBerry"):"Device Software")+" "+n[0],r=null):this!=d&&"Wii"!=A&&(F&&E||/Opera/.test(v)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==v&&/\bOS X (?:\d+\.){2,}/.test(w)||"IE"==v&&(w&&!/^Win/.test(w)&&5.5<r||/\bWindows XP\b/.test(w)&&8<r||8==r&&!/\bTrident\b/.test(a)))&&!u.test(n=
k.call(d,a.replace(u,"")+";"))&&n.name&&(n="ing as "+n.name+((n=n.version)?" "+n:""),u.test(v)?(/\bIE\b/.test(n)&&"Mac OS"==w&&(w=null),n="identify"+n):(n="mask"+n,v=I?b(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(n)&&(w=null),F||(r=null)),z=["Presto"],p.push(n));else v+=" Mobile";if(n=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1]){n=[parseFloat(n.replace(/\.(\d)$/,".0$1")),n];if("Safari"==v&&"+"==n[1].slice(-1))v="WebKit Nightly",K="alpha",r=n[1].slice(0,-1);else if(r==n[1]||r==(n[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))r=null;n[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1];537.36==n[0]&&537.36==n[2]&&28<=parseFloat(n[1])&&"WebKit"==z&&(z=["Blink"]);F&&(x||n[1])?(z&&(z[1]="like Chrome"),n=n[1]||(n=n[0],530>n?1:532>n?2:532.05>n?3:533>n?4:534.03>n?5:534.07>n?6:534.1>n?7:534.13>n?8:534.16>n?9:534.24>n?10:534.3>n?11:535.01>n?12:535.02>n?"13+":535.07>n?15:535.11>n?16:535.19>n?17:536.05>n?18:536.1>n?19:537.01>n?20:537.11>n?"21+":537.13>n?23:537.18>n?24:537.24>n?25:537.36>n?26:"Blink"!=
z?"27":"28")):(z&&(z[1]="like Safari"),n=(n=n[0],400>n?1:500>n?2:526>n?3:533>n?4:534>n?"4+":535>n?5:537>n?6:538>n?7:601>n?8:"8"));z&&(z[1]+=" "+(n+="number"==typeof n?".x":/[.+]/.test(n)?"":"+"));"Safari"==v&&(!r||45<parseInt(r))&&(r=n)}"Opera"==v&&(n=/\bzbov|zvav$/.exec(w))?(v+=" ",p.unshift("desktop mode"),"zvav"==n?(v+="Mini",r=null):v+="Mobile",w=w.replace(RegExp(" *"+n+"$"),"")):"Safari"==v&&/\bChrome\b/.exec(z&&z[1])&&(p.unshift("desktop mode"),v="Chrome Mobile",r=null,/\bOS X\b/.test(w)?(D=
"Apple",w="iOS 4.3+"):w=null);r&&0==r.indexOf(n=/[\d.]+$/.exec(w))&&-1<a.indexOf("/"+n+"-")&&(w=String(w.replace(n,"")).replace(/^ +| +$/g,""));z&&!/\b(?:Avant|Nook)\b/.test(v)&&(/Browser|Lunascape|Maxthon/.test(v)||"Safari"!=v&&/^iOS/.test(w)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(v)&&z[1])&&(n=z[z.length-1])&&p.push(n);p.length&&(p=["("+p.join("; ")+")"]);D&&A&&0>A.indexOf(D)&&p.push("on "+D);A&&p.push((/^on /.test(p[p.length-
1])?"":"on ")+A);if(w){var N=(n=/ ([\d.+]+)$/.exec(w))&&"/"==w.charAt(w.length-n[0].length-1);w={architecture:32,family:n&&!N?w.replace(n[0],""):w,version:n?n[1]:null,toString:function(){var a=this.version;return this.family+(a&&!N?" "+a:"")+(64==this.architecture?" 64-bit":"")}}}(n=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(J))&&!/\bi686\b/i.test(J)?(w&&(w.architecture=64,w.family=w.family.replace(RegExp(" *"+n),"")),v&&(/\bWOW64\b/i.test(a)||F&&/\w(?:86|32)$/.test(t.cpuClass||t.platform)&&!/\bWin64; x64\b/i.test(a))&&
p.unshift("32-bit")):w&&/^OS X/.test(w.family)&&"Chrome"==v&&39<=parseFloat(r)&&(w.architecture=64);a||(a=null);q={};q.description=a;q.layout=z&&z[0];q.manufacturer=D;q.name=v;q.prerelease=K;q.product=A;q.ua=a;q.version=v&&r;q.os=w||{architecture:null,family:null,version:null,toString:function(){return"null"}};q.parse=k;q.toString=function(){return this.description||""};q.version&&p.unshift(r);q.name&&p.unshift(v);w&&v&&(w!=String(w).split(" ")[0]||w!=v.split(" ")[0]&&!A)&&p.push(A?"("+w+")":"on "+
w);p.length&&(q.description=p.join(" "));return q}var l={"function":!0,object:!0},m=l[typeof window]&&window||this,q=l[typeof exports]&&exports;l=l[typeof module]&&module&&!module.nodeType&&module;var p=q&&l&&"object"==typeof global&&global;!p||p.global!==p&&p.window!==p&&p.self!==p||(m=p);var t=Math.pow(2,53)-1,u=/\bOpera/;p=Object.prototype;var x=p.hasOwnProperty,y=p.toString,r=k();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(m.platform=r,define(function(){return r})):q&&
l?d(r,function(a,b){q[b]=a}):m.platform=r}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],c=0;c<a.length;c++){var b=document.createElement("meta");b.name=a[c].name;b.content=a[c].content;var d=window.document.head.querySelector('meta[name="'+b.name+'"]');d&&d.parentNode.removeChild(d);window.document.head.appendChild(b)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;
case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}$(document).ready(function(){platform&&"iPhone"===platform.product&&(buildIOSFullscreenPanel(),buildIOSMeta())});jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&iosResize()});
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var c;"undefined"!=typeof window?c=window:"undefined"!=typeof global?c=global:"undefined"!=typeof self&&(c=self);c.TreeModel=a()}}(function(){return function e(c,b,d){function f(h,l){if(!b[h]){if(!c[h]){var k="function"==typeof require&&require;if(!l&&k)return k(h,!0);if(g)return g(h,!0);k=Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",
k;}k=b[h]={exports:{}};c[h][0].call(k.exports,function(b){var d=c[h][1][b];return f(d?d:b)},k,k.exports,e,c,b,d)}return b[h].exports}for(var g="function"==typeof require&&require,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(c,b,d){var e=c("mergesort");var f=c("find-insert-index");b.exports=function(){function b(b){this.config=b=b||{};this.config.childrenPropertyName=b.childrenPropertyName||"children";this.config.modelComparatorFn=b.modelComparatorFn}function c(b,c){this.config=b;this.model=c;
this.children=[]}function d(b,d,e){if(!(d instanceof c))throw new TypeError("Child must be of type Node.");d.parent=b;b.model[b.config.childrenPropertyName]instanceof Array||(b.model[b.config.childrenPropertyName]=[]);if("function"===typeof b.config.modelComparatorFn){var g=f(b.config.modelComparatorFn,b.model[b.config.childrenPropertyName],d.model);b.model[b.config.childrenPropertyName].splice(g,0,d.model);b.children.splice(g,0,d)}else if(void 0===e)b.model[b.config.childrenPropertyName].push(d.model),
b.children.push(d);else{if(0>e||e>b.children.length)throw Error("Invalid index.");b.model[b.config.childrenPropertyName].splice(e,0,d.model);b.children.splice(g,0,d)}return d}function l(){var b={};1===arguments.length?b.fn=arguments[0]:2===arguments.length?"function"===typeof arguments[0]?(b.fn=arguments[0],b.ctx=arguments[1]):(b.options=arguments[0],b.fn=arguments[1]):(b.options=arguments[0],b.fn=arguments[1],b.ctx=arguments[2]);b.options=b.options||{};b.options.strategy||(b.options.strategy="pre");
if(!m[b.options.strategy])throw Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return b}var m={};b.prototype.parse=function(b){var d;if(!(b instanceof Object))throw new TypeError("Model must be of type object.");var f=new c(this.config,b);if(b[this.config.childrenPropertyName]instanceof Array){this.config.modelComparatorFn&&(b[this.config.childrenPropertyName]=e(this.config.modelComparatorFn,b[this.config.childrenPropertyName]));var g=0;for(d=b[this.config.childrenPropertyName].length;g<
d;g++){var h=f,k=this.parse(b[this.config.childrenPropertyName][g]);k.parent=h;h.children.push(k)}}return f};c.prototype.isRoot=function(){return void 0===this.parent};c.prototype.hasChildren=function(){return 0<this.children.length};c.prototype.addChild=function(b){return d(this,b)};c.prototype.addChildAtIndex=function(b,c){if("function"===typeof this.config.modelComparatorFn)throw Error("Cannot add child at index when using a comparator function.");return d(this,b,c)};c.prototype.getPath=function(){var b=
[];(function u(c){b.unshift(c);c.isRoot()||u(c.parent)})(this);return b};c.prototype.walk=function(){var b=l.apply(this,arguments);m[b.options.strategy].call(this,b.fn,b.ctx)};m.pre=function u(b,c){var d;var e=b.call(c,this);var f=0;for(d=this.children.length;f<d;f++){if(!1===e)return!1;e=u.call(this.children[f],b,c)}return e};m.post=function x(b,c){var d;var e=0;for(d=this.children.length;e<d;e++){var f=x.call(this.children[e],b,c);if(!1===f)return!1}return f=b.call(c,this)};m.breadth=function(b,
c){var d=[this];(function r(){var e;if(0!==d.length){var f=d.shift();var g=0;for(e=f.children.length;g<e;g++)d.push(f.children[g]);!1!==b.call(c,f)&&r()}})()};c.prototype.all=function(){var b=[];var c=l.apply(this,arguments);m[c.options.strategy].call(this,function(d){c.fn.call(c.ctx,d)&&b.push(d)},c.ctx);return b};c.prototype.first=function(){var b;var c=l.apply(this,arguments);m[c.options.strategy].call(this,function(d){if(c.fn.call(c.ctx,d))return b=d,!1},c.ctx);return b};c.prototype.drop=function(){if(!this.isRoot()){var b=
this.parent.children.indexOf(this);this.parent.children.splice(b,1);this.parent.model[this.config.childrenPropertyName].splice(b,1);this.parent=void 0;delete this.parent}return this};return b}()},{"find-insert-index":2,mergesort:3}],2:[function(c,b,d){b.exports=function(){return function(b,c,d){var e;var f=0;for(e=c.length;f<e&&!(0<b(c[f],d));f++);return f}}()},{}],3:[function(c,b,d){b.exports=function(){function b(c,d){var e=d.length;if(2<=e){var f=d.slice(0,e/2);e=d.slice(e/2,e);f=b(c,f);e=b(c,
e);for(var g=[],m=f.length,q=e.length;0<m&&0<q;)0>=c(f[0],e[0])?(g.push(f.shift()),m--):(g.push(e.shift()),q--);0<m?g.push.apply(g,f):g.push.apply(g,e);return g}return d.slice()}return b}()},{}]},{},[1])(1)});
var CCTLMultiplayerGui=function(){this._cssClassDomain="ctl-multiplayer-";this._idCurDialog;this._idLoadingDialog;var a=localStorage.getItem("nickname");this._szNickName=null===a?"":a;jQuery(document).on("click","."+this._cssClassDomain+"room-list li",function(){g_oCTLMultiplayer.closeCurrentDialog();var a=jQuery(this).text();"true"===jQuery(this).attr("data-private")?g_oCTLMultiplayer.showTypeRoomPassword(a):(g_oCTLMultiplayer.showLoading("connecting"),on_ctl_multiplayer_join_room(a))})};
CCTLMultiplayerGui.prototype.refreshRoomList=function(a){for(var c="",b=0;b<a.length;b++)c+='<li data-private="'+a[b]["private"]+'">',c+="<span>",c+=a[b].name,c+="</span>",!0===a[b]["private"]&&(c+='<i class="'+this._cssClassDomain+'icons-lock"></i>'),c+="</li>";jQuery("."+this._cssClassDomain+"room-list").html(c)};
CCTLMultiplayerGui.prototype.showRoomList=function(a){var c='<ul class="'+this._cssClassDomain+'room-list">';c=c+'</ul><button onclick="on_ctl_multiplayer_refresh_room_list()" type="button" class="'+(this._cssClassDomain+"update "+this._cssClassDomain+'btn-gray">');c+='<i class="'+this._cssClassDomain+'icons-arrows-cw"></i>';this._idCurDialog=this.showDialog("Match list",c+"<span>update</span></button>",[{txt:"quick match",cb:"on_ctl_multiplayer_join_quick_match",classes:""},{txt:"create match",cb:"on_ctl_multiplayer_show_create_match",
classes:""},{txt:"back",cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}]);this.refreshRoomList(a)};CCTLMultiplayerGui.prototype.setNickName=function(a){this._szNickName=a;localStorage.setItem("nickname",a)};
CCTLMultiplayerGui.prototype.showTypeRoomPassword=function(a){var c='<div class="'+this._cssClassDomain+'form-group">';this._idCurDialog=this.showDialog("Type Room Password",c+'<label>Type Room Password</label><input type="password" name="password" data-room-name="'+(a+'"></div>'),[{txt:"ok",cb:"on_ctl_multiplayer_send_password",classes:""},{txt:"back",cb:"on_ctl_multiplayer_close_type_room_password",classes:""}])};
CCTLMultiplayerGui.prototype.showCreateRoom=function(){var a='<div class="'+this._cssClassDomain+'form-group">';a=a+'<label>Name Room</label><input type="text" name="roomname" value="'+(this._szNickName+"'s room\">");a=a+'</div><div class="'+(this._cssClassDomain+'form-group">');this._idCurDialog=this.showDialog("Create room",a+'<label>Password</label><input type="password" name="password"><p>If you don\'t set a password this room will be public.</p></div>',[{txt:"create",cb:"on_ctl_multiplayer_create_room",
classes:""},{txt:"back",cb:"on_ctl_multiplayer_close_create_room",classes:""}])};CCTLMultiplayerGui.prototype.showChooseNickName=function(){this._idCurDialog=this.showDialog("Choose nickname",'<input type="text" name="nickname" maxlength="20" value="'+this._szNickName+'">',[{txt:"ok",cb:"on_ctl_multiplayer_send_nickname",classes:""},{txt:"close",cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}])};
CCTLMultiplayerGui.prototype.showGeneralDialog=function(a,c){this._idCurDialog=this.showDialog(a,"",[{txt:"back",cb:c,classes:""}])};CCTLMultiplayerGui.prototype.closeLoadingDialog=function(){this.closeDlg(this._idLoadingDialog)};CCTLMultiplayerGui.prototype.closeCurrentDialog=function(){this.closeDlg(this._idCurDialog)};
CCTLMultiplayerGui.prototype.makeCode=function(){for(var a="",c=0;32>c;c++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a};
CCTLMultiplayerGui.prototype.showDialog=function(a,c,b,d){var e="";d||(d=this.makeCode());e+="<div id='"+d+"' class='"+this._cssClassDomain+"dlg-wrapper'>";e+="<div class='"+this._cssClassDomain+"dlg-block'></div>";e+="<div class='"+this._cssClassDomain+"dlg-content'>";e+="<div class='"+this._cssClassDomain+"dlg-header'>";e=e+("<h1>"+a+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body'>");e+=c;e+="</div>";if(b&&0<b.length){e+="<div class='"+this._cssClassDomain+"dlg-footer'>";for(a=
0;a<b.length;a++)e+="<button type='button' onclick='"+b[a].cb+'("'+d+"\");' class='"+this._cssClassDomain+"-mini "+b[a].classes+"'>"+b[a].txt+"</button>";e+=this.buildExtraFooter();e+="</div>"}e+="</div>";e+="</div>";jQuery("body").append(e);return d};CCTLMultiplayerGui.prototype.buildExtraFooter=function(){return'<div class="'+this._cssClassDomain+'copyright"><a href="http://www.codethislab.com" target="_blank">www.codethislab.com</a></div>'};
CCTLMultiplayerGui.prototype.showLoading=function(a,c){var b="";this._idLoadingDialog=this.makeCode();a||(a="Loading...");b+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";b+="<div class='"+this._cssClassDomain+"dlg-block'></div>";b+="<div class='"+this._cssClassDomain+"dlg-content'>";b+="<div class='"+this._cssClassDomain+"dlg-header'>";b=b+("<h1>"+a+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+
"align-center'>");b+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>';b+="</div>";c&&(b+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",b+="<button type='button' onclick='"+c+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"-mini '>back</button>",b+=this.buildExtraFooter(),b+="</div>");b+="</div>";b+="</div>";jQuery("body").append(b)};CCTLMultiplayerGui.prototype.closeDlg=function(a){jQuery("#"+a).remove()};
CCTLMultiplayerGui.prototype.closeAllDialog=function(){g_oCTLMultiplayer.closeLoadingDialog();g_oCTLMultiplayer.closeCurrentDialog()};CCTLMultiplayerGui.prototype.getNickname=function(){return this._szNickName};var g_oCTLMultiplayer=new CCTLMultiplayerGui,s_iScaleFactor=1,s_oCanvasLeft,s_oCanvasTop,s_bIsIphone;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var c=a.toLowerCase(),b=window.document,d=b.documentElement;if(void 0===window["inner"+a])a=d["client"+a];else if(window["inner"+a]!=d["client"+a]){var e=b.createElement("body");e.id="vpw-test-b";e.style.cssText="overflow:scroll";var f=b.createElement("div");f.id="vpw-test-d";f.style.cssText="position:absolute;top:-1000px";f.innerHTML="<style>@media("+c+":"+d["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";e.appendChild(f);d.insertBefore(e,b.head);
a=7==f["offset"+a]?d["client"+a]:window["inner"+a];d.removeChild(e)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}
function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function playSound(a,c,b){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(c),s_aSounds[a].loop(b),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].stop()}function setVolume(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].volume(c)}function setMute(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].mute(c)}
function fadeSound(a,c,b,d){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].fade(c,b,d)}function soundPlaying(a){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return s_aSounds[a].playing()}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var c=getSize("Width");_checkOrientation(c,a);var b=Math.min(a/CANVAS_HEIGHT,c/CANVAS_WIDTH),d=CANVAS_WIDTH*b;b*=CANVAS_HEIGHT;if(b<a){var e=a-b;b+=e;d+=CANVAS_WIDTH/CANVAS_HEIGHT*e}else d<c&&(e=c-d,d+=e,b+=CANVAS_HEIGHT/CANVAS_WIDTH*e);e=a/2-b/2;var f=c/2-d/2,g=CANVAS_WIDTH/d;if(f*g<-EDGEBOARD_X||e*g<-EDGEBOARD_Y)b=Math.min(a/(CANVAS_HEIGHT-2*
EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),d=CANVAS_WIDTH*b,b*=CANVAS_HEIGHT,e=(a-b)/2,f=(c-d)/2,g=CANVAS_WIDTH/d;s_iOffsetX=-1*f*g;s_iOffsetY=-1*e*g;0<=e&&(s_iOffsetY=0);0<=f&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oModeMenu&&s_oModeMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*d,s_oStage.canvas.height=
2*b,canvas.style.width=d+"px",canvas.style.height=b+"px",s_iScaleFactor=2*Math.min(d/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor):s_bMobile||isChrome()?($("#canvas").css("width",d+"px"),$("#canvas").css("height",b+"px")):(s_oStage.canvas.width=d,s_oStage.canvas.height=b,s_iScaleFactor=Math.min(d/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>e?$("#canvas").css("top",e+"px"):$("#canvas").css("top","0px");$("#canvas").css("left",f+"px");
fullscreenHandler()}}
function _checkOrientation(a,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function inIframe(){try{return window.self!==window.top}catch(a){return!0}}function createBitmap(a,c,b){var d=new createjs.Bitmap(a),e=new createjs.Shape;c&&b?e.graphics.beginFill("#fff").drawRect(0,0,c,b):e.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);d.hitArea=e;return d}function createSprite(a,c,b,d,e,f){a=null!==c?new createjs.Sprite(a,c):new createjs.Sprite(a);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-b,-d,e,f);a.hitArea=c;return a}
function pad(a,c,b){a+="";return a.length>=c?a:Array(c-a.length+1).join(b||"0")+a}function randomFloatBetween(a,c,b){"undefined"===typeof b&&(b=2);return parseFloat(Math.min(a+Math.random()*(c-a),c).toFixed(b))}function rotateVector2D(a,c){var b=c.getX()*Math.cos(a)+c.getY()*Math.sin(a),d=c.getX()*-Math.sin(a)+c.getY()*Math.cos(a);c.set(b,d)}function tweenVectorsOnX(a,c,b){return a+b*(c-a)}
function shuffle(a){for(var c=a.length,b,d;0!==c;)d=Math.floor(Math.random()*c),--c,b=a[c],a[c]=a[d],a[d]=b;return a}function bubbleSort(a){do{var c=!1;for(var b=0;b<a.length-1;b++)a[b]>a[b+1]&&(c=a[b],a[b]=a[b+1],a[b+1]=c,c=!0)}while(c)}function compare(a,c){return a.index>c.index?-1:a.index<c.index?1:0}function easeLinear(a,c,b,d){return b*a/d+c}function easeInQuad(a,c,b,d){return b*(a/=d)*a+c}function easeInSine(a,c,b,d){return-b*Math.cos(a/d*(Math.PI/2))+b+c}
function easeInCubic(a,c,b,d){return b*(a/=d)*a*a+c}function getTrajectoryPoint(a,c){var b=new createjs.Point,d=(1-a)*(1-a),e=a*a;b.x=d*c.start.x+2*(1-a)*a*c.traj.x+e*c.end.x;b.y=d*c.start.y+2*(1-a)*a*c.traj.y+e*c.end.y;return b}function formatTime(a){a/=1E3;var c=Math.floor(a/60);a=Math.floor(a-60*c);var b="";b=10>c?b+("0"+c+":"):b+(c+":");return 10>a?b+("0"+a):b+a}function degreesToRadians(a){return a*Math.PI/180}
function checkRectCollision(a,c){var b=getBounds(a,.9);var d=getBounds(c,.98);return calculateIntersection(b,d)}function calculateIntersection(a,c){var b,d,e,f;var g=a.x+(b=a.width/2);var h=a.y+(d=a.height/2);var k=c.x+(e=c.width/2);var l=c.y+(f=c.height/2);g=Math.abs(g-k)-(b+e);h=Math.abs(h-l)-(d+f);return 0>g&&0>h?(g=Math.min(Math.min(a.width,c.width),-g),h=Math.min(Math.min(a.height,c.height),-h),{x:Math.max(a.x,c.x),y:Math.max(a.y,c.y),width:g,height:h,rect1:a,rect2:c}):null}
function getBounds(a,c){var b={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){b.x2=-Infinity;b.y2=-Infinity;var d=a.children,e=d.length,f;for(f=0;f<e;f++){var g=getBounds(d[f],1);g.x<b.x&&(b.x=g.x);g.y<b.y&&(b.y=g.y);g.x+g.width>b.x2&&(b.x2=g.x+g.width);g.y+g.height>b.y2&&(b.y2=g.y+g.height)}Infinity==b.x&&(b.x=0);Infinity==b.y&&(b.y=0);Infinity==b.x2&&(b.x2=0);Infinity==b.y2&&(b.y2=0);b.width=b.x2-b.x;b.height=b.y2-b.y;delete b.x2;delete b.y2}else{if(a instanceof createjs.Bitmap){e=
a.sourceRect||a.image;f=e.width*c;var h=e.height*c}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){e=a.spriteSheet.getFrame(a.currentFrame);f=e.rect.width;h=e.rect.height;d=e.regX;var k=e.regY}else b.x=a.x||0,b.y=a.y||0;else b.x=a.x||0,b.y=a.y||0;d=d||0;f=f||0;k=k||0;h=h||0;b.regX=d;b.regY=k;e=a.localToGlobal(0-d,0-k);g=a.localToGlobal(f-d,h-k);f=a.localToGlobal(f-d,0-k);d=a.localToGlobal(0-d,h-k);b.x=
Math.min(Math.min(Math.min(e.x,g.x),f.x),d.x);b.y=Math.min(Math.min(Math.min(e.y,g.y),f.y),d.y);b.width=Math.max(Math.max(Math.max(e.x,g.x),f.x),d.x)-b.x;b.height=Math.max(Math.max(Math.max(e.y,g.y),f.y),d.y)-b.y}return b}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var c=a.length,b,d;0<c;)d=Math.floor(Math.random()*c),c--,b=a[c],a[c]=a[d],a[d]=b;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);a.dispatchEvent(c)}}};
(function(){function a(a){var b={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in b?document.body.className=b[a.type]:(document.body.className=this[c]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var c="hidden";c in document?document.addEventListener("visibilitychange",a):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(c="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(c="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var c=window.location.search.substring(1).split("&"),b=0;b<c.length;b++){var d=c[b].split("=");if(d[0]==a)return d[1]}}String.prototype.format=function(){for(var a=this,c=arguments.length;c--;)a=a.replace(new RegExp("\\{"+c+"\\}","gm"),arguments[c]);return a};
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut())}
if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oModeMenu&&s_oModeMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a,c,b,d,e,f;this.init=function(g,h,k){b=c=0;d=g;e=h;f=k;a={}};this.addSprite=function(b,d){a.hasOwnProperty(b)||(a[b]={szPath:d,oSprite:new Image},c++)};this.getSprite=function(b){return a.hasOwnProperty(b)?a[b].oSprite:null};this._onSpritesLoaded=function(){e.call(f)};this._onSpriteLoaded=function(){d.call(f);++b==c&&this._onSpritesLoaded()};this.loadSprites=function(){for(var b in a)a[b].oSprite.oSpriteLibrary=this,a[b].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
a[b].oSprite.src=a[b].szPath};this.getNumSprites=function(){return c}}
function CTextButton(a,c,b,d,e,f,g,h){var k,l,m,q,p,t,u;this._init=function(a,b,c,d,e,f,g,h){k=[];l=[];var t=createBitmap(c),r=Math.ceil(g/20);p=new createjs.Text(d,"bold "+g+"px "+e,"#000000");p.textAlign="center";p.textBaseline="alphabetic";var u=p.getBounds();p.x=c.width/2+r;p.y=Math.floor(c.height/2)+u.height/3+r;q=new createjs.Text(d,"bold "+g+"px "+e,f);q.textAlign="center";q.textBaseline="alphabetic";u=q.getBounds();q.x=c.width/2;q.y=Math.floor(c.height/2)+u.height/3;m=new createjs.Container;
m.x=a;m.y=b;m.regX=c.width/2;m.regY=c.height/2;m.addChild(t,p,q);h.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",t);m.off("pressup",u);h.removeChild(m)};this.setVisible=function(a){m.visible=a};this._initListener=function(){oParent=this;t=m.on("mousedown",this.buttonDown);u=m.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){k[a]=b;l[a]=c};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;k[ON_MOUSE_UP]&&k[ON_MOUSE_UP].call(l[ON_MOUSE_UP])};this.buttonDown=
function(){m.scaleX=.9;m.scaleY=.9;k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};this.setTextPosition=function(a){q.y=a;p.y=a+2};this.setPosition=function(a,b){m.x=a;m.y=b};this.setX=function(a){m.x=a};this.setY=function(a){m.y=a};this.getButtonImage=function(){return m};this.getX=function(){return m.x};this.getY=function(){return m.y};this.removeStroke=function(){p.visible=!1};this._init(a,c,b,d,e,f,g,h);return this}
function CToggle(a,c,b,d,e){var f,g,h,k,l,m,q;this._init=function(a,b,c,d,e){g=[];h=[];var l=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});f=d;k=createSprite(l,"state_"+f,c.width/2/2,c.height/2,c.width/2,c.height);k.x=a;k.y=b;k.stop();e.addChild(k);this._initListener()};this.unload=function(){s_bMobile?k.off("mousedown",l):(k.off("mousedown",l),k.off("mouseover",m));k.off("pressup",q);e.removeChild(k)};
this._initListener=function(){s_bMobile?l=k.on("mousedown",this.buttonDown):(l=k.on("mousedown",this.buttonDown),m=k.on("mouseover",this.buttonOver));q=k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){g[a]=b;h[a]=c};this.setActive=function(a){f=a;k.gotoAndStop("state_"+f)};this.buttonRelease=function(){k.scaleX=1;k.scaleY=1;playSound("click",1,!1);f=!f;k.gotoAndStop("state_"+f);g[ON_MOUSE_UP]&&g[ON_MOUSE_UP].call(h[ON_MOUSE_UP],f)};this.buttonDown=function(){k.scaleX=.9;k.scaleY=
.9;g[ON_MOUSE_DOWN]&&g[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN])};this.buttonOver=function(a){s_bMobile||(a.target.cursor="pointer")};this.setPosition=function(a,b){k.x=a;k.y=b};this.setVisible=function(a){k.visible=a};this._init(a,c,b,d,e)}
function CGfxButton(a,c,b,d){var e,f,g,h,k,l,m,q;this._init=function(a,b,c,d){e=!1;f=1;g=[];h=[];k=createBitmap(c);k.x=a;k.y=b;k.scaleX=k.scaleY=f;k.regX=c.width/2;k.regY=c.height/2;d.addChild(k);this._initListener()};this.unload=function(){s_bMobile?k.off("mousedown",l):(k.off("mousedown",l),k.off("mouseover",m));k.off("pressup",q);d.removeChild(k)};this.setVisible=function(a){k.visible=a};this.setClickable=function(a){e=!a};this.setScale=function(a){f=a;k.scaleX=f;k.scaleY=f};this._initListener=
function(){s_bMobile?l=k.on("mousedown",this.buttonDown):(l=k.on("mousedown",this.buttonDown),m=k.on("mouseover",this.buttonOver));q=k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){g[a]=b;h[a]=c};this.buttonRelease=function(){e||(k.scaleX=f,k.scaleY=f,g[ON_MOUSE_UP]&&g[ON_MOUSE_UP].call(h[ON_MOUSE_UP]))};this.buttonDown=function(){e||(k.scaleX=.9*f,k.scaleY=.9*f,playSound("click",1,!1),g[ON_MOUSE_DOWN]&&g[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN]))};this.buttonOver=function(a){s_bMobile||
e||(a.target.cursor="pointer")};this.pulseAnimation=function(){createjs.Tween.get(k).to({scaleX:.9*f,scaleY:.9*f},850,createjs.Ease.quadOut).to({scaleX:f,scaleY:f},650,createjs.Ease.quadIn).call(function(){p.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(k).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){p.trebleAnimation()})};this.setPosition=function(a,b){k.x=a;k.y=b};
this.setX=function(a){k.x=a};this.setY=function(a){k.y=a};this.getButtonImage=function(){return k};this.getX=function(){return k.x};this.getY=function(){return k.y};var p=this;this._init(a,c,b,d);return this}
var ON_CONNECTION_ERROR=0,ON_DISCONNECTION=1,ON_LOGIN_SUCCESS=2,ON_MATCHMAKING_CONNECTION_SUCCESS=3,ON_GAMEROOM_CONNECTION_SUCCESS=4,ON_USEROWNERROOM_CREATE_SUCCESS=5,ON_USEROWNERROOM_JOIN_SUCCESS=6,ON_ROOM_INFO_RETURNED=7,ON_BACK_FROM_A_ROOM=8,ERROR_CODE_UNKNOWNROOM="UnknownRoom",ROOM_TYPE_MATCHMAKING="MatchmakingRoom",ROOM_TYPE_USEROWNER="UserOwnerRoom",ROOM_TYPE_GAME="GameRoom";
function CNetworkManager(){var a,c,b,d,e,f,g,h,k,l,m;this._init=function(){a=[];c=[];e=new CNetworkMessageForwarder};this.unload=function(){s_oNetworkManager=null};this.connectToSystem=function(){s_oNetworkManager.addEventListener(ON_LOGIN_SUCCESS,s_oNetworkManager.gotoLobby);g_oCTLMultiplayer.showChooseNickName()};this.login=function(b){g=b;b=this._setValidNick(b);PlayerIO.useSecureApiRequests=!MULTIPLAYER_TEST_LOCAL;PlayerIO.authenticate(GAME_PLAYERIO_ID,"public",{userId:b},{},function(b){d=b;d.multiplayer.useSecureConnections=
!MULTIPLAYER_TEST_LOCAL;MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184",d.multiplayer.createJoinRoom("fakeroom"+Math.random(),"fakeroom",!1,null,null,function(a){a.addMessageCallback("*",e.messageHandler);a.addDisconnectCallback(s_oNetworkManager.callbackDisconnect)},s_oNetworkManager.callbackError));a[ON_LOGIN_SUCCESS]&&a[ON_LOGIN_SUCCESS].call(c[ON_LOGIN_SUCCESS])},s_oNetworkManager.callbackError)};this._setValidNick=function(a){var b=s_oNetworkManager._getRandomCodeNumber();
""===a?g=a="guest-"+b:a=a+"-"+b;return a};this._getRandomCodeNumber=function(){return Math.floor(1E3*Math.random())};this.generateRandomName=function(){var a="xmariox alex max mahuro biajus rob idah fabrix seth ikillyou commander admiral general seasalt emperorofthesea Aspect Kraken Dragon Shiver Dracula Doom Scar Roadkill Cobra Psycho Ranger Ripley Clink Bruise Bowser Creep Cannon Daemon Steel Tempest Hurricane Titanium Tito Lightning IronHeart Sabotage Rex Hydra Terminator Agrippa Gash Blade Katana Gladius Angon Claymore Pike Hammer Club Heart Gauntlet Montante Longbow bow Dagger".split(" "),
b=Math.floor(Math.random()*a.length);a=a[b];if(.5<Math.random()){var c=Math.floor(100*Math.random());if(.5<Math.random()){var d=["-","_"];b=Math.floor(Math.random()*d.length);a+=d[b]}a+=c}return m=a};this.getBotName=function(){return m};this.addEventListener=function(b,d,e){a[b]=d;c[b]=e};this.callbackError=function(b){a[ON_CONNECTION_ERROR]&&a[ON_CONNECTION_ERROR].call(c[ON_CONNECTION_ERROR],b)};this.callbackDisconnect=function(b){a[ON_DISCONNECTION]&&a[ON_DISCONNECTION].call(c[ON_DISCONNECTION],
b)};this.sendMsg=function(a,c){b&&b.send(a,c)};this.disconnect=function(){b&&(b.disconnect(),b=null)};this.isUserA=function(){return 0===parseInt(f)?!0:!1};this.getPlayerOrderID=function(){return f};this.getPlayerNickname=function(){return g};this.getEnemyNickname=function(){return h};this.createRoom=function(f,h){s_oNetworkManager.addEventListener(ON_USEROWNERROOM_CREATE_SUCCESS,this._onRoomCreated);MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.createJoinRoom(f,
ROOM_TYPE_USEROWNER,!0,{id:f,pass:h},{nickname:g},function(d){b=d;d.addMessageCallback("*",e.messageHandler);d.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_USEROWNERROOM_CREATE_SUCCESS]&&a[ON_USEROWNERROOM_CREATE_SUCCESS].call(c[ON_USEROWNERROOM_CREATE_SUCCESS])},s_oNetworkManager.callbackError)};this.joinRoom=function(f){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,this._onRoomJoinedFailed);MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.joinRoom(f,
{nickname:g},function(d){b=d;d.addMessageCallback("*",e.messageHandler);d.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_USEROWNERROOM_JOIN_SUCCESS]&&a[ON_USEROWNERROOM_JOIN_SUCCESS].call(c[ON_USEROWNERROOM_JOIN_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoGameRoom=function(g){MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");var k=g.getString(0);f=g.getInt(1);h=g.getString(2);d.multiplayer.createJoinRoom(k,ROOM_TYPE_GAME,!1,null,null,function(d){b=
d;d.addMessageCallback("*",e.messageHandler);d.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);g_oCTLMultiplayer.closeAllDialog();a[ON_GAMEROOM_CONNECTION_SUCCESS]&&a[ON_GAMEROOM_CONNECTION_SUCCESS].call(c[ON_GAMEROOM_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.gotoMatchMakingRoom=function(){MULTIPLAYER_TEST_LOCAL&&(d.multiplayer.developmentServer="localhost:8184");d.multiplayer.createJoinRoom("matchmakingroom1",ROOM_TYPE_MATCHMAKING,!0,null,{nickname:g},function(d){b=
d;d.addMessageCallback("*",e.messageHandler);d.addDisconnectCallback(s_oNetworkManager.callbackDisconnect);a[ON_MATCHMAKING_CONNECTION_SUCCESS]&&a[ON_MATCHMAKING_CONNECTION_SUCCESS].call(c[ON_MATCHMAKING_CONNECTION_SUCCESS])},s_oNetworkManager.callbackError)};this.tryCreateUniqueRoom=function(a,b){k=a;l=b;d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:a},0,0,s_oNetworkManager._onUniqueListRoomSearch,s_oNetworkManager.callbackError)};this._onUniqueListRoomSearch=function(a){0<a.length&&(k+="-"+s_oNetworkManager._getRandomCodeNumber());
s_oNetworkManager.createRoom(k,l)};this._onRoomCreated=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_WAITING_FOR_OPPONENT_IN_ROOM+k,"s_oNetworkManager._onDisconnectFromARoom")};this._onDisconnectFromARoom=function(){a[ON_BACK_FROM_A_ROOM]&&a[ON_BACK_FROM_A_ROOM].call(c[ON_BACK_FROM_A_ROOM]);s_oNetworkManager.disconnect();setTimeout(function(){s_oNetworkManager.gotoLobby()},250)};this._onRoomJoined=function(){};this._onRoomJoinedFailed=function(a){s_oNetworkManager.addEventListener(ON_CONNECTION_ERROR,
function(){});switch(a.code){case ERROR_CODE_UNKNOWNROOM:g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby")}};this.gotoLobby=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY);d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,s_oNetworkManager._onListRoom,s_oNetworkManager.callbackError)};this._onListRoom=function(a){for(var b=[],c=0;c<a.length;c++)b[c]={name:a[c].id,"private":0===
a[c].roomData.pass.length?!1:!0};g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showRoomList(b)};this.joinQuickMatch=function(){g_oCTLMultiplayer.showLoading(TEXT_FIND_OPPONENT,"s_oNetworkManager._onDisconnectFromARoom");s_oNetworkManager.gotoMatchMakingRoom()};this.tryJoinRoomWithPass=function(a,b){k=a;l=b;s_oNetworkManager.addEventListener(ON_ROOM_INFO_RETURNED,s_oNetworkManager._checkUserPermissionToJoin);s_oNetworkManager.getRoomInfo(a,b)};this._checkUserPermissionToJoin=function(a){0<a.length?
s_oNetworkManager.joinRoom(a[0].roomData.id,a[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_WRONG_PASSWORD,"s_oNetworkManager._onPasswordFailed"))};this._onPasswordFailed=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showTypeRoomPassword(k)};this.getRoomInfo=function(a,b){d.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:a,pass:b},0,0,s_oNetworkManager._onRoomInfoReturned,s_oNetworkManager.callbackError)};this._onRoomInfoReturned=function(b){a[ON_ROOM_INFO_RETURNED]&&
a[ON_ROOM_INFO_RETURNED].call(c[ON_ROOM_INFO_RETURNED],b)};this._init()}var MSG_ROOM_IS_FULL="room_is_full",MSG_GAME_FOUND="game_found",MSG_SET_WINNER="set_winner",MSG_REMATCH_PANEL="rematch_panel",MSG_REMATCH_ANSWER_RESULTS="rematch_answer_results",MSG_ENEMY_MOVES="enemy_moves",MSG_END_MATCH="end_match",MSG_ACCEPT_REMATCH="accept_rematch",MSG_DISCONNECTION="disconnection",MSG_MOVE="move";
function CNetworkMessageForwarder(){this._init=function(){};this.messageHandler=function(c){switch(c.type){case MSG_ROOM_IS_FULL:a._onFullRoom(c);break;case MSG_GAME_FOUND:a._onGameFound(c);break;case MSG_SET_WINNER:a._onSetWinner(c);break;case MSG_REMATCH_PANEL:a._onRematchPanel(c);break;case MSG_REMATCH_ANSWER_RESULTS:a._onRematchResults(c);break;case MSG_ENEMY_MOVES:a._onEnemyMoves(c)}};this._onFullRoom=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_FULL,
"s_oNetworkManager.gotoLobby")};this._onGameFound=function(a){s_oNetworkManager.gotoGameRoom(a)};this._onSetWinner=function(a){s_oGame.opponentLeftTheGame()};this._onRematchPanel=function(){s_oGame.showRematchQuestion()};this._onRematchResults=function(a){if(a.getBoolean(0))s_oGame.onOpponentAcceptRematch();else s_oGame.onOpponentRefuseRematch()};this._onEnemyMoves=function(a){a=a.getString(0);a=JSON.parse(a);s_oGame.remoteMovePiece(a[MSG_MOVE])};var a=this;this._init()}
function CTree(a){var c,b,d;this._init=function(a){c=[];for(var e=0;e<NUM_CELL;e++){c[e]=[];for(var g=0;g<NUM_CELL;g++)c[e][g]=[]}b=new TreeModel;d=b.parse(a);c[a.row][a.col][0]=d};this.getRoot=function(){return d};this.addNode=function(a,d,g,h,k,l,m,q){c[h][k][l]=b.parse({row:h,col:k,eatenrow:m,eatencol:q});c[a][d][g].addChild(c[h][k][l])};this.getNode=function(a,b){c[a][b][0]=d.all(function(c){return c.model.row===a&&c.model.col===b});return c[a][b][0]};this.getPath=function(a){return a.getPath()};
this.getTerminalNodes=function(){return d.all(function(a){return!a.hasChildren()})};this._init(a)}
function CTreeDecision(a){var c,b,d;this._init=function(a){c=[];for(var e=0;e<SEARCH_DEPTH+1;e++)c[e]=[];b=new TreeModel;d=b.parse(a);c[0][0]=d};this.getRoot=function(){return d};this.addNode=function(a,d,g,h,k,l,m,q){c[g][h]=b.parse({rating:k,moves:l,depth:g,blackmatrix:m,whitematrix:q});c[a][d].addChild(c[g][h])};this.getNode=function(a,b){return d.all(function(c){return c.model.rating===a&&c.model.depth===b})};this.getPath=function(a){return a.getPath()};this.getTerminalNodes=function(){return d.all(function(a){return!a.hasChildren()})};
this._init(a)}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=1920,EDGEBOARD_X=190,EDGEBOARD_Y=220,FPS=30,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,GAME_ORIENTATION="portrait",GAME_PLAYERIO_ID="master-checkers-agfxptrvxus8i2sijggd4g",GAME_NAME="master_checkers",MULTIPLAYER_TEST_LOCAL=!1,PRIMARY_FONT="arialrounded",STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,MODE_HUMAN=0,MODE_COMPUTER=1,EASY_MODE=0,MEDIUM_MODE=1,HARD_MODE=2,
BOARD8=0,NUM_CELL=8,TOT_CELL=64,BOARD_LENGTH=815,CELL_LENGTH=BOARD_LENGTH/NUM_CELL,BG_BLACK=0,BG_WHITE=1,DRAW=-1,WIN_WHITE=0,WIN_BLACK=1,WIN_WHITE_BLACK_NOMOVES=2,WIN_BLACK_WHITE_NOMOVES=3,PAWN_WHITE=0,PAWN_BLACK=1,KING_WHITE=2,KING_BLACK=3,PAWN_NULL=-1,PAWN_STOP=-1,PAWN_MOVE=0,PAWN_EAT=1,ALERT_TYPE_NOMOVES=0,ALERT_TYPE_STALL=1,PAWN_SIZE=100,TIME_MOVE=500,TIME_LOOP_WAIT=1E3,MIN_AI_THINKING=1E3,MAX_AI_THINKING=1500,SEARCH_DEPTH=4,DRAW_COUNTER=40,TIME_AD=12E4,ENABLE_CHECK_ORIENTATION,ENABLE_FULLSCREEN,
TEXT_PRELOADER_CONTINUE="START",TEXT_GAMEOVER="WINS",TEXT_DRAW="DRAW",TEXT_MOVES="MOVES",TEXT_THINKING="THINKING",TEXT_WAITING_MOVES="WAITING OPPONENT",TEXT_ARE_SURE="ARE YOU SURE?",TEXT_WINS="({0} WINS)",TEXT_MODE="CHOOSE GAME MODE",TEXT_BLACK="BLACK",TEXT_WHITE="WHITE",TEXT_JUMP="MANDATORY JUMP!",TEXT_MOVES_AVAIL="NO MOVES AVAILABLE",TEXT_CREDITS_DEVELOPED="DEVELOPED BY",TEXT_SHARE_IMAGE="200x200.jpg",TEXT_SHARE_TITLE="Congratulations!",TEXT_SHARE_MSG1="You collected <strong>",TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!",
TEXT_SHARE_SHARE1="My score is ",TEXT_SHARE_SHARE2=" points! Can you do better?",TEXT_NETWORK_CONNECTING="CONNECTING...",TEXT_WAIT_OPPONENT="WAITING OPPONENT...",TEXT_OPPONENT_LEFT="OPPONENT LEFT!",TEXT_PLAYER_DISCONNECTED="YOU LEFT!",TEXT_REMATCH="do you want the re-match?",TEXT_WRONG_PASSWORD="Wrong Password!",TEXT_ROOM_IS_FULL="Room is full!",TEXT_FIND_OPPONENT="finding opponent...",TEXT_CONNECT_TO_LOBBY="Connect to lobby...",TEXT_ROOM_DOESNT_EXIST="Room doesn't exist!",TEXT_WAITING_FOR_OPPONENT_IN_ROOM=
"waiting for opponent in room: ";
function CPreloader(){var a,c,b,d,e,f,g,h,k,l;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();l=new createjs.Container;s_oStage.addChild(l)};this.unload=function(){l.removeAllChildren();k.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(m);m=s_oSpriteLibrary.getSprite("200x200");g=createBitmap(m);g.regX=.5*m.width;g.regY=.5*m.height;g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2-180;l.addChild(g);h=new createjs.Shape;h.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(g.x-100,g.y-100,200,200,10);l.addChild(h);g.mask=h;
m=s_oSpriteLibrary.getSprite("progress_bar");d=createBitmap(m);d.x=CANVAS_WIDTH/2-m.width/2;d.y=CANVAS_HEIGHT/2+50;l.addChild(d);a=m.width;c=m.height;e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(d.x,d.y,1,c);l.addChild(e);d.mask=e;b=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2+100;b.textBaseline="alphabetic";b.textAlign="center";l.addChild(b);m=s_oSpriteLibrary.getSprite("but_start");k=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,m,TEXT_PRELOADER_CONTINUE,"Arial","#000",40,l);k.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);k.setVisible(!1);f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(f);createjs.Tween.get(f).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(f);l.removeChild(f)})};this._onButStartRelease=function(){$(s_oMain).trigger("show_preroll_ad");s_oMain._onRemovePreloader()};this.refreshLoader=function(f){b.text=f+"%";100===f&&(k.setVisible(!0),
b.visible=!1,d.visible=!1);e.graphics.clear();f=Math.floor(f*a/100);e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(d.x,d.y,f,c)};this._init()}
function CCreditsPanel(){var a,c,b,d,e,f,g,h,k;this._init=function(){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;s_oStage.addChild(e);createjs.Tween.get(e).to({alpha:.7},500);var l=s_oSpriteLibrary.getSprite("msg_box");k=new createjs.Container;k.y=CANVAS_HEIGHT+l.height/2;s_oStage.addChild(k);a=createBitmap(l);a.regX=l.width/2;a.regY=l.height/2;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2;k.addChild(a);f=new createjs.Shape;f.graphics.beginFill("#0f0f0f").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=.01;g=f.on("click",this._onLogoButRelease);k.addChild(f);l=s_oSpriteLibrary.getSprite("but_exit");b=new CGfxButton(1E3,610,l,k);b.addEventListener(ON_MOUSE_UP,this.unload,this);d=new createjs.Text(TEXT_CREDITS_DEVELOPED,"80px "+PRIMARY_FONT,"#402604");d.textAlign="center";d.textBaseline="alphabetic";d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-100;k.addChild(d);l=s_oSpriteLibrary.getSprite("logo_ctl");c=createBitmap(l);c.regX=l.width/2;c.regY=l.height/2;c.x=CANVAS_WIDTH/
2;c.y=CANVAS_HEIGHT/2;k.addChild(c);h=new createjs.Text("www.codethislab.com","68px "+PRIMARY_FONT,"#402604");h.textAlign="center";h.textBaseline="alphabetic";h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2+130;k.addChild(h);l=new createjs.Text("v2","14px "+PRIMARY_FONT,"#402604");l.textAlign="center";l.textBaseline="alphabetic";l.x=CANVAS_WIDTH/2-370;l.y=CANVAS_HEIGHT/2+370;k.addChild(l);(new createjs.Tween.get(k)).to({y:0},1E3,createjs.Ease.backOut)};this.unload=function(){f.off("click",g);b.unload();b=
null;s_oStage.removeChild(e);s_oStage.removeChild(k)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CMain(a){var c,b=0,d=0,e=STATE_LOADING,f;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=
!0);s_oSpriteLibrary=new CSpriteLibrary;s_oNetworkManager=new CNetworkManager;f=new CPreloader};this.preloaderReady=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();c=!0};this.soundLoaded=function(){b++;f.refreshLoader(Math.floor(b/d*100))};this._initSounds=function(){var a=[];a.push({path:"./sounds/",filename:"press_button",loop:!1,volume:1,ingamename:"click"});a.push({path:"./sounds/",filename:"ot_game_over",loop:!1,volume:1,ingamename:"game_over"});a.push({path:"./sounds/",
filename:"ot_click_cell",loop:!1,volume:1,ingamename:"click_cell"});a.push({path:"./sounds/",filename:"ot_win",loop:!1,volume:1,ingamename:"win"});a.push({path:"./sounds/",filename:"drawer",loop:!1,volume:1,ingamename:"drawer"});a.push({path:"./sounds/",filename:"king",loop:!1,volume:1,ingamename:"king"});d+=a.length;s_aSounds=[];for(var b=0;b<a.length;b++)s_aSounds[a[b].ingamename]=new Howl({src:[a[b].path+a[b].filename+".mp3"],autoplay:!1,preload:!0,loop:a[b].loop,volume:a[b].volume,onload:s_oMain.soundLoaded})};
this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("local_but","./sprites/local_but.png");s_oSpriteLibrary.addSprite("multiplayer_but","./sprites/multiplayer_but.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_mod_menu","./sprites/bg_mod_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");
s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_vs_man","./sprites/vs_man_panel.png");s_oSpriteLibrary.addSprite("but_vs_pc","./sprites/vs_pc_panel.png");s_oSpriteLibrary.addSprite("message","./sprites/message.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon",
"./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_settings","./sprites/but_settings.png");s_oSpriteLibrary.addSprite("white_chip","./sprites/chip_vertical_white.png");s_oSpriteLibrary.addSprite("black_chip","./sprites/chip_vertical_black.png");s_oSpriteLibrary.addSprite("board8","./sprites/grid_8.png");s_oSpriteLibrary.addSprite("chip_box","./sprites/chip_box.png");s_oSpriteLibrary.addSprite("chip_flip_white","./sprites/chip_flip_white.png");s_oSpriteLibrary.addSprite("chip_flip_black",
"./sprites/chip_flip_black.png");s_oSpriteLibrary.addSprite("highlight","./sprites/highlight.png");s_oSpriteLibrary.addSprite("bg_turn","./sprites/player_panel.png");s_oSpriteLibrary.addSprite("pawn","./sprites/pawn.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_show",
"./sprites/but_show.png");if(CloudAPI.logos.active()){var a=CloudAPI.logos.list();s_oSpriteLibrary.addSprite("logo_publisher",a.vertical)}d+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){b++;f.refreshLoader(Math.floor(b/d*100))};this._onRemovePreloader=function(){CloudAPI.play();f.unload();this.gotoMenu()};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.gotoMenu=function(){new CMenu;e=STATE_MENU};
this.gotoModeMenu=function(){new CModeMenu;e=STATE_MENU};this.gotoGame=function(a){s_iGameType=a;s_oGame=new CGameSingle(g);e=STATE_GAME};this.gotoGameMulti=function(){s_iGameType=MODE_HUMAN;s_oGame=new CGameMulti(g);e=STATE_GAME};this.gotoGameWithBot=function(){s_oGame=_oGame=new CGameSingleWithBot(g);e=STATE_GAME};this.gotoHelp=function(){new CHelp;e=STATE_HELP};this.stopUpdate=function(){c=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=
(new Date).getTime();c=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");s_bAudioActive&&Howler.mute(!1)};this._update=function(a){if(!1!==c){var b=(new Date).getTime();s_iTimeElaps=b-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=b;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);e===STATE_GAME&&s_oGame.update();s_oStage.update(a)}};s_oMain=this;var g=a;ENABLE_CHECK_ORIENTATION=a.check_orientation;ENABLE_FULLSCREEN=a.fullScreen;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oStage,s_oMain,s_oSpriteLibrary,s_oCanvas,s_iGameType,s_bWeightSquares=!1,s_bEdgeSensitive=!1,s_aSounds,s_oNetworkManager=null,s_bMultiplayer=!1;
function CMessage(a,c){var b,d,e,f;this._init=function(a,c){a===PAWN_WHITE?(b=400,d=-200,e=1490):(b=920,d=CANVAS_HEIGHT+200,e=430);f=new createjs.Container;f.x=b;f.y=d;s_bMobile&&a===PAWN_BLACK&&!s_bMultiplayer&&(f.rotation=180);s_oStage.addChild(f);var g=s_oSpriteLibrary.getSprite("message"),h=createBitmap(g);h.regX=g.width/2;h.regY=g.height/2;g=new createjs.Text(c," 40px "+PRIMARY_FONT,"#ffffff");g.textAlign="center";g.textBaseline="top";g.lineWidth=350;g.regY=g.getBounds().height/2;f.addChild(h,
g);createjs.Tween.get(f).to({y:e},2E3,createjs.Ease.bounceOut)};this.unload=function(){s_oStage.removeChild(f)};this._init(a,c)}
function CMenu(){var a,c,b,d,e,f,g,h,k,l,m,q,p,t,u,x,y=null,r=null,B,C;this._init=function(){l=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(l);var k=s_oSpriteLibrary.getSprite("local_but");m=new CGfxButton(CANVAS_WIDTH/2-50,CANVAS_HEIGHT-450,k,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this);k=s_oSpriteLibrary.getSprite("multiplayer_but");q=new CGfxButton(CANVAS_WIDTH/2+300,CANVAS_HEIGHT-450,k,s_oStage);q.addEventListener(ON_MOUSE_UP,this._onButMultiplayerRelease,
this);k=s_oSpriteLibrary.getSprite("but_credits");e=20+k.width/2;f=k.height/2+25;u=new CGfxButton(e,f,k,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onCredits,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k=s_oSpriteLibrary.getSprite("audio_icon"),a=CANVAS_WIDTH-k.height/2-10,c=k.height/2+25,t=new CToggle(a,c,k,s_bAudioActive,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);k=window.document;var H=k.documentElement;y=H.requestFullscreen||H.mozRequestFullScreen||H.webkitRequestFullScreen||
H.msRequestFullscreen;r=k.exitFullscreen||k.mozCancelFullScreen||k.webkitExitFullscreen||k.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(y=!1);y&&screenfull.enabled&&(k=s_oSpriteLibrary.getSprite("but_fullscreen"),b=e+k.width/2+10,d=f,x=new CToggle(b,d,k,s_bFullscreen,s_oStage),x.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),x.setVisible(!1));CloudAPI.logos.active()&&(k=s_oSpriteLibrary.getSprite("logo_publisher"),g=k.width/2*.4+10,h=CANVAS_HEIGHT-k.height/2*.4-10,C=new createjs.Container,
C.x=g,C.y=h,s_oStage.addChild(C),B=new CGfxButton(0,0,k,C),B.setScale(.4),B.addEventListener(ON_MOUSE_UP,this._onLogo,this));p=new createjs.Shape;p.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(p);createjs.Tween.get(p).to({alpha:0},1E3).call(function(){p.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){m.unload();m=null;q.unload();q=null;p.visible=!1;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t.unload(),t=null;u.unload();
y&&screenfull.enabled&&x.unload();CloudAPI.logos.active()&&B.unload();s_oStage.removeChild(l);s_oMenu=l=null};this.refreshButtonPos=function(k,l){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||t.setPosition(a-k,l+c);u.setPosition(e+k,l+f);y&&screenfull.enabled&&x.setPosition(b+k,l+d);CloudAPI.logos.active()&&(C.x=g+s_iOffsetX,C.y=h-s_iOffsetY)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onCredits=function(){new CCreditsPanel};this.resetFullscreenBut=
function(){y&&screenfull.enabled&&x.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?r.call(window.document):y.call(window.document.documentElement);sizeHandler()};this._onButLocalRelease=function(){this.unload();s_bPlayWithBot=s_bMultiplayer=!1;$(s_oMain).trigger("start_session");s_oMain.gotoModeMenu()};this._onButMultiplayerRelease=function(){$(s_oMain).trigger("start_session");s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,
this._onGameStart);s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._checkMatchWithBot);s_oNetworkManager.addEventListener(ON_BACK_FROM_A_ROOM,this.clearBotCheck);s_oNetworkManager.connectToSystem()};this._onGameStart=function(){s_oMenu.clearBotCheck();s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oMenu.unload();s_oMain.gotoGameMulti()};this._checkMatchWithBot=function(){var a=randomFloatBetween(18E3,26E3);k=setTimeout(function(){s_bPlayWithBot=s_bMultiplayer=!0;s_iGameType=MODE_COMPUTER;
g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.disconnect();s_oNetworkManager.generateRandomName();s_oMenu.unload();s_oMain.gotoGameWithBot()},a)};this.clearBotCheck=function(){clearTimeout(k)};this._onLogo=function(){CloudAPI.links.active()&&window.open(CloudAPI.links.list().logo)};s_oMenu=this;this._init()}var s_oMenu=null;
function CModeMenu(){var a,c,b,d,e,f,g,h,k,l,m=null,q,p=null,t=null;this._init=function(){var u=createBitmap(s_oSpriteLibrary.getSprite("bg_mod_menu"));s_oStage.addChild(u);u=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-u.height/2-10;c=u.height/2+25;l=new CGfxButton(a,c,u,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onExit,this);b=CANVAS_WIDTH-u.width/2-125;d=u.height/2+25;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u=s_oSpriteLibrary.getSprite("audio_icon"),m=new CToggle(b,d,u,s_bAudioActive,
s_oStage),m.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);u=window.document;var x=u.documentElement;p=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;t=u.exitFullscreen||u.mozCancelFullScreen||u.webkitExitFullscreen||u.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(p=!1);p&&screenfull.enabled&&(u=s_oSpriteLibrary.getSprite("but_fullscreen"),e=u.width/4+20,f=u.height/2+25,q=new CToggle(e,f,u,s_bFullscreen,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,
this),q.setVisible(!1));g=new createjs.Text(TEXT_MODE,"bold 80px "+PRIMARY_FONT,"#ffffff");g.x=CANVAS_WIDTH/2;g.y=400;g.textAlign="center";g.textBaseline="middle";g.lineWidth=600;s_oStage.addChild(g);u=s_oSpriteLibrary.getSprite("but_vs_man");h=new CGfxButton(CANVAS_WIDTH/2,800,u,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onButHumanRelease,this);u=s_oSpriteLibrary.getSprite("but_vs_pc");k=new CGfxButton(CANVAS_WIDTH/2,1300,u,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onButComputerRelease,
this);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){h.unload();k.unload();l.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)m.unload(),m=null;p&&screenfull.enabled&&q.unload();s_oModeMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(g,h){l.setPosition(a-g,h+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||m.setPosition(b-g,h+d);p&&screenfull.enabled&&q.setPosition(e+g,h+f)};this.resetFullscreenBut=function(){p&&screenfull.enabled&&q.setActive(s_bFullscreen)};
this._onFullscreenRelease=function(){s_bFullscreen?t.call(window.document):p.call(window.document.documentElement);sizeHandler()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onButHumanRelease=function(){this.unload();s_oMain.gotoGame(MODE_HUMAN)};this._onButComputerRelease=function(){this.unload();s_oMain.gotoGame(MODE_COMPUTER)};s_oModeMenu=this;this._init()}
var s_oModeMenu=null,CGameBase=function(a){this._bTouchActive;this._bStartGame;this._bValidMoves;this._bEat;this._bConstrainedMoves;this._bBlock=!1;this._iTimeElaps;this._iCurPlayer;this._iTurnStallCount;this._iWhiteEaten;this._iBlackEaten;this._iBlackTime;this._iWhiteTime;this._iContJump;this._iNumBlack;this._iNumWhite;this._iDrawCounter=0;this._aCellPos;this._aCell;this._aCellSupport;this._aWhitePos;this._aBlackPos;this._aCellConstrained;this._aMovesAvailable;this._oInterface;this._oEndPanel=null;
this._oParent;this._oAnimationContainer;this._oPieaceEatenContainer;this._oGridContainer;this._oDrawContainer;this._oThinking;this._oBoard;this._oActiveCell=null;this._oEatenPawn;this._oMoveTree;this._oDecisionTree;this._oMessage=null;this._oStartAnimation};
CGameBase.prototype._init=function(){this._reset();var a=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(a);this._oDrawContainer=new createjs.Container;this._oDrawContainer.x=CANVAS_WIDTH/2;this._oDrawContainer.y=CANVAS_HEIGHT/2;s_oStage.addChild(this._oDrawContainer);this._oGridContainer=new createjs.Container;this._oGridContainer.x=CANVAS_WIDTH/2;this._oGridContainer.y=CANVAS_HEIGHT/2;s_oStage.addChild(this._oGridContainer);this._oAnimationContainer=new createjs.Container;
s_oStage.addChild(this._oAnimationContainer);this._oPieaceEatenContainer=new createjs.Container;s_oStage.addChild(this._oPieaceEatenContainer);this._oInterface=new CInterface(this._oPieaceEatenContainer);a=s_oSpriteLibrary.getSprite("board8");this._oBoard=new createBitmap(a);this._oBoard.regX=a.width/2;this._oBoard.regY=a.height/2;this._oGridContainer.addChild(this._oBoard);this._oThinking=new CThinking;this._oThinking.hide()};
CGameBase.prototype._reset=function(){this._bConstrainedMoves=this._bEat=this._bValidMoves=this._bStartGame=this._bTouchActive=!1;this._iCurPlayer=PAWN_WHITE;this._iTimeElaps=this._iContJump=this._iWhiteTime=this._iBlackTime=this._iWhiteEaten=this._iBlackEaten=this._iTurnStallCount=0;this._aCellConstrained=[]};
CGameBase.prototype._initGrid=function(){this._aCell=[];this._aCellSupport=[];for(var a=BG_BLACK,c=0;c<NUM_CELL;c++){this._aCell[c]=[];this._aCellSupport[c]=[];for(var b=0;b<NUM_CELL;b++)this._aCell[c][b]=new CCell(this._aCellPos[c][b].x,this._aCellPos[c][b].y,-1,c,b,a,this._oGridContainer),this._aCell[c][b].setVisible(!1),this._aCellSupport[c][b]=-1,a=a===BG_BLACK?BG_WHITE:BG_BLACK;a=1===c%2?BG_BLACK:BG_WHITE}this._initPieces();this._oInterface.activePlayer(PAWN_WHITE)};
CGameBase.prototype._initPieces=function(){this._aBlackPos=[];for(var a=0;3>a;a++)for(var c=0;c<NUM_CELL;c++)this._aCell[a][c].getBgColor()===BG_BLACK&&(this._aCell[a][c].setColor(PAWN_BLACK),this._aCellSupport[a][c]=PAWN_BLACK,this._aBlackPos.push({x:this._aCell[a][c].getGlobalX(),y:this._aCell[a][c].getGlobalY()}));this._aWhitePos=[];for(a=NUM_CELL-3;a<NUM_CELL;a++)for(c=0;c<NUM_CELL;c++)this._aCell[a][c].getBgColor()===BG_BLACK&&(this._aCell[a][c].setColor(PAWN_WHITE),this._aCellSupport[a][c]=
PAWN_WHITE,this._aWhitePos.push({x:this._aCell[a][c].getGlobalX(),y:this._aCell[a][c].getGlobalY()}))};
CGameBase.prototype._AIMoves=function(a){var c=1<a.length?Math.floor(Math.random()*a.length):0;this._oActiveCell={row:a[c].model.moves.currow,col:a[c].model.moves.curcol};var b=a[c].model.moves.destrow,d=a[c].model.moves.destcol,e=[];if(null===a[c].model.moves.rawpath||1===a[c].model.moves.rawpath.length)e[0]=[{row:b,col:d}];else{e[0]=[];for(var f=0;f<a[c].model.moves.rawpath.length;f++)b=a[c].model.moves.rawpath[f].model.row,d=a[c].model.moves.rawpath[f].model.col,e[0].push({row:b,col:d})}this._aCell[this._oActiveCell.row][this._oActiveCell.col].setMovesChain(e);
this._iCurPlayer===PAWN_BLACK&&s_iGameType===MODE_COMPUTER&&(s_oGame._oThinking.show(),setTimeout(function(){s_oGame._oThinking.hide();s_oGame._movePawn(e[0][0].row,e[0][0].col)},MIN_AI_THINKING+Math.random()*(MAX_AI_THINKING-MIN_AI_THINKING)))};
CGameBase.prototype._checkEndGame=function(){if(0===this._iNumBlack)this.gameOver(WIN_WHITE);else if(0===this._iNumWhite)this.gameOver(WIN_BLACK);else if(this._iDrawCounter++,this._iDrawCounter===DRAW_COUNTER)this.gameOver(DRAW);else if(this._iCurPlayer===PAWN_WHITE){var a=this._checkCanMove(PAWN_BLACK);a||this.gameOver(WIN_WHITE_BLACK_NOMOVES)}else(a=this._checkCanMove(PAWN_WHITE))||this.gameOver(WIN_BLACK_WHITE_NOMOVES)};
CGameBase.prototype._disableAllClick=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)this._aCell[a][c].setClickableArea(!1)};
CGameBase.prototype.cellClicked=function(a,c){this._bBlock||(null===this._oActiveCell?this._activePawn(a,c):this._oActiveCell.row===a&&this._oActiveCell.col===c?(this._resetMoves(),this._disableAllHighlight(),this._activeCellClick(),this._oActiveCell=null):this._oActiveCell.row===a&&this._oActiveCell.col===c||this._aCell[a][c].isLegalMove()?this._oActiveCell.row===a&&this._oActiveCell.col===c||!this._aCell[a][c].isLegalMove()||(this._resetMoves(),this._disableAllHighlight(),this._disableAllClick(),
this._movePawn(a,c)):(this._resetMoves(),this._activeCellClick(),this._activePawn(a,c)))};
CGameBase.prototype.onFinishMove=function(a,c,b,d){playSound("click_cell",1,!1);b===PAWN_BLACK&&a===NUM_CELL-1?(playSound("king",1,!1),this._aCell[a][c].setColor(KING_BLACK),this._aCellSupport[a][c]=KING_BLACK,this._iBlackEaten--,this._oInterface.refreshBlackPawnNumber(this._iBlackEaten)):b===PAWN_WHITE&&0===a?(playSound("king",1,!1),this._aCell[a][c].setColor(KING_WHITE),this._aCellSupport[a][c]=KING_WHITE,this._iWhiteEaten--,this._oInterface.refreshWhitePawnNumber(this._iWhiteEaten)):(this._aCell[a][c].setColor(b),
this._aCellSupport[a][c]=b);this._bEat&&(this._iDrawCounter=0,this._aCell[this._oEatenPawn.row][this._oEatenPawn.col].getType()===PAWN_BLACK?(this._iBlackEaten++,this._oInterface.refreshBlackPawnNumber(this._iBlackEaten)):this._aCell[this._oEatenPawn.row][this._oEatenPawn.col].getType()===PAWN_WHITE?(this._iWhiteEaten++,this._oInterface.refreshWhitePawnNumber(this._iWhiteEaten)):this._aCell[this._oEatenPawn.row][this._oEatenPawn.col].getType()===KING_BLACK?(this._iBlackEaten+=2,this._oInterface.refreshBlackPawnNumber(this._iBlackEaten)):
(this._iWhiteEaten+=2,this._oInterface.refreshWhitePawnNumber(this._iWhiteEaten)),this._aCell[this._oEatenPawn.row][this._oEatenPawn.col].setColor(PAWN_NULL),this._aCellSupport[this._oEatenPawn.row][this._oEatenPawn.col]=PAWN_NULL);this._resetMoves();if(null!==d){this._aCell[a][c].setMovesChain(d);this._oActiveCell={row:a,col:c};this._disableAllHighlight();this._iCurPlayer===PAWN_BLACK&&s_iGameType===MODE_COMPUTER?this._aCell[a][c].highlight(!1):this._aCell[a][c].highlight(!0);for(a=0;a<d.length;a++)this._aCell[d[a][0].row][d[a][0].col].showMoves(!0,
b),this._aCell[d[a][0].row][d[a][0].col].setLegalMove(!0),this._aCell[d[a][0].row][d[a][0].col].setClickableArea(!0);this._iCurPlayer===PAWN_BLACK&&s_iGameType===MODE_COMPUTER&&setTimeout(function(){s_oGame._movePawn(d[0][0].row,d[0][0].col)},500)}else this.changeTurn();this._bEat=!1};
CGameBase.prototype._activePawn=function(a,c){this._oActiveCell={row:a,col:c};this._disableAllHighlight();this._iCurPlayer===PAWN_BLACK&&s_iGameType===MODE_COMPUTER?this._aCell[a][c].highlight(!1,!1):this._aCell[a][c].highlight(!0);var b=this._aCell[a][c].getType();this._checkLegalMoves(a,c,b,this._aCellSupport,this._iCurPlayer);this._enableMoves(b)};
CGameBase.prototype._checkLegalMoves=function(a,c,b,d,e){var f=!1,g=[];this._aMovesAvailable=[];b>PAWN_BLACK&&(0<c&&a<NUM_CELL-1&&d[a+1][c-1]===PAWN_NULL?g.push({row:a+1,col:c-1,move:PAWN_MOVE,eatentype:d[a+1][c-1],eatenrow:a+1,eatencol:c-1}):1<c&&a<NUM_CELL-2&&d[a+1][c-1]%2!==e&&d[a+2][c-2]===PAWN_NULL&&(g.push({row:a+2,col:c-2,move:PAWN_EAT,eatentype:d[a+1][c-1],eatenrow:a+1,eatencol:c-1}),f=!0),c<NUM_CELL-1&&a<NUM_CELL-1&&d[a+1][c+1]===PAWN_NULL?g.push({row:a+1,col:c+1,move:PAWN_MOVE,eatentype:d[a+
1][c+1],eatenrow:a+1,eatencol:c+1}):c<NUM_CELL-2&&a<NUM_CELL-2&&d[a+1][c+1]%2!==e&&d[a+2][c+2]===PAWN_NULL&&(g.push({row:a+2,col:c+2,move:PAWN_EAT,eatentype:d[a+1][c+1],eatenrow:a+1,eatencol:c+1}),f=!0),0<c&&0<a&&d[a-1][c-1]===PAWN_NULL?g.push({row:a-1,col:c-1,move:PAWN_MOVE,eatentype:d[a-1][c-1],eatenrow:a-1,eatencol:c-1}):1<c&&1<a&&d[a-1][c-1]%2!==e&&d[a-2][c-2]===PAWN_NULL&&(g.push({row:a-2,col:c-2,move:PAWN_EAT,eatentype:d[a-1][c-1],eatenrow:a-1,eatencol:c-1}),f=!0),c<NUM_CELL-1&&0<a&&d[a-1][c+
1]===PAWN_NULL?g.push({row:a-1,col:c+1,move:PAWN_MOVE,eatentype:d[a-1][c+1],eatenrow:a-1,eatencol:c+1}):c<NUM_CELL-2&&1<a&&d[a-1][c+1]%2!==e&&d[a-2][c+2]===PAWN_NULL&&(g.push({row:a-2,col:c+2,move:PAWN_EAT,eatentype:d[a-1][c+1],eatenrow:a-1,eatencol:c+1}),f=!0));b===PAWN_WHITE?(0<c&&0<a&&d[a-1][c-1]===PAWN_NULL?g.push({row:a-1,col:c-1,move:PAWN_MOVE,eatentype:d[a-1][c-1],eatenrow:a-1,eatencol:c-1}):1<c&&1<a&&d[a-1][c-1]%2!==e&&d[a-2][c-2]===PAWN_NULL&&(g.push({row:a-2,col:c-2,move:PAWN_EAT,eatentype:d[a-
1][c-1],eatenrow:a-1,eatencol:c-1}),f=!0),c<NUM_CELL-1&&0<a&&d[a-1][c+1]===PAWN_NULL?g.push({row:a-1,col:c+1,move:PAWN_MOVE,eatentype:d[a-1][c+1],eatenrow:a-1,eatencol:c+1}):c<NUM_CELL-2&&1<a&&d[a-1][c+1]%2!==e&&d[a-2][c+2]===PAWN_NULL&&(g.push({row:a-2,col:c+2,move:PAWN_EAT,eatentype:d[a-1][c+1],eatenrow:a-1,eatencol:c+1}),f=!0)):b===PAWN_BLACK&&(0<c&&a<NUM_CELL-1&&d[a+1][c-1]===PAWN_NULL?g.push({row:a+1,col:c-1,move:PAWN_MOVE,eatentype:d[a+1][c-1],eatenrow:a+1,eatencol:c-1}):1<c&&a<NUM_CELL-2&&
d[a+1][c-1]%2!==e&&d[a+2][c-2]===PAWN_NULL&&(g.push({row:a+2,col:c-2,move:PAWN_EAT,eatentype:d[a+1][c-1],eatenrow:a+1,eatencol:c-1}),f=!0),c<NUM_CELL-1&&a<NUM_CELL-1&&d[a+1][c+1]===PAWN_NULL?g.push({row:a+1,col:c+1,move:PAWN_MOVE,eatentype:d[a+1][c+1],eatenrow:a+1,eatencol:c+1}):c<NUM_CELL-2&&a<NUM_CELL-2&&d[a+1][c+1]%2!==e&&d[a+2][c+2]===PAWN_NULL&&(g.push({row:a+2,col:c+2,move:PAWN_EAT,eatentype:d[a+1][c+1],eatenrow:a+1,eatencol:c+1}),f=!0));if(f){for(a=0;a<g.length;a++)g[a].move===PAWN_EAT&&this._aMovesAvailable.push(g[a]);
return{move:PAWN_EAT,listmove:this._aMovesAvailable}}for(a=0;a<g.length;a++)g[a].move===PAWN_MOVE&&this._aMovesAvailable.push(g[a]);return{move:PAWN_MOVE,listmove:this._aMovesAvailable}};CGameBase.prototype._enableMoves=function(a){for(var c,b,d=0;d<this._aMovesAvailable.length;d++)c=this._aMovesAvailable[d].row,b=this._aMovesAvailable[d].col,this._aCell[c][b].showMoves(!0,a),this._aCell[c][b].setLegalMove(!0),this._aCell[c][b].setClickableArea(!0)};CGameBase.prototype.setShowNumFlip=function(){this.calcFlipCounts()};
CGameBase.prototype.restartGame=function(){s_oGame._oEndPanel.unload();this._oActiveCell=null;s_oGame._disableAllHighlight();this._reset();for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)this._aCell[a][c].setColor(-1),this._aCellSupport[a][c]=-1;this._initPieces();s_oGame.setAllVisible(!0);s_oGame._oInterface.resetInfo();s_oGame._oInterface.refreshWhitePawnNumber(0);s_oGame._oInterface.refreshBlackPawnNumber(0);s_oGame._oInterface.setInfoVisible(!0);s_oGame._oInterface.activePlayer(this._iCurPlayer);
s_oGame._activeCellClick();this._oMessage&&this._oMessage.unload();this._bStartGame=!0;this._bBlock=!1};CGameBase.prototype.pauseGame=function(a){this._bStartGame=!a};CGameBase.prototype._onExitHelp=function(){this._bStartGame=!0};
CGameBase.prototype.update=function(){this._bStartGame&&(this._iTimeElaps+=s_iTimeElaps,this._iTimeElaps>TIME_AD&&(this._iTimeElaps=0,CloudAPI.gameOver()),this._oThinking.update(),this._iCurPlayer===PAWN_WHITE?(this._iWhiteTime+=s_iTimeElaps,this._oInterface.refreshWhiteTime(this._iWhiteTime)):(this._iBlackTime+=s_iTimeElaps,this._oInterface.refreshBlackTime(this._iBlackTime)))};
CGameBase.prototype.numFlips=function(a,c){var b,d,e,f=0;for(d=-1;1>=d;d++)for(b=-1;1>=b;b++)for(e=1;;e++){var g=a+e*b;var h=c+e*d;if(0>g||g>=NUM_CELL||0>h||h>=NUM_CELL)break;if(this._aCell[g][h].getType()===PAWN_NULL)break;if(this._aCell[g][h].getType()===this._iCurPlayer){f+=e-1;break}}return f};CGameBase.prototype._disableAllHighlight=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)this._aCell[a][c].highlight(!1),this._aCell[a][c].showMoves(!1,!1)};
CGameBase.prototype.setAllVisible=function(a){for(var c=0;c<NUM_CELL;c++)for(var b=0;b<NUM_CELL;b++)this._aCell[c][b].setVisible(a)};CGameBase.prototype._checkMatrix=function(a){for(var c="",b=0;b<NUM_CELL;b++){for(var d=0;d<NUM_CELL;d++)c=0<=a[b][d]?c+(" "+a[b][d]+" | "):c+(a[b][d]+" | ");c+="|| "+b+"\n"}trace(c)};CGameBase.prototype._copyMatrix=function(a){for(var c=[],b=0;b<NUM_CELL;b++){c[b]=[];for(var d=0;d<NUM_CELL;d++)c[b][d]=a[b][d]}return c};
CGameBase.prototype._resetMoves=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)this._aCell[a][c].setLegalMove(!1)};CGameBase.prototype._checkRecursivePawn=function(a,c,b,d,e){var f=this._checkLegalMoves(a,c,b,e,d);if(f.move===PAWN_EAT){this._bConstrainedMoves=!0;for(var g=0;g<f.listmove.length;g++)this._oMoveTree.addNode(a,c,0,f.listmove[g].row,f.listmove[g].col,0,f.listmove[g].eatenrow,f.listmove[g].eatencol),this._checkRecursivePawn(f.listmove[g].row,f.listmove[g].col,b,d,e)}};
CGameBase.prototype._checkRecursiveKing=function(a,c,b,d,e,f){var g=this._checkLegalMoves(a,c,b,d,f);if(g.move===PAWN_EAT){this._bConstrainedMoves=!0;for(var h=0;h<g.listmove.length;h++)if(this._oMoveTree.addNode(a,c,e,g.listmove[h].row,g.listmove[h].col,e+1,g.listmove[h].eatenrow,g.listmove[h].eatencol),h===g.listmove.length-1)for(var k=0;k<g.listmove.length;k++){var l=this._copyMatrix(d);l[g.listmove[k].eatenrow][g.listmove[k].eatencol]=PAWN_NULL;this._checkRecursiveKing(g.listmove[k].row,g.listmove[k].col,
b,l,e+1,f)}}};
CGameBase.prototype._checkConstrainedMoves=function(){this._aCellConstrained=[];this._bConstrainedMoves=!1;for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)if(this._aCell[a][c].getType()===this._iCurPlayer){this._oMoveTree=new CTree({row:a,col:c});this._checkRecursivePawn(a,c,this._aCell[a][c].getType(),this._iCurPlayer,this._aCellSupport);for(var b=this._oMoveTree.getTerminalNodes(),d=[],e=0;e<b.length;e++)d[e]=this._oMoveTree.getPath(b[e]);this._aCell[a][c].setMovesChain(d)}else if((this._aCell[a][c].getType()===KING_BLACK||
this._aCell[a][c].getType()===KING_WHITE)&&this._aCell[a][c].getType()%2===this._iCurPlayer){this._oMoveTree=new CTree({row:a,col:c});b=this._copyMatrix(this._aCellSupport);b[a][c]=PAWN_NULL;this._checkRecursiveKing(a,c,this._aCell[a][c].getType(),b,0,this._iCurPlayer);_bTerminal=!1;b=this._oMoveTree.getTerminalNodes();d=[];for(e=0;e<b.length;e++)d[e]=this._oMoveTree.getPath(b[e]);this._aCell[a][c].setMovesChain(d)}};
CGameBase.prototype._activeCellClick=function(){this._checkConstrainedMoves();this._resetMoves();this._disableAllHighlight();this._disableAllClick();if(this._bConstrainedMoves){this._evaluatePath();for(var a=0;a<this._aCellConstrained.length;a++){var c=this._aCellConstrained[a].row,b=this._aCellConstrained[a].col;if(this._iCurPlayer!==PAWN_BLACK||s_iGameType!==MODE_COMPUTER)this._aCell[c][b].setClickableArea(!0),this._aCell[c][b].highlight(!0)}this._showMessage()}else for(a=0;a<NUM_CELL;a++)for(c=
0;c<NUM_CELL;c++)this._aCell[a][c].setClickableArea(!1),this._aCell[a][c].getType()%2!==this._iCurPlayer||this._iCurPlayer===PAWN_BLACK&&s_iGameType===MODE_COMPUTER||this._aCell[a][c].setClickableArea(!0)};
CGameBase.prototype._evaluatePath=function(){for(var a=0,c=0;c<NUM_CELL;c++)for(var b=0;b<NUM_CELL;b++)if(this._aCell[c][b].getType()%2===this._iCurPlayer)for(var d=0;d<this._aCell[c][b].getMovesChain().length;d++)a<this._aCell[c][b].getMovesChain()[d].length&&(a=this._aCell[c][b].getMovesChain()[d].length);var e=!1;for(c=0;c<NUM_CELL;c++)for(b=0;b<NUM_CELL;b++)if(this._aCell[c][b].getType()%2===this._iCurPlayer)for(d=0;d<this._aCell[c][b].getMovesChain().length;d++)a===this._aCell[c][b].getMovesChain()[d].length&&
this._aCell[c][b].getType()>PAWN_BLACK&&(e=!0);for(c=0;c<NUM_CELL;c++)for(b=0;b<NUM_CELL;b++)if(this._aCell[c][b].getType()%2===this._iCurPlayer){var f=[],g=!1;for(d=0;d<this._aCell[c][b].getMovesChain().length;d++)if(f[d]=[],e){if(a===this._aCell[c][b].getMovesChain()[d].length&&this._aCell[c][b].getType()>PAWN_BLACK){for(g=0;g<a;g++)f[d].push({row:this._aCell[c][b].getMovesChain()[d][g].model.row,col:this._aCell[c][b].getMovesChain()[d][g].model.col});g=!0}}else if(a===this._aCell[c][b].getMovesChain()[d].length){for(g=
0;g<a;g++)f[d].push({row:this._aCell[c][b].getMovesChain()[d][g].model.row,col:this._aCell[c][b].getMovesChain()[d][g].model.col});g=!0}for(d=f.length-1;0<=d;d--)0===f[d].length?f.splice(d,1):f[d].splice(0,1);this._aCell[c][b].setMovesChain(f);g&&this._aCellConstrained.push({row:c,col:b})}};CGameBase.prototype._checkBoard=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)trace(this._aCell[a][c].isLegalMove())};CGameBase.prototype._calculateMin=function(a,c){return a<c?a:c};
CGameBase.prototype._calculateMax=function(a,c){return a>c?a:c};
CGameBase.prototype._minimax=function(a,c){if(!a.hasChildren()||0===c)return a.model.rating;if(0===c%2)if(0===SEARCH_DEPTH%2){var b=-9999;for(var d=0;d<a.children.length;d++)b=this._calculateMax(b,this._minimax(a.children[d],c-1))}else for(b=9999,d=0;d<a.children.length;d++)b=this._calculateMin(b,this._minimax(a.children[d],c-1));else if(1===c%2)if(0===SEARCH_DEPTH%2)for(b=9999,d=0;d<a.children.length;d++)b=this._calculateMin(b,this._minimax(a.children[d],c-1));else for(b=-9999,d=0;d<a.children.length;d++)b=
this._calculateMax(b,this._minimax(a.children[d],c-1));return a.model.rating=b};CGameBase.prototype._buildDecisionTree=function(){this._oDecisionTree=new CTreeDecision({rating:0,moves:[],depth:0});var a=this._copyMatrix(this._aCellSupport);this._buildDecisionRecursive(a,0,0);a=this._minimax(this._oDecisionTree.getRoot(),SEARCH_DEPTH);return this._oDecisionTree.getNode(a,1)};
CGameBase.prototype._buildDecisionRecursive=function(a,c,b){if(c!==SEARCH_DEPTH)for(var d=this._findAllMoves(a,(c+this._iCurPlayer)%2),e=[],f=0;f<d.length;f++){e[f]=this._buildNewBoard(a,d[f]);var g=this._evalBoard(e[f]);this._oDecisionTree.addNode(c,b,c+1,f,g.rate,d[f],g.blackmatrix,g.whitematrix);if(f===d.length-1)for(g=0;g<d.length;g++)this._buildDecisionRecursive(e[g],c+1,g)}};
CGameBase.prototype._findAllMoves=function(a,c){for(var b,d=!1,e=[],f=0;f<NUM_CELL;f++)for(var g=0;g<NUM_CELL;g++)if(a[f][g]%2===c)if(b=this._checkLegalMoves(f,g,a[f][g],a,c),b.move===PAWN_MOVE&&0!==b.listmove.length)for(var h=0;h<b.listmove.length;h++)e.push({currow:f,curcol:g,pawntype:a[f][g],movetype:PAWN_MOVE,destrow:b.listmove[h].row,destcol:b.listmove[h].col,rawpath:null});else if(b.move===PAWN_EAT)if(d=!0,this._oMoveTree=new CTree({row:f,col:g}),a[f][g]===c){this._checkRecursivePawn(f,g,a[f][g],
c,a);b=this._oMoveTree.getTerminalNodes();var k=[];for(h=0;h<b.length;h++)k[h]=this._oMoveTree.getPath(b[h]),k[h].splice(0,1),e.push({currow:f,curcol:g,pawntype:a[f][g],movetype:PAWN_EAT,destrow:k[h][k[h].length-1].model.row,destcol:k[h][k[h].length-1].model.col,rawpath:k[h]})}else if((a[f][g]===KING_BLACK||a[f][g]===KING_WHITE)&&a[f][g]%2===c)for(h=this._copyMatrix(a),h[f][g]=PAWN_NULL,this._checkRecursiveKing(f,g,a[f][g],h,0,c),_bTerminal=!1,b=this._oMoveTree.getTerminalNodes(),k=[],h=0;h<b.length;h++)k[h]=
this._oMoveTree.getPath(b[h]),k[h].splice(0,1),e.push({currow:f,curcol:g,pawntype:a[f][g],movetype:PAWN_EAT,destrow:k[h][k[h].length-1].model.row,destcol:k[h][k[h].length-1].model.col,rawpath:k[h]});if(d){for(f=e.length-1;0<=f;f--)e[f].movetype===PAWN_MOVE&&e.splice(f,1);e=this._evaluatePathForAI(e)}return e};
CGameBase.prototype._evaluatePathForAI=function(a){for(var c=0,b=0;b<a.length;b++)c<a[b].rawpath.length&&(c=a[b].rawpath.length);var d=!1;for(b=0;b<a.length;b++)c===a[b].rawpath.length&&a[b].pawntype>PAWN_BLACK&&(d=!0);var e=[];for(b=0;b<a.length;b++)d?c===a[b].rawpath.length&&a[b].pawntype>PAWN_BLACK&&e.push(a[b]):c===a[b].rawpath.length&&e.push(a[b]);return e};
CGameBase.prototype._buildNewBoard=function(a,c){var b=this._copyMatrix(a);b[c.currow][c.curcol]=PAWN_NULL;b[c.destrow][c.destcol]=c.pawntype;if(null!==c.rawpath)for(var d=0;d<c.rawpath.length;d++)b[c.rawpath[d].model.eatenrow][c.rawpath[d].model.eatencol]=PAWN_NULL;return b};
CGameBase.prototype._evalBoard=function(a){var c=this._buildDistanceMatrix(a,PAWN_BLACK);var b=this._buildDistanceMatrix(a,PAWN_WHITE);for(var d=0,e=0,f=0,g=0,h=0;h<NUM_CELL;h++)for(var k=0;k<NUM_CELL;k++)a[h][k]===PAWN_BLACK?f++:a[h][k]===PAWN_WHITE?d++:a[h][k]===KING_BLACK?g+=c[h][k]:a[h][k]===KING_WHITE&&(e+=c[h][k]);return{rate:f-d+1.4*(g-e),blackmatrix:c,whitematrix:b}};
CGameBase.prototype._buildDistanceMatrix=function(a,c){for(var b=[],d=!0,e=0;e<NUM_CELL;e++)for(var f=0;f<NUM_CELL;f++)a[e][f]<KING_WHITE&&-1!==a[e][f]&&(d=!1),a[e][f]%2!==c&&-1<a[e][f]&&b.push({row:e,col:f});e=[];if(!d||0===b.length)e=[[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]];else if(d){d=[];for(e=0;e<b.length;e++){var g=b[e].row;var h=b[e].col;d[e]=[];for(f=0;f<NUM_CELL;f++){d[e][f]=[];for(var k=
0;k<NUM_CELL;k++){var l=NUM_CELL-Math.abs(g-f);var m=NUM_CELL-Math.abs(h-k);d[e][f][k]=this._calculateMin(l,m)}}}g=d[0];for(e=0;e<b.length;e++)for(f=0;f<NUM_CELL;f++)for(k=0;k<NUM_CELL;k++)g[f][k]<d[e][f][k]&&(g[f][k]=d[e][f][k]);e=g}return e};CGameBase.prototype.countPawn=function(){for(var a,c=this._iNumWhite=this._iNumBlack=0;c<NUM_CELL;c++)for(var b=0;b<NUM_CELL;b++)a=this._aCell[c][b].getType()%2,a===PAWN_BLACK?this._iNumBlack++:a===PAWN_WHITE&&this._iNumWhite++};
CGameBase.prototype._checkCanMove=function(a){for(var c,b=0;b<NUM_CELL;b++)for(var d=0;d<NUM_CELL;d++)if(this._aCellSupport[b][d]%2===a&&(c=this._checkLegalMoves(b,d,this._aCellSupport[b][d],this._aCellSupport,a),0<c.listmove.length))return!0;return!1};CGameBase.prototype._getOtherPlayer=function(a){return a===PAWN_WHITE?PAWN_BLACK:PAWN_WHITE};CGameBase.prototype.nullMessage=function(){this._oMessage=null};var CGameSingle=function(a){CGameBase.call(this,a);this._init()};CGameSingle.prototype=Object.create(CGameBase.prototype);
CGameSingle.prototype._init=function(){CGameBase.prototype._init();this._startGame()};CGameSingle.prototype._startGame=function(){this._oInterface.configureInfoPanel(!0);this._setGrid();this._initGrid();this._activeCellClick();this._oStartAnimation=new CStartAnimation(this._oDrawContainer,this._aWhitePos,this._aBlackPos,this._oAnimationContainer,!0)};
CGameSingle.prototype._setGrid=function(){var a=NUM_CELL,c=CELL_LENGTH,b=-BOARD_LENGTH/2+c/2;this._aCellPos=[];for(var d=0;d<a;d++){this._aCellPos[d]=[];for(var e=0;e<a;e++)this._aCellPos[d][e]={x:b+e*c,y:b+d*c}}};
CGameSingle.prototype.changeTurn=function(){this.countPawn();this._checkEndGame();null!==this._oMessage&&(this._oMessage.unload(),this._oMessage=null);if(this._iCurPlayer===PAWN_BLACK)this._iCurPlayer=PAWN_WHITE,s_iGameType===MODE_COMPUTER&&(this._bBlock=!1);else if(this._iCurPlayer=PAWN_BLACK,s_iGameType===MODE_COMPUTER){this._bBlock=!0;var a=this._buildDecisionTree();this._AIMoves(a)}this._oInterface.activePlayer(this._iCurPlayer);(s_iGameType===MODE_HUMAN||s_iGameType===MODE_COMPUTER&&this._iCurPlayer===
PAWN_WHITE)&&this._activeCellClick()};
CGameSingle.prototype._movePawn=function(a,c){var b=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getX(),d=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getY(),e=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getType();e<KING_WHITE&&(this._iDrawCounter=0);var f=(this._oActiveCell.row-a)/2,g=(this._oActiveCell.col-c)/2;.5<Math.abs(f)&&(this._bEat=!0,this._oEatenPawn={row:this._oActiveCell.row-f,col:this._oActiveCell.col-g});this._aCell[this._oActiveCell.row][this._oActiveCell.col].setColor(PAWN_NULL);this._aCellSupport[this._oActiveCell.row][this._oActiveCell.col]=
PAWN_NULL;b=new CMovingCell(b,d,e,this._oGridContainer);d=this._aCell[a][c].getX();e=this._aCell[a][c].getY();f=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getMovesChain();1<f[0].length?b.move(d,e,TIME_MOVE,a,c,f):b.move(d,e,TIME_MOVE,a,c,null);this._oActiveCell=null};CGameSingle.prototype._showMessage=function(){null===this._oMessage&&(this._oMessage=new CMessage(this._iCurPlayer,TEXT_JUMP))};
CGameSingle.prototype.unload=function(){this._bStartGame=!1;this._oInterface.unload();null!==this._oEndPanel&&this._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};CGameSingle.prototype.onExit=function(){this.unload();s_oMain.gotoMenu()};CGameSingle.prototype.checkBoard=function(){var a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.4)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.on("click",s_oGame.returnToEndPanel,s_oGame,!0,a);s_oStage.addChild(a);this._oEndPanel.hide()};
CGameSingle.prototype.returnToEndPanel=function(a,c){s_oStage.removeChild(c);this._oEndPanel.reShow()};CGameSingle.prototype.gameOver=function(a){this._bStartGame=!1;this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.show(a,this._iBlackTime,this._iWhiteTime);this._oEndPanel.setRestartBut(s_oGame.restartGame,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame);this._oInterface.setInfoVisible(!1)};
var CGameMulti=function(a){CGameBase.call(this,a);this._init()};CGameMulti.prototype=Object.create(CGameBase.prototype);CGameMulti.prototype._init=function(){CGameBase.prototype._init();this._startGame()};
CGameMulti.prototype._startGame=function(){this._oInterface.configureInfoPanel(s_oNetworkManager.isUserA());this._oThinking.setMessage(TEXT_WAITING_MOVES);s_oNetworkManager.isUserA()?s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getEnemyNickname()):(this._oThinking.show(),this._oBoard.rotation=180,s_oInterface.setPlayersInfo(s_oNetworkManager.getEnemyNickname(),s_oNetworkManager.getPlayerNickname()));this._setGrid();this._initGrid();this._activeCellClick();this._oStartAnimation=
new CStartAnimation(this._oDrawContainer,this._aWhitePos,this._aBlackPos,this._oAnimationContainer,s_oNetworkManager.isUserA());s_oNetworkManager.addEventListener(ON_DISCONNECTION,this.playerDisconnectedFromGame)};
CGameMulti.prototype._setGrid=function(){var a=BOARD_LENGTH,c=NUM_CELL,b=CELL_LENGTH,d=-a/2+b/2;if(s_oNetworkManager.isUserA())for(this._aCellPos=[],a=0;a<c;a++){this._aCellPos[a]=[];for(var e=0;e<c;e++)this._aCellPos[a][e]={x:d+e*b,y:d+a*b}}else for(d=a/2-b/2,this._aCellPos=[],a=0;a<c;a++)for(this._aCellPos[a]=[],e=0;e<c;e++)this._aCellPos[a][e]={x:d-e*b,y:d-a*b}};
CGameMulti.prototype.changeTurn=function(){this.countPawn();this._checkEndGame();null!==this._oMessage&&(this._oMessage.unload(),this._oMessage=null);if(this._iCurPlayer===PAWN_BLACK)this._iCurPlayer=PAWN_WHITE,s_iGameType===MODE_COMPUTER&&(this._bBlock=!1),s_oNetworkManager.isUserA()?this._oThinking.hide():this._oThinking.show();else{this._iCurPlayer=PAWN_BLACK;if(s_iGameType===MODE_COMPUTER){this._bBlock=!0;var a=this._buildDecisionTree();this._AIMoves(a)}s_oNetworkManager.isUserA()?this._oThinking.show():
this._oThinking.hide()}this._oInterface.activePlayer(this._iCurPlayer);(s_iGameType===MODE_HUMAN||s_iGameType===MODE_COMPUTER&&this._iCurPlayer===PAWN_WHITE)&&this._activeCellClick();this._oThinking.isVisible()&&this._disableAllHighlight()};
CGameMulti.prototype._movePawn=function(a,c){var b=this._oActiveCell.row,d=this._oActiveCell.col,e=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getX(),f=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getY(),g=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getType();g<KING_WHITE&&(this._iDrawCounter=0);var h=(this._oActiveCell.row-a)/2,k=(this._oActiveCell.col-c)/2;.5<Math.abs(h)&&(this._bEat=!0,this._oEatenPawn={row:this._oActiveCell.row-h,col:this._oActiveCell.col-
k});this._aCell[this._oActiveCell.row][this._oActiveCell.col].setColor(PAWN_NULL);this._aCellSupport[this._oActiveCell.row][this._oActiveCell.col]=PAWN_NULL;e=new CMovingCell(e,f,g,this._oGridContainer);f=this._aCell[a][c].getX();g=this._aCell[a][c].getY();h=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getMovesChain();1<h[0].length?e.move(f,g,TIME_MOVE,a,c,h):e.move(f,g,TIME_MOVE,a,c,null);this._oActiveCell=null;e={};e[MSG_MOVE]={sourcerow:b,sourcecol:d,destrow:a,destcol:c};s_oNetworkManager.sendMsg(MSG_MOVE,
JSON.stringify(e))};
CGameMulti.prototype.remoteMovePiece=function(a){this._oActiveCell={row:a.sourcerow,col:a.sourcecol};var c=a.destrow;a=a.destcol;var b=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getX(),d=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getY(),e=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getType();e<KING_WHITE&&(this._iDrawCounter=0);var f=(this._oActiveCell.row-c)/2,g=(this._oActiveCell.col-a)/2;.5<Math.abs(f)&&(this._bEat=!0,this._oEatenPawn={row:this._oActiveCell.row-
f,col:this._oActiveCell.col-g});this._aCell[this._oActiveCell.row][this._oActiveCell.col].setColor(PAWN_NULL);this._aCellSupport[this._oActiveCell.row][this._oActiveCell.col]=PAWN_NULL;b=new CMovingCell(b,d,e,this._oGridContainer);d=this._aCell[c][a].getX();e=this._aCell[c][a].getY();f=this._aCell[this._oActiveCell.row][this._oActiveCell.col].getMovesChain();1<f[0].length?b.move(d,e,TIME_MOVE,c,a,f):b.move(d,e,TIME_MOVE,c,a,null);this._oActiveCell=null};
CGameMulti.prototype._showMessage=function(){null!==this._oMessage||this._oThinking.isVisible()||(s_oNetworkManager.isUserA()?this._iCurPlayer===PAWN_WHITE&&(this._oMessage=new CMessage(this._iCurPlayer,TEXT_JUMP)):this._iCurPlayer===PAWN_BLACK&&(this._oMessage=new CMessage(this._getOtherPlayer(this._iCurPlayer),TEXT_JUMP)))};
CGameMulti.prototype.unload=function(){this._bStartGame=!1;this._oInterface.unload();null!==this._oEndPanel&&this._oEndPanel.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren();s_oNetworkManager.addEventListener(ON_DISCONNECTION,function(){})};CGameMulti.prototype.onExit=function(){this.unload();s_oMain.gotoMenu();s_oNetworkManager.disconnect()};
CGameMulti.prototype.gameOver=function(a){this._oThinking.hide();var c=this._bStartGame=!1;a===WIN_WHITE?s_oNetworkManager.isUserA()&&(c=!0):s_oNetworkManager.isUserA()||(c=!0);s_oNetworkManager.sendMsg(MSG_END_MATCH,c);this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.show(a,this._iBlackTime,this._iWhiteTime);this._oInterface.setInfoVisible(!1)};
CGameMulti.prototype.showRematchQuestion=function(){this._oEndPanel.setRestartBut(s_oGame._onConfirmRematch,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame)};CGameMulti.prototype.checkBoard=function(){var a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.4)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.on("click",s_oGame.returnToEndPanel,s_oGame,!0,a);s_oStage.addChild(a);this._oEndPanel.hide()};
CGameMulti.prototype.returnToEndPanel=function(a,c){s_oStage.removeChild(c);this._oEndPanel.reShow()};CGameMulti.prototype._onConfirmRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_WAIT_OPPONENT);s_oNetworkManager.sendMsg(MSG_ACCEPT_REMATCH,"")};
CGameMulti.prototype.onOpponentRefuseRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_home"),ON_MOUSE_UP,this.onExit,this);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_show"),ON_MOUSE_UP,this.checkBoard,this)};CGameMulti.prototype.onOpponentAcceptRematch=function(){s_oNetworkManager.isUserA()?this._oThinking.hide():this._oThinking.show();s_oGame.restartGame()};
CGameMulti.prototype.playerDisconnectedFromGame=function(){this._oEndPanel&&this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this);s_oNetworkManager.sendMsg(MSG_DISCONNECTION,"")};
CGameMulti.prototype.opponentLeftTheGame=function(){this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this);s_oNetworkManager.isUserA()?this._oEndPanel.setExplMsg(TEXT_WINS.format(TEXT_WHITE)):this._oEndPanel.setExplMsg(TEXT_WINS.format(TEXT_BLACK))};var CGameSingleWithBot=function(a){CGameSingle.call(this,a)};CGameSingleWithBot.prototype=Object.create(CGameSingle.prototype);
CGameSingleWithBot.prototype._startGame=function(){this._oInterface.configureInfoPanel(!0);this._oThinking.setMessage(TEXT_WAITING_MOVES);this._setGrid();this._initGrid();this._activeCellClick();this._oStartAnimation=new CStartAnimation(this._oDrawContainer,this._aWhitePos,this._aBlackPos,this._oAnimationContainer,!0);s_oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getBotName())};
CGameSingleWithBot.prototype.gameOver=function(a){this._bStartGame=!1;this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));this._oEndPanel.show(a,this._iBlackTime,this._iWhiteTime);this._oEndPanel.setRestartBut(s_oGame._onConfirmRematch,s_oGame);this._oEndPanel.setCheckBut(s_oGame.checkBoard,s_oGame);this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame);this._oInterface.setInfoVisible(!1)};
CGameSingleWithBot.prototype._onConfirmRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_WAIT_OPPONENT);var a=randomFloatBetween(200,2E3);if(.33<Math.random()).4<Math.random()?setTimeout(function(){s_oGame._rematch()},a):s_oGame._rematch();else if(.4<Math.random())setTimeout(function(){s_oGame.onBotRefuseRematch()},a);else s_oGame.onBotRefuseRematch()};
CGameSingleWithBot.prototype.onBotRefuseRematch=function(){this._oEndPanel.unload();this._oEndPanel=new CMsgBox(TEXT_OPPONENT_LEFT);this._oEndPanel.addButton(s_oSpriteLibrary.getSprite("but_yes"),ON_MOUSE_UP,this.onExit,this)};CGameSingleWithBot.prototype._rematch=function(){s_oGame.restartGame()};
function CInterface(a){var c,b,d,e,f,g,h,k,l,m,q,p,t,u,x=null,y=null;this._init=function(a){var h=s_oSpriteLibrary.getSprite("but_exit");d=CANVAS_WIDTH-h.height/2-10;e=h.height/2+25;m=new CGfxButton(d,e,h,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onExit,this);a=CANVAS_WIDTH-h.width/2-125;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)h=s_oSpriteLibrary.getSprite("audio_icon"),c=a,b=25+h.height/2,q=new CToggle(c,b,h,s_bAudioActive,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);
a=window.document;h=a.documentElement;x=h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullScreen||h.msRequestFullscreen;y=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.enabled&&(h=s_oSpriteLibrary.getSprite("but_fullscreen"),f=h.width/4+20,g=h.height/2+25,u=new CToggle(f,g,h,s_bFullscreen,s_oStage),u.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),u.setVisible(!1));p=new CInfoTurn(815,1630,
PAWN_WHITE,s_oStage);t=new CInfoTurn(485,290,PAWN_BLACK,s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){m.unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||q.unload();t.unload();p.unload();for(var b=0;b<h;b++)a.removeChild(k[b]),a.removeChild(l[b]);x&&screenfull.enabled&&u.unload();s_oInterface=null};this.configureInfoPanel=function(b){var c={x:485,y:290},d={x:815,y:1630};b?(p.setPos(d),t.setPos(c)):(p.setPos(c),t.setPos(d));h=12;l=[];for(c=0;c<h;c++)l[c]=createBitmap(s_oSpriteLibrary.getSprite("black_chip")),
b?(l[c].x=310+19*c,l[c].y=410):(l[c].x=970-19*c,l[c].y=1424),l[c].visible=!1,a.addChild(l[c]);k=[];for(c=0;c<h;c++)k[c]=createBitmap(s_oSpriteLibrary.getSprite("white_chip")),b?(k[c].x=970-19*c,k[c].y=1424):(k[c].x=310+19*c,k[c].y=410),k[c].visible=!1,a.addChild(k[c])};this.setPlayersInfo=function(a,b){p.setName(a);t.setName(b)};this.resetInfo=function(){p.refreshTime(formatTime(0));t.refreshTime(formatTime(0))};this.refreshButtonPos=function(a,h){m.setPosition(d-a,h+e);!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||q.setPosition(c-a,h+b);x&&screenfull.enabled&&u.setPosition(f+a,h+g)};this.refreshWhitePawnNumber=function(a){0>a&&(a=0);for(var b=0;b<a;b++)k[b].visible=!0;for(b=a;b<h;b++)k[b].visible=!1};this.refreshWhiteTime=function(a){50<a&&p.refreshTime(formatTime(a))};this.refreshBlackPawnNumber=function(a){0>a&&(a=0);for(var b=0;b<a;b++)l[b].visible=!0;for(b=a;b<h;b++)l[b].visible=!1};this.refreshBlackTime=function(a){50<a&&t.refreshTime(formatTime(a))};this.activePlayer=function(a){a===PAWN_WHITE?
(t.active(!1),p.active(!0)):(p.active(!1),t.active(!0))};this.setInfoVisible=function(a){p.setPanelVisible(a);t.setPanelVisible(a)};this._onButConfigRelease=function(){new CConfigPanel};this._onButRestartRelease=function(){s_oGame.restartGame()};this.onExitFromHelp=function(){null.unload()};this._onExit=function(){new CAreYouSurePanel(s_oInterface._onConfirmExit)};this._onConfirmExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.onExit()};this._onAudioToggle=
function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){x&&screenfull.enabled&&u.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?y.call(window.document):x.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init(a);return this}var s_oInterface=null;
function CStartAnimation(a,c,b,d,e){var f,g=0,h=0,k=0,l=0,m,q,p,t,u,x,y,r,B;this._init=function(a,b,c,d,e){m=[];q=[];for(d=0;d<b.length;d++)m[d]={x:b[d].x/s_oStage.scaleX,y:b[d].y/s_oStage.scaleY},q[d]={x:c[d].x/s_oStage.scaleX,y:c[d].y/s_oStage.scaleY};f=12;u=a;x=new createjs.Container;x.y=-360;u.addChild(x);a=s_oSpriteLibrary.getSprite("chip_box");r=createBitmap(a);r.regX=a.width/2;r.regY=a.height/2;x.addChild(r);y=new createjs.Container;y.y=335;u.addChild(y);a=s_oSpriteLibrary.getSprite("chip_box");
B=createBitmap(a);B.regX=a.width/2;B.regY=a.height/2;y.addChild(B);a=s_oSpriteLibrary.getSprite("chip_flip_black");a={images:[a],framerate:6,frames:[[0,0,22,91,0,-38,-3],[22,0,30,93,0,-33,-2],[52,0,74,92,0,-11,-2],[0,93,98,99,0,-1,-1],[98,93,98,99,0,-1,-1]],animations:{chip_0:[0,0,"chip_1"],chip_1:[1,1,"chip_2"],chip_2:[2,2,"chip_4"],chip_3:[3,3,"chip_4"],chip_4:[4,4,"stop"]}};a=new createjs.SpriteSheet(a);t=[];for(d=0;d<f;d++)t[d]=createSprite(a,"chip_0",PAWN_SIZE/2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE),
t[d].y=-34,t[d].gotoAndStop("chip_0"),e?(t[d].x=-160-19*d,x.addChild(t[d])):(t[d].x=80+19*d,y.addChild(t[d]));a=s_oSpriteLibrary.getSprite("chip_flip_white");a={images:[a],framerate:6,frames:[[0,0,22,91,0,-38,-3],[22,0,30,93,0,-33,-2],[52,0,74,92,0,-11,-2],[0,93,98,99,0,-1,-1],[98,93,98,99,0,-1,-1]],animations:{chip_0:[0,0,"chip_1"],chip_1:[1,1,"chip_2"],chip_2:[2,2,"chip_4"],chip_3:[3,3,"chip_4"],chip_4:[4,4,"stop"]}};a=new createjs.SpriteSheet(a);p=[];for(d=0;d<f;d++)p[d]=createSprite(a,"chip_0",
PAWN_SIZE/2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE),p[d].y=-36,p[d].gotoAndStop("chip_0"),e?(p[d].x=80+19*d,y.addChild(p[d])):(p[d].x=-160-19*d,x.addChild(p[d]));this._openBox()};this.unload=function(){u.removeChild(x);u.removeChild(y)};this._openBox=function(){playSound("drawer",1,!1);createjs.Tween.get(x).to({y:x.y-160},1E3).call(function(){C._onBoxOpen()});createjs.Tween.get(y).to({y:y.y+160},1E3).call(function(){C._onBoxOpen()})};this._onBoxOpen=function(){g++;if(2===g){for(var a=150,b=0;b<f;b++){var c=
t[b].localToGlobal(0,0).x/s_oStage.scaleX,e=t[b].localToGlobal(0,0).y/s_oStage.scaleY;x.removeChild(t[b]);t[b].x=c;t[b].y=e;d.addChild(t[b]);setTimeout(function(){C.playBlack()},a);createjs.Tween.get(t[b]).wait(a).to({x:q[b].x-PAWN_SIZE/2+2,y:q[b].y-PAWN_SIZE/2+1},500,createjs.Ease.cubicOut).call(function(){playSound("click_cell",1,!1);C._onFinishPositioning()});c=p[b].localToGlobal(0,0).x/s_oStage.scaleX;e=p[b].localToGlobal(0,0).y/s_oStage.scaleY;y.removeChild(p[b]);p[b].x=c;p[b].y=e;d.addChild(p[b]);
setTimeout(function(){C.playWhite()},a);createjs.Tween.get(p[b]).wait(a).to({x:m[f-b-1].x-PAWN_SIZE/2+1,y:m[f-b-1].y-PAWN_SIZE/2+1},500,createjs.Ease.cubicOut).call(function(){playSound("click_cell",1,!1);C._onFinishPositioning()});a+=150}a=150;for(b=0;b<f;b++);}};this.playWhite=function(){p[h].gotoAndPlay("chip_1");h++};this.playBlack=function(){t[k].gotoAndPlay("chip_1");k++};this._onFinishPositioning=function(){l++;if(l===2*f)for(var a=0;a<f;a++)d.removeChild(t[a]),d.removeChild(p[a]),s_oGame.setAllVisible(!0),
s_oGame._onExitHelp()};var C=this;this._init(a,c,b,d,e)}var startanim=this;
function CInfoTurn(a,c,b,d){var e,f,g,h,k;this._init=function(a,b,c,d){e=new createjs.Container;e.x=a;e.y=b;s_iGameType===MODE_HUMAN&&c===PAWN_BLACK&&s_bMobile&&!s_bMultiplayer&&(e.rotation=180);d.addChild(e);a=s_oSpriteLibrary.getSprite("bg_turn");b={images:[a],framerate:58,frames:{width:a.width/2,height:a.height,regX:a.width/2/2,regY:a.height/2},animations:{off:[0,0,"on"],on:[1,1,"off"]}};b=new createjs.SpriteSheet(b);f=createSprite(b,0,a.width/2/2,a.height/2,a.width/2,a.height);f.stop();e.addChild(f);
g=createSprite(b,1,a.width/2/2,a.height/2,a.width/2,a.height);g.stop();g.x=10;g.alpha=0;e.addChild(g);a=s_oSpriteLibrary.getSprite("pawn");b={images:[a],frames:{width:PAWN_SIZE,height:PAWN_SIZE,regX:PAWN_SIZE/2,regY:PAWN_SIZE/2},animations:{white:[0],black:[1],white_checker:[2],black_checker:[3]}};b=new createjs.SpriteSheet(b);k=createSprite(b,c,PAWN_SIZE/2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE);k.x=160;k.y=2;k.stop();e.addChild(k);h=new createjs.Text("00:00","bold 58px "+PRIMARY_FONT,"#ffffff");h.x=-75;
h.y=2;h.textBaseline="middle";h.lineWidth=200;e.addChild(h)};this.refreshTime=function(a){h.text=a};this.invert=function(){h.x=0;k.x=-100};this.active=function(a){a?(createjs.Tween.get(f).to({alpha:0},750,createjs.Ease.cubicOut).to({alpha:1},750,createjs.Ease.cubicIn).call(function(){l.active(a)}),createjs.Tween.get(g).to({alpha:1},750,createjs.Ease.cubicOut).to({alpha:0},750,createjs.Ease.cubicIn)):(f.alpha=1,g.alpha=0,createjs.Tween.removeTweens(f),createjs.Tween.removeTweens(g))};this.unload=function(){d.removeChild(e)};
this.setBgVisible=function(a){f.visible=a};this.setPanelVisible=function(a){e.visible=a};this.setPawn=function(a){k.gotoAndStop(a)};this.setPos=function(a){e.x=a.x;e.y=a.y};this.setName=function(a){a=new createjs.Text(a," 50px "+PRIMARY_FONT,"#ffffff");e.y>CANVAS_HEIGHT/2?(a.x=-f.getBounds().width/2,a.textAlign="right"):(a.x=f.getBounds().width/2,a.textAlign="left");a.textBaseline="middle";a.lineWidth=500;e.addChild(a)};var l=this;this._init(a,c,b,d)}
function CThinking(){var a,c,b,d,e,f,g;this._init=function(){a=!0;c=0;b=new createjs.Container;var h=(new createjs.Graphics).beginFill("rgba(0,0,0,0.3)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f=new createjs.Shape(h);g=f.on("click",function(){});d=new createjs.Text(TEXT_THINKING,"bold 60px "+PRIMARY_FONT,"#ffffff");d.x=.5*CANVAS_WIDTH;d.y=.5*CANVAS_HEIGHT-100;d.textAlign="center";d.textBaseline="alphabetic";d.lineWidth=800;e=new createjs.Text("","bold 180px "+PRIMARY_FONT,"#ffffff");e.x=.5*CANVAS_WIDTH-
76;e.y=.5*CANVAS_HEIGHT-50;e.textAlign="left";e.textBaseline="alphabetic";e.lineWidth=800;b.addChild(f,d,e);s_oStage.addChild(b)};this.show=function(){b.visible=!0};this.hide=function(){b.visible=!1};this.isVisible=function(){return b.visible};this.setMessage=function(a){d.text=a};this.unload=function(){a=!1;f.off("click",g);s_oStage.removeChild(b)};this.update=function(){a&&(c+=s_iTimeElaps,0<=c&&c<TIME_LOOP_WAIT/4?e.text="":c>=TIME_LOOP_WAIT/4&&c<2*TIME_LOOP_WAIT/4?e.text=".":c>=2*TIME_LOOP_WAIT/
4&&c<3*TIME_LOOP_WAIT/4?e.text="..":c>=3*TIME_LOOP_WAIT/4&&c<TIME_LOOP_WAIT?e.text="...":c=0)};this._init()}
function CEndPanel(a){var c,b,d,e,f,g,h,k,l,m,q;this._init=function(a){s_oGame.pauseGame(!0);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.7;c=createBitmap(a);c.regX=a.width/2;c.regY=a.height/2;c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2;f=new createjs.Text("","bold 90px "+PRIMARY_FONT,"#ffffff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2-200;f.textAlign="center";f.textBaseline="alphabetic";f.lineWidth=800;g=new createjs.Text("","bold 40px "+PRIMARY_FONT,
"#ffffff");g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2-150;g.textAlign="center";g.textBaseline="alphabetic";g.lineWidth=800;b=new createjs.Container;b.alpha=0;b.visible=!1;b.addChild(h,c,f,g);d=new CInfoTurn(CANVAS_WIDTH/2,1020,PAWN_BLACK,b);d.setBgVisible(!1);d.invert();e=new CInfoTurn(CANVAS_WIDTH/2,870,PAWN_WHITE,b);e.setBgVisible(!1);e.invert();s_oStage.addChild(b)};this.unload=function(){s_oStage.removeChild(b);q&&q.unload();l&&l.unload();m&&m.unload();d.unload();e.unload();b.off("mousedown",k)};
this._initListener=function(){k=b.on("mousedown",this._onExit)};this.setRestartBut=function(a,c){var d=s_oSpriteLibrary.getSprite("but_restart");q=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+250,d,b);q.addEventListener(ON_MOUSE_UP,a,c)};this.setHomeBut=function(a,c){var d=s_oSpriteLibrary.getSprite("but_home");l=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+250,d,b);l.addEventListener(ON_MOUSE_UP,a,c)};this.setCheckBut=function(a,c){var d=s_oSpriteLibrary.getSprite("but_show");m=new CGfxButton(CANVAS_WIDTH/
2+180,CANVAS_HEIGHT/2+250,d,b);m.addEventListener(ON_MOUSE_UP,a,c)};this.show=function(a,c,h){CloudAPI.gameOver();CloudAPI.gameOver();CloudAPI.gameOver();CloudAPI.gameOver();d.refreshTime(formatTime(c));e.refreshTime(formatTime(h));a===WIN_WHITE?(playSound("win",1,!1),f.text=TEXT_WHITE+" "+TEXT_GAMEOVER):a===WIN_BLACK?(MODE_HUMAN?playSound("win",1,!1):playSound("game_over",1,!1),f.text=TEXT_BLACK+" "+TEXT_GAMEOVER):a===DRAW?(playSound("game_over",1,!1),f.text=TEXT_DRAW):a===WIN_WHITE_BLACK_NOMOVES?
(playSound("win",1,!1),f.text=TEXT_WHITE+" "+TEXT_GAMEOVER,g.text="("+TEXT_BLACK+" "+TEXT_MOVES_AVAIL+")"):a===WIN_BLACK_WHITE_NOMOVES&&(MODE_HUMAN?playSound("win",1,!1):playSound("game_over",1,!1),f.text=TEXT_BLACK+" "+TEXT_GAMEOVER,g.text="("+TEXT_WHITE+" "+TEXT_MOVES_AVAIL+")");b.visible=!0;createjs.Tween.get(b).to({alpha:1},500);var k=18E5-c;$(s_oMain).trigger("save_score",[a,c,h,s_iGameType,k]);$(s_oMain).trigger("share_event",[k,s_iGameType,a])};this._onExit=function(){b.off("mousedown",k);
d.unload();e.unload();s_oStage.removeChild(b);$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad");s_oGame.onExit()};this.hide=function(){b.visible=!1;$(s_oMain).trigger("end_session")};this.reShow=function(){b.visible=!0};this._init(a);return this}
function CCell(a,c,b,d,e,f,g){var h,k,l,m,q,p=[],t,u,x,y,r,B;this._init=function(a,b,c,d,e,f,g){h=!1;k=c;l=d;m=e;q=f;t=new createjs.Container;t.x=a;t.y=b;g.addChild(t);a=s_oSpriteLibrary.getSprite("pawn");a=new createjs.SpriteSheet({images:[a],frames:{width:PAWN_SIZE,height:PAWN_SIZE,regX:PAWN_SIZE/2,regY:PAWN_SIZE/2},animations:{white:[0],black:[1],white_checker:[2],black_checker:[3]}});u=createSprite(a,c,PAWN_SIZE/2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE);u.stop();t.addChild(u);r=createSprite(a,c,PAWN_SIZE/
2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE);r.alpha=.4;r.visible=!1;t.addChild(r);a=s_oSpriteLibrary.getSprite("highlight");y=createBitmap(a);y.regX=a.width/2;y.regY=a.height/2;y.alpha=.8;y.visible=!1;t.addChild(y);x=new createjs.Shape;x.graphics.beginFill("rgba(158,0,0,0.01)").drawRect(-CELL_LENGTH/2,-CELL_LENGTH/2,CELL_LENGTH,CELL_LENGTH);B=x.on("mousedown",this._onCellClick);x.visible=!1;t.addChild(x)};this.unload=function(){g.removeChild(t);x.off("mousedown",B)};this.setClickableArea=function(a){x.visible=
a};this.showMoves=function(a,b){s_iGameType===MODE_HUMAN&&b===KING_BLACK&&(t.rotation=180);r.gotoAndStop(b);r.visible=a};this.highlight=function(a,c){s_iGameType===MODE_HUMAN&&b===KING_BLACK&&(t.rotation=180);y.visible=a};this.setColor=function(a){s_iGameType===MODE_HUMAN&&a===KING_BLACK&&(t.rotation=180);u.gotoAndStop(a);k=a};this.reversi=function(){k===PAWN_WHITE?(k=PAWN_BLACK,createjs.Tween.get(t).to({scaleX:.1},200).call(function(){u.gotoAndStop(PAWN_BLACK)}).to({scaleX:1},200).call(function(){s_oGame.onFlipsEnd()})):
(k=PAWN_WHITE,createjs.Tween.get(t).to({scaleX:.1},200).call(function(){u.gotoAndStop(PAWN_WHITE)}).to({scaleX:1},200).call(function(){s_oGame.onFlipsEnd()}))};this._onCellClick=function(){s_oGame.cellClicked(l,m)};this.setType=function(a){k=a};this.getType=function(){return k};this.getBgColor=function(){return q};this.setLegalMove=function(a){h=a};this.isLegalMove=function(){return h};this.setVisible=function(a){t.visible=a};this.getX=function(){return a};this.getY=function(){return c};this.getGlobalX=
function(){return t.localToGlobal(0,0).x};this.getGlobalY=function(){return t.localToGlobal(0,0).y};this.setMovesChain=function(a){p=[];for(var b=0;b<a.length;b++){p[b]=[];for(var c=0;c<a[b].length;c++)p[b][c]=a[b][c]}};this.getMovesChain=function(){return p};this._init(a,c,b,d,e,f,g)}
function CMovingCell(a,c,b,d){var e,f,g,h,k,l;this._init=function(a,b,c,d){e=a;f=b;g=c;h=1;k=d;a={images:[s_oSpriteLibrary.getSprite("pawn")],frames:{width:PAWN_SIZE,height:PAWN_SIZE,regX:PAWN_SIZE/2,regY:PAWN_SIZE/2},animations:{white:[0],black:[1],white_checker:[2],black_checker:[3]}};a=new createjs.SpriteSheet(a);l=createSprite(a,c,PAWN_SIZE/2,PAWN_SIZE/2,PAWN_SIZE,PAWN_SIZE);l.stop();l.x=e;l.y=f;s_iGameType===MODE_HUMAN&&c===KING_BLACK&&(l.rotation=180);k.addChild(l)};this.unload=function(){k.removeChild(l)};
this.move=function(a,b,c,d,e,f){createjs.Tween.get(l).to({x:a,y:b},c).call(function(){m.unload();if(null!==f){for(var a=f.length-1;0<=a;a--)f[a][0].row===d&&f[a][0].col===e||f.splice(a,1);for(a=0;a<f.length;a++)f[a].splice(0,1)}s_oGame.onFinishMove(d,e,g,f)});createjs.Tween.get(l).to({scaleX:h+.2,scaleY:h+.2},c/2,createjs.Ease.cubicOut).to({scaleX:h,scaleY:h},c/2,createjs.Ease.cubicIn)};var m=this;this._init(a,c,b,d)}
function CAreYouSurePanel(a){var c,b,d,e,f,g,h,k;this._init=function(a){g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;k=g.on("mousedown",function(){});s_oStage.addChild(g);(new createjs.Tween.get(g)).to({alpha:.7},500);h=new createjs.Container;s_oStage.addChild(h);a=s_oSpriteLibrary.getSprite("msg_box");var l=createBitmap(a);l.regX=a.width/2;l.regY=a.height/2;h.addChild(l);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT+a.height/2;c=h.y;(new createjs.Tween.get(h)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.cubicOut);b=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#000000");b.y=-a.height/2+120;b.textAlign="center";b.textBaseline="middle";b.lineWidth=600;b.outline=5;d=new createjs.Text(TEXT_ARE_SURE," 100px "+PRIMARY_FONT,"#ffffff");d.y=b.y;d.textAlign="center";d.textBaseline="middle";d.lineWidth=600;h.addChild(d);e=new CGfxButton(170,80,s_oSpriteLibrary.getSprite("but_yes"),h);e.addEventListener(ON_MOUSE_UP,this._onButYes,this);f=new CGfxButton(-170,80,s_oSpriteLibrary.getSprite("but_no"),
h);f.addEventListener(ON_MOUSE_UP,this._onButNo,this);f.pulseAnimation()};this._onButYes=function(){f.setClickable(!1);e.setClickable(!1);(new createjs.Tween.get(g)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:c},400,createjs.Ease.backIn).call(function(){l.unload();a()})};this._onButNo=function(){f.setClickable(!1);e.setClickable(!1);(new createjs.Tween.get(g)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:c},400,createjs.Ease.backIn).call(function(){l.unload()})};this.changeMessage=
function(a,c){b.text=a;d.text=a;c&&(b.font=" "+c+"px "+PRIMARY_FONT,d.font=" "+c+"px "+PRIMARY_FONT)};this.unload=function(){f.unload();e.unload();s_oStage.removeChild(g);s_oStage.removeChild(h);g.off("mousedown",k)};var l=this;this._init(a)}
function CMsgBox(a){var c,b,d,e,f;this._init=function(a){b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.7;b.on("mousedown",function(){});s_oStage.addChild(b);d=new createjs.Container;s_oStage.addChild(d);var g=s_oSpriteLibrary.getSprite("msg_box"),k=createBitmap(g);k.regX=g.width/2;k.regY=g.height/2;d.addChild(k);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2;e=new createjs.Text(a," 80px "+PRIMARY_FONT,"#ffffff");e.y=0;e.textAlign="center";e.textBaseline=
"middle";e.lineWidth=600;d.addChild(e);f=new createjs.Container;f.y=180;d.addChild(f);c=[]};this.unload=function(){s_oStage.removeChild(b);s_oStage.removeChild(d);b.off("mousedown",function(){});for(var a=0;a<c.length;a++)c[a].unload()};this.setMessage=function(a){e.text=a};this.setExplMsg=function(a){a=new createjs.Text(a," 50px "+PRIMARY_FONT,"#ffffff");a.y=-100;a.textAlign="center";a.textBaseline="middle";a.lineWidth=400;d.addChild(a)};this.addButton=function(a,b,d,l){e.y=-250;var g=new CGfxButton(c.length*
(a.width+150),0,a,f);g.addEventListener(b,d,l);c.push(g);f.regX=f.getBounds().width/2-a.width/2};this.show=function(){b.visible=!0;d.visible=!0};this.reShow=function(){b.visible=!0;d.visible=!0};this.hide=function(){b.visible=!1;d.visible=!1};this._init(a)};
var ARK_game_arena_connector={_actionHandler:{},_showGameEnd:!0,_scoreChangleLog:[],_score:0,_playId:"",_gameSecret:"",_params:[],_arena_events_subscription:{},_arena_return_values_subscription:{},_TRUE_AS_STRING:String(!0).toLowerCase(),_messageSender:null,_postInitCallback:null,_md5:function(e){function s(e,n){return e<<n|e>>>32-n}function g(e,n){var a,r,o,_,t;return o=2147483648&e,_=2147483648&n,t=(1073741823&e)+(1073741823&n),(a=1073741824&e)&(r=1073741824&n)?2147483648^t^o^_:a|r?1073741824&t?3221225472^t^o^_:1073741824^t^o^_:t^o^_}function n(e,n,a,r,o,_,t){var c;return e=g(e,g(g((c=n)&a|~c&r,o),t)),g(s(e,_),n)}function a(e,n,a,r,o,_,t){var c;return e=g(e,g(g(n&(c=r)|a&~c,o),t)),g(s(e,_),n)}function r(e,n,a,r,o,_,t){return e=g(e,g(g(n^a^r,o),t)),g(s(e,_),n)}function o(e,n,a,r,o,_,t){return e=g(e,g(g(a^(n|~r),o),t)),g(s(e,_),n)}function _(e){var n,a="",r="";for(n=0;n<=3;n++)a+=(r="0"+(e>>>8*n&255).toString(16)).substr(r.length-2,2);return a}var t,c,m,i,l,u,d,p,A,R=Array();for(R=function(e){for(var n,a=e.length,r=a+8,o=16*(1+(r-r%64)/64),_=Array(o-1),t=0,c=0;c<a;)t=c%4*8,_[n=(c-c%4)/4]=_[n]|e.charCodeAt(c)<<t,c++;return t=c%4*8,_[n=(c-c%4)/4]=_[n]|128<<t,_[o-2]=a<<3,_[o-1]=a>>>29,_}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var n="",a=0;a<e.length;a++){var r=e.charCodeAt(a);r<128?n+=String.fromCharCode(r):(127<r&&r<2048?n+=String.fromCharCode(r>>6|192):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128)),n+=String.fromCharCode(63&r|128))}return n}(e)),u=1732584193,d=4023233417,p=2562383102,A=271733878,t=0;t<R.length;t+=16)u=n(c=u,m=d,i=p,l=A,R[t+0],7,3614090360),A=n(A,u,d,p,R[t+1],12,3905402710),p=n(p,A,u,d,R[t+2],17,606105819),d=n(d,p,A,u,R[t+3],22,3250441966),u=n(u,d,p,A,R[t+4],7,4118548399),A=n(A,u,d,p,R[t+5],12,1200080426),p=n(p,A,u,d,R[t+6],17,2821735955),d=n(d,p,A,u,R[t+7],22,4249261313),u=n(u,d,p,A,R[t+8],7,1770035416),A=n(A,u,d,p,R[t+9],12,2336552879),p=n(p,A,u,d,R[t+10],17,4294925233),d=n(d,p,A,u,R[t+11],22,2304563134),u=n(u,d,p,A,R[t+12],7,1804603682),A=n(A,u,d,p,R[t+13],12,4254626195),p=n(p,A,u,d,R[t+14],17,2792965006),u=a(u,d=n(d,p,A,u,R[t+15],22,1236535329),p,A,R[t+1],5,4129170786),A=a(A,u,d,p,R[t+6],9,3225465664),p=a(p,A,u,d,R[t+11],14,643717713),d=a(d,p,A,u,R[t+0],20,3921069994),u=a(u,d,p,A,R[t+5],5,3593408605),A=a(A,u,d,p,R[t+10],9,38016083),p=a(p,A,u,d,R[t+15],14,3634488961),d=a(d,p,A,u,R[t+4],20,3889429448),u=a(u,d,p,A,R[t+9],5,568446438),A=a(A,u,d,p,R[t+14],9,3275163606),p=a(p,A,u,d,R[t+3],14,4107603335),d=a(d,p,A,u,R[t+8],20,1163531501),u=a(u,d,p,A,R[t+13],5,2850285829),A=a(A,u,d,p,R[t+2],9,4243563512),p=a(p,A,u,d,R[t+7],14,1735328473),u=r(u,d=a(d,p,A,u,R[t+12],20,2368359562),p,A,R[t+5],4,4294588738),A=r(A,u,d,p,R[t+8],11,2272392833),p=r(p,A,u,d,R[t+11],16,1839030562),d=r(d,p,A,u,R[t+14],23,4259657740),u=r(u,d,p,A,R[t+1],4,2763975236),A=r(A,u,d,p,R[t+4],11,1272893353),p=r(p,A,u,d,R[t+7],16,4139469664),d=r(d,p,A,u,R[t+10],23,3200236656),u=r(u,d,p,A,R[t+13],4,681279174),A=r(A,u,d,p,R[t+0],11,3936430074),p=r(p,A,u,d,R[t+3],16,3572445317),d=r(d,p,A,u,R[t+6],23,76029189),u=r(u,d,p,A,R[t+9],4,3654602809),A=r(A,u,d,p,R[t+12],11,3873151461),p=r(p,A,u,d,R[t+15],16,530742520),u=o(u,d=r(d,p,A,u,R[t+2],23,3299628645),p,A,R[t+0],6,4096336452),A=o(A,u,d,p,R[t+7],10,1126891415),p=o(p,A,u,d,R[t+14],15,2878612391),d=o(d,p,A,u,R[t+5],21,4237533241),u=o(u,d,p,A,R[t+12],6,1700485571),A=o(A,u,d,p,R[t+3],10,2399980690),p=o(p,A,u,d,R[t+10],15,4293915773),d=o(d,p,A,u,R[t+1],21,2240044497),u=o(u,d,p,A,R[t+8],6,1873313359),A=o(A,u,d,p,R[t+15],10,4264355552),p=o(p,A,u,d,R[t+6],15,2734768916),d=o(d,p,A,u,R[t+13],21,1309151649),u=o(u,d,p,A,R[t+4],6,4149444226),A=o(A,u,d,p,R[t+11],10,3174756917),p=o(p,A,u,d,R[t+2],15,718787259),d=o(d,p,A,u,R[t+9],21,3951481745),u=g(u,c),d=g(d,m),p=g(p,i),A=g(A,l);return(_(u)+_(d)+_(p)+_(A)).toLowerCase()},_urlEncode:function(){for(var e="",n=arguments,a=0;a<n.length;a++){var r=n[a].key,o=n[a].value;e+=r+"=";for(var _=0;_<o.length;_++)e+=o[_],_<o.length-1&&(e+=",");a<n.length-1&&(e+="&")}return e},_urlDecode:function(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))},_parseMessage:function(e){for(var n={empty:!0,events:[],actions:[],params:ARK_game_arena_connector._params,returnValues:[],show_game_end:ARK_game_arena_connector._showGameEnd,play_id:ARK_game_arena_connector._playId},a=e.split("&"),r=0;r<a.length;r++){var o=a[r].split("=");if(2===o.length){var _=o[0];"action"===_&&(_="actions");var t=decodeURIComponent(o[1]),c=t.split(",");if("events"===_||"actions"===_)n[_]=c,n.empty=!1;else if("get_values"===_)n.returnValues=c,n.empty=!1;else if("play_id"===_)n[_]=t,n.empty=!1;else if("show_game_end"===_)n[_]=t===ARK_game_arena_connector._TRUE_AS_STRING,n.empty=!1;else if(0<c.length)for(var s=!(n.empty=!1),g=0;g<c.length;g++){for(var m=0;m<n.params.length;++m)if(n.params[m].name===_){n.params[m].value=decodeURIComponent(c[g]),s=!1;break}s&&n.params.push({name:_,value:decodeURIComponent(c[g])})}}}return n},registerAction:function(e,n){ARK_game_arena_connector._actionHandler[e]=n},fireEventToArena:function(e,n){if(!0===ARK_game_arena_connector._arena_events_subscription[e]||"event_change"===e||"test_ready"===e){var a="event="+e;if("game_end"===e)for(var r in a+="&score="+encodeURIComponent(ARK_game_arena_connector._score)+"&score_hash="+ARK_game_arena_connector._md5(ARK_game_arena_connector._score.toString()+"_"+ARK_game_arena_connector._playId+"_"+ARK_game_arena_connector._gameSecret),ARK_game_arena_connector._arena_return_values_subscription)"game_log"===r&&!0===ARK_game_arena_connector._arena_return_values_subscription[r]&&(a+="&game_log="+encodeURIComponent(JSON.stringify(ARK_game_arena_connector._scoreChangleLog)));else n&&0<n.length&&(a+="&"+n);try{ARK_game_arena_connector._messageSender(a,"*")}catch(e){}}},showGameEnd:function(){return ARK_game_arena_connector._showGameEnd},changeScore:function(e,n){ARK_game_arena_connector._score=e,ARK_game_arena_connector._scoreChangleLog.push({score:e,time:(new Date).getTime(),comment:n})},setGameSecret:function(e){ARK_game_arena_connector._gameSecret=e},_handleMessageFromArena:function(e){ARK_game_arena_connector.doInit(e.data)},_iframe_messageSender:function(e){parent.postMessage(e,"*")},_arkPage_messageSender:function(e){arkPage.postMessage(e)},getParam:function(e,n){for(var a=0;a<ARK_game_arena_connector._params.length;++a)if(ARK_game_arena_connector._params[a].name===e)return ARK_game_arena_connector._params[a].value;return n},init:function(e,n){var a;(ARK_game_arena_connector._postInitCallback="function"==typeof e?e:null,"arkPage"in window&&null!=arkPage.postMessage)?(ARK_game_arena_connector._messageSender=ARK_game_arena_connector._arkPage_messageSender,ARK_game_arena_connector._arkPage_messageSender("event=game_loaded&callback=ARK_game_arena_connector.doInit")):(ARK_game_arena_connector._messageSender=ARK_game_arena_connector._iframe_messageSender,window.addEventListener?window.addEventListener("message",ARK_game_arena_connector._handleMessageFromArena,!1):window.attachEvent("onmessage",ARK_game_arena_connector._handleMessageFromArena),a=n?"".concat(window.location.search.substr(1),"&",n):window.location.search.substr(1),ARK_game_arena_connector.doInit(a))},doInit:function(e){var n,a,r=ARK_game_arena_connector._parseMessage(e);if(r.empty)null!==ARK_game_arena_connector._postInitCallback&&(ARK_game_arena_connector._postInitCallback(),ARK_game_arena_connector._postInitCallback=null);else{for(ARK_game_arena_connector._showGameEnd=r.show_game_end,ARK_game_arena_connector._playId=r.play_id,ARK_game_arena_connector._params=r.params,a=0;a<r.actions.length;++a)"function"==typeof(n=ARK_game_arena_connector._actionHandler[r.actions[a]])&&n(r.params);var o="";for(a=0;a<r.returnValues.length;++a)ARK_game_arena_connector._arena_return_values_subscription[r.returnValues[a]]=!0,"score"===r.returnValues[a]&&(o+="score="+encodeURIComponent(ARK_game_arena_connector._score)),"score_hash"===r.returnValues[a]&&(o+="&score_hash="+ARK_game_arena_connector._md5(ARK_game_arena_connector._score.toString()+"_"+ARK_game_arena_connector._playId)),"game_log"===r.returnValues[a]&&(o+="&game_log="+encodeURIComponent(JSON.stringify(ARK_game_arena_connector._scoreChangleLog)));for(a=0;a<r.events.length;++a)ARK_game_arena_connector._arena_events_subscription[r.events[a]]=!0;0<o.length&&ARK_game_arena_connector._messageSender(o),null!==ARK_game_arena_connector._postInitCallback&&(ARK_game_arena_connector._postInitCallback(),ARK_game_arena_connector._postInitCallback=null)}},initTestingEnvironment:function(){ARK_game_arena_connector.fireEventToArena("test_ready")}};
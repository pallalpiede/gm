!function(){function e(){e.swipeDistance=160,e.swipeMaxtime=800,e.clickTime=200,e._mouseDownWhen=0,e._mouseSwipeStart=null,e.callbackList=null,e._showDebugWindowData=!1,window.addEventListener("resize",e.resizeCanvas,!1),window.addEventListener("orientationchange",e.resizeCanvas,!1)}function t(){if("hidden"in document)return null;for(var e=["moz","ms","o","webkit"],t=0;t<e.length;t++){var s=e[t]+"Hidden";if(s in document)return e[t]}return null}function s(e){return e?e+"Hidden":"hidden"}function i(e){return e?e+"visibilitychange":"visibilitychange"}function n(){PIXI.Sprite.call(this),this.x=0,this.y=0,this.usePcnt=!1,this.anchor.set(0,0),this.responsive=null,this.myFilters=null,this.pickerMaskData=null,this.fader=null,this.tweener=null,this.button=null,this.globalScale=null}function a(e,t){PIXI.Text.call(this,e,t),this.x=0,this.y=0,this.responsive=null}function o(){this.parent=null,this.managers=null,this.bg=null,this.text=null,this.buttons=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removeAtTimeOut=!0,this.timeOut=0,this.doneIn=!1,this.doneOut=!1,this.buttonPressed=0,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1}function r(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null}function l(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.tab1=null,this.tab2=null,this.whichTab=0,this.checkBox=null}function h(e){n.call(this),this.textures=null,this.type=e||h.TYPE_BUTTON,this.downDetected=!0,this.callback=null,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null}function c(){this.checked=!1,this.tick=null,this.toggleEvent=null,h.call(this,h.TYPE_CHECKBOX)}function u(){this.panel=null,this.sprites=null,this.buttons=null,this.texts=null,this.soundBtn=null,this.musicBtn=null,this.destroyCallback=null,this.removing=!1,this.doneIn=!1,this.doneOut=!1,this.adShown=!1,this.soundAdjustTracked=!1,this.sliderTab=[],this.sliderBar=[]}function d(){this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.chain=0,this.multiMatch=0,this.spriteList=null,this.lastHovered=null}function p(){this.managers=null}function g(){this.strings=null}function m(e,t,s){A.debug&&console.log("FontLoaded ",e),this.fontList=e,this.loadedCallback=t,this.loadedCallbackContext=s,this.loadedFonts=0,this.width=m.getTextExtent("giItT1WQy@!-/#%","font_that_doesnt_exist",300),this.checkFonts()||(this.interval=setInterval(this.checkFonts.bind(this),50))}function f(){this.fadeValue=0,this.fadedir=0,this.trigger=void 0,this.direction=void 0,this.callback=null,this.context=null,this.args=null}function y(){this.list=null}function v(){this.pending=0,this.loader=null}function b(){}function _(){this.list=null,this.pending=0}function w(){this.list=null,this.mute=!1,this.gameTune=null,this.tunesMuted=!1,this.rememberMute=void 0,this.rememberTunesMuted=void 0,this.delayed=null,this.pending=0,this.managers=null}function x(e){this.root=null,this.textureManager=null,this.dataManager=null,this.audioManager=null,this.localeManager=null,this.loadManager=null,this.lowResolution=!1,this.levels=0,this.baseUrl=e}function k(e,t,s,i,a,o,r){this.managers=t,this.symbol=o,this.value=r,this.name="cube_"+this.symbol+"_1",n.call(this),this.create(e,null,this.name,this.managers.textures),this.setPickerData(this.managers.data.get("maskData_1")),this.anchor.set(.5,.5),this.scale.x=k.scale,this.scale.y=k.scale,this.sizex=125*A.tileAssetScale*k.scale,this.sizey=125*A.tileAssetScale*k.scale,this.scalez=.28,this.cx=s,this.cy=i,this.cz=a,this.wobbleCount=0,this.angle=35*Math.PI/180,this.rotate3d(this.angle)}function S(){PIXI.Container.call(this),this.angle=0,this.targetAngle=0,this.speedMatchValue=0,this.speedMatchTime=0,this.multiMatchValue=0,this.levelBonusValues=null,this.world=null,this.tileDescriptions=null,this.puzzleLayout=null,this.tiles=null,this.managers=null,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.cacheSpriteList=[],this.second=!1,this.removeTiles=null,S.turnSpeed=4*Math.PI/180}function T(){this.preloader=null,this.titles=null,this.game=null,this.bm=null}function A(){A.VERSION="1.8.97",A.testKeys=!1,A.debug=!1,A.showFPS=!1,A.congig=null,A.analyticsHelper=null,A.pauseOnFocusLoss=!1,A.playAgainCount=1,A.playMidRollAd=!1,A.playMidRollAdAfterPause=!1,A.eventChangeAdOnMatch=!1,A.eventChangeAdOnTitlesShow=!1,A.eventChangeAdOnTitlesClose=!1,A.eventChangeAdOnRotate=!1,A.eventChangeAdOnPopup=!0,A.eventChangeAdOnOptions=!0,A.eventChangeAdOnIdle=0,A.idleTimer=Number.MAX_VALUE,A.timerStart=350999,A.gameWide=1200,A.gameHigh=900,A.volumeControl=.5,A.click=null,A.hover=null,A.mouseDown=null,A.mouseUp=null,A.swipe=0,A.swipeEnabled=!1,A.quitConfirmed=!1,A.showTitleScreenOnStart=!0,A.grabFocusOnStart=!1,A.showHelp=!0,A.showQuitButtonDuringGameplay=!1,A.showQuitButtonAtGameEnd=!0,A.forceResize=!1,A.resized=!1,A.resizeConsumed=!1,A.time=0,A.elapsedTime=0,A.muteUntil=-1,A.isPortrait=!0,A.aspectRatio=1,A.countryCode="en-US",A.nowTime=0,A.repeatedGamesLeft=0,A.lowResolutionAssets=void 0,A.tileAssetScale=1,A.suppressBigAnimations=!1,A.pieceScale=.85,A.puzzleOffsetY=0,A._lastTime=0,this.gameControl=null}function P(){this.bg=null,this.sprites=null,this.buttons=null,this.fader=null,this.textures=null}function M(){this.world=null,this.managers=null,this.level=0,this.numLevels=0,this.help=null,this.confirm=null,this.bm=null,this.lastState=-1,this.state=M.STARTING,this.nextState=-1,this.delay=0,this.won=!1,M.paused=!1,M.requestQuit=!1,M.effects=null,M.timeLeft=0,M.score=0,M.options=null}function E(e){this.game=e,this.managers=null,this.lastMatchTime=-1,this.bg=null,this.buttons=null,this.icons=null,this.sprites=null,this.texts=null,this.timeText=null,this.scoreText=null,this.bm=null,this.container1=null,this.container2=null,this.ignoreClick=null,this.puzzleInput=null,this.puzzle=null}e.resetInput=function(){e._mouseDownWhen=0,e._mouseSwipeStart=null},e.pixiListeners=function(t){t.plugins.interaction.on("mousedown",e.mouseDownHandler),t.plugins.interaction.on("mouseup",e.mouseUpHandler),t.plugins.interaction.on("mousemove",e.mouseMoveHandler),t.plugins.interaction.on("mouseout",e.mouseOutHandler),t.plugins.interaction.on("touchstart",e.mouseDownHandler),t.plugins.interaction.on("touchmove",e.mouseMoveHandler),t.plugins.interaction.on("touchclick",e.inputClickHandler),t.plugins.interaction.on("touchend",e.mouseUpHandler)},e.mouseToStage=function(e,t){return{x:e,y:t}},e.inputClickHandler=function(t){A.click=e.mouseToStage(t.data.global.x,t.data.global.y)},e.inputSwipeHandler=function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(A.swipe=e.deltaX<-20?-1:e.deltaX>20?1:0)},e.mouseOutHandler=function(){A.mouseOut=!0},e.mouseMoveHandler=function(t){A.mouseOut&&(A.mouseOut=!1),A.hover=e.mouseToStage(t.data.global.x,t.data.global.y),e._mouseSwipeStart&&A.swipeEnabled&&L.distanceBetween(e._mouseSwipeStart,A.hover)>=e.swipeDistance&&A.nowTime-e._mouseDownWhen<e.swipeMaxtime&&(e.inputSwipeHandler({deltaX:A.hover.x-e._mouseSwipeStart.x,deltaY:A.hover.y-e._mouseSwipeStart.y}),e._mouseDownWhen=0,A.mouseDown=null)},e.mouseDownHandler=function(t){e._mouseDownWhen=A.nowTime,A.mouseDown=e.mouseToStage(t.data.global.x,t.data.global.y),!e._mouseSwipeStart&&A.swipeEnabled&&(e._mouseSwipeStart=e.mouseToStage(t.data.global.x,t.data.global.y)),e.triggerCallback("mousedown",A.mouseDown.x,A.mouseDown.y)},e.mouseUpHandler=function(t){var s=0;A.mouseUp&&A.mouseDown&&(s=L.distanceBetween(A.mouseUp,A.mouseDown)),A.mouseDown&&(!A.swipeEnabled||s<e.swipeDistance&&(!e._mouseDownWhen||A.nowTime-e._mouseDownWhen<e.clickTime)?e.inputClickHandler(t):(A.mouseUp=e.mouseToStage(t.data.global.x,t.data.global.y),A.mouseUp&&A.mouseDown&&s>=e.swipeDistance&&e.inputSwipeHandler({deltaX:A.mouseUp.x-A.mouseDown.x,deltaY:A.mouseUp.y-A.mouseDown.y}))),e._mouseDownWhen=0,A.mouseDown=e._mouseSwipeStart=null},e.resizeCanvas=function(){null===A.HTMLElement?e._internalResize(window.innerWidth,window.innerHeight):e._internalResize(A.HTMLElement.clientWidth,A.HTMLElement.clientHeight)},e._internalResize=function(e,t){if(A.forceResize||A.width!=e||A.height!=t){if(A.width=e,A.height=t,A.aspectRatio=A.width/A.height,A.isPortrait=A.aspectRatio<1,void 0===A.lowResolutionAssets){var s=Math.max(A.width*A.app.renderer.resolution,A.height*A.app.renderer.resolution),i=s>635;A.lowResolutionAssets=!i}A.tileAssetScale=A.lowResolutionAssets?.5:1;var n=1;A.renderer.resize(A.width,A.height),A.stage.x=Math.round(A.width/2),A.stage.y=Math.round(A.height/2);var a=A.width/A.gameWide,o=A.height/A.gameHigh;A.background.scale.set(n*Math.max(a,o));var r=k.pieceSizePixels*A.tileAssetScale*k.scale,l=r*S.maxHalfTilesWide*.5,h=r*S.maxTilesHigh,c=A.width/l,u=A.height/h;A.puzzle.scale.set(n*Math.min(A.pieceScale*c,A.pieceScale*u)),A.centerpiece.scale.set(n*Math.min(A.pieceScale*c,A.pieceScale*u)),A.centerpiece.y=r*S.currentPuzzleZ*A.puzzle.scale.y*S.centerpieceCoeffY,A.topUI.y=-A.height/2,A.topUI.scale.set(n*Math.min(a,o)),A.fullUI.scale.set(n*Math.min(a*A.fullUIScale,o*A.fullUIScale)),A.rightUI.scale.set(n*Math.min(a,o)),A.rightUI.x=.45*A.width,A.rightUI.y=-A.height/2,A.bottomUI.scale.set(1.5*n*Math.min(a,o)),A.resized=!0,A.resizeConsumed=!1,A.forceResize=!1,A.debug&&console.log("\nMahjonggDimensions "+A.width.toString()+" x "+A.height.toString()+" res = "+(A.lowResolutionAssets?"low":"high")),A.debug&&(console.log("aspectRatio:",A.aspectRatio,A.aspectRatio>=1?"landscape":"portrait"),console.log("devicePixelRatio",window.devicePixelRatio),console.log("doc window.inner:   ",window.innerWidth,"x",window.innerHeight),console.log("Resolution: ",A.lowResolutionAssets?"low":"high"),console.log("View ratio: ",a,":",o),console.log("stage offset: ",A.stage.x,",",A.stage.y,"\n"))}},e.registerCallback=function(t,s,i){A.debug&&console.log("registerCallback for",t),e.callbackList||(e.callbackList=[]),e.callbackList.push({event:t,callback:s,arg:i})},e.triggerCallback=function(t,s,i){if(e.callbackList)for(var n=e.callbackList.length-1;n>=0;--n){var a=e.callbackList[n];a.event==t&&(A.debug&&console.log("triggerCallback for",t),a.callback.call(a.arg.context,s,i,a.arg.args))}},e.clearCallback=function(t,s){if(e.callbackList){for(var i=e.callbackList.length-1;i>=0;--i){var n=e.callbackList[i];if(n.event==t&&n.callback==s){e.callbackList.splice(i,1),A.debug&&console.log("clearCallback for",t);break}}0===e.callbackList.length&&(e.callbackList=null)}},e.clearCallbacks=function(){e.callbackList=null},e.debugWindowData=function(){if(!e._showDebugWindowData){var t=A.width/A.gameWide,s=A.height/A.gameHigh,i="aspectRatio: "+A.aspectRatio+" "+(A.aspectRatio>=1?"landscape":"portrait")+"\n";i+="devicePixelRatio: "+window.devicePixelRatio+"\n",i+="window.inner: "+window.innerWidth+" x "+window.innerHeight+"\n",i+="resolution: "+(A.lowResolutionAssets?"low":"high")+"\n",i+="view ratio: "+t+" : "+s;var n=new a(i,A.textStyleMediumTiny);n.create(A.topUI,-0.45,.25,!0),n.anchor.y=1,e._showDebugWindowData=!0}};var I={};I.isPressed=null,I.edgeDown=null,I.edgeUp=null,I.debug=!1,I.create=function(e){I.captureKeys=[],A.testKeys&&(I.captureKeys=[C.key_l,C.key_r,C.key_t,C.key_v,C.key_x]),I.debug=e||!1,I.reset(),document.body&&document.body.addEventListener?document.body.addEventListener("keydown",I.keyDown,!0):document.addEventListener?document.addEventListener("keydown",I.keyDown,!0):window.addEventListener?window.addEventListener("keydown",I.keyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",I.keyDown),document.body&&document.body.addEventListener?document.body.addEventListener("keyup",I.keyUp,!0):document.addEventListener?document.addEventListener("keyup",I.keyUp,!0):window.addEventListener?window.addEventListener("keyup",I.keyUp,!0):document.attachEvent&&document.attachEvent("onkeyup",I.keyUp)},I.destroy=function(){I.isPressed=null,I.edgeDown=null,I.edgeUp=null},I.update=function(){return!0},I.reset=function(e){void 0===e?(I.isPressed=[],I.edgeDown=[],I.edgeUp=[]):(I.isPressed[e]=!1,I.edgeDown[e]=!1,I.edgeUp[e]=!1)},I.getCode=function(e){return void 0!==e.keyCode?e.keyCode:void 0!==e.charCode?e.charCode:void 0!==e.which?e.which:void 0!==e.key?e.key:void(A.debug&&console.log("ERROR: Keys.getCode unable to recognise what the key value is called in this object: ",e))},I.keyDown=function(e){var t=I.getCode(e);~I.captureKeys.indexOf(t)&&e.preventDefault(),I.isPressed[t]||(I.edgeDown[t]=!0),I.isPressed[t]=!0},I.keyUp=function(e){var t=I.getCode(e);~I.captureKeys.indexOf(t)&&e.preventDefault(),I.isPressed[t]&&(I.edgeUp[t]=!0),I.isPressed[t]=!1};var C={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert_key:45,delete_key:46,key_0:48,key_1:49,key_2:50,key_3:51,key_4:52,key_5:53,key_6:54,key_7:55,key_8:56,key_9:57,key_a:65,key_b:66,key_c:67,key_d:68,key_e:69,key_f:70,key_g:71,key_h:72,key_i:73,key_j:74,key_k:75,key_l:76,key_m:77,key_n:78,key_o:79,key_p:80,key_q:81,key_r:82,key_s:83,key_t:84,key_u:85,key_v:86,key_w:87,key_x:88,key_y:89,key_z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,numpad_4:100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,decimal_point:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,equal_sign:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,open_bracket:219,back_slash:220,close_braket:221,single_quote:222},L={};L.normaliseAngle=function(e,t){t||(t=2*Math.PI);for(var s=t/2;-s>e;)e+=t;for(;e>=s;)e-=t;return e},L.normaliseAnglePositive=function(e,t){for(t||(t=2*Math.PI);0>e;)e+=t;for(;e>=t;)e-=t;return e},L.distance=function(e,t,s,i){var n=s-e,a=i-t;return Math.sqrt(n*n+a*a)},L.distanceBetween=function(e,t){var s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)},L.rotateTo=function(e,t,s,i){i||(i=2*Math.PI);var n,a=i/2,o=L.normaliseAnglePositive(e-t+i,i);return n=o>a?e+Math.min(i-o,s):0!==o?e-Math.min(o,s):t,L.normaliseAngle(n,i)},L.replaceAt=function(e,t,s){return e.substr(0,t)+s+e.substr(t+s.length)},L.setValuesFromObject=function(e,t){if(t)for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},L.indexOfParameter=function(e,t,s){if(!e)return-1;for(var i=0,n=e.length;n>i;i++)if(e[i][t]==s)return i;return-1},L.indexOfStringNoCase=function(e,t){if(!e)return-1;for(var s=0,i=e.length;i>s;s++)if(e[s].toLowerCase()==t.toLowerCase())return s;return-1},L.timeToString=function(e){(void 0===e||null===e||isNaN(e))&&(e=0);var t=e/1e3,s=t/60,i=Math.floor(s).toString(),n=(Math.floor(t)%60).toString();return n.length<2&&(n="0"+n),i+":"+n},L.clamp=function(e,t,s){return Math.min(Math.max(e,t),s)},L.padToLength=function(e,t,s,i){for(;e.length<t;)i?e+=s:e=s+e;return e},L.randomFromList=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},L.makeFunctionForSprite=function(e){return function(t){L.setValuesFromObject(e,t)}},L.focusChangeCallback=null,L.focusChangeContext=null,L._visListener=!1,L._hidden=!1,L._focusIn=function(){L._hidden=!1,A.debug&&console.log("Utils._focusIn hidden =",L._hidden),L.focusChangeContext&&L.focusChangeCallback&&L.focusChangeCallback.call(L.focusChangeContext,L._hidden)},L._focusOut=function(){L._hidden=!0,A.debug&&console.log("Utils._focusOut hidden =",L._hidden),L.focusChangeContext&&L.focusChangeCallback&&L.focusChangeCallback.call(L.focusChangeContext,L._hidden)},L.detectHidden=function(){if(!L._visListener){var e=t(),n=s(e),a=i(e);document.addEventListener(a,function(){document[n]?L._focusOut():L._focusIn()}),window.addEventListener("focus",L._focusIn,!1),window.addEventListener("blur",L._focusOut,!1),L._visListener=!0}},L.isHidden=function(){return document.hidden},L.blanker=null,L.addBlanker=function(e){return null!==L.blanker?void L.blanker.instances++:(L.blanker=new n,L.blanker.create(A.fullUI,"menuAtlas","blanker",e,0,0),L.blanker.anchor.set(.5),L.blanker.scale.set(40),void(L.blanker.instances=1))},L.removeBlanker=function(){L.blanker&&(L.blanker.instances--,L.blanker.instances<=0&&(L.blanker.destroy(),L.blanker=null))},n.prototype=Object.create(PIXI.Sprite.prototype),n.prototype.constructor=n,n.prototype.create=function(e,t,s,i,n,a,o){A.debug&&console.log("Sprite.create",s),this.atlas=t,this.key=s,this.textures=i,this.myFilters=null,this.usePcnt=o,this.key&&(this.texture=this.textures.get(t,s),!this.texture&&A.debug&&console.log("WARNING: unrecognised texture applied to Sprite "+s)),e.addChild(this),this.usePcnt?(this.pcntx=n||0,this.pcnty=a||0):(this.x=n||0,this.y=a||0),this.bounds=this.getBounds(!1),this.getGlobalScale()},n.prototype.destroy=function(){A.debug&&console.log("Sprite.destroy",this.key),this.fader&&(this.fader.destroy(),this.fader=null),this.myFilters=null,this.tweener=null,this.pickerMaskData=null,this.responsive=null,this.globalScale=null,this.texture=null,this.textures=null,PIXI.Sprite.prototype.destroy.call(this)},n.prototype.update=function(e){return A.resized&&(this.getGlobalScale(!0),this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),A.resizeConsumed=!0),this.fader&&(this.alpha=this.fader.fadeValue,this.fader.fading(e)),!0},n.prototype.addFilter=function(e){this.myFilters||(this.myFilters=[]),-1===this.myFilters.indexOf(e)&&(this.myFilters.push(e),this.filters=this.myFilters)},n.prototype.removeFilter=function(e){if(!this.myFilters)return void(this.filters=null);var t=this.myFilters.indexOf(e);-1!==t&&(this.myFilters.splice(t,1),this.filters=this.myFilters)},n.prototype.setPickerData=function(e){this.pickerMaskData=e},n.prototype.setFrame=function(e){return this.key!=e&&(this.key=e,this.key)?(this.texture=this.textures.get(this.atlas,e),!0):!1},n.prototype.getGlobalScale=function(e){if(e||null===this.globalScale){for(var t=this.scale.x,s=this.scale.y,i=this.parent;i;)t*=i.scale.x,s*=i.scale.y,i=i.parent;this.globalScale={x:t,y:s}}return this.globalScale},n.prototype.pixelPicker=function(e,t){if(this.bounds=this.getBounds(!1),e<this.bounds.left||e>=this.bounds.right)return 0;if(t<this.bounds.top||t>=this.bounds.bottom)return 0;this.getGlobalScale();var s=4*Math.floor((e-this.bounds.left)/this.globalScale.x)+3,i=Math.floor((t-this.bounds.top)/this.globalScale.y),n=this.pickerMaskData[s+i*this.texture.frame.width*4];return n?!0:!1},n.prototype.createCanvasFromTexture=function(e){var t=document.createElement("canvas");t.width=this.texture.frame.width*e,t.height=this.texture.frame.height*e;var s=t.getContext("2d");return s.drawImage(this.texture.baseTexture.source,this.texture.frame.x*e,this.texture.frame.y*e,this.texture.frame.width,this.texture.frame.height,0,0,this.texture.frame.width,this.texture.frame.height),t},n.prototype.setCallback=function(e,t,s){this.fadeCallback=e,this.fadeCtx=t,this.fadeArg=s},n.prototype.addFader=function(e,t,s,i,n,a){this.fader=new f,this.fader.setFade(e,t,s,i,n,a)},n.prototype.getPixels=function(){var e=PIXI.RenderTexture.create(this.texture._frame.width,this.texture._frame.height);return A.renderer.render(this,e),A.renderer.extract.pixels(e)},n.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(A.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(A.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},n.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},n.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(n.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=A.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*A.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=A.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent&&this.parent.parent&&!this.parent.parent.parent?e*A.height:e*this.parent.height}},setx:{set:function(e){this.x=e,this.parent&&this.parent.texture.noFrame?(this.msx=A.width/this.parent.scale.x,this.percentx=e/this.msx):this.percentx=this.parent&&this.parent.parent&&!this.parent.parent.parent?e/A.width:e/this.parent.width}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),a.prototype=Object.create(PIXI.Text.prototype),a.prototype.constructor=a,a.prototype.create=function(e,t,s,i){e.addChild(this),i?(this.pcntx=t||0,this.pcnty=s||0):(this.x=t||0,this.y=s||0)},a.prototype.destroy=function(){this.responsive=null,PIXI.Text.prototype.destroy.call(this)},a.prototype.update=function(){return A.resized&&(this.responsive&&this.handleResponsiveLayout(),isNaN(this.percentx)||(this.pcntx=this.percentx),isNaN(this.percenty)||(this.pcnty=this.percenty),A.resizeConsumed=!0),!0},a.prototype.handleResponsiveLayout=function(){for(var e=!1,t=0;t<this.responsive.length;t++){var s=this.responsive[t];isNaN(s.minWidth*this.scale.x)||(A.width<s.minWidth?e=this.respond(s):e||this.respondDefault()),void 0!==s.aspectRatioMin&&(A.aspectRatio<s.aspectRatioMin?e=this.respond(s):e||this.respondDefault())}},a.prototype.respond=function(e){var t=!1;return e.position&&(this.pcntx=e.position.x,this.pcnty=e.position.y,t=!0),e.scale&&(this.scale.x=e.scale.x,this.scale.y=e.scale.y,t=!0),t},a.prototype.respondDefault=function(){this.pcntx=this.responsive.x,this.pcnty=this.responsive.y,this.scale.x=this.responsive.scale.x,this.scale.y=this.responsive.scale.y},Object.defineProperties(a.prototype,{scaleFactor:{get:function(){return this.scale},set:function(e){"number"==typeof e?(this.scale.x=e,this.scale.y=e):(e.hasOwnProperty("x")&&(this.scale.x=e.x),e.hasOwnProperty("y")&&(this.scale.y=e.y))}},pcntx:{set:function(e){this.percentx=e,this.parent&&this.parent.texture.noFrame?(this.msx=A.width/this.parent.scale.x,this.x=e*this.msx):this.x=this.parent==A.window?e*A.width:e*this.parent.width}},pcnty:{set:function(e){this.percenty=e,this.parent&&this.parent.texture.noFrame?(this.msy=A.height/this.parent.scale.y,this.y=e*this.msy):this.y=this.parent==A.window?e*A.height:e*this.parent.height}},responsiveLayout:{set:function(e){this.responsive=e,this.responsive.x=this.percentx,this.responsive.y=this.percenty,this.responsive.scale={x:this.scale.x,y:this.scale.y}}}}),o.prototype.create=function(e,t,s,i,r){this.parent=e,this.managers=t,this.callback=i||null,this.context=r||null,this.timeOut=0,this.removeAtTimeOut=!0,this.doneIn=this.doneOut=!1,this.removing=!1,this.removeAfterClick=!0,this.adShown=!1,this.buttons=[],this.buttonPressed=0,L.addBlanker(this.managers.textures),this.bg=new n,this.bg.create(this.parent,"menuAtlas","popup",this.managers.textures),this.bg.anchor.set(.5,.5);var l,h=this.managers.locale.get(s)||s;h.length<60?(l=A.textStyleBoldHugeCentered.clone(),l.wordWrap=!0,l.wordWrapWidth=2e3):(l=A.textStyleMedium.clone(),l.align="center",l.fontSize=55,l.wordWrap=!0,l.wordWrapWidth=.95*this.bg.width),this.text=new a(h,l),this.text.create(this.bg,0,0,!0),this.text.anchor.set(.5,.45),o.tweenIn.step=L.makeFunctionForSprite(this.bg),this.bg.tweener=new Tweenable,this.bg.tweener.tween(o.tweenIn),this.bg.tweener.owner=this.bg,this.bg.tweener.context=this,this.managers.audio.play("snd_rotate")},o.prototype.addPromoLink=function(e){var t=new h(h.TYPE_BUTTON);t.create(this.bg,"introAtlas","promo-button",this.managers,0,230,!1,"promo-button","promo-button-rollover","promo-button-down",function(){window.open(e.url,"_blank")}),t.anchor.set(.5,.5);var s=new a(e.text,A.textStyleBoldButtonsLarge);s.create(t,0,0,!0),s.anchor.set(.5,.5),t.text=s,t.sfx="snd_clickPlay",this.buttons.push(t)},o.prototype.addButton=function(e,t){var s=new h(h.TYPE_BUTTON);s.create(this.bg,"introAtlas","play-button",this.managers,0,340,!1,"play-button","play-button-rollover","play-button-down",t||"click1_event"),s.anchor.set(.5,.5);var i=new a(this.managers.locale.get(e),A.textStyleBoldButtonsLarge);i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",this.buttons.push(s)},o.prototype.addButtons=function(e,t,s){this.removeAfterClick=s;var i=new h(h.TYPE_BUTTON);i.create(this.bg,"introAtlas","play-button",this.managers,-200,340,!1,"play-button","play-button-rollover","play-button-down","click1_event"),i.anchor.set(.5,.5);var n=new a(this.managers.locale.get(e),A.textStyleBoldButtonsLarge);n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i),i=new h(h.TYPE_BUTTON),i.create(this.bg,"introAtlas","play-button",this.managers,200,340,!1,"play-button","play-button-rollover","play-button-down","click2_event"),i.anchor.set(.5,.5),n=new a(this.managers.locale.get(t),A.textStyleBoldButtonsLarge),n.create(i,0,0,!0),n.anchor.set(.5,.5),i.text=n,i.sfx="snd_clickPlay",this.buttons.push(i)},o.prototype.remove=function(e,t){return this.removing?!1:(this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.removing=!0,this.bg&&(o.tweenOut.step=L.makeFunctionForSprite(this.bg),this.bg.tweener.tween(o.tweenOut),this.bg.tweener.owner=this,this.bg.tweener.context=this),this.removeContext=e||null,this.removeArgument=t||null,!0)},o.prototype.destroy=function(){var e,t;if(L.removeBlanker(),this.buttons)for(e=0,t=this.buttons.length;t>e;e++)this.buttons[e].destroy();this.buttons=null,this.bg&&this.bg.tweener&&(this.bg.tweener.stop(),this.bg.tweener.owner=null,this.bg.tweener.context=null),this.bg&&this.bg.destroy(),this.bg=null,this.text&&this.text.destroy(),this.text=null,this.managers=null,this.parent=null,this.callback=null,this.context=null,this.removeContext=null,this.removeArgument=null,this.removing=!1,A.idleTimer=A.eventChangeAdOnIdle},o.prototype.update=function(e){if(this.doneIn&&(A.eventChangeAdOnPopup&&!this.adShown&&(A.arenaHelper.handleEventChange(),this.adShown=!0,this.timeOut<2e3&&(this.timeOut=2e3)),this.context&&this.callback&&(this.callback.call(this.context),this.callback=null),!this.removeAtTimeOut||!this.timeOut||this.buttons&&this.buttons.length&&!A.showQuitButtonAtGameEnd||(this.timeOut-=A.elapsedTime,this.timeOut<=0&&(this.timeOut=0,this.remove(this.context,e))),this.buttons)){var t,s,i;for(t=0,s=this.buttons.length;s>t&&(i=this.buttons[t].update(),1!=this.buttons[t].alpha&&(i=null),!i);t++);if("click1_event"==i){if(this.timeOut=0,this.buttonPressed=1,!this.removeAfterClick)return!1;this.remove(this.context,e)}else if("click2_event"==i){if(this.timeOut=0,this.buttonPressed=2,!this.removeAfterClick)return!1;this.remove(this.context,e)}}return!this.doneOut},o.prototype.fadeButtons=function(e){for(var t=0,s=this.buttons.length;s>t;t++)this.buttons[t].addFader(e||-.02,1)};var z=350;o.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:z,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},o.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:z,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.removeContext&&this.owner.removeArgument&&(this.owner.removeContext[this.owner.removeArgument]=null),this.owner.destroy(),this.owner=null)}},r.prototype.create=function(e,t,s,i,o,r){A.swipeEnabled=!1,this.game=e,this.managers=t,this.context=i,this.onYes=o,this.onNo=r,this.sprites=[],this.buttons=[],this.texts=[],this.bg=new n,this.bg.create(A.background,"introAtlas","title_bg",t.textures),this.bg.anchor.set(.5,1),this.bg.y=A.height/2/this.bg.parent.scale.y,this.panel=new n,this.panel.create(A.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var l=new h(h.TYPE_BUTTON);l.create(this.panel,"introAtlas","play-button",this.managers,-.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_yes_event"),l.anchor.set(.5,.5),l.scale.set(1);var c=new a(this.managers.locale.get("quit_yes_button_string"),A.textStyleBoldButtons);c.create(l,0,0,!0),c.anchor.set(.5,.5),l.text=c,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l),l=new h(h.TYPE_BUTTON),l.create(this.panel,"introAtlas","play-button",this.managers,.2,.14,!0,"play-button","play-button-rollover","play-button-down","click_no_event"),l.anchor.set(.5,.5),l.scale.set(1),c=new a(this.managers.locale.get("quit_no_button_string"),A.textStyleBoldButtons),c.create(l,0,0,!0),c.anchor.set(.5,.5),l.text=c,l.sfx="snd_clickPlay",l.sfxHover="snd_rollOver",this.buttons.push(l);var u=A.textStyleBold.clone();u.wordWrap=!0,u.wordWrapWidth=800,c=new a(this.managers.locale.get(s),u),c.create(this.panel,0,-.14,!0),c.anchor.set(.5,.5),this.texts.push(c)},r.prototype.destroy=function(){var e;if(this.bg&&(this.bg.destroy(),this.bg=null),this.panel&&(this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.managers=null,this.context=null,this.onYes=null,this.onNo=null,A.resized=!0,A.resizeConsumed=!1,A.swipeEnabled=!0},r.prototype.update=function(){var e,t;if(this.bg.y=A.height/2/this.bg.parent.scale.y,this.bg.update(),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(this.buttons)for(e=0;e<this.buttons.length;e++){var i=this.buttons[e];if(t=i.update(),null!==t)break}return"click_yes_event"==t?(A.click=null,this.onYes.call(this.context),!1):"click_no_event"==t?(A.click=null,this.onNo.call(this.context),!1):!0},l.prototype.create=function(e,t){this.managers=e,this.sprites=[],this.buttons=[],this.texts=[],L.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(A.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new h(h.TYPE_BUTTON);s.create(this.panel,"introAtlas","play-button",this.managers,0,361,!1,"play-button","play-button-rollover","play-button-down","click_event"),s.anchor.set(.5,.5),this.buttons.push(s);var i;i=t?new a(this.managers.locale.get("help_play_string"),A.textStyleBoldButtonsLarge):new a(this.managers.locale.get("continue_button_string"),A.textStyleBoldButtonsLarge),i.create(s,0,0,!0),i.anchor.set(.5,.5),s.text=i,s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_BUTTON),s.create(this.panel,"menuAtlas","basic-gameplay-on",this.managers,-.432,-.4322,!0,"basic-gameplay-on","basic-gameplay-on","basic-gameplay-on","click_tab1_event",null,"basic-gameplay-off","basic-gameplay-off-rollover","basic-gameplay-off","click_tab1_event"),s.toggled=!0,this.buttons.push(s),this.tab1={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",s=new h(h.TYPE_BUTTON),s.create(this.panel,"menuAtlas","max-your-score-button-off",this.managers,-.175,-.4322,!0,"max-your-score-button-on","max-your-score-button-on","max-your-score-button-on","click_tab2_event",null,"max-your-score-button-off","max-your-score-button-off-rollover","max-your-score-button-off","click_tab2_event"),s.toggled=!1,this.buttons.push(s),this.tab2={button:s},s.sfx="snd_clickPlay",s.sfxHover="snd_rollOver",i=new a(this.managers.locale.get("help_page1_text_string"),A.textStyleMedium),i.create(this.panel,A.config.helpPage1TextPos.x,A.config.helpPage1TextPos.y,!0),i.anchor.set(.5,.5),this.texts.push(i);var o=A.textStyleMedium.clone();A.config.helpPage2TextPos.width>0&&(o.align="center",o.wordWrap=!0,o.wordWrapWidth=A.config.helpPage2TextPos.width),i=new a(this.managers.locale.get("help_page2_text_string"),o),i.create(this.panel,A.config.helpPage2TextPos.x,A.config.helpPage2TextPos.y,!0),i.anchor.set(.5,.5),this.texts.push(i);
var r=new c;r.create(this.panel,"menuAtlas","check-box",this.managers,A.config.helpCheckboxPos.x,A.config.helpCheckboxPos.y,!1,"check-box","check-box-rollover","check-box","check_toggled_event",27,0),r.anchor.set(0,.5),r.sfx="snd_clickPlay",r.sfxHover="snd_rollOver",this.buttons.push(r),this.checkBox=r,r.setCheck(A.showHelp);var u=A.textStyleMediumTiny.clone();u.wordWrap=!0,u.wordWrapWidth=170,i=new a(this.managers.locale.get("help_show_help_string"),u),i.create(this.panel,A.config.helpCheckboxTextPos.x,A.config.helpCheckboxTextPos.y,!1),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list=[];var d=A.textStyleMedium2.clone();d.wordWrap=!0,d.wordWrapWidth=A.config.helpGameplayWordWrapWidth,i=new a(this.managers.locale.get("help_page1_text1_string"),d),i.create(this.panel,A.config.helpMatchingRulesTextPos.x,A.config.helpMatchingRulesTextPos.y,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i);var p=new n;p.create(this.panel,"menuAtlas","matching_rules",this.managers.textures,A.config.helpMatchingRulesPos.x,A.config.helpMatchingRulesPos.y,!0),p.anchor.set(.5,.5),p.scale.set(.6,.6),this.sprites.push(p),this.tab1.list.push(p),p=new n,p.create(this.panel,"gameAtlas","time icon",this.managers.textures,A.config.helpTimeIconPos.x,A.config.helpTimeIconPos.y,!0),p.anchor.set(.5,.5),p.scale.set(.75,.75),this.sprites.push(p),this.tab1.list.push(p),i=new a("2:55",A.textStyleSemiBold2),i.create(this.panel,.28,.02,!0),i.anchor.set(0,.5),this.texts.push(i),this.tab1.list.push(i);var g=d.clone();g.wordWrapWidth=A.config.helpGameplayWordWrapWidth+100,i=new a(this.managers.locale.get("help_page1_text2_string"),g),i.create(this.panel,A.config.helpTimeTextPos.x,A.config.helpTimeTextPos.y,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),p=new n,p.create(this.panel,"gameAtlas","arrow_lft",this.managers.textures,A.config.helpArrowLeftPos.x,A.config.helpArrowLeftPos.y,!0),p.anchor.set(.5,.5),p.scale.set(.4,.4),this.sprites.push(p),this.tab1.list.push(p),p=new n,p.create(this.panel,"gameAtlas","arrow_rgt",this.managers.textures,A.config.helpArrowRightPos.x,A.config.helpArrowRightPos.y,!0),p.anchor.set(.5,.5),p.scale.set(.4,.4),this.sprites.push(p),this.tab1.list.push(p),i=new a(this.managers.locale.get("help_page1_text3_string"),d),i.create(this.panel,A.config.helpArrowTextPos.x,A.config.helpArrowTextPos.y,!0),i.anchor.set(0,0),this.texts.push(i),this.tab1.list.push(i),this.tab2.list=[],p=new n,p.create(this.panel,"menuAtlas","x2_speedmatch",this.managers.textures,-.305,-.2,!0),p.anchor.set(.5,.5),p.scale.set(.75,.75),this.sprites.push(p),this.tab2.list.push(p),i=new a(this.managers.locale.get("help_page2_text1_string"),g),i.create(this.panel,-.2,-.2-.04,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),p=new n,p.create(this.panel,"menuAtlas","x5_multimatch",this.managers.textures,-.305,-.015,!0),p.anchor.set(.5,.5),p.scale.set(.75,.75),this.sprites.push(p),this.tab2.list.push(p),i=new a(this.managers.locale.get("help_page2_text2_string"),g),i.create(this.panel,-.2,-0.055,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i),p=new n,p.create(this.panel,"gameAtlas","reshuffle_button",this.managers.textures,-.305,.17,!0),p.anchor.set(.5,.5),p.scale.set(1.5,1.5),this.sprites.push(p),this.tab2.list.push(p),i=new a(this.managers.locale.get("help_page2_text4_string"),g),i.create(this.panel,-.2,.13,!0),i.anchor.set(0,0),this.texts.push(i),this.tab2.list.push(i);var m=g.clone();m.wordWrapWidth=900,i=new a(this.managers.locale.get("help_page2_text5_string"),m),i.create(this.panel,0,.25,!0),i.anchor.set(.5,0),this.texts.push(i),this.tab2.list.push(i),this.showTab(1,!1),l.tweenIn.step=L.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(l.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},l.prototype.remove=function(e){this.removing||(this.removing=!0,A.debug&&console.log("Help.remove"),l.tweenOut.step=L.makeFunctionForSprite(this.panel),this.panel.tweener.tween(l.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},l.prototype.destroy=function(){var e;if(L.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.tab1=this.tab2=null,this.managers=null,A.resized=!0,A.resizeConsumed=!1},l.prototype.update=function(){var e,t;if(this.removing)return!0;if(this.panel.update(),this.buttons)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return"click_event"==t||I.isPressed[32]?(A.resetInput(),!1):("check_toggled_event"==t&&(A.showHelp=this.checkBox.checked,this.managers.preloader.loadManager.saveGameStatus()),("click_tab1_event"==t&&!this.tab1.button.toggled||"click_tab2_event"==t&&!this.tab2.button.toggled)&&(this.tab2.button.toggled=this.tab1.button.toggled,this.tab1.button.toggled=!this.tab1.button.toggled,this.showTab(this.tab1.button.toggled?1:0,!1),this.showTab(this.tab1.button.toggled?0:1,!0)),!0)},l.prototype.showTab=function(e,t){var s=0===e?this.tab1.list:this.tab2.list;if(s)for(var i=0;i<s.length;i++)s[i].visible=t};var O=350;l.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:O,easing:"easeInQuad",step:null,finish:function(){}},l.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:O,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},h.TYPE_BUTTON=1,h.TYPE_CHECKBOX=2,h.TYPE_TOGGLE=3,h.TYPE_NOLATCH=4,h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.prototype.create=function(t,s,i,a,o,r,l,h,c,u,d,p,g,m,f,y,v){this.managers=a,n.prototype.create.call(this,t,s,i,this.managers.textures,o,r,l),this.upKey={on:h,off:g},this.overKey={on:c,off:m},this.downKey={on:u,off:f},this.downEvent={on:d,off:y},this.overEvent={on:p,off:v},this.downDetected=!0,this._toggled="on",this.text=null,this.sfx=null,this.sfxHover=null,e.registerCallback("mousedown",this.playSfx,{context:this}),"function"==typeof d&&(this.callback=d,this.interactive=!0,this.on("pointertap",this.triggerCallback.bind(this)))},h.prototype.destroy=function(){e.clearCallback("mousedown",this.playSfx),this.off("pointertap",this.triggerCallback.bind(this)),n.prototype.destroy.call(this),this.text&&(this.text.destroy(),this.text=null),this.managers=null,this.upKey=this.overKey=this.downKey=this.downEvent=this.overEvent=null,this.callback=null,this._toggled=null,this.sfx=this.sfxHover=null},h.prototype.update=function(){var e=null,t=!1,s=!1;this.calculateBounds();var i=this.getBounds();return this.hitAreaPercent&&(i.width*=this.hitAreaPercent.x,i.height*=this.hitAreaPercent.y),s=this.type==h.TYPE_BUTTON||this.type==h.TYPE_NOLATCH?this.downDetected&&null!==A.mouseDown&&i.contains(A.mouseDown.x,A.mouseDown.y)||null!==A.click&&i.contains(A.click.x,A.click.y):null!==A.click&&i.contains(A.click.x,A.click.y),s&&(this.setFrame(this.downKey[this._toggled]),A.mouseDown=A.click=null,e=this.downEvent[this._toggled],t=!0),this.type==h.TYPE_BUTTON&&this.key==this.downKey[this._toggled]&&this.downKey[this._toggled]!=this.upKey[this._toggled]&&(t=!0),!t&&A.hover&&i.contains(A.hover.x,A.hover.y)&&(this.setFrame(this.overKey[this._toggled])&&this.sfxHover&&this.managers.audio.play(this.sfxHover),this.overEvent&&(e=this.overEvent[this._toggled]),t=!0),t||this.type==h.TYPE_TOGGLE||this.setFrame(this.upKey[this._toggled]),n.prototype.update.call(this),this.text&&this.text.update(),e},h.prototype.playSfx=function(e,t){if(this&&this.managers&&this.sfx){this.calculateBounds();var s=this.getBounds();s.contains(e,t)&&this.managers.audio.play(this.sfx)}},h.prototype.triggerCallback=function(){this.callback&&this.callback()},Object.defineProperties(h.prototype,{toggled:{set:function(e){this._toggled=e?"on":"off",this.setFrame(this.upKey[this._toggled])},get:function(){return"on"==this._toggled}}}),c.EVENT_CLICK="check_click",c.prototype=Object.create(h.prototype),c.prototype.constructor=c,c.prototype.create=function(e,t,s,i,a,o,r,l,u,d,p,g,m){this.tick=new n,this.tick.create(this,t,"check",i.textures,g,m,!1),this.tick.anchor.set(.5),this.checked=!0,this.toggleEvent=p,h.prototype.create.call(this,e,t,s,i,a,o,r,l,u,d,c.EVENT_CLICK),this.downDetected=!1},c.prototype.destroy=function(){h.prototype.destroy.call(this)},c.prototype.update=function(){var e=h.prototype.update.call(this);return e==c.EVENT_CLICK&&(this.setCheck(!this.checked),this.toggleEvent&&(e=this.toggleEvent)),e},c.prototype.setCheck=function(e){this.checked=e,this.tick.visible=e},u.prototype.create=function(e,t){A.arenaHelper.handlePauseRequest(),A.swipeEnabled=!1,this.game=e,this.managers=t,this.sprites=[],this.buttons=[],this.texts=[],this.doneIn=this.doneOut=!1,this.adShown=!1,L.addBlanker(this.managers.textures),this.panel=new n,this.panel.create(A.fullUI,"menuAtlas","backboard",this.managers.textures,0,0,!0),this.panel.anchor.set(.5),this.sprites.push(this.panel);var s=new a(this.managers.locale.get("options_header_string"),A.textStyleBold);s.create(this.panel,0,-.33,!0),s.anchor.set(.5,.5),this.texts.push(s);var i=new h(h.TYPE_BUTTON);i.create(this.panel,"menuAtlas","close",this.managers,.33,-.3,!0,"close","close_rollover","close-down","click_close_event"),i.anchor.set(.5,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i);var o=-.15,r=.16;o=.15,r=.16,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","sound",this.managers,-.22,o-.35+0*r,!0,"sound","sound_rollover","sound-down","click_sound_event",null,"sound-no","sound-no_rollover","sound-no-down","click_sound_event_mute",null),i.anchor.set(0,.5),i.toggled=!this.managers.audio.mute,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.soundBtn=i;var l=new n;l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,o-.35+0*r,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[0]=l,l=new n,l.create(this.sliderBar[0],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),this.sprites.push(l),l.setx=this.sliderBar[0].width*w.sfxVolume,this.sliderTab[0]=l,i=new h(h.TYPE_BUTTON),i.create(this.panel,"menuAtlas","music",this.managers,-.22,o-.35+1*r,!0,"music","music_rollover","music-down","click_music_event",null,"music-no","music-no_rollover","music-no-down","click_music_event_mute"),i.anchor.set(0,.5),i.toggled=!this.managers.audio.tunesMuted,i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),this.musicBtn=i,l=new n,l.create(this.panel,"menuAtlas","slider-bar",this.managers.textures,-.1,o-.35+1*r,!0),l.anchor.set(0,.5),this.sprites.push(l),this.sliderBar[1]=l,l=new n,l.create(this.sliderBar[1],"menuAtlas","slider",this.managers.textures,0,0,!0),l.anchor.set(.5,.5),l.setx=this.sliderBar[1].width*w.musicVolume,this.sprites.push(l),this.sliderTab[1]=l,i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","help",this.managers,-.22,o-.35+2*r,!0,"help","help_rollover","help-down","click_help_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("help_header_string"),A.textStyleLarge),s.create(this.panel,-.1,o-.35+2*r,!0),s.anchor.set(0,.5),this.texts.push(s),i=new h(h.TYPE_NOLATCH),i.create(this.panel,"menuAtlas","quit",this.managers,-.22,o-.35+3*r,!0,"quit","quit_rollover","quit-down","click_quit_event"),i.anchor.set(0,.5),i.sfx="snd_clickPlay",i.sfxHover="snd_rollOver",this.buttons.push(i),s=new a(this.managers.locale.get("options_quit_string"),A.textStyleLarge),s.create(this.panel,-.1,o-.35+3*r,!0),s.anchor.set(0,.5),this.texts.push(s);var c=null;c=new a("v"+A.VERSION,A.textStyleVersionTiny),c.anchor.y=1;var d=A.config.versionLabel.x||.325,p=A.config.versionLabel.y||.38;c.create(this.panel,d,p,!0),u.tweenIn.step=L.makeFunctionForSprite(this.panel),this.panel.tweener=new Tweenable,this.panel.tweener.tween(u.tweenIn),this.panel.tweener.owner=this.panel,this.panel.tweener.context=this,this.removing=!1,this.managers.audio.play("snd_rotate")},u.prototype.remove=function(e){this.removing||(A.arenaHelper.handleResumeRequest(),this.removing=!0,A.debug&&console.log("Options.remove"),u.tweenOut.step=L.makeFunctionForSprite(this.panel),this.panel.tweener.tween(u.tweenOut),this.panel.tweener.owner=this,this.destroyCallback=e)},u.prototype.destroy=function(){var e;if(L.removeBlanker(),this.destroyCallback&&(this.destroyCallback.call(this),this.destroyCallback=null),this.panel&&(this.panel.tweener=null,this.panel.destroy({children:!0}),this.panel=null),this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.soundBtn=null,this.musicBtn=null,this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}this.sliderTab=null,this.sliderBar=null,this.game=null,this.managers=null,A.resized=!0,A.resizeConsumed=!1,A.swipeEnabled=!0,A.idleTimer=A.eventChangeAdOnIdle},u.prototype.update=function(){var e,t;if(this.doneIn&&A.eventChangeAdOnOptions&&!this.adShown&&(A.arenaHelper.handleEventChange(),this.adShown=!0),this.panel.update(),this.sprites)for(e=0;e<this.sprites.length;e++){var s=this.sprites[e];s.update()}if(null!==A.mouseDown){var i=A.hover;for(null===i&&(i=A.mouseDown),e=0;e<this.sliderBar.length;e++)this.sliderBar[e].getGlobalScale(!0),this.sliderBar[e].bounds=this.sliderBar[e].getBounds(!1),this.sliderBar[e].bounds.contains(i.x,i.y)&&(this.sliderTab[e].pcntx=L.clamp((i.x-this.sliderBar[e].bounds.left)/this.sliderBar[e].globalScale.x/this.sliderBar[e].width,0,1),0===e?(w.sfxVolume=this.sliderTab[e].percentx,this.soundAdjustTracked||(this.soundAdjustTracked=!0)):(this.managers.audio.setMusicVolume(this.sliderTab[e].percentx),this.soundAdjustTracked||(this.soundAdjustTracked=!0)),this.managers.preloader.loadManager.saveGameStatus())}if(this.buttons)for(e=0;e<this.buttons.length;e++){var n=this.buttons[e];if(t=n.update(),null!==t)break}switch(null===t&&I.isPressed[C.space_bar]&&(t="click_close_event"),t){case"click_close_event":return A.click=null,I.reset(C.space_bar),A.playMidRollAdAfterPause&&A.arenaHelper.handleMidrollRequest(),!1;case"click_help_event":this.game.showHelp(!1);break;case"click_quit_event":this.game.showConfirm("quit_header_string",this,this.onYesQuit,this.onNoQuit);break;case"click_sound_event":this.soundBtn.toggled=!1,this.managers.audio.setMute(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0);break;case"click_sound_event_mute":this.soundBtn.toggled=!0,this.managers.audio.setMute(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0);break;case"click_music_event":this.musicBtn.toggled=!1,this.managers.audio.muteTunes(!0,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0);break;case"click_music_event_mute":this.musicBtn.toggled=!0,this.managers.audio.muteTunes(!1,!1),this.soundAdjustTracked||(this.soundAdjustTracked=!0)}return!0},u.prototype.onYesQuit=function(){if(A.quitConfirmed=!0,A.analyticsHelper.analytic){var e=Math.min(this.game.level+1,this.game.numLevels),t=Date.now(),s=Math.round((t-A.timeStartLevelMs)/1e3),i=Math.round((t-A.timeStarted)/1e3);A.analyticsHelper.analytic.quitGamePanelConfirmed(),A.analyticsHelper.analytic.levelEndNotFinished(e,s),A.analyticsHelper.analytic.gameQuited(M.score,e,i)}this.destroy(),M.requestQuit=!0,M.options=null},u.prototype.onNoQuit=function(){};var z=350;u.tweenIn={from:{pcnty:1},to:{pcnty:0},duration:z,easing:"easeInQuad",step:null,finish:function(){this.context.doneIn=!0}},u.tweenOut={from:{pcnty:0},to:{pcnty:-1},duration:z,easing:"easeFrom",step:null,finish:function(){this.context.doneOut=!0,this.owner&&(this.owner.destroy(),this.owner=null)}},d.prototype.create=function(e,t){this.managers=e,this.puzzle=t,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.chain=1,this.multiMatch=0,this.selectedPiece=null,this.spriteList=[]},d.prototype.destroy=function(){if(this.removeHoverPiece(),this._removeSelectedPiece(),this.managers=null,this.puzzle=null,this.hoveredPiece=null,this.dropPiece=null,this.selectedPiece=null,this.lastHovered=null,this.spriteList){for(var e=0,t=this.spriteList.length;t>e;e++)this.spriteList[e].destroy();this.spriteList=null}},d.prototype.update=function(){if(this.spriteList&&this.spriteList.length>0){for(var e=this.spriteList.length-1;e>=0;--e){var t=this.spriteList[e];t instanceof n?(t.alpha-=.02,t.alpha<=0?(t.destroy(),this.spriteList.splice(e,1)):t.update()):t instanceof PIXI.Container&&(t.y-=4,0===t.children.length&&(t.destroy(),this.spriteList.splice(e,1)))}return this.spriteList.length>0}return!1},d.prototype.clickedPiece=function(e){if(this.puzzle.tornadoRemove)return!1;if(this.puzzle.tileOpen(e)){if(this.selectedPiece){if(e!=this.selectedPiece)if(this.managers.audio.play("snd_clickTile"),e.symbol==this.selectedPiece.symbol){this._matchedPieces(e);var t=this._chainBonusScoring(e);this._multiBonusScoring(e);var s=0;t&&(s+=this.puzzle.speedMatchValue*this.chain),M.score+=(0|e.value)+s+this.puzzle.multiMatchValue*this.multiMatch,A.debug&&console.log("chain =",this.chain,"value =",e.value,"speedMatchValue =",this.puzzle.speedMatchValue,"score =",M.score);var i=16;this.managers.audio.play(this._specialTileScoring(e)&&this.managers.audio.hasAudio("snd_specialMatch")?"snd_specialMatch":this.chain<=i?"snd_match"+Math.min(this.chain,i).toString():["snd_correct1","snd_correct2"]),this.lastMatchTime=A.time,this.lastMatchType=e.symbol}else this._deselectPiece(this.selectedPiece),this._selectPiece(e)}else this.managers.audio.play("snd_clickTile"),this._selectPiece(e);return!0}return e&&e.wobble(),this.managers.audio.playDelayed(["snd_error1","snd_error2","snd_error3"],.1,this.cancelIfSwipe,this),!1},d.prototype.createHoveredPiece=function(e){this.hoveredPiece={sprite:e,fallSpeed:0}},d.prototype.createDroppedPiece=function(e){this.dropPiece={sprite:e,fallSpeed:0}},d.prototype.showDropAndHoverPieces=function(){if(this.dropPiece){var e=this.dropPiece.sprite.y;this.dropPiece.sprite.y=E.SelectionPreviewY,E.SelectionPreviewBotY=this.dropPiece.sprite.y+this.dropPiece.sprite.height,this.dropPiece.sprite.y=e,A.isPortrait?(this.dropPiece.sprite.y=E.SelectionPreviewBotY,this.dropPiece.fallSpeed=0):(this.dropPiece.sprite.y+=this.dropPiece.fallSpeed,this.dropPiece.fallSpeed++,this.dropPiece.sprite.y>E.SelectionPreviewBotY&&(this.dropPiece.sprite.y=E.SelectionPreviewBotY,this.dropPiece.fallSpeed=0)),this.dropPiece.sprite.update()}this.hoveredPiece&&(this.hoveredPiece.sprite.y=E.SelectionPreviewY,this.hoveredPiece.sprite.update())},d.prototype.cancelIfSwipe=function(e){return e&&null!==A.mouseDown?!0:A.swipeEnabled&&0!==A.swipe?!0:!1},d.prototype._selectPiece=function(e){this.selectedPiece=e,this.selectedPiece.addFilter(E.brighter),this.dropPiece&&(this.dropPiece.sprite.destroy(),this.dropPiece=null);var t=new n;t.create(A.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=k.scale/A.tileAssetScale,this.createDroppedPiece(t),this.removeHoverPiece()},d.prototype._deselectPiece=function(e){e&&e.removeFilter(E.brighter),this._removeSelectedPiece()},d.prototype._removeSelectedPiece=function(){this.dropPiece&&(this.dropPiece.sprite&&this.dropPiece.sprite.destroy(),this.dropPiece=null)},d.prototype._matchedPieces=function(e){A.debug&&console.log("Matched symbol",e.symbol),this.puzzle.fadeTile(this.selectedPiece,this.puzzle.removeTile),this._selectPiece(e),this.puzzle.fadeTile(e,this.puzzle.removeTile),this._removeSelectedPiece(),this.removeHoverPiece(),this.selectedPiece=null,M.levelMatches++},d.prototype.showHoveredPiece=function(e){if(e)if(this.selectedPiece&&this.selectedPiece==e)this.lastHovered&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null);else if(this.lastHovered&&this.lastHovered!==e&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null),e.addFilter(E.brighter2),this.lastHovered=e,!this.hoveredPiece||!this.hoveredPiece.piece||this.hoveredPiece.piece.symbol!=e.symbol){this.hoveredPiece&&this.removeHoverPiece();var t=new n;t.create(A.topUI,null,"cube_"+e.symbol+"_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=k.scale/A.tileAssetScale,this.hoveredPiece={piece:e,sprite:t,fallSpeed:0}}},d.prototype.removeHoverPiece=function(){if(this.lastHovered&&(this.lastHovered.removeFilter(E.brighter2),this.lastHovered=null),this.hoveredPiece){if(this.sprites){var e=this.hoveredPiece.sprite;this.sprites.push(e),this.hoveredPiece.sprite.addFader(-.1,1,this.destroySprite,this,e,0)}else this.hoveredPiece.sprite.destroy();this.hoveredPiece=null}},d.prototype._specialTileScoring=function(e){if(A.config.specialTile&&A.config.specialTile===e.symbol){var t=new PIXI.Container;e.parent.addChild(t),A.lowResolutionAssets&&t.scale.set(.5),this.spriteList&&this.spriteList.push(t);for(var s=e.value.split(""),i=0,a=0;a<s.length;++a){var o=new n;o.create(t,"gameAtlas","noglowtext/MM"+s[a],this.managers.textures,i,0,!1),o.scale.set(.6),o.anchor.set(.5),o.tz=-1e3,i+=o.width,this.spriteList&&this.spriteList.push(o)}return t.x=e.x-.4*i,t.y=e.y+75,t.tz=-1e3,e.parent.reSort(),!0}return!1},d.prototype._chainBonusScoring=function(e){var t=!1;if(-1!==this.lastMatchTime&&A.time<=this.lastMatchTime+1e3*this.puzzle.speedMatchTime){this.chain++,t=!0;var s,i=this.chain.toString(),a="noglowtext/SM"+i[0];i.length>1&&(s="noglowtext/SM"+i[1]);var o=new PIXI.Container;e.parent.addChild(o),o.x=e.x,o.y=e.y,o.tz=-1e3,A.lowResolutionAssets&&o.scale.set(.5),this.spriteList&&this.spriteList.push(o);var r=new n;r.create(o,"gameAtlas","noglowtext/speedmatch",this.managers.textures,0,0,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),r=new n,r.create(o,"gameAtlas",a,this.managers.textures,29.5,-15.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r),s&&(r=new n,r.create(o,"gameAtlas",s,this.managers.textures,77.5,-15.5,!1),r.anchor.set(.5),r.tz=-1e3,this.spriteList&&this.spriteList.push(r)),e.parent.reSort()}else this.chain=1;return t},d.prototype._multiBonusScoring=function(e){if(e.symbol==this.lastMatchType){this.multiMatch+=0===this.multiMatch?2:1;var t,s=this.multiMatch.toString(),i="noglowtext/MM"+s[0];s.length>1&&(t="noglowtext/MM"+s[1]);var a=new PIXI.Container;e.parent.addChild(a),a.x=e.x,a.y=e.y,a.tz=-1e3,A.lowResolutionAssets&&a.scale.set(.5),this.spriteList&&this.spriteList.push(a);var o=new n;o.create(a,"gameAtlas","noglowtext/multimatch",this.managers.textures,0,150,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),o=new n,o.create(a,"gameAtlas",i,this.managers.textures,30.5,140.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o),t&&(o=new n,o.create(a,"gameAtlas",t,this.managers.textures,78.5,140.5,!1),o.anchor.set(.5),o.tz=-1e3,this.spriteList&&this.spriteList.push(o)),e.parent.reSort()}else this.multiMatch=0},p.prototype.create=function(e){this.managers=e},p.prototype.destroy=function(){this.managers=null},p.prototype.loadGameStatus=function(){A.debug&&console.log("loadGameStatus");try{var e=localStorage.getItem("MahjonggDimensions_status");if(e){var t=JSON.parse(e);return A.debug&&console.log("sfx = ",t.sfxVolume,t.sfxMute,"music = ",t.musicVolume,t.musicMute,"show help =",t.showHelp),this.managers.audio.setMute(t.sfxMute,!0),this.managers.audio.muteTunes(t.musicMute,!0),w.sfxVolume=t.sfxVolume,this.managers.audio.setMusicVolume(t.musicVolume),A.showHelp=t.showHelp,!0}}catch(s){}return A.debug&&console.log("Game data is not available in localStorage."),!1},p.prototype.saveGameStatus=function(){A.debug&&console.log("saveGameStatus");var e={sfxVolume:w.sfxVolume,musicVolume:w.musicVolume,sfxMute:this.managers.audio.mute,musicMute:this.managers.audio.tunesMuted,showHelp:A.showHelp},t=JSON.stringify(e);try{localStorage.setItem("MahjonggDimensions_status",t)}catch(s){}return!0},g.prototype.create=function(e){this.dataManager=e,this.onLocaleChanged()},g.prototype.get=function(e){if(!this.dataManager)return A.debug&&console.log("ERROR: Locale.get called before dataManager is set!"),"error";this.strings||(this.strings=this.dataManager.get("strings"));var t=L.indexOfParameter(this.strings.Strings.String,"_id",e);return-1!==t?this.strings.Strings.String[t].__text:(A.debug&&console.log("WARNING: Locale.get unknown string id = "+e),null)},g.prototype.onLocaleChanged=function(){A.countryCode=A.arenaHelper.getLocale();for(var e=[{value:"en",localization:"en-US",name:"English"},{value:"de",localization:"de-DE",name:"Deutsch"},{value:"es",localization:"es-ES",name:"Espaol"},{value:"fr",localization:"fr-FR",name:"Franais"},{value:"it",localization:"it-IT",name:"Italiano"}],t=0;t<e.length;t++)if(e[t].value===A.countryCode){A.countryCode=e[t].localization;break}var s=this.dataManager.get("localizations");A.debug&&console.log("available languages: ",s),s&&s.availableLocales&&-1==L.indexOfStringNoCase(s.availableLocales,A.countryCode)&&(A.debug&&console.log("language is not available: ",A.countryCode),A.countryCode="en-US"),A.debug&&console.log("language code = ",A.countryCode),this.dataManager.loadData("strings",A.arenaHelper.getAbsoluteURL("")+"data/locale/"+A.countryCode+"/strings.json"),this.strings=null},m.prototype.checkFonts=function(){if(this.fontList)for(var e=this.fontList.length-1;e>=0;--e){var t=this.fontList[e];m.getTextExtent("giItT1WQy@!-/#%",t,300)!=this.width&&(A.debug&&console.log("Font loaded:",this.fontList[e]),this.fontList.splice(e,1))}else A.debug&&console.log("FontLoaded.checkFonts() list is empty",this.fontList);return this.fontList&&0!==this.fontList.length?(A.debug&&console.log("Waiting for fonts:",this.fontList),!1):(this.interval&&clearInterval(this.interval),this.interval=null,this.fontList=null,this.loadedCallback&&(this.loadedCallback.call(this.loadedCallbackContext),this.loadedCallback=null,this.loadedCallbackContext=null),A.debug&&console.log("All fonts loaded or failed."),!0)},m.getTextExtent=function(e,t,s){var i=document.createElement("span");i.innerHTML=e,i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize=s.toString()+"px",i.style.fontFamily=t,i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",document.body.appendChild(i);var n=i.offsetWidth;return i.parentNode.removeChild(i),n},f.prototype.destroy=function(){this.callback=null,this.context=null,this.args=null},f.prototype.setFade=function(e,t,s,i,n,a){null!==e&&void 0!==e&&(this.fadedir=e),null!==t&&void 0!==t&&(this.fadeValue=t),this.callback=s,this.context=i,this.args=n,null!==a&&(this.trigger=a,void 0!==this.trigger&&(this.direction=this.fadeValue>=this.trigger?-1:1))},f.prototype.reached=function(e){return this.fadeValue==e},f.prototype.fading=function(){var e=!0;if(0!==this.fadedir&&(this.fadeValue+=this.fadedir,(isNaN(this.trigger)||void 0===this.direction)&&(this.fadeValue<=0?(this.fadeValue=0,this.fadedir=0,A.debug&&console.log("FadeState: finished fading out"),e=!1):this.fadeValue>=1&&(this.fadeValue=1,this.fadedir=0,A.debug&&console.log("FadeState: finished fading in"),e=!1))),!isNaN(this.trigger)&&void 0!==this.direction)if(-1===this.direction){if(this.fadeValue<=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1}else if(this.fadeValue>=this.trigger&&this.callback.call(this.context,this.args))return this.callback=null,!1;return e},y.REMOVE_TILE=1,y.PRELOADER=2,y.definitions=[{},{first:1,last:30,baseKey:"match/matchEffect",endKey:"",numPrecedingZeroes:4,scale:2.2},{first:0,last:67,baseKey:"frame_",endKey:"_delay-0.03s",numPrecedingZeroes:0,scale:1,repeat:!0}],y.prototype.create=function(e){this.textureManager=e,this.list=[]},y.prototype.destroy=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].destroy();this.list=null},y.prototype.add=function(e,t,s,i,a){var o=new n,r=y.definitions[e];o.create(t.parent,s,this.getKeyName(e,r.first),this.textureManager,t.x+i,t.y+a,!1),t.parent.setChildIndex(o,t.parent.getChildIndex(t)),o.anchor.set(t.anchor.x,t.anchor.y),o.scale.set(r.scale,r.scale),o.fxType=e,o.fxFrameNumber=r.first,o.repeat=r.repeat===!0?!0:!1,o.tz=t.tz,A.lowResolutionAssets&&e!=y.PRELOADER&&o.scale.set(.5*o.scale.x,.5*o.scale.y),this.list.push(o)},y.prototype.update=function(){for(var e=this.list.length-1;e>=0;--e){var t=this.list[e];if(t.fxFrameNumber>y.definitions[t.fxType].last){if(!t.repeat){t.destroy(),this.list.splice(e,1);continue}t.fxFrameNumber=0}var s=this.getKeyName(t.fxType,Math.floor(t.fxFrameNumber));t.setFrame(s),t.update(),t.fxFrameNumber+=.06*A.elapsedTime}return this.list.length},y.prototype.getKeyName=function(e,t){var s=y.definitions[e];return s.numPrecedingZeroes>0?s.baseKey+L.padToLength(t.toString(),s.numPrecedingZeroes,"0",!1)+s.endKey:s.baseKey+t.toString()+s.endKey},v.prototype.create=function(){this.pending=0,this.loader=PIXI.loader},v.prototype.destroy=function(){this.pending=0,this.loader=null},v.prototype.addImage=function(e,t){this.loader.add(e,t),A.debug&&console.log("Textures.addImage ",e,t),this.pending++},v.prototype.startLoading=function(e,t){var s=this;A.debug&&console.log("Textures.startLoading"),this.pending>0?this.loader.once("complete",function(){s.pending=0,A.debug&&console.log("Textures all loaded!"),e&&t&&e.call(t)}).load():A.debug&&console.log("WARNING: Textures.startLoading - no images to load!")},v.prototype.loadImage=function(e,t,s,i){A.debug&&console.log("Textures.loadImage",e,t),this.loader.add(e,t),this.loader.once("complete",function(){A.debug&&console.log("Texture loaded!"),s.call(i)}).load()},v.prototype.get=function(e,t,s){if(e){var i=PIXI.loader.resources[e];if(!i)return null;if(i.textures[t])return i.textures[t]}if(s)return null;A.debug&&console.log("texture created from canvas",e,t);var n=PIXI.loader.resources[t];if(!n)return null;var a=PIXI.Texture.fromCanvas(PIXI.loader.resources[t]);return PIXI.loader.resources[t].texture=a,a},v.prototype.set=function(e,t){A.debug&&PIXI.loader.resources[e]&&PIXI.loader.resources[e]!=t&&console.log("WARNING: Textures.set is overwriting image in cache",e),PIXI.loader.resources[e]=t,A.debug&&console.log("image added to cache",e,t.width,"x",t.height)},b.createTweens=function(e,t,s,i,o,r){isNaN(i)&&(i=0),isNaN(o)&&(o=0);for(var l=[],c=[],u=0;u<e.length;u++){var d=e[u];if(d.button){var p=new h(h.TYPE_BUTTON);if(p.create(t,d.atlas,d.key,s,d.x+i,d.y+o,!1,d.key,d.button.over,d.button.down,d.button.clickEvent),p.anchor.x=p.anchor.y=.5,void 0!==d.visible&&(p.visible=d.visible),p.sfx=d.button.sfx,p.sfxHover=d.button.sfxHover,void 0!==d.button.text){var g=new a(s.locale.get(d.button.text),r||A.textStyleBoldButtons);g.create(p,0,0,!0),g.anchor.set(.5,.5),p.text=g}void 0!==d.fade&&p.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=L.makeFunctionForSprite(p),p.tweener=new Tweenable,p.tweener.tween(d.tween),p.tweener.owner=p),c.push(p)}else if(s.textures.get(d.atlas,d.key)){var m=new n;m.create(t,d.atlas,d.key,s.textures,d.x+i,d.y+o,!1),m.anchor.x=m.anchor.y=.5,void 0!==d.visible&&(m.visible=d.visible),void 0!==d.fade&&m.addFader(d.fade,d.alpha),void 0!==d.tween&&(d.tween.step=L.makeFunctionForSprite(m),m.tweener=new Tweenable,m.tweener.tween(d.tween),m.tweener.owner=m),l.push(m)}}return{sprites:l,buttons:c}},_.prototype.create=function(){this.list=[]},_.prototype.destroy=function(){this.list=null},_.prototype.loadData=function(e,t,s){var i;if(this.list[e])return i=this.list[e];A.debug&&console.log("DataManager.loadData ",e,t),i={},i.isReady=!1,this.list[e]=i;var n=this,a=new XMLHttpRequest;return a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&(i.isReady=!0,i.data=JSON.parse(a.responseText),n.pending--,s&&s())
},a.send(null),this.pending++,i.src=t,i},_.prototype.get=function(e){return this.list&&this.list[e]&&this.list[e].isReady!==!1?this.list[e].data||this.list[e]:(A.debug&&console.log("DataManager.get(): data not in cache",e),null)},_.prototype.set=function(e,t){if(this.list[e])return void(A.debug&&console.log("WARNING: attempt to overwrite existing cache item",e));for(var s in this.list)if(this.list[s]==t)return A.debug&&console.log("WARNING: adding additional key to existing cache item",s,"==",e),void(this.list[e]=this.list[s]);this.list[e]=t,A.debug&&console.log("DataManager.set(): data added to cache",e)},w.sfxVolume=.5,w.musicVolume=.5,w.prototype.create=function(e){this.managers=e,this.list=[],this.delayed=[],this.pending=0,this.mute=!1,this.tunesMuted=!1,w.sfxVolume=.5,w.musicVolume=.5},w.prototype.destroy=function(){if(this.managers=null,this.list){for(var e in this.list)if(this.list.hasOwnProperty(e)){var t=this.list[e];t.unload(),this.list[e]=null}this.list=null}this.delayed=null,this.gameTune=null,this.delayed=null},w.prototype.loadAudio=function(e,t,s){for(var i=[],n=0,a=s.length;a>n;n++)i.push(t+"."+s[n]);this.pending++,A.debug&&console.log("AudioManager.loadAudio ",e,t);var o=this;this.list[e]=new Howl({src:i,onload:function(){o.pending--}})},w.prototype.hasAudio=function(e){return this.list&&this.list[e]},w.prototype.play=function(e){return Array.isArray(e),this._playOne(e)},w.prototype.play=function(e,t){if(Array.isArray(e)){if(!t){var s=L.randomFromList(e);return this._playOne(s)}for(var i=0;i<e.length;++i)if(this.hasAudio(e[i]))return this._playOne(e[i])}return this._playOne(e)},w.prototype._playOne=function(e){if(e&&this.list&&this.list[e]&&A.muteUntil<=A.time){var t=this.list[e];if("loaded"!=t._state)return A.debug&&console.log("AudioManager.playOne",e,"SFX not loaded!"),null;t.volume(w.sfxVolume);var s=t.play();return A.debug&&(console.log("AudioManager.playOne",e,"=",s),s||console.log("SFX not playable!")),t}return null},w.prototype.playDelayed=function(e,t,s,i){Array.isArray(e)&&(e=L.randomFromList(e)),e&&this.list&&this.list[e]&&!this.mute&&this.delayed.push({key:e,time:A.time+1e3*t,cancelCallback:s,context:i})},w.prototype.update=function(){for(var e=A.time,t=this.delayed.length-1;t>=0;--t){var s=this.delayed[t];s&&s.cancelCallback&&s.cancelCallback.call(s.context,e>s.time)?this.delayed.splice(t,1):e>s.time&&(this._playOne(s.key),this.delayed.splice(t,1))}},w.prototype.visibilityMute=function(e){A.debug&&console.log("AudioManager.visibilityMute",e),e?void 0===this.rememberMute&&(this.rememberMute=this.mute,this.rememberTunesMuted=this.tunesMuted,this.setMute(!0,!0),this.muteTunes(!0,!0)):void 0!==this.rememberMute&&(this.setMute(this.rememberMute,!0),this.muteTunes(this.rememberTunesMuted,!0),this.rememberMute=void 0,this.rememberTunesMuted=void 0)},w.prototype.setMute=function(e,t){A.debug&&console.log("AudioManager.setMute",e),this.mute=e;for(var s in this.list)if(this.list.hasOwnProperty(s)){var i=this.list[s];i!==this.gameTune&&i.mute(e)}t||this.managers.loadSave.saveGameStatus()},w.prototype.muteTunes=function(e,t){A.debug&&console.log("AudioManager.muteTunes",e),this.tunesMuted=e,this.gameTune&&this.gameTune.mute(this.tunesMuted),t||this.managers.loadSave.saveGameStatus()},w.prototype.startTune=function(e,t){this.gameTune&&this.stopTune(),this.list[e].loop(!0),this.gameTune=this._playOne(e),this.gameTune&&this.gameTune.volume(w.musicVolume*A.volumeControl),void 0!==t?this.muteTunes(t,!0):this.muteTunes(this.tunesMuted,!0)},w.prototype.stopTune=function(){this.gameTune&&(this.gameTune.stop(),this.gameTune=null)},w.prototype.setMusicVolume=function(e){w.musicVolume=e,this.gameTune&&this.gameTune.volume(w.musicVolume*A.volumeControl)},w.prototype.sfxLoaded=function(){for(var e in this.list){var t=this.list[e];if("loaded"!=t._state)return!1}return!0};var R=function(){void 0!==window.ArenaXApi&&null!==window.ArenaXApi&&(this.arenaXApi=ArenaXApi.getInstance()),this.testActionCallback=null,this.pauseCallback=null,this.resumeCallback=null,this.pauseHandler=this.handleMidrollStart.bind(this),this.resumeHandler=this.handleMidrollFinish.bind(this),this.arenaXApi?(this.arenaXApi.addAction("GAME_PAUSE",this.pauseHandler),this.arenaXApi.addAction("GAME_RESUME",this.resumeHandler)):(ARK_game_arena_connector.init(),ARK_game_arena_connector.registerAction("pause",this.pauseHandler),ARK_game_arena_connector.registerAction("resume",this.resumeHandler))};R.prototype={init:function(e,t){this.pauseCallback=e,this.resumeCallback=t},getParam:function(e,t){if(!this.arenaXApi)return ARK_game_arena_connector.getParam(e,t);switch(e){default:return t;case"configURL":return""}},handleMidrollRequest:function(){this.arenaXApi?this.arenaXApi.dispatch({type:"PAUSE_READY",payload:null}):ARK_game_arena_connector.fireEventToArena("pause_ready")},handleMidrollStart:function(){this.pauseCallback&&this.pauseCallback.call()},handleMidrollFinish:function(){this.resumeCallback&&this.resumeCallback.call()},handlePauseRequest:function(){this.arenaXApi||ARK_game_arena_connector.fireEventToArena("pause")},handleResumeRequest:function(){this.arenaXApi||ARK_game_arena_connector.fireEventToArena("resume")},handleSaveLocalProgress:function(e){this.arenaXApi||ARK_game_arena_connector.fireEventToArena("local_save",e)},handleEventChange:function(){this.arenaXApi?this.arenaXApi.dispatch({type:"EVENT_CHANGE",payload:null}):ARK_game_arena_connector.fireEventToArena("event_change")},handleGameStart:function(){this.arenaXApi?this.arenaXApi.dispatch({type:"GAME_START",payload:null}):ARK_game_arena_connector.fireEventToArena("game_start")},handleGameEnd:function(e,t){this.arenaXApi?(this.arenaXApi.dispatch({type:"CHANGE_SCORE",payload:e}),this.arenaXApi.dispatch({type:"GAME_END",payload:null})):(ARK_game_arena_connector.changeScore(e,t),ARK_game_arena_connector.fireEventToArena("game_end"))},handleLevelStart:function(){this.arenaXApi||ARK_game_arena_connector.fireEventToArena("level_start")},handleLevelComplete:function(e){this.arenaXApi||ARK_game_arena_connector.fireEventToArena("level_complete","score="+e)},initTestingEnvironment:function(){return this.arenaXApi?(this.arenaXApi.addAction("TEST_ACTION",this.processTestAction.bind(this)),void this.arenaXApi.dispatch({type:"TEST_READY",payload:null})):(ARK_game_arena_connector.registerAction("test_action",this.processTestAction.bind(this)),void ARK_game_arena_connector.initTestingEnvironment())},processTestAction:function(e){for(var t=0;t<e.length;t++){var s=e[t];if("test_object"==s.name){var i=s.value.split(";"),n=i[0];this.testActionCallback&&this.testActionCallback(n);break}}},shouldShowInternalGameEnd:function(){if(this.arenaXApi)return!1;var e=ARK_game_arena_connector.showGameEnd(),t=1==e;return t},getAbsoluteURL:function(e){return this.arenaXApi?[this.arenaXApi.assetOriginUrl,e].join(""):e},getLocale:function(){return this.arenaXApi?this.arenaXApi.locale:ARK_game_arena_connector.getParam("locale","en-US")},setGameSecret:function(e){this.arenaXApi||ARK_game_arena_connector.setGameSecret(e)},getArenaName:function(){return this.arenaXApi?window.arenaName||"unknown":ARK_game_arena_connector.getParam("arena_name")||"unknown"},getArenaDomain:function(){return this._arenaXapi?window.location.hostname:null},destroy:function(){this.arenaXApi&&(this.arenaXApi.removeAction("GAME_PAUSE"),this.arenaXApi.removeAction("GAME_RESUME"),this.arenaXApi.removeAction("TEST_ACTION"))}};var U=function(){"use strict"};U.prototype.init=function(e){"use strict";this._arenaHelper=e},U.prototype.initTestingEnvironment=function(){"use strict";this._arenaHelper.testActionCallback=this.testArenaCallback.bind(this),this._arenaHelper.initTestingEnvironment()},U.prototype.testArenaCallback=function(e){"use strict";switch(e){case"game_end":break;case"play_game":A.showHelp=!1,I.isPressed[32]=!0;break;case"quit_game":M.requestQuit=!0,M.highScore=1,this._arenaHelper.handleGameEnd(1);break;case"draw_border":var t=A.width,s=A.height,i=new PIXI.Graphics;i.beginFill(16711680),i.lineStyle(10,65280,1),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(t,s),i.lineTo(0,s),i.lineTo(0,0),i.endFill(),i.x=.5*-t,i.y=.5*-s,A.stage.addChild(i)}};var H=function(e){"use strict";if(this._dimensions={trafficSource:e.arena.name,gameVersion:e.version,deviceType:e.device},null!=e.testGroup&&void 0!=e.testGroup&&(this._dimensions.abtestVersion=e.testGroup),null!=e.arena.domain&&void 0!=e.arena.domain&&(this._dimensions.domain=e.arena.domain),void 0!=window.ArenaXApi&&null!=window.ArenaXApi)this._aiTracker=new window.appInsightsMJDimensions.ApplicationInsights({config:{instrumentationKey:e.appId,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,maxBatchInterval:0}}),this._aiTracker.loadAppInsights();else{var t="appInsightsSDK";window[t]="appInsightsMJDimensions";var s=window[t],i=window[s]||function(e){function t(e){s[e]=function(){var t=arguments;s.queue.push(function(){s[e].apply(s,t)})}}var s={config:e};s.initialize=!0;var i=document,n=window;setTimeout(function(){var t=i.createElement("script");t.src=e.url||"https://az416426.vo.msecnd.net/scripts/b/ai.2.5.9.min.js",i.getElementsByTagName("script")[0].parentNode.appendChild(t)});try{s.cookie=i.cookie}catch(e){}s.queue=[],s.version=2;for(var a=["Event","PageView","Exception","Trace","DependencyData","Metric","PageViewPerformance"];a.length;)t("track"+a.pop());t("startTrackPage"),t("stopTrackPage");var o="Track"+a[0];if(t("start"+o),t("stop"+o),t("setAuthenticatedUserContext"),t("clearAuthenticatedUserContext"),t("flush"),!(!0===e.disableExceptionTracking||e.extensionConfig&&e.extensionConfig.ApplicationInsightsAnalytics&&!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){t("_"+(a="onerror"));var r=n[a];n[a]=function(e,t,i,n,o){var l=r&&r(e,t,i,n,o);return!0!==l&&s["_"+a]({message:e,url:t,lineNumber:i,columnNumber:n,error:o}),l},e.autoExceptionInstrumented=!0}return s}({instrumentationKey:e.appId,overridePageViewDuration:!0,enableSessionStorageBuffer:!1,disableAjaxTracking:!0,disableExceptionTracking:!0,disableCorrelationHeaders:!0,disableDataLossAnalysis:!0,maxBatchInterval:0});window[s]=i,i.queue&&0===i.queue.length&&i.trackPageView({}),this._aiTracker=window.appInsightsMJDimensions}};H.prototype.constructor=H,H.prototype.sendPageView=function(e){"use strict";this._aiTracker&&(this._aiTracker.trackPageView({name:e,properties:this._dimensions}),this._aiTracker.flush&&this._aiTracker.flush())},H.prototype.sendEvent=function(e,t,s,i){"use strict";var n=i||{};n.action=t,this._aiTracker&&(this._aiTracker.trackEvent({name:e,properties:n},this._dimensions),this._aiTracker.flush&&this._aiTracker.flush())};var N=function(e){"use strict";this._dimensions={dimension1:e.arena.name,dimension2:e.version},null!=e.testGroup&&void 0!=e.testGroup&&(this._dimensions.dimension3=e.testGroup),_gameGATracker("create",e.appId,{sampleRate:e.googleAnalyticsSampleRate,storeGac:!1,cookieExpires:21600})};N.prototype.constructor=N,N.prototype.sendPageView=function(e){"use strict";_gameGATracker("send","pageview",e)},N.prototype.sendEvent=function(e,t,s){"use strict";_gameGATracker("send","event",e,t,s,0,this._dimensions)};var D=function(){"use strict";this.START_BUTTON="Start_Button",this.GAME_END="Game_End",this.ROUND_N="Round{N}",this.ROUND_N_END="Round{N}_End",this.IMPRESSION="Impression",this.CLICK="Click",this.WIN="Win",this.LOSS="Loss",this.TIME_OUT="Time_Out",this.NEW_GAME="New_Game",this.RESTART="Restart",this.QUIT="Quit",this.START="Start",this.FINISHED="Finished",this.NOT_FINISHED="Not_Finished",this.INTRO_SCREEN="IntroScreen",this.GAME_SCREEN="GameScreen",this.GAME_OVER_SCREEN="GameOver",this.QUIT_CONFIRMED="QuitConfirmed",this.SCORE="score",this.ROUND="round",this.TIME_SPENT="timespent",this._impl=[]};D.prototype.constructor=D,D.Providers={GOOGLE:"analyticsProvider.google",APPINSIGHTS:"analyticsProvider.AppInsights"},D.prototype.init=function(e){"use strict";for(var t=0;t<e.providers.length;t++){var s=e.providers[t];switch(s.type){case D.Providers.GOOGLE:e.appId=s.appId,this._impl.push(new N(e));break;case D.Providers.APPINSIGHTS:e.appId=s.appId,this._impl.push(new H(e))}}},D.prototype.sendPageView=function(e){"use strict";for(var t=0;t<this._impl.length;t++)this._impl[t].sendPageView(e)},D.prototype.sendEvent=function(e,t,s,i){"use strict";for(var n=0;n<this._impl.length;n++)this._impl[n].sendEvent(e,t,s,i)},D.prototype.startButtonImpression=function(){"use strict";this.sendEvent(this.START_BUTTON,this.IMPRESSION)},D.prototype.startButtonClick=function(){"use strict";this.sendEvent(this.START_BUTTON,this.CLICK)},D.prototype.gameEndWin=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.WIN,this.getLabelWithPipe(e,t),i)},D.prototype.gameEndLoss=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.LOSS,this.getLabelWithPipe(e,t),i)},D.prototype.gameEndTimeOut=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.TIME_OUT,this.getLabelWithPipe(e,t),i)},D.prototype.gameQuited=function(e,t,s){"use strict";var i={};this.addProperty(i,this.SCORE,e),this.addProperty(i,this.ROUND,t),this.addProperty(i,this.TIME_SPENT,s),this.sendEvent(this.GAME_END,this.QUIT,this.getLabelWithPipe(e,t),i)},D.prototype.levelStart=function(e){"use strict";this.sendEvent(this.ROUND_N.replace("{N}",e.toString()),this.START)},D.prototype.levelEndFinished=function(e,t){"use strict";var s={};this.addProperty(s,this.TIME_SPENT,t),this.sendEvent(this.ROUND_N_END.replace("{N}",e.toString()),this.FINISHED,t.toString(),s)},D.prototype.levelEndNotFinished=function(e,t){"use strict";var s={};this.addProperty(s,this.TIME_SPENT,t),this.sendEvent(this.ROUND_N_END.replace("{N}",e.toString()),this.NOT_FINISHED,t.toString(),s)},D.prototype.introPanelShowed=function(){"use strict";this.sendPageView(this.INTRO_SCREEN)},D.prototype.gamePanelShowed=function(){"use strict";this.sendPageView(this.GAME_SCREEN)},D.prototype.gameOverPanelShowed=function(){"use strict";this.sendPageView(this.GAME_OVER_SCREEN)},D.prototype.quitGamePanelConfirmed=function(){"use strict";this.sendPageView(this.QUIT_CONFIRMED)},D.prototype.getLabelWithPipe=function(e,t){"use strict";return t?t+"|"+e:e.toString()},D.prototype.addProperty=function(e,t,s){"use strict";e[t]=s},Object.freeze(D.Providers);var B=function(e){"use strict";this._analyticsManager=new D,this._analyticsManager.init(e)};B.prototype.constructor=B,Object.defineProperty(B.prototype,"analytic",{get:function(){"use strict";return this._analyticsManager}}),B.prototype.destroy=function(){"use strict";this._analyticsManager=null},x.prototype.preload=function(e,t){this.root=e,this.lowResolution=t,this.textureManager=new v,this.textureManager.create(),this.dataManager=new _,this.dataManager.create(),this.localeManager=new g,this.audioManager=new w,this.loadManager=new p,this.audioManager.create(this.getManagers()),this.loadManager.create(this.getManagers());var s=this.lowResolution?"images/0.5x/":"images/1x/";this.textureManager.addImage("introAtlas",this.baseUrl+s+"introAtlas.json"),this.dataManager.loadData("localConfig",this.baseUrl+"config/config.json",this.onConfigLoaded.bind(this));var i="";window.configURL&&(i=window.configURL());var n=A.arenaHelper.getParam("configURL",i);""!==n&&null!==n&&this.dataManager.loadData("externalConfig",n,this.onConfigLoaded.bind(this))},x.prototype.onConfigLoaded=function(){if(0===this.dataManager.pending){A.config=this.dataManager.get("localConfig");var e=this.dataManager.get("externalConfig");if(null!=e)for(var t in e)A.config[t]=e[t];this.textureManager.startLoading(this.preloaderReady,this)}},x.prototype.preloaderReady=function(){var e=this;this.bg=new n,this.bg.create(A.background,"introAtlas","title_bg",this.textureManager),this.bg.anchor.set(.5,1),this.bg.y=A.config.centerBackground&&A.width>A.height?this.bg.height/2:A.height/2/this.bg.parent.scale.y,this.effects=new y,this.effects.create(this.textureManager),this.effects.add(y.PRELOADER,A.fullUI,"introAtlas",0,0);var t=this.lowResolution?"images/0.5x/":"images/1x/";this.textureManager.addImage("gameAtlas",this.baseUrl+t+"gameAtlas.json"),this.textureManager.addImage("menuAtlas",this.baseUrl+t+"menuAtlas.json"),this.textureManager.addImage("cubeAtlas",this.baseUrl+t+"cubeAtlas.json"),this.textureManager.startLoading(),this.loadAudioAssets(),this.dataManager.loadData("level1",this.baseUrl+"data/mahjongg_leveldata_0.txt"),this.dataManager.loadData("level2",this.baseUrl+"data/mahjongg_leveldata_1.txt"),this.dataManager.loadData("level3",this.baseUrl+"data/mahjongg_leveldata_2.txt"),this.dataManager.loadData("symbol_offsets",this.baseUrl+"data/symbol_offsets.json"),this.dataManager.loadData("text_styles",this.baseUrl+"data/text_styles.json",function(){A.createTextStyles(e.dataManager)}),this.dataManager.loadData("localizations",this.baseUrl+"data/locale/localization.json",function(){e.localeManager.create(e.dataManager)}),this.levels=3},x.prototype.loadAudioAssets=function(){if(this.audioManager.loadAudio("game_tune",this.baseUrl+"sounds/music_loop",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickPlay",this.baseUrl+"sounds/play_button_press",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rollOver",this.baseUrl+"sounds/menu_rollover_generic",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_clickTile",this.baseUrl+"sounds/click_tile",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct1",this.baseUrl+"sounds/correct_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_correct2",this.baseUrl+"sounds/correct_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match1",this.baseUrl+"sounds/tilematch1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match2",this.baseUrl+"sounds/tilematch2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match3",this.baseUrl+"sounds/tilematch3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match4",this.baseUrl+"sounds/tilematch4",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match5",this.baseUrl+"sounds/tilematch5",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match6",this.baseUrl+"sounds/tilematch6",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match7",this.baseUrl+"sounds/tilematch7",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match8",this.baseUrl+"sounds/tilematch8",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match9",this.baseUrl+"sounds/tilematch9",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match10",this.baseUrl+"sounds/tilematch10",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match11",this.baseUrl+"sounds/tilematch11",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match12",this.baseUrl+"sounds/tilematch12",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match13",this.baseUrl+"sounds/tilematch13",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match14",this.baseUrl+"sounds/tilematch14",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match15",this.baseUrl+"sounds/tilematch15",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_match16",this.baseUrl+"sounds/tilematch16",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error1",this.baseUrl+"sounds/error_sound_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error2",this.baseUrl+"sounds/error_sound_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_error3",this.baseUrl+"sounds/error_sound_3",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_rotate",this.baseUrl+"sounds/rotate",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_startSting",this.baseUrl+"sounds/game_opening_sting",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_endSting",this.baseUrl+"sounds/level_end",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle1",this.baseUrl+"sounds/reshuffle_1",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_reshuffle2",this.baseUrl+"sounds/reshuffle_2",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timerWarning",this.baseUrl+"sounds/timer_warning",["mp3","mp4","ogg"]),this.audioManager.loadAudio("snd_timeUp",this.baseUrl+"sounds/out_of_time_sting",["mp3","mp4","ogg"]),A.config.specialSounds)for(var e=A.config.specialSounds,t=0;t<e.length;++t)this.audioManager.loadAudio(e[t].id,this.baseUrl+e[t].url,e[t].formats)},x.prototype.cleanUp=function(){this.root=null,this.effects&&(this.effects.destroy(),this.effects=null),this.bg&&(this.bg.destroy(),this.bg=null)},x.prototype.update=function(){this.effects&&this.effects.update()},x.prototype.allLoaded=function(){var e=0===this.textureManager.pending&&0===this.dataManager.pending&&0===this.audioManager.pending;return e&&this.bg?(this.cleanUp(),!0):!1},x.prototype.getManagers=function(){return{preloader:this,textures:this.textureManager,data:this.dataManager,audio:this.audioManager,locale:this.localeManager,loadSave:this.loadManager}},k.prototype=Object.create(n.prototype),k.prototype.constructor=k,k.scale=.75,k.pieceSizePixels=188,k.prototype.destroy=function(){this.name=null,this.managers=null,this.symbol=null,n.prototype.destroy.call(this)},k.prototype.update=function(e){if(e&&(this.wobbleCount=0),this.wobbleCount>0)if(this.wobbleCount--,0===this.wobbleCount)this.x=this.startX,this.y=this.startY;else{var t=this.wobbleCount>10?4:2;this.x=this.startX+Math.random()*t-t/2,this.y=this.startY+Math.random()*t-t/2}n.prototype.update.call(this)},k.prototype.clone=function(){var e=new k(this.parent,this.managers,this.cx,this.cy,this.cz,this.symbol,this.value);return e.name=this.name,e.create(this.parent,null,e.name,e.managers.textures),e.setPickerData(e.managers.data.get("maskData_1")),e.anchor.set(this.anchor.x,this.anchor.y),e.scale.set(this.scale.x,this.scale.y),e.sizex=this.sizex,e.sizey=this.sizey,e.scalez=this.scalez,e.rotate3d(this.angle),e},k.prototype.copyLocation=function(e){e.cx=this.cx,e.cy=this.cy,e.cz=this.cz,e.rotate3d(e.angle)},k.prototype.setPicture=function(e){this.setFrame("cube_"+this.symbol+"_"+e.toString()),this.setPickerData(this.managers.data.get("maskData_"+e.toString()))},k.prototype.rotate3d=function(e){void 0!==e&&(this.angle=e);var t=Math.round(180*this.angle/Math.PI),s=t-t%10+5;e=s*Math.PI/180;var i=Math.sin(e),n=Math.cos(e);this.tx=this.cx*n-this.cz*i,this.tz=this.cx*i+this.cz*n,this.x=this.tx*this.sizex,this.y=(this.cy+A.puzzleOffsetY-this.tz*this.scalez)*this.sizey,this.tz+=.001*this.y,this.setPicture(Math.round(180*e/Math.PI/10+5)%9+1)},k.prototype.picked=function(e,t){return this.pixelPicker(e,t)>0},k.prototype.wobble=function(){0===this.wobbleCount&&(this.startX=this.x,this.startY=this.y,this.wobbleCount=20)},S.prototype=Object.create(PIXI.Container.prototype),S.prototype.constructor=S,S.maxTilesHigh=6,S.maxHalfTilesWide=12,S.prototype.create=function(t,s,i,n,a){this.world=t,this.managers=s,this.centerpieceObj=a,this.tileDescriptions=i.ignoreMeContainer.levels.level.TileImages.tile,this.parent=A.puzzle,this.x=0,this.y=0,this.tornadoRemove=!1,this.lastTornadoPiece=0,this.second=!1,this.createTiles(this.tileDescriptions,this.cacheSpriteList),this.removeTiles=[],this.tiles=[];var o=parseFloat(i.ignoreMeContainer.levels.level.nScale);A.pieceScale=o;var r=parseFloat(i.ignoreMeContainer.levels.level.yOff);A.puzzleOffsetY=r,S.centerpieceCoeffY=parseFloat(i.ignoreMeContainer.levels.level.nCenterpieceCoeffY),S.currentPuzzleZ=parseFloat(i.ignoreMeContainer.levels.level.TileStructure._z),e.resizeCanvas(),this.puzzleLayout=i.ignoreMeContainer.levels.level.TileStructure,this.resetPuzzle("1","-"),this.multiMatchValue=n.ignoreMeContainer.config.nMultiMatchValue.__text||0,this.speedMatchValue=n.ignoreMeContainer.config.nSpeedMatchValue.__text||0,this.speedMatchTime=n.ignoreMeContainer.config.nSpeedMatchTime.__text||0,this.levelBonusValues=JSON.parse("["+n.ignoreMeContainer.config.aLevelCompleteBonuses.__text+"]");for(var l,h,c=0,u=0;;){if(0===u){if(c>=this.tileDescriptions.length)break;u=this.tileDescriptions[c]._num||0,l=this.tileDescriptions[c]._name,h=this.tileDescriptions[c]._value,c++}this.addTileToPuzzle(l,h,this.puzzleLayout,"1","-"),u--}A.puzzle.addChild(this),A.forceResize=!0},S.prototype.destroy=function(){var e;if(PIXI.Container.prototype.destroy.call(this),this.levelBonusValues=null,this.tileDescriptions=null,this.world=null,this.tiles){for(e=0;e<this.tiles.length;e++)this.tiles[e].destroy({texture:!0,baseTexture:!0});this.tiles=null}if(this.managers=null,this.puzzleLayout=null,this.cacheSpriteList){for(e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}},S.prototype.update=function(){var e;if(this.cacheSpriteList&&this.cacheSpriteList.length>0&&this.second){for(A.debug&&console.log("Puzzle.prototype destroying cacheSpriteList items",this.cacheSpriteList.length),e=0;e<this.cacheSpriteList.length;e++)this.cacheSpriteList[e].destroy({texture:!0,baseTexture:!0});this.cacheSpriteList=null}this.second=!0,this.removePendingTiles();var t=!1;for(this.angle!=this.targetAngle&&(this.angle=L.rotateTo(this.angle,this.targetAngle,S.turnSpeed*A.elapsedTime*.06),this.rotate(this.angle),t=!0),e=this.tiles.length-1;e>=0;--e)this.tiles[e].update(t);return this.tornadoRemove&&this.tornado(),this.angle!=this.targetAngle||this.tornadoRemove?!0:!this.puzzleLocked()},S.prototype.setTargetAngle=function(e,t){this.targetAngle=L.normaliseAngle(e),t&&(this.angle=this.targetAngle,this.rotate(this.angle))},S.prototype.adjustTargetAngle=function(e){return this.angle==this.targetAngle?(this.targetAngle=L.normaliseAngle(this.targetAngle+e),!0):!1},S.prototype.isTurning=function(){return this.angle!=this.targetAngle},S.prototype.rotate=function(e){this.centerpieceObj&&(this.centerpieceObj.rotation=-e);for(var t=L.normaliseAnglePositive(e),s=this.tiles.length-1;s>=0;--s)this.tiles[s].rotate3d(t);this.reSort()},S.prototype.reSort=function(){this.children.sort(function(e,t){return e.tz=e.tz||0,t.tz=t.tz||0,t.tz-e.tz})},S.prototype.createTiles=function(e,t){for(var s=[],i=1;9>=i;i++){var a=new n,o="tile_"+L.padToLength(i.toString(),5,"0",!1);a.create(this,"cubeAtlas",o,this.managers.textures),s.push(a);var r=a.getPixels();this.managers.data.set("maskData_"+i.toString(),r)}for(var l=this.managers.data.get("symbol_offsets"),h=A.lowResolutionAssets?.5:1,c=0;c<e.length;c++){var u=new n,d=e[c]._name.replace("s","");u.create(this,"cubeAtlas",d,this.managers.textures);for(var p=0;p<s.length;p++){var g="cube_"+e[c]._name+"_"+(p+1).toString();if(!this.managers.textures.get(null,g,!1)){var m=u.createCanvasFromTexture(h),f=u.createCanvasFromTexture(h),y=s[p].createCanvasFromTexture(h),v=y.width/2,b=y.height/2,_=y.getContext("2d");_.save(),_.scale(.5*l.scalex[0][p],.5),_.transform(1,l.skewy[0][p],0,1,0,0),_.drawImage(m,v+l.offx[0][p]*A.tileAssetScale-m.width/2,b+l.offy[0][p]*A.tileAssetScale-m.height/2),_.restore(),_.save(),_.scale(.5*l.scalex[1][p],.5),_.transform(1,l.skewy[1][p],0,1,0,0),_.drawImage(f,v+l.offx[1][p]*A.tileAssetScale-f.width/2,b+l.offy[1][p]*A.tileAssetScale-f.height/2),_.restore(),this.managers.textures.set(g,y)}var w=new n;w.create(A.puzzle,null,g,this.managers.textures,0,0,!0),t.push(w)}u.destroy()}for(i=0;i<s.length;i++)s[i].destroy()},S.prototype.tilePicker=function(e,t){for(var s=[],i=null,n=null,a=this.tiles.length-1;a>=0;--a)n=this.tiles[a],!n.fader&&n.picked(e,t)&&s.push(n);if(s.length>0){for(a=s.length-1;a>=0;--a)n=s[a],(!i||i.tz>n.tz)&&(i=n);return i}return null},S.prototype.tileOpen=function(e){var t=e.cx,s=e.cy,i=e.cz;return this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i+1)||this.spaceOpen(t-1,s,i)&&this.spaceOpen(t,s,i-1)||this.spaceOpen(t+1,s,i)&&this.spaceOpen(t,s,i-1)},S.prototype.spaceOpen=function(e,t,s){for(var i=this.tiles.length-1;i>=0;--i){var n=this.tiles[i];if(!n.fader&&n.cx==e&&n.cy==t&&n.cz==s)return!1}return!0},S.prototype.removeTile=function(e){this.removeTiles||(this.removeTiles=[]),this.removeTiles.push(e)},S.prototype.removePendingTiles=function(){if(this.removeTiles&&0!==this.removeTiles.length){for(var e=this.removeTiles.length-1;e>=0;--e){var t=this.removeTiles[e];if(!(t.children.length>0)){var s=this.tiles.indexOf(t);-1!=s&&(t.destroy(),this.tiles.splice(s,1)),this.removeTiles.splice(e,1)}}A.eventChangeAdOnMatch&&A.arenaHelper.handleEventChange(),this.reSort()}},S.prototype.fadeTile=function(e,t){M.effects.add(y.REMOVE_TILE,e,"gameAtlas",0,0),e.addFader(-0.1,1,t,this,e,-.5),this.reSort()},S.prototype.resetPuzzle=function(e,t){for(var s=this.puzzleLayout.layer,i=0;i<s.length;i++)for(var n=s[i].row,a=0;a<n.length;a++)for(var o=n[a],r=0;r<o.length;r++)o.charAt(r)==t&&(o=this.puzzleLayout.layer[i].row[a]=L.replaceAt(o,r,e))},S.prototype.addTileToPuzzle=function(e,t,s,i,n){var a,o,r;do a=Math.floor(Math.random()*s._x),o=Math.floor(Math.random()*s._z),r=Math.floor(Math.random()*s._y);while(s.layer[o].row[r].charAt(a)!==i);this.tiles.push(new k(this,this.managers,a-(s._x-1)/2,-(s._z-1-o),r-(s._y-1)/2,e,t)),s.layer[o].row[r]=L.replaceAt(s.layer[o].row[r],a,n)},S.prototype.matchingPair=function(e,t){for(var s=t.length-1;s>=0;--s)if(t[s].symbol==e.symbol)return!0;return!1},S.prototype.puzzleLocked=function(){for(var e=[],t=this.tiles.length;--t>=0;){var s=this.tiles[t];if(this.tileOpen(s)){if(this.matchingPair(s,e))return!1;e.push(s)}}return!0},S.prototype.finished=function(e){if(!this.tiles||0===this.tiles.length)return!0;if(e){for(var t=this.tiles.length-1;t>=0;--t)if(!this.tiles[t].fader)return!1;return!0}return!1},S.prototype.reshuffle=function(){for(var e=1e3,t=this.tiles.length;e-->0;){var s=Math.floor(Math.random()*t),i=Math.floor(Math.random()*t);if(s!=i){var n=this.tiles[s].clone();this.tiles[i].copyLocation(n),this.tiles[s].copyLocation(this.tiles[i]),this.tiles[s].destroy(),this.tiles[s]=this.tiles[i].clone(),this.tiles[i].destroy(),this.tiles[i]=n}}A.debug&&console.log("Puzzle pieces reshuffled"),this.setTargetAngle(this.targetAngle,!0)},S.prototype.highestTile=function(){for(var e=null,t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.fader||s.tornadoRemove||(!e||s.cy<e.cy&&e.tz>s.tz)&&(e=s)}return e},S.prototype.tornado=function(){if(this.setTargetAngle(this.angle+S.turnSpeed),!this.lastTornadoPiece||A.time-this.lastTornadoPiece>100){this.lastTornadoPiece=A.time;var e=this.highestTile();e&&(A.suppressBigAnimations?e.cy=-100:e.tornadoRemove=!0)}for(var t=this.tiles.length-1;t>=0;--t){var s=this.tiles[t];s.tornadoRemove&&(s.cy-=.2),s.cy<-13&&(s.destroy(),this.tiles.splice(t,1))}0===this.tiles.length&&(this.tornadoRemove=!1)},S.prototype.contains=function(e){var t=this.getBounds();return t.contains(e.x,e.y)},T.GameStates={NONE:-1,PRELOAD:0,TITLES:1,PLAY:2},T.pageHidden=!1,T.prototype.create=function(){A.debug&&window.addEventListener("message",function(e){console.log("message: "+e.data)},!1),this.preloader=new x(A.arenaHelper.getAbsoluteURL("")),this.preloader.preload(this,A.lowResolutionAssets),this.lastState=T.GameStates.NONE,this.state=T.GameStates.PRELOAD,this.titles=null,this.game=null,this.bm=null},T.prototype.update=function(){var t;do{t=!1;var s=this.lastState!=this.state;switch(this.lastState=this.state,A.debug&&s&&console.log("GameControl.state changed to",this.state),this.state){case T.GameStates.PRELOAD:if(this.preloader.update(),this.preloader.allLoaded()){this.state=T.GameStates.TITLES;var i=new MobileDetect(window.navigator.userAgent),n="pc";i.phone()?n="phone":i.tablet()&&(n="tablet");var a=A.config.includeAnalytics?[{type:D.Providers.GOOGLE,appId:A.config.googleAnalyticsId},{type:D.Providers.APPINSIGHTS,appId:A.config.appInsightsId}]:[],o={arena:{name:A.arenaHelper.getArenaName(),domain:A.arenaHelper.getArenaDomain()},device:n,version:A.VERSION,providers:a,googleAnalyticsSampleRate:A.config.googleAnalyticsSampleRate||10};
A.analyticsHelper=new B(o),L.focusChangeCallback=this.onFocusChange,L.focusChangeContext=this,L.detectHidden(),T.pageHidden=L.isHidden(),this.preloader.loadManager.loadGameStatus(),t=!0}break;case T.GameStates.TITLES:s&&(I.create(),e.clearCallbacks(),this.resetInput(),A.showTitleScreenOnStart?(this.titles=new P,this.titles.create(this.preloader)):this.state=T.GameStates.PLAY,this.preloader.audioManager.stopTune(),A.gameAutotestingManager.initTestingEnvironment()),this.preloader.audioManager.update(),this.titles.update()||(this.titles.destroy(),this.titles=null,this.state=T.GameStates.PLAY);break;case T.GameStates.PLAY:s&&(A.arenaHelper.handleGameStart(),A.arenaHelper.handleLevelStart(),this.resetInput(),this.game=new M,this.game.create(this.preloader.getManagers(),this.preloader.levels)),this.preloader.audioManager.update(),this.game.update()||(this.game.destroy(),this.game=null,this.state=T.GameStates.TITLES)}}while(t);A.mouseDown&&A.getFocus(),A.render()},T.prototype.resetInput=function(){I.reset(),A.resetInput()},T.prototype.onFocusChange=function(e){e||A.getFocus(),(A.pauseOnFocusLoss||(this.preloader.audioManager.visibilityMute(e),PIXI.utils.isMobile.any))&&(e?(this.bm&&this.bm.removing&&(this.bm.destroy(),this.bm=null),!this.bm&&this.game&&(this.bm=new o,this.bm.create(A.fullUI,this.preloader.getManagers(),"click_to_continue_string"))):(this.bm&&this.bm.remove(this,"bm")&&(A.mouseDown=null,A.mouseUp=null),M.paused=null!==M.options),A.time=1e3*Math.floor(A.time/1e3)+999,this.preloader.audioManager.visibilityMute(e),A.debug&&console.log("GameControl.onFocusChange hidden =",e,"at time =",Date.now()))},A.timeStarted=Date.now(),A.timeStartLevelMs=0,A.HTMLElement=null,A.prototype.createGame=function(t,s,i){new e;var n=window?window.devicePixelRatio:1;n=Math.min(2,n),A.app=new PIXI.Application(t||A.gameWide,s||A.gameHigh,{autoResize:!0,resolution:n}),A.renderer=A.app.renderer,A.gameAutotestingManager=new U,A.gameAutotestingManager.init(A.arenaHelper),A.debug&&(A.renderer instanceof PIXI.CanvasRenderer?(console.log("PIXI using Canvas Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")):(console.log("PIXI using WebGl Renderer"),PIXI.utils.isMobile.any&&console.log("Mobile device")));var a=null;null!==i&&(a=document.getElementById(i)),A.HTMLElement=a,a?a.appendChild(A.app.view):document.body.appendChild(A.app.view),A.getFocus(),A.suppressBigAnimations=A.renderer instanceof PIXI.CanvasRenderer?!0:!1,A.debug&&console.log("Main.suppressBigAnimations =",A.suppressBigAnimations),A.isAndroid=PIXI.utils.isMobile.android.phone||PIXI.utils.isMobile.android.seven_inch||PIXI.utils.isMobile.android.tablet,A.debug&&console.log("Main.android device =",A.isAndroid),A.isChromeMobile=A.isAndroid,A.debug&&console.log("Main.isChromeMobile =",A.isChromeMobile),A.stage=A.app.stage,A.stage.x=A.gameWide/2,A.stage.y=A.gameHigh/2,A.background=new PIXI.Sprite,A.background.anchor.set(.5),A.stage.addChild(A.background),A.centerpiece=new PIXI.Sprite,A.centerpiece.anchor.set(.5),A.stage.addChild(A.centerpiece),A.puzzle=new PIXI.Sprite,A.puzzle.anchor.set(.5,.5),A.stage.addChild(A.puzzle),A.bottomUI=new PIXI.Sprite,A.bottomUI.anchor.set(.5,1),A.stage.addChild(A.bottomUI),A.rightUI=new PIXI.Sprite,A.rightUI.anchor.set(.5),A.stage.addChild(A.rightUI),A.topUI=new PIXI.Sprite,A.topUI.anchor.set(.5,0),A.stage.addChild(A.topUI),A.fullUI=new PIXI.Sprite,A.fullUI.anchor.set(.5,.5),A.fullUIScale=1,A.stage.addChild(A.fullUI),e.resizeCanvas(),e.pixiListeners(A.renderer),A.nowTime=Date.now(),A.time=0,A.repeatedGamesLeft=A.playAgainCount,this.gameControl=new T,this.gameControl.create(),new m(["mjd_font1","mjd_font2","mjd_font3"],this.playGame,this)},A.prototype.playGame=function(){A.debug&&console.log("starting game loop");var t=null;A.showFPS&&(t=new Stats,t.showPanel(0),document.body.appendChild(t.dom));var s=this;e.resizeCanvas();var i=function(){A._lastTime=A.nowTime,A.nowTime=Date.now(),A.elapsedTime=Math.min(A.nowTime-A._lastTime,50),A.time+=A.elapsedTime,requestAnimationFrame(i),t&&t.begin(),s.gameControl.update(),A.resizeConsumed&&(A.resized=!1,A.resizeConsumed=!1),e.resizeCanvas(),t&&t.end()};requestAnimationFrame(i)},A.createTextStyles=function(e){var t=e.get("text_styles");A.textStyleBold=A.wrapTextStyle(t.textStyleBold),A.textStyleBoldHugeCentered=A.wrapTextStyle(t.textStyleBoldHugeCentered),A.textStyleBoldButtons=A.wrapTextStyle(t.textStyleBoldButtons),A.textStyleBoldButtonsLarge=A.wrapTextStyle(t.textStyleBoldButtonsLarge),A.textStyleBoldButtonTitles=A.wrapTextStyle(t.textStyleBoldButtonTitles),A.textStyleBoldLargeCentered=A.wrapTextStyle(t.textStyleBoldLargeCentered),A.textStyleMedium=A.wrapTextStyle(t.textStyleMedium),A.textStyleMedium2=A.wrapTextStyle(t.textStyleMedium2),A.textStyleMediumTiny=A.wrapTextStyle(t.textStyleMediumTiny),A.textStyleVersionTiny=A.wrapTextStyle(t.textStyleVersionTiny),A.textStyleLarge=A.wrapTextStyle(t.textStyleLarge),A.textStyleSemiBold=A.wrapTextStyle(t.textStyleSemiBold),A.textStyleSemiBold2=A.wrapTextStyle(t.textStyleSemiBold2)},A.wrapTextStyle=function(e){var t=new PIXI.TextStyle;return L.setValuesFromObject(t,e),t},A.render=function(){A.renderer.render(A.stage),!A.HTMLElement||A.HTMLElement.clientWidth==A.width&&A.HTMLElement.clientHeight==A.height||e.resizeCanvas()},A.resetInput=function(){e.resetInput(),A.click=null,A.hover=null,A.mouseDown=null,A.mouseUp=null,A.swipe=0},A.getFocus=function(){A.app&&A.app.view&&(A.debug&&console.log("Main.getFocus - grab keyboard focus"),A.grabFocusOnStart&&(A.app.view.setAttribute("tabindex","0"),A.app.view.focus()),window.focus()),I.create()},A.number2StringWithSeparator=function(e,t,s,i){var n=e.toString().split("."),a=n[0];parseInt(n[1])>99&&(n[1]=Math.floor(parseInt(n[1].substr(0,2))));var o=n.length>1?i+n[1]:"";t?(""==o&&(o=i+"00"),o.length>0&&o.length<3&&(o+="0")):o="";for(var r=/(\d+)(\d{3})/;r.test(a);)a=a.replace(r,"$1"+s+"$2");return a+o},P.ready=!1;var z=400,G=50;P.pieces=[{atlas:"introAtlas",key:"logo_panel",x:0,y:-90,alpha:0,fade:.05},{atlas:"introAtlas",key:"logo_tiles",x:0,y:-131,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:z+4*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_m",x:-216,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+0*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_a",x:-161,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+1*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_h",x:-109,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+2*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_j",x:-60,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+3*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_n",x:67,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+5*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:128,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+6*G,easing:"bounce"}},{atlas:"introAtlas",key:"letter_g",x:190,y:-122,tween:{from:{scaleFactor:.25},to:{scaleFactor:.95},duration:z+7*G,easing:"bounce"}},{atlas:"introAtlas",key:"logo_dimensions",x:-10,y:-28,tween:{from:{scaleFactor:.25},to:{scaleFactor:1},duration:z+8*G,easing:"bounce"}},{atlas:"introAtlas",key:"play-button",x:4,y:130,button:{over:"play-button-rollover",down:"play-button-down",clickEvent:"click_start",text:"new_game_start_button_string",sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){P.ready=!0},duration:z+8*G,easing:"bounce"}}],P.prototype.create=function(t){if(P.ready=!1,this.preloader=t,this.managers=this.preloader.getManagers(),this.bg=new n,this.bg.create(A.background,"introAtlas","title_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=A.height/2/this.bg.parent.scale.y,this.logoArkadium=new n,this.logoArkadium.create(A.bottomUI,"introAtlas","logo_arkadium",this.managers.textures,-.505,-.505,!0),this.logoArkadium.visible=A.config.showArkadiumLogo,A.fullUIScale=1.6,A.forceResize=!0,A.config.showCallToActionOnMobile){var s=new MobileDetect(window.navigator.userAgent);s.phone()&&P.pieces.push({atlas:"introAtlas",key:"android_download_up",x:-120,y:230,button:{over:"android_download_over",down:"android_download_down",clickEvent:function(){var e=A.config.mobileAppLink;setTimeout(function(){window.open(e,"_blank").focus()},250)},sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){P.ready=!0},duration:z+8*G,easing:"bounce"}},{atlas:"introAtlas",key:"ios_download_up",x:116,y:230,button:{over:"ios_download_over",down:"ios_download_down",clickEvent:function(){var e=A.config.mobileAppLink;setTimeout(function(){window.open(e,"_blank").focus()},250)},sfx:"snd_clickPlay",sfxHover:"snd_rollOver"},tween:{from:{scaleFactor:.15},to:{scaleFactor:.9*.8},finish:function(){P.ready=!0},duration:z+8*G,easing:"bounce"}})}var i=b.createTweens(P.pieces,A.fullUI,this.managers,0,0,A.textStyleBoldButtonTitles);this.sprites=i.sprites,this.buttons=i.buttons,e.registerCallback("mousedown",this.startTune,{context:this}),this.fader=new f,this.fader.setFade(.1),A.debug&&console.log("titles are fading in"),A.eventChangeAdOnTitlesShow&&A.arenaHelper.handleEventChange(),A.analyticsHelper.analytic&&A.analyticsHelper.analytic.startButtonImpression(),A.analyticsHelper.analytic&&A.analyticsHelper.analytic.introPanelShowed()},P.prototype.startTune=function(){e.clearCallback("mousedown",this.startTune),A.debug&&console.log("Titles.startTune"),this.managers&&this.managers.audio&&(this.managers.audio.sfxLoaded()||(A.debug&&console.log("retry loadAudioAssets from input gesture"),this.preloader.loadAudioAssets()),A.debug&&console.log("play the tune..."),this.managers.audio.startTune("game_tune"))},P.prototype.destroy=function(){var e;if(A.fullUIScale=1,A.forceResize=!0,this.logoArkadium&&(this.logoArkadium.destroy(),this.logoArkadium=null),this.version&&(this.version.destroy(),this.version=null),this.bg&&(this.bg.destroy(),this.bg=null),this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}this.fader&&(this.fader.destroy(),this.fader=null),this.managers=null},P.prototype.update=function(){var e,t="";if(!this.fader.fading()&&this.fader.reached(0))return!1;if(this.bg.alpha=this.fader.fadeValue,this.bg.y=A.config.centerBackground&&A.width>A.height?this.bg.height/2:A.height/2/this.bg.parent.scale.y,this.bg.update(),this.sprites)for(e=0;e<this.sprites.length;e++)this.sprites[e].update();if(this.buttons&&P.ready)for(e=0;e<this.buttons.length;e++){var s=this.buttons[e];if(t=s.update(),null!==t)break}return this.logoArkadium&&(this.logoArkadium.alpha=this.fader.fadeValue,this.logoArkadium.update()),this.version&&this.version.update(),this.fader.reached(1)&&(0!==A.eventChangeAdOnIdle&&(A.idleTimer-=A.elapsedTime,A.idleTimer<0&&(A.arenaHelper.handleEventChange(),A.idleTimer=Number.MAX_VALUE)),("click_start"==t||I.isPressed[32])&&(A.analyticsHelper.analytic&&A.analyticsHelper.analytic.startButtonClick(),A.analyticsHelper.analytic&&A.analyticsHelper.analytic.gamePanelShowed(),A.idleTimer=A.eventChangeAdOnIdle,A.hover=null,A.click=null,I.reset(32),this.fader.setFade(-.05),A.eventChangeAdOnTitlesClose&&A.arenaHelper.handleEventChange(),A.debug&&console.log("Titles: start fading out"))),!0},M.frameCount=0,M.paused=!1,M.requestQuit=!1,M.effects=null,M.score=0,M.highScore=0,M.timeLeft=0,M.options=null,M.levelMatches=0,M.STARTING=0,M.PLAYING=1,M.WON_LEVEL=2,M.FINAL_MESSAGE=3,M.NEXT_LEVEL=4,M.TIME_UP=5,M.NO_MOVES=6,M.GAME_WON=7,M.WAIT_DELAY=8,M.QUIT_REQUEST=9,M.REMOVE_MSG_QUIT=10,M.WAIT_FOR_GAME_END=11,M.prototype.create=function(e,t){this.managers=e,this.numLevels=t,M.paused=!1,M.requestQuit=!1,M.score=0,M.levelMatches=0,M.timeLeft=A.timerStart,M.effects=new y,M.effects.create(this.managers.textures),this.level=0,this.help=null,this.confirm=null,this.bm=null,this.state=M.PLAYING,this.nextState=-1,this.delay=0,this.won=!1,A.arenaHelper.init(M.pauseGame.bind(this),M.resumeGame.bind(this)),A.config.startRoundSoundEnabled&&this.managers.audio.play("snd_startSting"),A.showHelp&&this.showHelp(!0)},M.prototype.destroy=function(){this.bm&&(this.bm.destroy(),this.bm=null),this.world&&(this.world.destroy(),this.world=null),this.help&&(this.help.destroy(),this.help=null),this.confirm&&(this.confirm.destroy(),this.confirm=null),M.effects&&(M.effects.destroy(),M.effects=null),M.options&&(M.options.destroy(),M.options=null),this.managers=null},M.prototype.update=function(){var e=!0;if(M.frameCount++,this.confirm){if(this.confirm.update())return e;this.confirm.destroy(),this.confirm=null}if(this.help){if(this.help.update())return e;var t=this;this.help.remove(function(){t.help=null})}if(M.paused&&M.options)return M.options.update()?e:(M.options.remove(M.optionsDestroyed),e);M.requestQuit&&(M.requestQuit=!1,this.state=M.QUIT_REQUEST),A.puzzle.alpha<1&&(A.puzzle.alpha+=.2);var s,i=this.managers.locale.get("number_delimiter_string"),n=this.managers.locale.get("number_decimal_string");do{s=!1;var a=this.lastState!=this.state;switch(this.lastState=this.state,this.state){case M.PLAYING:if(a){var r=Math.min(this.level+1,this.numLevels);A.analyticsHelper.analytic&&A.analyticsHelper.analytic.levelStart(r),A.timeStartLevelMs=Date.now(),this.world=new E(this),this.world.create(this.managers,this.level),M.levelMatches=0,A.idleTimer=A.eventChangeAdOnIdle}this.world.update()?0!==A.eventChangeAdOnIdle&&(A.idleTimer-=A.elapsedTime,A.idleTimer<0&&(A.arenaHelper.handleEventChange(),A.idleTimer=Number.MAX_VALUE)):this.state=this.world.levelBeaten()?M.WON_LEVEL:this.world.timeUp()?M.TIME_UP:M.NO_MOVES;break;case M.WON_LEVEL:if(a){this.managers.audio.play(["snd_specialEndSting","snd_endSting"],!0);var l=(new Date).getTime(),h=Math.round((l-A.timeStartLevelMs)/1e3),r=Math.min(this.level+1,this.numLevels);A.analyticsHelper.analytic&&A.analyticsHelper.analytic.levelEndFinished(r,h);var c=this.world.getLevelBonus();M.score+=c,A.arenaHelper.handleLevelComplete(M.score);var u=c>0?"+"+A.number2StringWithSeparator(c,!1,i,n):"",d=this.managers.locale.get("gvp_level_good_job_text_string")+"\n"+u;this.bm=new o,this.bm.create(A.fullUI,this.managers,d),this.bm.timeOut=1e3}this.world&&this.world.updateScore(),this.bm.update()||(this.state=M.NEXT_LEVEL,1===this.level&&0===A.repeatedGamesLeft&&A.playMidRollAd&&A.arenaHelper.handleMidrollRequest());break;case M.NEXT_LEVEL:if(a){if(A.arenaHelper.handleLevelStart(),this.level++,this.level>this.numLevels-1){this.state=M.GAME_WON,this.won=!0,s=!0;break}this.world.destroy(),this.state=M.PLAYING,s=!0}break;case M.TIME_UP:this.managers.audio.play("snd_timeUp");var r=Math.min(this.level+1,this.numLevels),p=Date.now(),h=Math.round((p-A.timeStartLevelMs)/1e3),g=Math.round((p-A.timeStarted)/1e3);A.analyticsHelper.analytic&&(A.analyticsHelper.analytic.levelEndNotFinished(r,h),A.analyticsHelper.analytic.gameOverPanelShowed(),A.analyticsHelper.analytic.gameEndTimeOut(M.score,r,g)),this.bm=new o,M.score>M.highScore&&(M.highScore=M.score);var m="";A.config.customGameEnd?(m=A.config.customGameEnd.timeUpMessage,m=m.replace("%SCORE%",A.number2StringWithSeparator(M.score,!1,i,n))):m=this.managers.locale.get("gvp_level_times_up_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.number2StringWithSeparator(M.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.number2StringWithSeparator(M.highScore,!1,i,n),this.bm.create(A.fullUI,this.managers,m),A.config.customGameEnd&&A.config.customGameEnd.promoLink&&this.bm.addPromoLink(A.config.customGameEnd.promoLink),(A.repeatedGamesLeft>0||A.showQuitButtonAtGameEnd)&&this.bm.addButton("play_again_string"),this.world.puzzle.tornadoRemove=!0,this.state=M.FINAL_MESSAGE;break;case M.NO_MOVES:this.managers.audio.play("snd_error2"),this.bm=new o,M.score>M.highScore&&(M.highScore=M.score);var f="";A.config.customGameEnd?(f=A.config.customGameEnd.noMovesMessage,f=f.replace("%SCORE%",A.number2StringWithSeparator(M.score,!1,i,n))):f=this.managers.locale.get("gvp_level_no_more_move_text_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.number2StringWithSeparator(M.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.number2StringWithSeparator(M.highScore,!1,i,n),this.bm.create(A.fullUI,this.managers,f),A.config.customGameEnd&&A.config.customGameEnd.promoLink&&this.bm.addPromoLink(A.config.customGameEnd.promoLink),(A.repeatedGamesLeft>0||A.showQuitButtonAtGameEnd)&&this.bm.addButton("play_again_string"),this.world.puzzle.tornadoRemove=!0,this.state=M.FINAL_MESSAGE;break;case M.GAME_WON:this.managers.audio.play("snd_gameComplete"),this.bm=new o,M.score>M.highScore&&(M.highScore=M.score);var y="";A.config.customGameEnd?(y=A.config.customGameEnd.winMessage,y=y.replace("%SCORE%",A.number2StringWithSeparator(M.score,!1,i,n))):y=this.managers.locale.get("game_over_win_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.number2StringWithSeparator(M.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.number2StringWithSeparator(M.highScore,!1,i,n),this.bm.create(A.fullUI,this.managers,y),A.config.customGameEnd&&A.config.customGameEnd.promoLink&&this.bm.addPromoLink(A.config.customGameEnd.promoLink),(A.repeatedGamesLeft>0||A.showQuitButtonAtGameEnd)&&this.bm.addButton("play_again_string"),this.state=M.FINAL_MESSAGE;break;case M.QUIT_REQUEST:if(a){this.bm=new o,M.score>M.highScore&&(M.highScore=M.score);var v="";A.config.customGameEnd?(v=A.config.customGameEnd.quitMessage,v=v.replace("%SCORE%",A.number2StringWithSeparator(M.score,!1,i,n))):v=this.managers.locale.get("game_over_lose_header_string")+"\n"+this.managers.locale.get("gvp_level_score_indication_text_string")+" "+A.number2StringWithSeparator(M.score,!1,i,n)+"\n"+this.managers.locale.get("gvp_high_score_indication_text_string")+" "+A.number2StringWithSeparator(M.highScore,!1,i,n),this.bm.create(A.fullUI,this.managers,v),A.config.customGameEnd&&A.config.customGameEnd.promoLink&&this.bm.addPromoLink(A.config.customGameEnd.promoLink),(A.repeatedGamesLeft>0||A.showQuitButtonAtGameEnd)&&this.bm.addButton("play_again_string"),this.world.puzzle.tornadoRemove=!0,this.state=M.FINAL_MESSAGE}break;case M.FINAL_MESSAGE:if(a){var r=Math.min(this.level+1,this.numLevels),g=Math.round((Date.now()-A.timeStarted)/1e3);this.bm.timeOut=5e3,A.config.timeOutAtGameEnd===!1&&(this.bm.removeAtTimeOut=!1),this.won&&A.analyticsHelper.analytic&&A.analyticsHelper.analytic.gameEndWin(M.score,r,g),A.analyticsHelper.analytic&&!A.quitConfirmed&&A.analyticsHelper.analytic.gameOverPanelShowed()}this.world&&this.world.puzzle.tornadoRemove&&this.world.puzzle.update(),this.bm.update()||(this.bm.destroy(),this.bm=null,this.delay=A.repeatedGamesLeft>0?100:4e3,this.state=M.WAIT_DELAY,this.nextState=M.REMOVE_MSG_QUIT);break;case M.WAIT_DELAY:this.world&&(this.world.updateScore(),this.world.puzzle.tornadoRemove&&this.world.puzzle.update()),this.delay=Math.max(this.delay-A.elapsedTime,0),0===this.delay?(this.state=this.nextState,s=!0):this.bm&&this.bm.update();break;case M.REMOVE_MSG_QUIT:a&&this.bm&&this.bm.remove(this,"bm"),this.managers.audio.stopTune(),this.bm?this.bm.update()||(this.bm=null):A.repeatedGamesLeft>0&&(A.arenaHelper.handleGameEnd(M.score),this.state=M.WAIT_FOR_GAME_END,A.arenaHelper.shouldShowInternalGameEnd()&&(this.world.destroy(),e=!1))}}while(s);return M.effects.update(),e},M.prototype.showHelp=function(e){this.help=new l,this.help.create(this.managers,e)},M.prototype.showConfirm=function(e,t,s,i){this.confirm=new r,this.confirm.create(this,this.managers,e,t,s,i)},M.prototype.pauseToggle=function(){M.paused=!M.paused,A.debug&&console.log(M.paused?"Game.pauseToggle to true":"Game.pauseToggle to false"),M.paused?(M.options=new u,M.options.create(this,this.managers)):M.options&&(M.options.destroy(),M.options=null)},M.pauseGame=function(){A.debug&&console.log("Game.pauseGame"),this.managers.audio.visibilityMute(!0),M.paused=!0},M.resumeGame=function(){A.debug&&console.log("Game.resumeGame"),this.managers.audio.visibilityMute(!1),M.paused=null!==M.options},M.optionsDestroyed=function(){M.options=null,M.paused=!1},E.brighter=null,E.brighter2=null,E.prototype.create=function(e,t){this.managers=e,A.swipeEnabled=!0,E.SelectionPreviewX=504,E.SelectionPreviewY=206,E.SelectionPreviewBotY=216,E.brighter=new PIXI.filters.ColorMatrixFilter,E.brighter.brightness(1.5,!0),E.brighter2=new PIXI.filters.ColorMatrixFilter,E.brighter2.brightness(1.2,!0),this.bg=new n,this.bg.create(A.background,"gameAtlas","game_bg",this.managers.textures),this.bg.anchor.set(.5,1),this.bg.y=A.height/2/this.bg.parent.scale.y;var s=this.managers.data.get("level"+(t+1).toString());A.config.showCenterpiece&&(this.centerpiece=new n,this.centerpiece.scale.x=parseFloat(s.ignoreMeContainer.levels.level.nCenterpieceScaleX),this.centerpiece.scale.y=.4,A.centerpiece.addChild(this.centerpiece),this.centerpieceObj=new n,this.centerpieceObj.create(this.centerpiece,"gameAtlas","centerpiece",this.managers.textures),this.centerpieceObj.anchor.set(.5,.5)),this.icons=[],this.buttons=[],this.sprites=[],this.texts=[],this.puzzle=new S,this.puzzle.create(this,this.managers,s,this.managers.data.get("level1"),this.centerpieceObj),this.puzzle.setTargetAngle(30*Math.PI/180,!0),this.puzzle.adjustTargetAngle(90*Math.PI/180),this.puzzleInput=new d,this.puzzleInput.create(this.managers,this.puzzle),this._createUI(),A.resized=!0,A.resizeConsumed=!1,this.lastMatchTime=-1,this.lastMatchType=-1,this.ignoreClick=null,this.reshuffled=!1,this.bm=null},E.prototype.destroy=function(){this.managers=null,this.bg&&(this.bg.destroy(),this.bg=null);var e;if(this.buttons){for(e=0;e<this.buttons.length;e++)this.buttons[e].destroy();this.buttons=null}if(this.icons){for(e=0;e<this.icons.length;e++)this.icons[e].destroy();this.icons=null}if(this.sprites){for(e=0;e<this.sprites.length;e++)this.sprites[e].destroy();this.sprites=null}if(this.texts){for(e=0;e<this.texts.length;e++)this.texts[e].destroy();this.texts=null}this.puzzleInput&&(this.puzzleInput.destroy(),this.puzzleInput=null),this.puzzle&&(this.puzzle.destroy(),this.puzzle=null),this.centerpieceObj&&(this.centerpieceObj.destroy(),this.centerpieceObj=null),this.centerpiece&&(this.centerpiece.destroy(),this.centerpiece=null),E.brighter=null,E.brighter2=null,this.bm&&(this.bm.destroy(),this.bm=null),this.container1&&(this.container1.destroy(),this.container1=null),this.container2&&(this.container2.destroy(),this.container2=null),this.reshuffleBtn=null,this.ignoreClick=null,this.game=null},E.prototype.update=function(){if(this._background(),this._userInput(),this.puzzle){if(!this._timerUpdate())return!1;if(!this._finishedOrStuck())return!1}var e=!this.puzzle.finished(!1);return this.container1&&this.container1.update(),this.container2&&this.container2.update(),this._userInterface()?!0:e},E.prototype.levelBeaten=function(){return this.puzzle?this.puzzle.finished(!1):!0},E.prototype.timeUp=function(){return M.timeLeft<=0},E.prototype.updateScore=function(){if(M.score>this.scoreText._visibleScore){var e=M.score-this.scoreText._visibleScore;e>25&&(e=Math.max(Math.floor(e/25),1)),this.scoreText._visibleScore+=e;var t=this.managers.locale.get("number_delimiter_string"),s=this.managers.locale.get("number_decimal_string");this.scoreText.text=A.number2StringWithSeparator(this.scoreText._visibleScore,!1,t,s)}},E.prototype._createUI=function(){var e=new h(h.TYPE_NOLATCH);e.create(A.topUI,"gameAtlas","pause_button",this.managers,516,63,!1,"pause_button","pause_button-rollover","pause_button-down","click_pause_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.buttons.push(e),A.showQuitButtonDuringGameplay&&(e=new h(h.TYPE_NOLATCH),e.create(A.topUI,"menuAtlas","quit",this.managers,573,63,!1,"quit","quit_rollover","quit-down","click_quit_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.75,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",e.hitAreaPercent=new PIXI.Point(.22,1),this.buttons.push(e)),e=new h(h.TYPE_BUTTON),e.create(A.topUI,"gameAtlas","reshuffle_button",this.managers,336,63,!1,"reshuffle_button","reshuffle_button-rollover","reshuffle_button-down","click_reshuffle_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=1.5,e.sfx="snd_clickPlay",e.sfxHover="snd_rollOver",this.reshuffleBtn=e,this.buttons.push(e);var t=new n;t.create(A.topUI,"gameAtlas","time icon",this.managers.textures,-540,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var s=new a("",A.textStyleSemiBold);s.create(A.topUI,-480,63,!1),s.anchor.y=.5,this.texts.push(s),this.timeText=s,t=new n,t.create(A.topUI,"gameAtlas","score icon",this.managers.textures,-150,63,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t);var i=this.managers.locale.get("number_delimiter_string"),o=this.managers.locale.get("number_decimal_string"),r=A.number2StringWithSeparator(M.score,!1,i,o);s=new a(r,A.textStyleSemiBold),s.create(A.topUI,-90,63,!1),s.anchor.y=.5,this.texts.push(s),this.scoreText=s,this.scoreText._visibleScore=M.score,this.managers.textures.get("gameAtlas","sponsorship-logo")&&(t=new n,t.create(A.topUI,"gameAtlas","sponsorship-logo",this.managers.textures,-490,E.SelectionPreviewY,!1),t.anchor.x=t.anchor.y=.5,t.scale.x=t.scale.y=1,this.icons.push(t)),e=new h(h.TYPE_BUTTON),e.create(A.bottomUI,"gameAtlas","arrow_lft",this.managers,-.43,.45,!0,"arrow_lft","arrow_lft-rollover","arrow_lft","click_left_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e),e=new h(h.TYPE_BUTTON),e.create(A.bottomUI,"gameAtlas","arrow_rgt",this.managers,.43,.45,!0,"arrow_rgt","arrow_rgt-rollover","arrow_rgt","click_right_event"),e.anchor.x=e.anchor.y=.5,e.scale.x=e.scale.y=.3,e.sfxHover="snd_rollOver",this.buttons.push(e);var l;l=new n,l.create(A.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=1.3,l.scale.y=1.2,l.alpha=.5,this.container1=l,l=new n,l.create(A.topUI,"gameAtlas","preview-tile-icon",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=1.3,l.scale.y=1.2,l.alpha=.5,this.container2=l,l=new n,l.create(A.topUI,null,"cube_s1_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.anchor.x=l.anchor.y=.5,l.scale.x=l.scale.y=k.scale/A.tileAssetScale,this.puzzleInput.createHoveredPiece(l),l=new n,l.create(A.topUI,null,"cube_s1_1",this.managers.textures,E.SelectionPreviewX,E.SelectionPreviewY,!1),l.y+=l.height,l.anchor.x=l.anchor.y=.5,l.scale.x=l.scale.y=k.scale/A.tileAssetScale,this.puzzleInput.createDroppedPiece(l),this.container1.visible=this.container2.visible=A.isPortrait?!1:!0,this.container2&&(this.container2.y=E.SelectionPreviewBotY=l.y)},E.prototype._timerUpdate=function(){if(this.bm)this.bm.update("bm");else if(!this.puzzle.tornadoRemove&&!M.paused){if(M.timeLeft-=A.elapsedTime,this.timeUp())return!1;var e=L.timeToString(M.timeLeft);this.timeText.text!=e&&(this.timeText.text=e),M.timeLeft/1e3<10&&(M.timeLeft%1e3<500?16711680!=this.timeText.tint&&(M.timeLeft/1e3<5&&this.managers.audio.play("snd_timerWarning"),this.timeText.tint=16711680):16777215!=this.timeText.tint&&(this.managers.audio.play("snd_timerWarning"),this.timeText.tint=16777215))}return!0},E.prototype._finishedOrStuck=function(){if((!this.puzzle.update()||A.testKeys&&I.isPressed[C.key_l])&&!this.puzzle.finished(!0)){if(this.reshuffled)return this.managers.audio.play(["snd_error1","snd_error2","snd_error3"]),!1;for(;this.puzzle.puzzleLocked()||A.testKeys&&I.isPressed[C.key_l];)I.isPressed[C.key_l]=!1,this._reshuffle()}return!0},E.prototype._background=function(){this.bg.y=A.config.centerBackground&&A.width>A.height?this.bg.height/2:A.height/2/this.bg.parent.scale.y,this.bg.update()},E.prototype._userInterface=function(){I.update(),this.container1.visible=this.container2.visible=A.isPortrait?!1:!0;for(var e,t=this.puzzleInput.update(),s=0;s<this.buttons.length&&(e=this.buttons[s].update(),null===e||void 0===e);s++);switch(e){case"click_pause_event":this.puzzleInput.removeHoverPiece(),this.game.pauseToggle();break;case"click_quit_event":this.game.showConfirm("quit_header_string",this,this.onYesQuit,this.onNoQuit);break;case"click_reshuffle_event":this._reshuffleClick();break;case"click_left_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(-90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),A.eventChangeAdOnRotate&&A.arenaHelper.handleEventChange();break;case"click_right_event":this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(90*Math.PI/180)&&this.managers.audio.play("snd_rotate"),A.eventChangeAdOnRotate&&A.arenaHelper.handleEventChange()}for(s=0;s<this.icons.length;s++)this.icons[s].update();for(s=0;s<this.sprites.length;s++)this.sprites[s].update();for(this.updateScore(),s=0;s<this.texts.length;s++)this.texts[s].update();return this.puzzleInput.showDropAndHoverPieces(),this.container1&&(this.container1.y=E.SelectionPreviewY),this.container2&&(this.container2.y=E.SelectionPreviewBotY),t},E.directions={left:0,right:1},E.prototype._turnCube=function(e){var t=E.directions.left===e?-90:90;this.puzzleInput.removeHoverPiece(),this.puzzle.adjustTargetAngle(t*Math.PI/180)&&(this.managers.audio.play("snd_rotate"),A.eventChangeAdOnRotate&&A.arenaHelper.handleEventChange()),A.swipe=0,A.idleTimer=A.eventChangeAdOnIdle,I.reset()},E.prototype._userInput=function(){if(!this.bm&&!this.puzzle.tornadoRemove){(A.swipe<0||I.isPressed[C.left_arrow]||I.isPressed[C.key_a]||I.isPressed[C.key_q])&&this._turnCube(E.directions.left),(A.swipe>0||I.isPressed[C.right_arrow]||I.isPressed[C.key_d]||I.isPressed[C.key_e])&&this._turnCube(E.directions.right);var t;if(null!==A.mouseDown||null!==A.click||null===A.hover||isNaN(A.hover.x)||isNaN(A.hover.y)||!this.puzzle.contains(A.hover)||(t=this.puzzle.tilePicker(A.hover.x,A.hover.y),A.hover=null,t?this.puzzleInput.showHoveredPiece(t):this.puzzleInput.removeHoverPiece()),null!==A.click){A.idleTimer=A.eventChangeAdOnIdle;var s=!1;this.ignoreClick&&L.distanceBetween(this.ignoreClick,A.click)<10&&M.frameCount-this.ignoreClick.when<30&&(s=!0),s||(t=this.puzzle.tilePicker(A.click.x,A.click.y),t&&this.puzzleInput.clickedPiece(t)),A.click=null,this.ignoreClick=null}null!==A.mouseDown&&(A.idleTimer=A.eventChangeAdOnIdle,t=this.puzzle.tilePicker(A.mouseDown.x,A.mouseDown.y),this.ignoreClick=A.mouseDown,this.ignoreClick.when=M.frameCount,t&&this.puzzleInput.clickedPiece(t)&&(A.mouseDown=null)),A.testKeys&&I.isPressed[C.key_r]&&this._reshuffleClick(),A.testKeys&&I.isPressed[C.key_t]&&(this.puzzle.tornadoRemove=!0),A.testKeys&&I.isPressed[C.key_x]&&(M.timeLeft=1),A.testKeys&&(I.isPressed[C.key_v]||A.mouseDown&&A.mouseDown.x<30&&A.mouseDown.y<30)&&e.debugWindowData()}},E.prototype.destroySprite=function(e){var t=this.sprites.indexOf(e);-1!==t&&this.sprites.splice(t,1),e.destroy()},E.prototype._reshuffle=function(){this.managers.audio.playDelayed(["snd_reshuffle2"],1.5),this.puzzle.reshuffle(),this.reshuffled=!0},E.prototype._reshuffleClick=function(){this.puzzleInput.removeHoverPiece(),!this.reshuffled&&this.reshuffleBtn.visible?(this.managers.audio.play("snd_reshuffle1"),this.bm=new o,this.bm.create(A.fullUI,this.managers,"gvp_level_reshuffle_text_string",this._reshuffle,this),this.bm.timeOut=2500,this.reshuffleBtn&&(this.reshuffleBtn.visible=!1)):this.managers.audio.play(["snd_error1","snd_error2","snd_error3"])},E.prototype.onYesQuit=function(){M.requestQuit=!0},E.prototype.onNoQuit=function(){},E.prototype.getLevelBonus=function(){return this.puzzle.levelBonusValues?this.puzzle.levelBonusValues[this.game.level]:0},A.debug&&console.time("Game create"),A.arenaHelper=new R,(new A).createGame(),A.debug&&console.timeEnd("Game create")
}();